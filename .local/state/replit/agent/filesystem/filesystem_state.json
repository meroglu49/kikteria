{"file_contents":{"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/game/HUD.tsx":{"content":"import React from 'react';\nimport { useGameStore } from '../../lib/store';\nimport { Bomb, Target, Coins, Clock, Layers, X, Shield, RotateCcw, Snowflake, Wand2 } from 'lucide-react';\n\nexport function HUD() {\n  const { \n    score, \n    figuresPlaced, \n    totalFigures, \n    bombsRemaining, \n    notification, \n    kikMessage,\n    placedFigures, \n    timeRemaining, \n    currentLevel, \n    currentLevelConfig,\n    bombTargetingMode,\n    toggleBombTargeting,\n    upgrades,\n    freezeCount,\n    cleanserCount,\n    isFrozen,\n    isLassoMode,\n    useFreeze,\n    toggleLassoMode,\n    isEndlessMode,\n    endlessWave,\n  } = useGameStore();\n\n  const handleBombClick = () => {\n    toggleBombTargeting();\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    const secsFormatted = secs.toFixed(1).padStart(4, '0');\n    return `${mins}:${secsFormatted}`;\n  };\n\n  const isLowTime = timeRemaining <= 10;\n\n  return (\n    <>\n      <div className=\"absolute left-0 top-0 bottom-0 w-24 bg-gradient-to-b from-muted to-background border-r-2 border-primary/30 flex flex-col items-center py-4 gap-4 z-30\">\n        <div className=\"block-panel px-3 py-3 flex flex-col items-center gap-1\">\n          <Coins size={24} className=\"text-secondary\" />\n          <span className=\"font-display text-xs coin-display\" data-testid=\"text-score\">\n            {score}\n          </span>\n        </div>\n        \n        <div className=\"block-panel px-3 py-3 flex flex-col items-center gap-1\">\n          <Target size={24} className={isEndlessMode ? 'text-purple-400' : 'text-primary'} />\n          <span className={`font-display text-xl ${isEndlessMode ? 'text-purple-400' : 'text-primary'} text-glow`} data-testid=\"text-remaining\">\n            {isEndlessMode ? 'âˆž' : Math.max(0, totalFigures - figuresPlaced)}\n          </span>\n          <span className=\"font-ui text-xs text-muted-foreground\">{isEndlessMode ? 'ENDLESS' : 'LEFT'}</span>\n        </div>\n        \n        <div className=\"block-panel px-3 py-3 flex flex-col items-center gap-1\">\n          <span className=\"font-ui text-sm text-muted-foreground\">BOARD</span>\n          <span className=\"font-display text-lg text-foreground\" data-testid=\"text-onboard\">\n            {placedFigures.length}\n          </span>\n        </div>\n        \n        <div className=\"flex-1\" />\n        \n        <div className=\"flex flex-col gap-2\">\n          <button\n            onClick={handleBombClick}\n            disabled={bombsRemaining <= 0}\n            className={`block-panel p-3 flex flex-col items-center gap-1 transition-all relative\n              ${bombTargetingMode \n                ? 'border-destructive shadow-[0_0_20px_rgba(255,68,68,0.6)] animate-pulse bg-destructive/20' \n                : bombsRemaining > 0 \n                  ? 'hover:border-destructive hover:shadow-[0_0_15px_rgba(255,68,68,0.3)] cursor-pointer' \n                  : 'opacity-50 cursor-not-allowed'\n              }`}\n            data-testid=\"button-use-bomb\"\n          >\n            {bombTargetingMode ? (\n              <>\n                <X size={28} className=\"text-destructive\" />\n                <span className=\"font-display text-xs text-destructive\">CANCEL</span>\n              </>\n            ) : (\n              <>\n                <Bomb size={28} className={bombsRemaining > 0 ? 'text-destructive' : 'text-muted-foreground'} />\n                <span className=\"font-display text-xs text-foreground\">{bombsRemaining}</span>\n              </>\n            )}\n          </button>\n          \n          <div \n            className={`block-panel p-2 flex flex-col items-center gap-1 ${upgrades.shield > 0 ? '' : 'opacity-50'}`}\n            data-testid=\"display-shield\"\n          >\n            <Shield size={20} className={upgrades.shield > 0 ? 'text-cyan-400' : 'text-muted-foreground'} />\n            <span className=\"font-display text-xs text-foreground\">x{upgrades.shield}</span>\n          </div>\n          \n          <div \n            className={`block-panel p-2 flex flex-col items-center gap-1 ${upgrades.secondChance > 0 ? '' : 'opacity-50'}`}\n            data-testid=\"display-second-chance\"\n          >\n            <RotateCcw size={20} className={upgrades.secondChance > 0 ? 'text-orange-400' : 'text-muted-foreground'} />\n            <span className=\"font-display text-xs text-foreground\">x{upgrades.secondChance}</span>\n          </div>\n          \n          <button\n            onClick={useFreeze}\n            disabled={freezeCount <= 0 || isFrozen}\n            className={`block-panel p-2 flex flex-col items-center gap-1 transition-all\n              ${isFrozen \n                ? 'border-blue-400 shadow-[0_0_15px_rgba(59,130,246,0.5)] bg-blue-500/20' \n                : freezeCount > 0 \n                  ? 'hover:border-blue-400 cursor-pointer' \n                  : 'opacity-50 cursor-not-allowed'\n              }`}\n            data-testid=\"button-freeze\"\n          >\n            <Snowflake size={20} className={freezeCount > 0 || isFrozen ? 'text-blue-400' : 'text-muted-foreground'} />\n            <span className=\"font-display text-xs text-foreground\">{isFrozen ? 'ON' : `x${freezeCount}`}</span>\n          </button>\n          \n          <button\n            onClick={toggleLassoMode}\n            disabled={cleanserCount <= 0 && !isLassoMode}\n            className={`block-panel p-2 flex flex-col items-center gap-1 transition-all\n              ${isLassoMode \n                ? 'border-purple-400 shadow-[0_0_15px_rgba(168,85,247,0.5)] bg-purple-500/20' \n                : cleanserCount > 0 \n                  ? 'hover:border-purple-400 cursor-pointer' \n                  : 'opacity-50 cursor-not-allowed'\n              }`}\n            data-testid=\"button-cleanser\"\n          >\n            <Wand2 size={20} className={cleanserCount > 0 || isLassoMode ? 'text-purple-400' : 'text-muted-foreground'} />\n            <span className=\"font-display text-xs text-foreground\">{isLassoMode ? 'DRAW' : `x${cleanserCount}`}</span>\n          </button>\n        </div>\n      </div>\n\n      <div className=\"absolute top-0 left-24 right-0 h-16 bg-gradient-to-r from-muted to-background border-b-2 border-primary/30 flex items-center justify-between px-4 z-30\">\n        <div className=\"block-panel px-4 py-2 flex items-center gap-2\">\n          <Layers size={20} className={isEndlessMode ? 'text-purple-400' : 'text-accent'} />\n          <div className=\"flex flex-col\">\n            <span className={`font-display text-xs ${isEndlessMode ? 'text-purple-400' : 'text-accent'}`} data-testid=\"text-level\">\n              {isEndlessMode ? `WAVE ${endlessWave}` : `LVL ${currentLevel}`}\n            </span>\n            <span className=\"font-ui text-xs text-muted-foreground\">\n              {isEndlessMode ? 'ENDLESS' : currentLevelConfig.name}\n            </span>\n          </div>\n        </div>\n        \n        <div className={`block-panel px-6 py-2 flex items-center gap-3 ${isLowTime ? 'border-destructive shadow-[0_0_20px_rgba(255,68,68,0.4)]' : ''}`}>\n          <Clock size={24} className={isLowTime ? 'text-destructive' : 'text-primary'} />\n          <span \n            className={`font-display text-xl ${isLowTime ? 'text-destructive animate-pulse' : 'text-primary text-glow'}`} \n            data-testid=\"text-timer\"\n          >\n            {formatTime(timeRemaining)}\n          </span>\n        </div>\n        \n        <div className=\"w-32\" />\n      </div>\n\n      {notification && (\n        <div \n          className=\"absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50\"\n          data-testid=\"notification-banner\"\n        >\n          <div className=\"block-panel px-8 py-4 border-2 border-secondary shadow-[0_0_30px_rgba(249,233,0,0.4)]\">\n            <span className=\"font-display text-lg text-secondary text-glow\">\n              {notification}\n            </span>\n          </div>\n        </div>\n      )}\n      \n      {bombTargetingMode && (\n        <div \n          className=\"absolute top-20 left-1/2 -translate-x-1/2 z-40\"\n          data-testid=\"targeting-mode-banner\"\n        >\n          <div className=\"block-panel px-6 py-2 border-2 border-destructive shadow-[0_0_20px_rgba(255,68,68,0.4)] bg-background/90\">\n            <span className=\"font-display text-sm text-destructive animate-pulse\">\n              CLICK TO DETONATE BOMB\n            </span>\n          </div>\n        </div>\n      )}\n      \n      {kikMessage && (\n        <div \n          className=\"absolute bottom-24 right-6 z-50 animate-in fade-in slide-in-from-right-3 duration-300\"\n          data-testid=\"kik-announcer\"\n        >\n          <div className=\"relative\">\n            <div className=\"block-panel px-4 py-2 border-2 border-accent bg-background/95 shadow-[0_0_20px_rgba(255,106,213,0.4)]\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"font-display text-xs text-accent\">K.I.K.</span>\n                <span className=\"font-ui text-sm text-foreground\">{kikMessage}</span>\n              </div>\n            </div>\n            <div className=\"absolute -bottom-1 right-4 w-3 h-3 bg-background border-b-2 border-r-2 border-accent transform rotate-45\" />\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","path":null,"size_bytes":9188,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@theme inline {\n  /* Retro Neon Palette - Deep & Vibrant */\n  --color-background: hsl(175 40% 8%); /* Deep midnight teal #0E1C1F */\n  --color-foreground: hsl(160 60% 90%); /* Light mint for text */\n  \n  --color-primary: hsl(156 90% 54%); /* Neon green #22F2A2 */\n  --color-primary-foreground: hsl(175 40% 8%);\n  \n  --color-secondary: hsl(52 95% 50%); /* Bright yellow #F9E900 */\n  --color-secondary-foreground: hsl(0 0% 0%);\n  \n  --color-accent: hsl(316 90% 70%); /* Neon pink #FF6AD5 */\n  --color-accent-foreground: hsl(0 0% 0%);\n  \n  --color-destructive: hsl(0 85% 60%); /* Bright red */\n  --color-destructive-foreground: hsl(0 0% 100%);\n  \n  --color-muted: hsl(175 30% 15%); /* Muted teal #123842 */\n  --color-muted-foreground: hsl(160 30% 60%);\n  \n  --color-card: hsl(175 35% 12%); /* Dark card bg */\n  --color-card-foreground: hsl(160 60% 90%);\n  \n  --color-popover: hsl(175 35% 14%);\n  --color-popover-foreground: hsl(160 60% 90%);\n  \n  --color-border: hsl(175 40% 25%);\n  --color-input: hsl(175 30% 18%);\n  --color-ring: hsl(156 90% 54%);\n\n  /* Retro Pixel Fonts */\n  --font-display: \"Press Start 2P\", monospace;\n  --font-ui: \"VT323\", monospace;\n  --font-sans: \"VT323\", monospace;\n  \n  /* Rounded corners for playful look */\n  --radius-sm: 4px;\n  --radius-md: 8px;\n  --radius-lg: 12px;\n}\n\n@layer base {\n  * {\n    border-color: var(--border);\n    box-sizing: border-box;\n  }\n  body {\n    background-color: var(--color-background);\n    color: var(--color-foreground);\n    font-family: var(--font-sans);\n    font-size: 18px;\n    min-height: 100vh;\n    min-height: 100dvh;\n  }\n  \n  .game-playing {\n    overflow: hidden;\n    touch-action: none;\n  }\n  \n  .scrollable-screen {\n    -webkit-overflow-scrolling: touch;\n    touch-action: pan-y;\n    overscroll-behavior: contain;\n  }\n  \n  h1, h2, h3, h4, h5, h6 {\n    font-family: var(--font-display);\n    text-transform: uppercase;\n    letter-spacing: 0.02em;\n  }\n\n  button {\n    font-family: var(--font-display);\n  }\n}\n\n@layer utilities {\n  .font-display { font-family: var(--font-display); }\n  .font-ui { font-family: var(--font-ui); font-size: 24px; }\n  \n  /* Retro pixel text shadow */\n  .text-shadow-pixel {\n    text-shadow: 2px 2px 0px rgba(0,0,0,0.5), 4px 4px 0px rgba(0,0,0,0.3);\n  }\n  \n  /* Neon glow text */\n  .text-glow {\n    text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 40px currentColor;\n  }\n  \n  /* Pixel border box */\n  .pixel-border {\n    border: 3px solid;\n    border-color: hsl(175 40% 30%) hsl(175 30% 15%) hsl(175 30% 15%) hsl(175 40% 30%);\n    border-radius: 8px;\n  }\n  \n  /* Dark panel style with glow */\n  .block-panel {\n    background: linear-gradient(180deg, hsl(175 35% 14%) 0%, hsl(175 40% 10%) 100%);\n    border: 2px solid hsl(175 40% 25%);\n    border-radius: 8px;\n    box-shadow: 0 0 20px rgba(34, 242, 162, 0.1), inset 0 1px 0 rgba(255,255,255,0.05);\n  }\n  \n  /* Retro button style with neon glow */\n  .pixel-btn {\n    background: linear-gradient(180deg, hsl(156 80% 45%) 0%, hsl(156 90% 35%) 100%);\n    border: 3px solid;\n    border-color: hsl(156 70% 55%) hsl(156 90% 20%) hsl(156 90% 20%) hsl(156 70% 55%);\n    color: #000;\n    font-weight: bold;\n    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n    border-radius: 6px;\n    box-shadow: 0 0 20px rgba(34, 242, 162, 0.3), 0 4px 0 hsl(156 90% 20%);\n  }\n  \n  .pixel-btn:hover {\n    transform: translateY(-2px);\n    background: linear-gradient(180deg, hsl(156 80% 50%) 0%, hsl(156 90% 40%) 100%);\n    box-shadow: 0 0 30px rgba(34, 242, 162, 0.5), 0 6px 0 hsl(156 90% 20%);\n  }\n  \n  .pixel-btn:active {\n    transform: translateY(2px);\n    box-shadow: 0 0 15px rgba(34, 242, 162, 0.3), 0 2px 0 hsl(156 90% 20%);\n  }\n  \n  /* Secondary button (yellow) */\n  .pixel-btn-secondary {\n    background: linear-gradient(180deg, hsl(52 95% 55%) 0%, hsl(52 95% 45%) 100%);\n    border: 3px solid;\n    border-color: hsl(52 90% 65%) hsl(52 95% 30%) hsl(52 95% 30%) hsl(52 90% 65%);\n    color: #000;\n    font-weight: bold;\n    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n    border-radius: 6px;\n    box-shadow: 0 0 20px rgba(249, 233, 0, 0.3), 0 4px 0 hsl(52 95% 30%);\n  }\n  \n  .pixel-btn-secondary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 0 30px rgba(249, 233, 0, 0.5), 0 6px 0 hsl(52 95% 30%);\n  }\n  \n  /* Accent button (pink) */\n  .pixel-btn-accent {\n    background: linear-gradient(180deg, hsl(316 90% 70%) 0%, hsl(316 90% 55%) 100%);\n    border: 3px solid;\n    border-color: hsl(316 80% 80%) hsl(316 90% 40%) hsl(316 90% 40%) hsl(316 80% 80%);\n    color: #000;\n    font-weight: bold;\n    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n    border-radius: 6px;\n    box-shadow: 0 0 20px rgba(255, 106, 213, 0.3), 0 4px 0 hsl(316 90% 40%);\n  }\n  \n  .pixel-btn-accent:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 0 30px rgba(255, 106, 213, 0.5), 0 6px 0 hsl(316 90% 40%);\n  }\n  \n  /* CRT scanline effect */\n  .scanlines::after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    background: repeating-linear-gradient(\n      0deg,\n      rgba(0, 0, 0, 0.15) 0px,\n      rgba(0, 0, 0, 0.15) 1px,\n      transparent 1px,\n      transparent 3px\n    );\n    pointer-events: none;\n  }\n  \n  /* CRT vignette effect */\n  .crt-vignette::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    background: radial-gradient(ellipse at center, transparent 0%, transparent 50%, rgba(0,0,0,0.4) 100%);\n    pointer-events: none;\n    z-index: 1;\n  }\n\n  /* Neon grid background */\n  .grid-bg {\n    background-image: \n      linear-gradient(rgba(34, 242, 162, 0.08) 1px, transparent 1px),\n      linear-gradient(90deg, rgba(34, 242, 162, 0.08) 1px, transparent 1px);\n    background-size: 40px 40px;\n  }\n\n  /* Floating animation */\n  @keyframes float {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-8px); }\n  }\n  .animate-float {\n    animation: float 3s ease-in-out infinite;\n  }\n\n  /* Pulse scale animation */\n  @keyframes pulse-scale {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.03); }\n  }\n  .animate-pulse-scale {\n    animation: pulse-scale 2s ease-in-out infinite;\n  }\n  \n  /* Glow pulse animation */\n  @keyframes glow-pulse {\n    0%, 100% { box-shadow: 0 0 20px rgba(34, 242, 162, 0.3); }\n    50% { box-shadow: 0 0 40px rgba(34, 242, 162, 0.6); }\n  }\n  .animate-glow-pulse {\n    animation: glow-pulse 2s ease-in-out infinite;\n  }\n  \n  /* Neon flicker */\n  @keyframes neon-flicker {\n    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }\n    20%, 24%, 55% { opacity: 0.8; }\n  }\n  .animate-neon-flicker {\n    animation: neon-flicker 3s infinite;\n  }\n\n  /* Game area styling - dark with neon border */\n  .game-area {\n    background: linear-gradient(135deg, hsl(175 30% 10%) 0%, hsl(175 35% 8%) 50%, hsl(180 30% 10%) 100%);\n    border-radius: 12px;\n    border: 3px solid hsl(156 90% 40%);\n    box-shadow: 0 0 30px rgba(34, 242, 162, 0.2), inset 0 0 60px rgba(0,0,0,0.5);\n  }\n  \n  /* Coin/gold styling */\n  .coin-display {\n    color: hsl(52 95% 50%);\n    text-shadow: 0 0 10px rgba(249, 233, 0, 0.5);\n  }\n}\n","path":null,"size_bytes":7084,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/game/Shop.tsx":{"content":"import React, { useEffect } from 'react';\nimport { useGameStore, UPGRADE_MAX_LEVELS, UPGRADE_COSTS, SKILL_COSTS } from '../../lib/store';\nimport { motion } from 'framer-motion';\nimport { Bomb, Maximize, Layers, ArrowLeft, Coins, Clock, Zap, Gauge, Shield, TrendingUp, Clover, RotateCcw, Snowflake, Wand2 } from 'lucide-react';\nimport { usePlayerProfile, useUpdateProfile } from '../../lib/api';\nimport { offlineStorage } from '../../lib/offline-storage';\nimport { useAuth } from '../../hooks/use-auth';\n\ntype UpgradeType = keyof typeof UPGRADE_COSTS;\n\nexport function Shop() {\n  const { coins, upgrades, buyUpgrade, setGameState, syncWithProfile, freezeCount, cleanserCount, buySkillConsumable } = useGameStore();\n  const { data: profile } = usePlayerProfile();\n  const { user } = useAuth();\n  const updateProfile = useUpdateProfile();\n\n  useEffect(() => {\n    if (profile) {\n      syncWithProfile(profile);\n    }\n  }, [profile, syncWithProfile]);\n\n  const handleBuyUpgrade = async (type: UpgradeType) => {\n    const success = buyUpgrade(type);\n    \n    if (success) {\n      const newUpgrades = useGameStore.getState().upgrades;\n      const newCoins = useGameStore.getState().coins;\n      \n      offlineStorage.setPlayerStats({\n        coins: newCoins,\n        ...newUpgrades,\n      });\n      \n      if (user && navigator.onLine) {\n        try {\n          await updateProfile.mutateAsync({\n            coins: newCoins,\n            speedUpgrade: newUpgrades.bombCount,\n            startSizeUpgrade: newUpgrades.figureSize,\n            magnetUpgrade: newUpgrades.queueSize,\n          });\n        } catch (error) {\n          offlineStorage.addPendingProfileSync({\n            coins: newCoins,\n            speedUpgrade: newUpgrades.bombCount,\n            startSizeUpgrade: newUpgrades.figureSize,\n            magnetUpgrade: newUpgrades.queueSize,\n          });\n        }\n      }\n    }\n  };\n\n  const UPGRADE_ITEMS: {\n    id: UpgradeType;\n    name: string;\n    icon: React.ReactNode;\n    desc: string;\n    level: number;\n    maxLevel: number;\n    cost: number;\n    color: string;\n    glow: string;\n  }[] = [\n    {\n      id: 'bombCount',\n      name: 'BOMBS+',\n      icon: <Bomb size={24} />,\n      desc: '+1 tactical bomb',\n      level: upgrades.bombCount,\n      maxLevel: UPGRADE_MAX_LEVELS.bombCount,\n      cost: UPGRADE_COSTS.bombCount * upgrades.bombCount,\n      color: 'bg-destructive',\n      glow: 'rgba(255,68,68,0.4)'\n    },\n    {\n      id: 'figureSize',\n      name: 'SHRINK',\n      icon: <Maximize size={24} />,\n      desc: '-5% bacteria size',\n      level: upgrades.figureSize,\n      maxLevel: UPGRADE_MAX_LEVELS.figureSize,\n      cost: UPGRADE_COSTS.figureSize * upgrades.figureSize,\n      color: 'bg-primary',\n      glow: 'rgba(34,242,162,0.4)'\n    },\n    {\n      id: 'queueSize',\n      name: 'PREVIEW+',\n      icon: <Layers size={24} />,\n      desc: '+1 preview figure',\n      level: upgrades.queueSize,\n      maxLevel: UPGRADE_MAX_LEVELS.queueSize,\n      cost: UPGRADE_COSTS.queueSize * upgrades.queueSize,\n      color: 'bg-accent',\n      glow: 'rgba(255,106,213,0.4)'\n    },\n    {\n      id: 'timeBonus',\n      name: 'TIME+',\n      icon: <Clock size={24} />,\n      desc: '+3s starting time',\n      level: upgrades.timeBonus,\n      maxLevel: UPGRADE_MAX_LEVELS.timeBonus,\n      cost: UPGRADE_COSTS.timeBonus * upgrades.timeBonus,\n      color: 'bg-blue-500',\n      glow: 'rgba(59,130,246,0.4)'\n    },\n    {\n      id: 'placementBonus',\n      name: 'BONUS+',\n      icon: <Zap size={24} />,\n      desc: '+0.3s per placement',\n      level: upgrades.placementBonus,\n      maxLevel: UPGRADE_MAX_LEVELS.placementBonus,\n      cost: UPGRADE_COSTS.placementBonus * upgrades.placementBonus,\n      color: 'bg-yellow-500',\n      glow: 'rgba(234,179,8,0.4)'\n    },\n    {\n      id: 'slowMo',\n      name: 'SLOW-MO',\n      icon: <Gauge size={24} />,\n      desc: 'Slower vibration',\n      level: upgrades.slowMo,\n      maxLevel: UPGRADE_MAX_LEVELS.slowMo,\n      cost: UPGRADE_COSTS.slowMo * upgrades.slowMo,\n      color: 'bg-purple-500',\n      glow: 'rgba(168,85,247,0.4)'\n    },\n    {\n      id: 'shield',\n      name: 'SHIELD',\n      icon: <Shield size={24} />,\n      desc: 'Forgive 1 collision',\n      level: upgrades.shield,\n      maxLevel: UPGRADE_MAX_LEVELS.shield,\n      cost: UPGRADE_COSTS.shield,\n      color: 'bg-cyan-500',\n      glow: 'rgba(6,182,212,0.4)'\n    },\n    {\n      id: 'coinBoost',\n      name: 'COIN+',\n      icon: <TrendingUp size={24} />,\n      desc: '+10% coin earnings',\n      level: upgrades.coinBoost,\n      maxLevel: UPGRADE_MAX_LEVELS.coinBoost,\n      cost: UPGRADE_COSTS.coinBoost * upgrades.coinBoost,\n      color: 'bg-secondary',\n      glow: 'rgba(249,233,0,0.4)'\n    },\n    {\n      id: 'lucky',\n      name: 'LUCKY',\n      icon: <Clover size={24} />,\n      desc: 'More bombs in queue',\n      level: upgrades.lucky,\n      maxLevel: UPGRADE_MAX_LEVELS.lucky,\n      cost: UPGRADE_COSTS.lucky * upgrades.lucky,\n      color: 'bg-green-600',\n      glow: 'rgba(22,163,74,0.4)'\n    },\n    {\n      id: 'secondChance',\n      name: '2ND CHANCE',\n      icon: <RotateCcw size={24} />,\n      desc: 'Undo last move on game over',\n      level: upgrades.secondChance,\n      maxLevel: UPGRADE_MAX_LEVELS.secondChance,\n      cost: UPGRADE_COSTS.secondChance,\n      color: 'bg-orange-500',\n      glow: 'rgba(249,115,22,0.4)'\n    }\n  ];\n\n  const SKILL_ITEMS = [\n    {\n      id: 'freeze' as const,\n      name: 'FREEZE',\n      icon: <Snowflake size={24} />,\n      desc: 'Stop vibrations for 5 seconds',\n      count: freezeCount,\n      cost: SKILL_COSTS.freeze,\n      color: 'bg-blue-500',\n      glow: 'rgba(59,130,246,0.4)'\n    },\n    {\n      id: 'cleanser' as const,\n      name: 'CLEANSER',\n      icon: <Wand2 size={24} />,\n      desc: 'Draw to remove bacteria',\n      count: cleanserCount,\n      cost: SKILL_COSTS.cleanser,\n      color: 'bg-purple-500',\n      glow: 'rgba(168,85,247,0.4)'\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background flex flex-col items-center p-4 scanlines crt-vignette scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n      \n      <div className=\"w-full max-w-lg flex justify-between items-center mb-4 relative z-10 sticky top-0 bg-background/80 backdrop-blur-sm py-2\">\n        <motion.button \n          initial={{ x: -20, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          onClick={() => setGameState('MENU')}\n          className=\"block-panel p-2 hover:border-primary transition-colors\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"text-primary\" size={20} />\n        </motion.button>\n        <motion.h1 \n          initial={{ y: -20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          className=\"text-xl font-display\"\n          style={{\n            color: '#22F2A2',\n            textShadow: '0 0 10px #22F2A2, 0 0 20px #22F2A2'\n          }}\n        >\n          UPGRADES\n        </motion.h1>\n        <motion.div \n          initial={{ x: 20, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          className=\"flex items-center gap-2 block-panel px-3 py-1\" \n          data-testid=\"text-coins\"\n        >\n          <Coins className=\"text-secondary\" size={18} />\n          <span className=\"coin-display font-ui text-xl\">{coins}</span>\n        </motion.div>\n      </div>\n\n      <div className=\"w-full max-w-lg grid grid-cols-1 gap-3 relative z-10 pb-4\">\n        {UPGRADE_ITEMS.map((item, index) => {\n          const isConsumable = item.id === 'secondChance' || item.id === 'shield';\n          const isMaxed = !isConsumable && item.level >= item.maxLevel;\n          const canAfford = coins >= item.cost;\n          \n          return (\n            <motion.div \n              key={item.id}\n              initial={{ x: -30, opacity: 0 }}\n              animate={{ x: 0, opacity: 1 }}\n              transition={{ delay: index * 0.05 }}\n              whileHover={{ scale: 1.01 }}\n              className={`block-panel p-3 flex items-center gap-3 relative overflow-hidden ${isMaxed ? 'opacity-60' : ''}`}\n              data-testid={`upgrade-card-${item.id}`}\n            >\n              <div \n                className={`w-12 h-12 rounded-lg ${item.color} flex items-center justify-center text-black shadow-lg flex-shrink-0`}\n                style={{ boxShadow: `0 0 20px ${item.glow}` }}\n              >\n                {item.icon}\n              </div>\n\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex justify-between items-center mb-1\">\n                  <h3 className=\"font-display text-xs text-foreground\">{item.name}</h3>\n                  <span className=\"font-ui text-lg text-primary text-glow\" data-testid={`text-level-${item.id}`}>\n                    {isConsumable ? `x${item.level}` : (isMaxed ? 'MAX' : `LV.${item.level}`)}\n                  </span>\n                </div>\n                <p className=\"font-ui text-sm text-muted-foreground mb-2 truncate\">{item.desc}</p>\n                \n                {isMaxed ? (\n                  <div className=\"w-full py-1.5 font-display text-xs flex items-center justify-center gap-2 bg-muted text-muted-foreground border-2 border-border rounded-md\">\n                    MAXED OUT\n                  </div>\n                ) : (\n                  <motion.button\n                    whileHover={canAfford ? { scale: 1.02 } : {}}\n                    whileTap={canAfford ? { scale: 0.98 } : {}}\n                    onClick={() => handleBuyUpgrade(item.id)}\n                    disabled={!canAfford}\n                    className={`w-full py-1.5 font-display text-xs flex items-center justify-center gap-2 transition-all rounded-md\n                      ${canAfford \n                        ? 'pixel-btn' \n                        : 'bg-muted text-muted-foreground border-2 border-border cursor-not-allowed'\n                      }`}\n                    data-testid={`button-upgrade-${item.id}`}\n                  >\n                    {canAfford ? (isConsumable ? 'BUY +1' : 'BUY') : 'NEED'}\n                    <span className=\"font-ui text-sm\">\n                      [{item.cost}G]\n                    </span>\n                  </motion.button>\n                )}\n              </div>\n              \n              {!isConsumable && (\n                <div className=\"flex flex-col gap-0.5 flex-shrink-0\">\n                  {[...Array(item.maxLevel)].map((_, i) => (\n                    <div \n                      key={i} \n                      className={`w-2 h-3 rounded-sm ${i < item.level ? item.color : 'bg-muted'} transition-all`}\n                      style={i < item.level ? { boxShadow: `0 0 6px ${item.glow}` } : {}}\n                    />\n                  ))}\n                </div>\n              )}\n            </motion.div>\n          );\n        })}\n\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.5 }}\n          className=\"w-full mt-4 mb-2\"\n        >\n          <h2 className=\"font-display text-sm text-center\" style={{ color: '#FF6AD5', textShadow: '0 0 8px #FF6AD5' }}>\n            SKILL CONSUMABLES\n          </h2>\n        </motion.div>\n\n        {SKILL_ITEMS.map((item, index) => {\n          const canAfford = coins >= item.cost;\n          \n          return (\n            <motion.div \n              key={item.id}\n              initial={{ x: -30, opacity: 0 }}\n              animate={{ x: 0, opacity: 1 }}\n              transition={{ delay: 0.55 + index * 0.05 }}\n              whileHover={{ scale: 1.01 }}\n              className=\"block-panel p-3 flex items-center gap-3 relative overflow-hidden\"\n              data-testid={`skill-card-${item.id}`}\n            >\n              <div \n                className={`w-12 h-12 rounded-lg ${item.color} flex items-center justify-center text-white shadow-lg flex-shrink-0`}\n                style={{ boxShadow: `0 0 20px ${item.glow}` }}\n              >\n                {item.icon}\n              </div>\n\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex justify-between items-center mb-1\">\n                  <h3 className=\"font-display text-xs text-foreground\">{item.name}</h3>\n                  <span className=\"font-ui text-lg text-primary text-glow\" data-testid={`text-count-${item.id}`}>\n                    x{item.count}\n                  </span>\n                </div>\n                <p className=\"font-ui text-sm text-muted-foreground mb-2 truncate\">{item.desc}</p>\n                \n                <motion.button\n                  whileHover={canAfford ? { scale: 1.02 } : {}}\n                  whileTap={canAfford ? { scale: 0.98 } : {}}\n                  onClick={() => buySkillConsumable(item.id)}\n                  disabled={!canAfford}\n                  className={`w-full py-1.5 font-display text-xs flex items-center justify-center gap-2 transition-all rounded-md\n                    ${canAfford \n                      ? 'pixel-btn' \n                      : 'bg-muted text-muted-foreground border-2 border-border cursor-not-allowed'\n                    }`}\n                  data-testid={`button-buy-${item.id}`}\n                >\n                  {canAfford ? 'BUY +1' : 'NEED'}\n                  <span className=\"font-ui text-sm\">\n                    [{item.cost}G]\n                  </span>\n                </motion.button>\n              </div>\n            </motion.div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13461,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"./lib/queryClient\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js').catch(() => {});\n  });\n}\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <QueryClientProvider client={queryClient}>\n    <App />\n  </QueryClientProvider>\n);\n","path":null,"size_bytes":494,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/game/GameEngine.tsx":{"content":"import React, { useEffect, useRef, useCallback, useState } from 'react';\nimport { useGameStore } from '../../lib/store';\nimport { \n  GAME_CONFIG, \n  BACTERIA_TEMPLATES, \n  BOMB_TEMPLATE,\n  FigureInstance,\n  ShapeComponent,\n  VibrationPattern,\n  computeEffectiveRadius,\n  getCanvasScaleFactor,\n  calculateCanvasDimensions\n} from '../../lib/game-constants';\n\ninterface GameEngineProps {\n  onGameOver: () => void;\n}\n\ninterface Ripple {\n  x: number;\n  y: number;\n  radius: number;\n  maxRadius: number;\n  opacity: number;\n  color: string;\n}\n\ninterface ExplosionParticle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  radius: number;\n  color: string;\n  opacity: number;\n  life: number;\n}\n\ninterface Explosion {\n  x: number;\n  y: number;\n  radius: number;\n  maxRadius: number;\n  opacity: number;\n  shockwaveRadius: number;\n  particles: ExplosionParticle[];\n  flash: number;\n}\n\ninterface CollisionHighlight {\n  type: 'collision' | 'boundary';\n  figureIds?: string[];\n  position?: { x: number; y: number };\n  timestamp: number;\n}\n\ninterface ConfettiParticle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  rotation: number;\n  rotationSpeed: number;\n  width: number;\n  height: number;\n  color: string;\n  life: number;\n}\n\nexport function GameEngine({ onGameOver }: GameEngineProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const animationRef = useRef<number>(0);\n  const timeRef = useRef<number>(0);\n  const ripplesRef = useRef<Ripple[]>([]);\n  const explosionsRef = useRef<Explosion[]>([]);\n  const collisionHighlightRef = useRef<CollisionHighlight | null>(null);\n  const confettiRef = useRef<ConfettiParticle[]>([]);\n  const celebrationStartedRef = useRef<boolean>(false);\n  const gameOverTriggeredRef = useRef(false);\n  const collisionHistoryRef = useRef<Map<string, number[]>>(new Map());\n  const cleanFrameCountRef = useRef<Map<string, number>>(new Map());\n  const [previewPosition, setPreviewPosition] = useState<{ x: number; y: number } | null>(null);\n  const [isValidPlacement, setIsValidPlacement] = useState(true);\n  const [canvasScale, setCanvasScale] = useState(1);\n  \n  const { \n    placedFigures, \n    currentFigureId, \n    figureQueue,\n    placeFigure,\n    upgrades,\n    initializeGame,\n    setGameState,\n    startTimer,\n    stopTimer,\n    currentLevelConfig,\n    timeRemaining,\n    gameState,\n  } = useGameStore();\n  \n  const prevGameStateRef = useRef(gameState);\n  const mountedRef = useRef(false);\n\n  // Initialize game on mount\n  useEffect(() => {\n    if (!mountedRef.current) {\n      mountedRef.current = true;\n      gameOverTriggeredRef.current = false;\n      collisionHighlightRef.current = null;\n      celebrationStartedRef.current = false;\n      confettiRef.current = [];\n      collisionHistoryRef.current.clear();\n      cleanFrameCountRef.current.clear();\n      initializeGame();\n      startTimer();\n    }\n    \n    return () => {\n      stopTimer();\n      mountedRef.current = false;\n    };\n  }, [initializeGame, startTimer, stopTimer]);\n  \n  // Handle game state transitions\n  useEffect(() => {\n    const prev = prevGameStateRef.current;\n    \n    if (prev === 'GAME_OVER' && gameState === 'PLAYING') {\n      // Resuming from second chance - reset collision detection but don't reinitialize game\n      gameOverTriggeredRef.current = false;\n      collisionHighlightRef.current = null;\n      collisionHistoryRef.current.clear();\n      cleanFrameCountRef.current.clear();\n    }\n    \n    prevGameStateRef.current = gameState;\n  }, [gameState]);\n\n  const getVibrationOffset = useCallback((pattern: VibrationPattern, time: number, speed: number, amplitude: number) => {\n    const t = time * speed;\n    switch (pattern) {\n      case 'horizontal':\n        return { x: Math.sin(t) * amplitude, y: 0 };\n      case 'vertical':\n        return { x: 0, y: Math.sin(t) * amplitude };\n      case 'circular':\n        return { x: Math.cos(t) * amplitude, y: Math.sin(t) * amplitude };\n      case 'pulse':\n        return { x: 0, y: 0, scale: 1 + Math.sin(t) * 0.1 };\n      case 'diagonal':\n        return { x: Math.sin(t) * amplitude * 0.7, y: Math.sin(t) * amplitude * 0.7 };\n      default:\n        return { x: 0, y: 0 };\n    }\n  }, []);\n\n  const drawShape = useCallback((ctx: CanvasRenderingContext2D, shape: ShapeComponent, x: number, y: number, scale: number = 1) => {\n    ctx.save();\n    ctx.translate(x + shape.offsetX * scale, y + shape.offsetY * scale);\n    ctx.rotate((shape.rotation * Math.PI) / 180);\n    ctx.fillStyle = shape.color;\n    ctx.strokeStyle = shape.strokeColor || '#000';\n    ctx.lineWidth = shape.strokeWidth || 2;\n\n    const w = shape.width * scale;\n    const h = shape.height * scale;\n\n    switch (shape.type) {\n      case 'circle':\n        ctx.beginPath();\n        ctx.arc(0, 0, w / 2, 0, Math.PI * 2);\n        ctx.fill();\n        if (shape.strokeColor) ctx.stroke();\n        break;\n      case 'square':\n        ctx.fillRect(-w / 2, -h / 2, w, h);\n        if (shape.strokeColor) ctx.strokeRect(-w / 2, -h / 2, w, h);\n        break;\n      case 'rect':\n        ctx.fillRect(-w / 2, -h / 2, w, h);\n        if (shape.strokeColor) ctx.strokeRect(-w / 2, -h / 2, w, h);\n        break;\n      case 'triangle':\n        ctx.beginPath();\n        ctx.moveTo(0, -h / 2);\n        ctx.lineTo(w / 2, h / 2);\n        ctx.lineTo(-w / 2, h / 2);\n        ctx.closePath();\n        ctx.fill();\n        if (shape.strokeColor) ctx.stroke();\n        break;\n      case 'line':\n        ctx.fillRect(-w / 2, -h / 2, w, h);\n        if (shape.strokeColor) ctx.strokeRect(-w / 2, -h / 2, w, h);\n        break;\n      case 'oval':\n        ctx.beginPath();\n        ctx.ellipse(0, 0, w / 2, h / 2, 0, 0, Math.PI * 2);\n        ctx.fill();\n        if (shape.strokeColor) ctx.stroke();\n        break;\n    }\n    ctx.restore();\n  }, []);\n\n  const drawFigure = useCallback((\n    ctx: CanvasRenderingContext2D, \n    figure: FigureInstance, \n    time: number,\n    isPreview: boolean = false,\n    isInvalid: boolean = false\n  ) => {\n    const template = figure.templateId === 'bomb' \n      ? BOMB_TEMPLATE \n      : BACTERIA_TEMPLATES.find(t => t.id === figure.templateId);\n    \n    if (!template) return;\n\n    // Apply level-based speed multiplier and SLOW-MO upgrade\n    const state = useGameStore.getState();\n    const currentCanvasScale = state.canvasScale;\n    const levelSpeedMultiplier = state.currentLevelConfig.speedMultiplier;\n    const slowMoReduction = 1 - (state.upgrades.slowMo - 1) * 0.15;\n    const speedMultiplier = levelSpeedMultiplier * slowMoReduction;\n    const scaledAmplitude = template.vibrationAmplitude * currentCanvasScale;\n    const vibration = getVibrationOffset(\n      template.vibrationPattern, \n      time + figure.vibrationOffset, \n      template.vibrationSpeed * speedMultiplier, \n      scaledAmplitude\n    );\n\n    const x = figure.x + (vibration.x || 0);\n    const y = figure.y + (vibration.y || 0);\n    const pulseScale = (vibration as { scale?: number }).scale || 1;\n    const finalScale = figure.scale * pulseScale * currentCanvasScale;\n\n    ctx.save();\n    \n    if (isPreview) {\n      ctx.globalAlpha = 0.6;\n    }\n\n    for (const shape of template.shapes) {\n      const modifiedShape = isInvalid \n        ? { ...shape, color: '#FF4444' } \n        : shape;\n      drawShape(ctx, modifiedShape, x, y, finalScale);\n    }\n\n    // Draw collision border (visible hit area)\n    if (figure.isPlaced && figure.templateId !== 'bomb') {\n      const collisionRadius = computeEffectiveRadius(\n        { ...figure, scale: figure.scale * pulseScale },\n        BACTERIA_TEMPLATES,\n        BOMB_TEMPLATE,\n        currentCanvasScale\n      );\n      \n      ctx.beginPath();\n      ctx.arc(x, y, collisionRadius, 0, Math.PI * 2);\n      ctx.strokeStyle = isInvalid ? 'rgba(255, 68, 68, 0.6)' : 'rgba(34, 242, 162, 0.4)';\n      ctx.lineWidth = 2;\n      ctx.setLineDash([4, 4]);\n      ctx.stroke();\n      ctx.setLineDash([]);\n    }\n\n    ctx.restore();\n  }, [drawShape, getVibrationOffset]);\n\n  const getFigurePositionAtTime = useCallback((figure: FigureInstance, time: number) => {\n    const template = figure.templateId === 'bomb' \n      ? BOMB_TEMPLATE \n      : BACTERIA_TEMPLATES.find(t => t.id === figure.templateId);\n    \n    const state = useGameStore.getState();\n    const scale = state.canvasScale;\n    \n    if (!template) return { x: figure.x, y: figure.y, radius: GAME_CONFIG.FIGURE_BASE_SIZE * figure.scale * scale };\n\n    // Apply level-based speed multiplier and SLOW-MO upgrade\n    const levelSpeedMultiplier = state.currentLevelConfig.speedMultiplier;\n    const slowMoReduction = 1 - (state.upgrades.slowMo - 1) * 0.15;\n    const speedMultiplier = levelSpeedMultiplier * slowMoReduction;\n    const scaledAmplitude = template.vibrationAmplitude * scale;\n    const vibration = getVibrationOffset(\n      template.vibrationPattern, \n      time + figure.vibrationOffset, \n      template.vibrationSpeed * speedMultiplier, \n      scaledAmplitude\n    );\n\n    const pulseScale = (vibration as { scale?: number }).scale || 1;\n    const effectiveRadius = computeEffectiveRadius(\n      { ...figure, scale: figure.scale * pulseScale },\n      BACTERIA_TEMPLATES,\n      BOMB_TEMPLATE,\n      scale\n    );\n\n    return {\n      x: figure.x + (vibration.x || 0),\n      y: figure.y + (vibration.y || 0),\n      radius: effectiveRadius\n    };\n  }, [getVibrationOffset]);\n\n  const COLLISION_WINDOW_SIZE = 12;\n  const CONTACT_RATIO_THRESHOLD = 0.5;\n  \n  const checkRuntimeCollisions = useCallback((time: number): { collided: boolean; figureIds?: string[] } => {\n    const figures = useGameStore.getState().placedFigures;\n    if (figures.length < 2) {\n      collisionHistoryRef.current.clear();\n      cleanFrameCountRef.current.clear();\n      return { collided: false };\n    }\n\n    const activePairs = new Set<string>();\n    \n    for (let i = 0; i < figures.length; i++) {\n      for (let j = i + 1; j < figures.length; j++) {\n        const posA = getFigurePositionAtTime(figures[i], time);\n        const posB = getFigurePositionAtTime(figures[j], time);\n        \n        const dx = posA.x - posB.x;\n        const dy = posA.y - posB.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const rawMinDistance = posA.radius + posB.radius;\n        \n        const penetrationDepth = Math.max(0, rawMinDistance - distance);\n        const isInContact = penetrationDepth > 0;\n        \n        const pairKey = `${figures[i].id}-${figures[j].id}`;\n        activePairs.add(pairKey);\n        \n        let history = collisionHistoryRef.current.get(pairKey);\n        if (!history) {\n          history = [];\n          collisionHistoryRef.current.set(pairKey, history);\n        }\n        \n        let cleanFrames = cleanFrameCountRef.current.get(pairKey) || 0;\n        \n        if (isInContact) {\n          cleanFrames = 0;\n          history.push(penetrationDepth);\n        } else {\n          cleanFrames++;\n          if (cleanFrames >= 3) {\n            history.length = 0;\n            cleanFrames = 0;\n          } else {\n            history.push(0);\n          }\n        }\n        cleanFrameCountRef.current.set(pairKey, cleanFrames);\n        \n        if (history.length > COLLISION_WINDOW_SIZE) {\n          history.shift();\n        }\n        \n        const contactFrames = history.filter(d => d > 0).length;\n        const contactRatio = history.length > 0 ? contactFrames / history.length : 0;\n        \n        if (contactRatio >= CONTACT_RATIO_THRESHOLD && history.length >= COLLISION_WINDOW_SIZE) {\n          return { collided: true, figureIds: [figures[i].id, figures[j].id] };\n        }\n      }\n    }\n    \n    Array.from(collisionHistoryRef.current.keys()).forEach(key => {\n      if (!activePairs.has(key)) {\n        collisionHistoryRef.current.delete(key);\n        cleanFrameCountRef.current.delete(key);\n      }\n    });\n    \n    return { collided: false };\n  }, [getFigurePositionAtTime]);\n  \n  const findCollidingFigures = useCallback((newFigure: FigureInstance): string[] => {\n    const state = useGameStore.getState();\n    const figures = state.placedFigures;\n    const currentCanvasScale = state.canvasScale;\n    const effectiveRadius = computeEffectiveRadius(newFigure, BACTERIA_TEMPLATES, BOMB_TEMPLATE, currentCanvasScale);\n    const collidingIds: string[] = [];\n    \n    for (const placed of figures) {\n      const placedEffectiveRadius = computeEffectiveRadius(placed, BACTERIA_TEMPLATES, BOMB_TEMPLATE, currentCanvasScale);\n      const dx = newFigure.x - placed.x;\n      const dy = newFigure.y - placed.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      const minDistance = effectiveRadius + placedEffectiveRadius + 1;\n      \n      if (distance < minDistance) {\n        collidingIds.push(placed.id);\n      }\n    }\n    return collidingIds;\n  }, []);\n\n  const createRipple = useCallback((x: number, y: number, color: string = '#4ADE80') => {\n    const ripple: Ripple = {\n      x,\n      y,\n      radius: 10,\n      maxRadius: 80,\n      opacity: 0.6,\n      color,\n    };\n    ripplesRef.current.push(ripple);\n  }, []);\n\n  const updateAndDrawRipples = useCallback((ctx: CanvasRenderingContext2D) => {\n    const ripples = ripplesRef.current;\n    \n    for (let i = ripples.length - 1; i >= 0; i--) {\n      const ripple = ripples[i];\n      \n      // Draw ripple\n      ctx.save();\n      ctx.beginPath();\n      ctx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);\n      ctx.strokeStyle = ripple.color;\n      ctx.lineWidth = 3;\n      ctx.globalAlpha = ripple.opacity;\n      ctx.stroke();\n      \n      // Draw inner ripple\n      if (ripple.radius > 20) {\n        ctx.beginPath();\n        ctx.arc(ripple.x, ripple.y, ripple.radius * 0.6, 0, Math.PI * 2);\n        ctx.lineWidth = 2;\n        ctx.globalAlpha = ripple.opacity * 0.7;\n        ctx.stroke();\n      }\n      \n      // Draw outer ripple\n      ctx.beginPath();\n      ctx.arc(ripple.x, ripple.y, ripple.radius * 1.3, 0, Math.PI * 2);\n      ctx.lineWidth = 1;\n      ctx.globalAlpha = ripple.opacity * 0.4;\n      ctx.stroke();\n      \n      ctx.restore();\n      \n      // Update ripple\n      ripple.radius += 3;\n      ripple.opacity -= 0.02;\n      \n      // Remove faded ripples\n      if (ripple.opacity <= 0 || ripple.radius >= ripple.maxRadius) {\n        ripples.splice(i, 1);\n      }\n    }\n  }, []);\n\n  const createExplosion = useCallback((x: number, y: number) => {\n    const particles: ExplosionParticle[] = [];\n    const colors = ['#FF4444', '#FF6600', '#FFAA00', '#FFDD00', '#FF8800'];\n    \n    // Create explosion particles\n    for (let i = 0; i < 30; i++) {\n      const angle = (Math.PI * 2 * i) / 30 + Math.random() * 0.3;\n      const speed = 3 + Math.random() * 6;\n      particles.push({\n        x,\n        y,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed,\n        radius: 4 + Math.random() * 8,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        opacity: 1,\n        life: 1,\n      });\n    }\n    \n    const explosion: Explosion = {\n      x,\n      y,\n      radius: 10,\n      maxRadius: 160,\n      opacity: 1,\n      shockwaveRadius: 0,\n      particles,\n      flash: 1,\n    };\n    explosionsRef.current.push(explosion);\n  }, []);\n\n  const updateAndDrawExplosions = useCallback((ctx: CanvasRenderingContext2D) => {\n    const explosions = explosionsRef.current;\n    \n    for (let i = explosions.length - 1; i >= 0; i--) {\n      const explosion = explosions[i];\n      \n      ctx.save();\n      \n      // Draw flash effect\n      if (explosion.flash > 0) {\n        const gradient = ctx.createRadialGradient(\n          explosion.x, explosion.y, 0,\n          explosion.x, explosion.y, 150\n        );\n        gradient.addColorStop(0, `rgba(255, 255, 200, ${explosion.flash * 0.8})`);\n        gradient.addColorStop(0.3, `rgba(255, 150, 50, ${explosion.flash * 0.5})`);\n        gradient.addColorStop(1, `rgba(255, 50, 0, 0)`);\n        ctx.fillStyle = gradient;\n        ctx.beginPath();\n        ctx.arc(explosion.x, explosion.y, 150, 0, Math.PI * 2);\n        ctx.fill();\n        explosion.flash -= 0.08;\n      }\n      \n      // Draw shockwave rings\n      if (explosion.shockwaveRadius < 180) {\n        ctx.beginPath();\n        ctx.arc(explosion.x, explosion.y, explosion.shockwaveRadius, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(255, 100, 0, ${1 - explosion.shockwaveRadius / 180})`;\n        ctx.lineWidth = 4;\n        ctx.stroke();\n        \n        // Second shockwave\n        if (explosion.shockwaveRadius > 30) {\n          ctx.beginPath();\n          ctx.arc(explosion.x, explosion.y, explosion.shockwaveRadius - 30, 0, Math.PI * 2);\n          ctx.strokeStyle = `rgba(255, 200, 0, ${0.7 - explosion.shockwaveRadius / 250})`;\n          ctx.lineWidth = 3;\n          ctx.stroke();\n        }\n        \n        explosion.shockwaveRadius += 8;\n      }\n      \n      // Draw and update particles\n      for (let j = explosion.particles.length - 1; j >= 0; j--) {\n        const p = explosion.particles[j];\n        \n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.radius * p.life, 0, Math.PI * 2);\n        ctx.fillStyle = p.color;\n        ctx.globalAlpha = p.opacity * p.life;\n        ctx.fill();\n        \n        // Update particle\n        p.x += p.vx;\n        p.y += p.vy;\n        p.vy += 0.15; // gravity\n        p.vx *= 0.98; // friction\n        p.life -= 0.025;\n        \n        if (p.life <= 0) {\n          explosion.particles.splice(j, 1);\n        }\n      }\n      \n      ctx.restore();\n      \n      // Remove finished explosions\n      if (explosion.particles.length === 0 && explosion.shockwaveRadius >= 180) {\n        explosions.splice(i, 1);\n      }\n    }\n  }, []);\n\n  const spawnConfetti = useCallback((canvas: HTMLCanvasElement) => {\n    const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#F38181', '#AA96DA', '#FCBAD3', '#A8D8EA', '#FF9F43', '#6BCB77'];\n    const confetti = confettiRef.current;\n    \n    // Spawn confetti from top of screen\n    for (let i = 0; i < 15; i++) {\n      confetti.push({\n        x: Math.random() * canvas.width,\n        y: -20,\n        vx: (Math.random() - 0.5) * 6,\n        vy: Math.random() * 3 + 2,\n        rotation: Math.random() * 360,\n        rotationSpeed: (Math.random() - 0.5) * 15,\n        width: 8 + Math.random() * 8,\n        height: 6 + Math.random() * 6,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 1,\n      });\n    }\n  }, []);\n\n  const updateAndDrawConfetti = useCallback((ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement) => {\n    const confetti = confettiRef.current;\n    \n    for (let i = confetti.length - 1; i >= 0; i--) {\n      const p = confetti[i];\n      \n      ctx.save();\n      ctx.translate(p.x, p.y);\n      ctx.rotate((p.rotation * Math.PI) / 180);\n      ctx.fillStyle = p.color;\n      ctx.globalAlpha = p.life;\n      ctx.fillRect(-p.width / 2, -p.height / 2, p.width, p.height);\n      ctx.restore();\n      \n      // Update particle\n      p.x += p.vx;\n      p.y += p.vy;\n      p.vy += 0.1; // gravity\n      p.vx *= 0.99; // air resistance\n      p.rotation += p.rotationSpeed;\n      \n      // Fade out when near bottom\n      if (p.y > canvas.height - 100) {\n        p.life -= 0.02;\n      }\n      \n      // Remove dead confetti\n      if (p.life <= 0 || p.y > canvas.height + 50) {\n        confetti.splice(i, 1);\n      }\n    }\n  }, []);\n\n  const render = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const time = timeRef.current;\n    timeRef.current += 0.016;\n\n    const currentGameState = useGameStore.getState().gameState;\n    \n    // Handle celebration state - spawn confetti\n    if (currentGameState === 'CELEBRATING') {\n      if (!celebrationStartedRef.current) {\n        celebrationStartedRef.current = true;\n        confettiRef.current = [];\n      }\n      // Spawn confetti continuously during celebration\n      if (Math.random() < 0.4) {\n        spawnConfetti(canvas);\n      }\n    } else {\n      celebrationStartedRef.current = false;\n    }\n\n    // Only check collisions when playing (not celebrating)\n    if (currentGameState === 'PLAYING') {\n      const gameState = useGameStore.getState();\n      const isInCooldown = gameState.shieldCooldownUntil > Date.now();\n      \n      if (!isInCooldown) {\n        const collisionResult = checkRuntimeCollisions(time);\n        if (!gameOverTriggeredRef.current && collisionResult.collided) {\n          const hasShield = gameState.upgrades.shield >= 1 && !gameState.shieldUsed;\n          \n          if (hasShield && collisionResult.figureIds && collisionResult.figureIds.length > 0) {\n            const figureToRemove = collisionResult.figureIds[collisionResult.figureIds.length - 1];\n            useGameStore.getState().removeFigure(figureToRemove);\n            useGameStore.getState().useShield();\n            collisionHistoryRef.current.clear();\n            cleanFrameCountRef.current.clear();\n          } else {\n            gameOverTriggeredRef.current = true;\n            collisionHighlightRef.current = {\n              type: 'collision',\n              figureIds: collisionResult.figureIds,\n              timestamp: Date.now(),\n            };\n            useGameStore.getState().setNotification('COLLISION!');\n            useGameStore.getState().triggerKikAnnouncement('gameOverCollision');\n            setTimeout(() => {\n              setGameState('GAME_OVER');\n              onGameOver();\n            }, 800);\n          }\n        }\n      }\n    }\n\n    ctx.fillStyle = GAME_CONFIG.COLORS.BACKGROUND;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    ctx.strokeStyle = GAME_CONFIG.COLORS.GRID;\n    ctx.lineWidth = 1;\n    const gridSize = 40;\n    for (let x = 0; x < canvas.width; x += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(x, 0);\n      ctx.lineTo(x, canvas.height);\n      ctx.stroke();\n    }\n    for (let y = 0; y < canvas.height; y += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(0, y);\n      ctx.lineTo(canvas.width, y);\n      ctx.stroke();\n    }\n\n    const previewHeight = 120;\n    \n    // Calculate dynamic padding for shrinking play area with canvas scale\n    const currentCanvasScale = useGameStore.getState().canvasScale;\n    const basePadding = GAME_CONFIG.CANVAS_PADDING * currentCanvasScale;\n    const levelConfig = useGameStore.getState().currentLevelConfig;\n    const currentTime = useGameStore.getState().timeRemaining;\n    const maxTime = levelConfig.startTime;\n    const timeElapsed = maxTime - currentTime;\n    const shrinkAmount = Math.max(0, timeElapsed * levelConfig.areaShrinkRate * currentCanvasScale);\n    const dynamicPadding = basePadding + shrinkAmount;\n    const isShrinking = shrinkAmount > 0;\n    \n    // Draw the play area boundary with dynamic padding\n    const boundaryColor = isShrinking ? '#FF6B6B' : '#4ADE80';\n    ctx.strokeStyle = boundaryColor;\n    ctx.lineWidth = 3;\n    ctx.setLineDash([10, 5]);\n    ctx.strokeRect(dynamicPadding, dynamicPadding, canvas.width - dynamicPadding * 2, canvas.height - dynamicPadding * 2 - previewHeight);\n    ctx.setLineDash([]);\n    \n    // Use dynamic padding for click handling\n    const padding = dynamicPadding;\n\n    for (const figure of placedFigures) {\n      drawFigure(ctx, figure, time);\n    }\n    \n    // Draw collision highlight on figures that caused game over\n    const highlight = collisionHighlightRef.current;\n    if (highlight && highlight.type === 'collision' && highlight.figureIds) {\n      const elapsed = Date.now() - highlight.timestamp;\n      const pulse = Math.sin(elapsed * 0.02) * 0.3 + 0.7;\n      \n      for (const figureId of highlight.figureIds) {\n        const figure = placedFigures.find(f => f.id === figureId);\n        if (figure) {\n          const pos = getFigurePositionAtTime(figure, time);\n          ctx.save();\n          ctx.beginPath();\n          ctx.arc(pos.x, pos.y, pos.radius + 15, 0, Math.PI * 2);\n          ctx.strokeStyle = '#FF0000';\n          ctx.lineWidth = 6;\n          ctx.globalAlpha = pulse;\n          ctx.stroke();\n          ctx.beginPath();\n          ctx.arc(pos.x, pos.y, pos.radius + 25, 0, Math.PI * 2);\n          ctx.strokeStyle = '#FF6B6B';\n          ctx.lineWidth = 3;\n          ctx.globalAlpha = pulse * 0.5;\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    }\n    \n    // Draw boundary collision highlight\n    if (highlight && highlight.type === 'boundary' && highlight.position) {\n      const elapsed = Date.now() - highlight.timestamp;\n      const pulse = Math.sin(elapsed * 0.02) * 0.3 + 0.7;\n      \n      ctx.save();\n      ctx.beginPath();\n      ctx.arc(highlight.position.x, highlight.position.y, 50, 0, Math.PI * 2);\n      ctx.strokeStyle = '#FF0000';\n      ctx.lineWidth = 8;\n      ctx.globalAlpha = pulse;\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.arc(highlight.position.x, highlight.position.y, 70, 0, Math.PI * 2);\n      ctx.strokeStyle = '#FF6B6B';\n      ctx.lineWidth = 4;\n      ctx.globalAlpha = pulse * 0.5;\n      ctx.stroke();\n      ctx.restore();\n    }\n\n    // Draw water drop ripples\n    updateAndDrawRipples(ctx);\n    \n    // Draw bomb explosions\n    updateAndDrawExplosions(ctx);\n    \n    // Draw confetti during celebration\n    updateAndDrawConfetti(ctx, canvas);\n\n    if (previewPosition && currentFigureId) {\n      const sizeMultiplier = 1 + (upgrades.figureSize - 1) * 0.1;\n      const previewFigure: FigureInstance = {\n        id: 'preview',\n        templateId: currentFigureId,\n        x: previewPosition.x,\n        y: previewPosition.y,\n        rotation: 0,\n        scale: sizeMultiplier,\n        vibrationOffset: 0,\n        isPlaced: false,\n      };\n      drawFigure(ctx, previewFigure, time, true, !isValidPlacement);\n    }\n\n    const previewY = canvas.height - previewHeight;\n    ctx.fillStyle = GAME_CONFIG.COLORS.PREVIEW_AREA;\n    ctx.fillRect(0, previewY, canvas.width, previewHeight);\n    ctx.strokeStyle = '#4ADE80';\n    ctx.lineWidth = 2;\n    ctx.strokeRect(0, previewY, canvas.width, previewHeight);\n\n    ctx.fillStyle = '#4ADE80';\n    ctx.font = '16px \"Press Start 2P\"';\n    ctx.textAlign = 'center';\n    ctx.fillText('NEXT', canvas.width / 2, previewY + 25);\n\n    if (currentFigureId) {\n      const previewFigure: FigureInstance = {\n        id: 'current-preview',\n        templateId: currentFigureId,\n        x: canvas.width / 2,\n        y: previewY + 70,\n        rotation: 0,\n        scale: 1.2,\n        vibrationOffset: 0,\n        isPlaced: false,\n      };\n      drawFigure(ctx, previewFigure, time);\n    }\n\n    const previewCount = Math.min(upgrades.queueSize, 3, figureQueue.length);\n    for (let i = 0; i < previewCount; i++) {\n      const templateId = figureQueue[i];\n      const queueFigure: FigureInstance = {\n        id: `queue-${i}`,\n        templateId,\n        x: canvas.width - 60,\n        y: previewY + 40 + i * 25,\n        rotation: 0,\n        scale: 0.4,\n        vibrationOffset: i,\n        isPlaced: false,\n      };\n      drawFigure(ctx, queueFigure, time);\n    }\n\n    animationRef.current = requestAnimationFrame(render);\n  }, [placedFigures, currentFigureId, figureQueue, previewPosition, isValidPlacement, upgrades, drawFigure, checkRuntimeCollisions, setGameState, onGameOver, updateAndDrawRipples, updateAndDrawExplosions, getFigurePositionAtTime, spawnConfetti, updateAndDrawConfetti]);\n\n  useEffect(() => {\n    animationRef.current = requestAnimationFrame(render);\n    return () => cancelAnimationFrame(animationRef.current);\n  }, [render]);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const resize = () => {\n      const container = canvas.parentElement;\n      if (container) {\n        const { width, height } = calculateCanvasDimensions(container.clientWidth, container.clientHeight);\n        canvas.width = width;\n        canvas.height = height;\n        const scale = getCanvasScaleFactor(width, height);\n        setCanvasScale(scale);\n        useGameStore.getState().setCanvasScale(scale);\n      }\n    };\n\n    resize();\n    window.addEventListener('resize', resize);\n    return () => window.removeEventListener('resize', resize);\n  }, []);\n\n  const getScaleForTemplate = useCallback((templateId: string) => {\n    const template = templateId === 'bomb' \n      ? BOMB_TEMPLATE \n      : BACTERIA_TEMPLATES.find(t => t.id === templateId);\n    if (!template) return 1;\n    const upgradeMultiplier = 1 - (upgrades.figureSize - 1) * 0.1;\n    const levelSizeMultiplier = useGameStore.getState().currentLevelConfig.sizeMultiplier;\n    return template.baseScale * upgradeMultiplier * levelSizeMultiplier;\n  }, [upgrades]);\n\n  const getDynamicPadding = useCallback(() => {\n    const state = useGameStore.getState();\n    const basePadding = GAME_CONFIG.CANVAS_PADDING * state.canvasScale;\n    const levelConfig = state.currentLevelConfig;\n    const currentTime = state.timeRemaining;\n    const maxTime = levelConfig.startTime;\n    const timeElapsed = maxTime - currentTime;\n    const shrinkAmount = Math.max(0, timeElapsed * levelConfig.areaShrinkRate * state.canvasScale);\n    return basePadding + shrinkAmount;\n  }, []);\n\n  const handlePointerMove = useCallback((e: React.PointerEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas || !currentFigureId) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    const previewHeight = 120;\n    if (y > canvas.height - previewHeight) {\n      setPreviewPosition(null);\n      return;\n    }\n\n    setPreviewPosition({ x, y });\n\n    if (currentFigureId !== 'bomb') {\n      // Check boundary collision with dynamic padding\n      const scale = getScaleForTemplate(currentFigureId);\n      const scaledBaseSize = GAME_CONFIG.FIGURE_BASE_SIZE * canvasScale;\n      const radius = scaledBaseSize * scale;\n      const padding = getDynamicPadding();\n      \n      const touchesBoundary = (\n        x - radius < padding || \n        x + radius > canvas.width - padding || \n        y - radius < padding || \n        y + radius > canvas.height - padding - previewHeight\n      );\n      \n      if (touchesBoundary) {\n        setIsValidPlacement(false);\n        return;\n      }\n      \n      const testFigure: FigureInstance = {\n        id: 'test',\n        templateId: currentFigureId,\n        x,\n        y,\n        rotation: 0,\n        scale: scale,\n        vibrationOffset: 0,\n        isPlaced: false,\n      };\n      setIsValidPlacement(findCollidingFigures(testFigure).length === 0);\n    } else {\n      setIsValidPlacement(true);\n    }\n  }, [currentFigureId, findCollidingFigures, getScaleForTemplate, getDynamicPadding, canvasScale]);\n\n  const checkBoundaryCollision = useCallback((x: number, y: number, templateId: string, canvas: HTMLCanvasElement) => {\n    const scale = getScaleForTemplate(templateId);\n    const currentCanvasScale = useGameStore.getState().canvasScale;\n    const scaledBaseSize = GAME_CONFIG.FIGURE_BASE_SIZE * currentCanvasScale;\n    const radius = scaledBaseSize * scale;\n    const padding = getDynamicPadding();\n    const previewHeight = 120;\n    \n    // Check if figure touches or goes outside boundaries (using dynamic shrinking area)\n    if (x - radius < padding || \n        x + radius > canvas.width - padding || \n        y - radius < padding || \n        y + radius > canvas.height - padding - previewHeight) {\n      return true;\n    }\n    return false;\n  }, [getScaleForTemplate, getDynamicPadding]);\n\n  const handleClick = useCallback((e: React.PointerEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    const previewHeight = 120;\n    if (y > canvas.height - previewHeight) return;\n\n    const padding = getDynamicPadding();\n    // Don't allow clicking outside play area at all\n    if (x < padding || x > canvas.width - padding || y < padding) return;\n\n    if (gameOverTriggeredRef.current) return;\n    \n    // Check for bomb targeting mode first\n    const gameState = useGameStore.getState();\n    if (gameState.bombTargetingMode) {\n      const result = useGameStore.getState().detonateBombAt(x, y);\n      if (result.success) {\n        createExplosion(x, y);\n      }\n      return;\n    }\n    \n    // Need a current figure for regular placement\n    if (!currentFigureId) return;\n    \n    if (currentFigureId === 'bomb') {\n      placeFigure(x, y);\n      // Explosion effect for bomb\n      createExplosion(x, y);\n    } else {\n      // Check boundary collision - figure would touch the border\n      const touchesBoundary = checkBoundaryCollision(x, y, currentFigureId, canvas);\n      if (touchesBoundary) {\n        const gameState = useGameStore.getState();\n        const hasShield = gameState.upgrades.shield >= 1 && !gameState.shieldUsed;\n        \n        if (hasShield) {\n          useGameStore.getState().useShield();\n          return;\n        } else {\n          gameOverTriggeredRef.current = true;\n          collisionHighlightRef.current = {\n            type: 'boundary',\n            position: { x, y },\n            timestamp: Date.now(),\n          };\n          useGameStore.getState().setNotification('TOUCHED BOUNDARY!');\n          setTimeout(() => {\n            setGameState('GAME_OVER');\n            onGameOver();\n          }, 800);\n          return;\n        }\n      }\n      \n      // Check collision with other figures\n      const testFigure: FigureInstance = {\n        id: 'test',\n        templateId: currentFigureId,\n        x,\n        y,\n        rotation: 0,\n        scale: getScaleForTemplate(currentFigureId),\n        vibrationOffset: 0,\n        isPlaced: false,\n      };\n      \n      const collidingFigureIds = findCollidingFigures(testFigure);\n      if (collidingFigureIds.length > 0) {\n        const gameState = useGameStore.getState();\n        const hasShield = gameState.upgrades.shield >= 1 && !gameState.shieldUsed;\n        \n        if (hasShield) {\n          useGameStore.getState().useShield();\n          return;\n        } else {\n          gameOverTriggeredRef.current = true;\n          collisionHighlightRef.current = {\n            type: 'collision',\n            figureIds: collidingFigureIds,\n            timestamp: Date.now(),\n          };\n          useGameStore.getState().setNotification('COLLISION!');\n          setTimeout(() => {\n            setGameState('GAME_OVER');\n            onGameOver();\n          }, 800);\n          return;\n        }\n      }\n      \n      placeFigure(x, y);\n      // Water drop ripple effect on successful placement\n      createRipple(x, y, '#4ADE80');\n    }\n  }, [currentFigureId, placeFigure, findCollidingFigures, getScaleForTemplate, checkBoundaryCollision, setGameState, onGameOver, createRipple, createExplosion, getDynamicPadding]);\n\n  const handlePointerLeave = useCallback(() => {\n    setPreviewPosition(null);\n  }, []);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      className=\"cursor-crosshair touch-none\"\n      onPointerMove={handlePointerMove}\n      onPointerDown={handleClick}\n      onPointerLeave={handlePointerLeave}\n      data-testid=\"game-canvas\"\n    />\n  );\n}\n","path":null,"size_bytes":34974,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, uniqueIndex, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport * from \"./models/auth\";\nimport { users } from \"./models/auth\";\n\n// Player Profile - stores game progress\nexport const playerProfiles = pgTable(\"player_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  coins: integer(\"coins\").notNull().default(500),\n  highScore: integer(\"high_score\").notNull().default(0),\n  speedUpgrade: integer(\"speed_upgrade\").notNull().default(1),\n  startSizeUpgrade: integer(\"start_size_upgrade\").notNull().default(1),\n  magnetUpgrade: integer(\"magnet_upgrade\").notNull().default(1),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertPlayerProfileSchema = createInsertSchema(playerProfiles).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertPlayerProfile = z.infer<typeof insertPlayerProfileSchema>;\nexport type PlayerProfile = typeof playerProfiles.$inferSelect;\n\n// Leaderboard - top scores\nexport const leaderboard = pgTable(\"leaderboard\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  username: text(\"username\").notNull(),\n  score: integer(\"score\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"leaderboard_score_idx\").on(table.score),\n]);\n\nexport const insertLeaderboardSchema = createInsertSchema(leaderboard).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertLeaderboard = z.infer<typeof insertLeaderboardSchema>;\nexport type Leaderboard = typeof leaderboard.$inferSelect;\n\n// Level Progress - stores user's level completion status\nexport const levelProgress = pgTable(\"level_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  levelNumber: integer(\"level_number\").notNull(),\n  bestScore: integer(\"best_score\").notNull().default(0),\n  isCompleted: integer(\"is_completed\").notNull().default(0),\n}, (table) => [\n  uniqueIndex(\"level_progress_user_level_idx\").on(table.userId, table.levelNumber),\n]);\n\nexport const insertLevelProgressSchema = createInsertSchema(levelProgress).omit({\n  id: true,\n});\n\nexport type InsertLevelProgress = z.infer<typeof insertLevelProgressSchema>;\nexport type LevelProgress = typeof levelProgress.$inferSelect;\n\n// User Analytics/Metadata - tracks user behavior (synced from client, then deleted locally)\nexport const userAnalytics = pgTable(\"user_analytics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  eventType: text(\"event_type\").notNull(), // 'level_play', 'level_success', 'level_fail', 'session_start', 'session_end'\n  levelNumber: integer(\"level_number\"),\n  score: integer(\"score\"),\n  playDuration: integer(\"play_duration\"), // in seconds\n  eventDate: text(\"event_date\").notNull(), // YYYY-MM-DD format\n  eventTime: timestamp(\"event_time\").notNull(),\n  sessionId: text(\"session_id\"),\n  deviceInfo: text(\"device_info\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertUserAnalyticsSchema = createInsertSchema(userAnalytics).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUserAnalytics = z.infer<typeof insertUserAnalyticsSchema>;\nexport type UserAnalytics = typeof userAnalytics.$inferSelect;\n\n// Error Logs - for debugging (synced from client, then deleted locally)\nexport const errorLogs = pgTable(\"error_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: 'cascade' }),\n  severity: text(\"severity\").notNull(), // 'error', 'warn', 'info'\n  category: text(\"category\").notNull(), // 'runtime', 'api', 'sync', 'game', 'asset'\n  message: text(\"message\").notNull(),\n  stack: text(\"stack\"),\n  component: text(\"component\"), // Component or subsystem that threw\n  currentScreen: text(\"current_screen\"), // Active route/screen\n  gameState: text(\"game_state\"), // JSON of relevant game state (sanitized)\n  apiInfo: text(\"api_info\"), // JSON of API request info (method, endpoint, status)\n  sessionId: text(\"session_id\"),\n  deviceInfo: text(\"device_info\"),\n  networkStatus: text(\"network_status\"), // 'online' or 'offline'\n  lastUserAction: text(\"last_user_action\"),\n  eventTime: timestamp(\"event_time\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertErrorLogSchema = createInsertSchema(errorLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertErrorLog = z.infer<typeof insertErrorLogSchema>;\nexport type ErrorLog = typeof errorLogs.$inferSelect;\n\n// App Update Policy - controls version checking and update requirements\nexport const appUpdatePolicy = pgTable(\"app_update_policy\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  latestVersion: text(\"latest_version\").notNull(), // e.g. \"1.2.0\"\n  minSupportedVersion: text(\"min_supported_version\").notNull(), // e.g. \"1.0.0\"\n  downloadUrl: text(\"download_url\").notNull(), // URL to download update\n  releaseNotes: text(\"release_notes\"), // What's new in latest version\n  isActive: integer(\"is_active\").notNull().default(1), // Only one active policy\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertAppUpdatePolicySchema = createInsertSchema(appUpdatePolicy).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertAppUpdatePolicy = z.infer<typeof insertAppUpdatePolicySchema>;\nexport type AppUpdatePolicy = typeof appUpdatePolicy.$inferSelect;\n\n// Daily Lab Orders - rotating daily puzzles with special rewards\nexport const dailyLabOrders = pgTable(\"daily_lab_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderDate: text(\"order_date\").notNull(), // YYYY-MM-DD format\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  difficulty: text(\"difficulty\").notNull(), // 'easy', 'medium', 'hard'\n  targetScore: integer(\"target_score\").notNull(),\n  coinReward: integer(\"coin_reward\").notNull(),\n  bonusReward: text(\"bonus_reward\"), // JSON of bonus item/cosmetic\n  modifiers: text(\"modifiers\"), // JSON of gameplay modifiers\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertDailyLabOrderSchema = createInsertSchema(dailyLabOrders).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertDailyLabOrder = z.infer<typeof insertDailyLabOrderSchema>;\nexport type DailyLabOrder = typeof dailyLabOrders.$inferSelect;\n\n// Daily Order Completions - tracks which users completed which daily orders\nexport const dailyOrderCompletions = pgTable(\"daily_order_completions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  orderDate: text(\"order_date\").notNull(),\n  scoreAchieved: integer(\"score_achieved\").notNull(),\n  completedAt: timestamp(\"completed_at\").notNull().defaultNow(),\n}, (table) => [\n  uniqueIndex(\"daily_completions_user_date_idx\").on(table.userId, table.orderDate),\n]);\n\nexport const insertDailyOrderCompletionSchema = createInsertSchema(dailyOrderCompletions).omit({\n  id: true,\n  completedAt: true,\n});\n\nexport type InsertDailyOrderCompletion = z.infer<typeof insertDailyOrderCompletionSchema>;\nexport type DailyOrderCompletion = typeof dailyOrderCompletions.$inferSelect;\n\n// Weekly Community Goals - cooperative progress meter\nexport const weeklyGoals = pgTable(\"weekly_goals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  weekStart: text(\"week_start\").notNull(), // YYYY-MM-DD (Monday)\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  targetValue: integer(\"target_value\").notNull(),\n  currentValue: integer(\"current_value\").notNull().default(0),\n  goalType: text(\"goal_type\").notNull(), // 'total_placements', 'total_score', 'levels_completed', etc.\n  rewardType: text(\"reward_type\").notNull(), // 'cosmetic', 'coins', 'badge'\n  rewardData: text(\"reward_data\"), // JSON of reward details\n  isCompleted: integer(\"is_completed\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertWeeklyGoalSchema = createInsertSchema(weeklyGoals).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertWeeklyGoal = z.infer<typeof insertWeeklyGoalSchema>;\nexport type WeeklyGoal = typeof weeklyGoals.$inferSelect;\n\n// Weekly Goal Contributions - tracks individual contributions\nexport const weeklyGoalContributions = pgTable(\"weekly_goal_contributions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  weekStart: text(\"week_start\").notNull(),\n  contribution: integer(\"contribution\").notNull().default(0),\n  lastUpdated: timestamp(\"last_updated\").notNull().defaultNow(),\n}, (table) => [\n  uniqueIndex(\"weekly_contributions_user_week_idx\").on(table.userId, table.weekStart),\n]);\n\nexport const insertWeeklyGoalContributionSchema = createInsertSchema(weeklyGoalContributions).omit({\n  id: true,\n  lastUpdated: true,\n});\n\nexport type InsertWeeklyGoalContribution = z.infer<typeof insertWeeklyGoalContributionSchema>;\nexport type WeeklyGoalContribution = typeof weeklyGoalContributions.$inferSelect;\n\n// Achievements - tiered badges with rewards\nexport const achievements = pgTable(\"achievements\", {\n  id: varchar(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\").notNull(), // 'mastery', 'collection', 'social', 'challenge'\n  tier: integer(\"tier\").notNull(), // 1 = bronze, 2 = silver, 3 = gold\n  requirement: integer(\"requirement\").notNull(), // target value to unlock\n  coinReward: integer(\"coin_reward\").notNull(),\n  badgeIcon: text(\"badge_icon\").notNull(), // emoji or icon identifier\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertAchievementSchema = createInsertSchema(achievements).omit({\n  createdAt: true,\n});\n\nexport type InsertAchievement = z.infer<typeof insertAchievementSchema>;\nexport type Achievement = typeof achievements.$inferSelect;\n\n// User Achievement Progress - tracks progress toward achievements\nexport const userAchievementProgress = pgTable(\"user_achievement_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  achievementId: varchar(\"achievement_id\").notNull().references(() => achievements.id, { onDelete: 'cascade' }),\n  currentProgress: integer(\"current_progress\").notNull().default(0),\n  isUnlocked: integer(\"is_unlocked\").notNull().default(0),\n  isClaimed: integer(\"is_claimed\").notNull().default(0),\n  unlockedAt: timestamp(\"unlocked_at\"),\n  claimedAt: timestamp(\"claimed_at\"),\n}, (table) => [\n  uniqueIndex(\"user_achievement_progress_user_achievement_idx\").on(table.userId, table.achievementId),\n]);\n\nexport const insertUserAchievementProgressSchema = createInsertSchema(userAchievementProgress).omit({\n  id: true,\n});\n\nexport type InsertUserAchievementProgress = z.infer<typeof insertUserAchievementProgressSchema>;\nexport type UserAchievementProgress = typeof userAchievementProgress.$inferSelect;\n","path":null,"size_bytes":11678,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/lib/game-constants.ts":{"content":"// Game Constants for Kikteria - Bacteria Placement Game\n\nexport type GameState = 'MENU' | 'LEVEL_SELECT' | 'PLAYING' | 'PAUSED' | 'GAME_OVER' | 'SHOP' | 'WIN' | 'CELEBRATING' | 'CHRONICLES' | 'CODEX' | 'MUTATION_CHOICE' | 'ENDLESS_MODE' | 'ENDLESS_PLAYING';\n\n// Vibration pattern types\nexport type VibrationPattern = 'horizontal' | 'vertical' | 'circular' | 'pulse' | 'diagonal';\n\n// Basic shape types that make up figures\nexport type ShapeType = 'circle' | 'square' | 'triangle' | 'line' | 'oval' | 'rect';\n\n// Single shape component of a figure\nexport interface ShapeComponent {\n  type: ShapeType;\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n  rotation: number;\n  color: string;\n  strokeColor?: string;\n  strokeWidth?: number;\n}\n\n// Figure template\nexport interface FigureTemplate {\n  id: string;\n  name: string;\n  shapes: ShapeComponent[];\n  vibrationPattern: VibrationPattern;\n  vibrationSpeed: number;\n  vibrationAmplitude: number;\n  baseScale: number;\n  rarity: 'common' | 'rare' | 'epic';\n  coinValue: number;\n}\n\n// Instance of a placed or queued figure\nexport interface FigureInstance {\n  id: string;\n  templateId: string;\n  x: number;\n  y: number;\n  rotation: number;\n  scale: number;\n  vibrationOffset: number;\n  isPlaced: boolean;\n}\n\nexport const GAME_CONFIG = {\n  REFERENCE_WIDTH: 540,\n  REFERENCE_HEIGHT: 720,\n  MAX_CANVAS_WIDTH: 600,\n  MAX_CANVAS_HEIGHT: 800,\n  MIN_SCALE: 0.65,\n  MAX_SCALE: 1.1,\n  ASPECT_RATIO: 3 / 4,\n  CANVAS_PADDING: 50,\n  FIGURE_BASE_SIZE: 35,\n  COLLISION_PADDING: 5,\n  QUEUE_SIZE: 3,\n  STARTING_BOMBS: 2,\n  FIGURES_PER_ROUND: 15,\n  GAME_TIME: 15,\n  TIME_BONUS_PER_FIGURE: 1,\n  BOMB_BLAST_RADIUS: 150,\n  \n  COLORS: {\n    BACKGROUND: '#0E1C1F',\n    GRID: '#1A3038',\n    PREVIEW_AREA: '#123842',\n    PLACED_BORDER: '#22F2A2',\n    COLLISION_WARNING: '#FF4444',\n  }\n} as const;\n\nexport function getCanvasScaleFactor(canvasWidth: number, canvasHeight: number): number {\n  const widthRatio = canvasWidth / GAME_CONFIG.REFERENCE_WIDTH;\n  const heightRatio = canvasHeight / GAME_CONFIG.REFERENCE_HEIGHT;\n  const rawScale = Math.min(widthRatio, heightRatio);\n  return Math.max(GAME_CONFIG.MIN_SCALE, Math.min(GAME_CONFIG.MAX_SCALE, rawScale));\n}\n\nexport function calculateCanvasDimensions(containerWidth: number, containerHeight: number): { width: number; height: number } {\n  // First, fit within container while maintaining aspect ratio\n  let width = containerWidth;\n  let height = width / GAME_CONFIG.ASPECT_RATIO;\n  \n  // If height exceeds container, constrain by height instead\n  if (height > containerHeight) {\n    height = containerHeight;\n    width = height * GAME_CONFIG.ASPECT_RATIO;\n  }\n  \n  // Apply max constraints\n  if (width > GAME_CONFIG.MAX_CANVAS_WIDTH) {\n    width = GAME_CONFIG.MAX_CANVAS_WIDTH;\n    height = width / GAME_CONFIG.ASPECT_RATIO;\n  }\n  if (height > GAME_CONFIG.MAX_CANVAS_HEIGHT) {\n    height = GAME_CONFIG.MAX_CANVAS_HEIGHT;\n    width = height * GAME_CONFIG.ASPECT_RATIO;\n  }\n  \n  return { width: Math.floor(width), height: Math.floor(height) };\n}\n\nexport function getScaledValue(baseValue: number, scaleFactor: number): number {\n  return baseValue * scaleFactor;\n}\n\nexport function getVibrationEnvelope(template: FigureTemplate, scale: number, canvasScale: number = 1): number {\n  const baseAmplitude = template.vibrationAmplitude * canvasScale;\n  const baseRadius = GAME_CONFIG.FIGURE_BASE_SIZE * scale * canvasScale;\n  \n  switch (template.vibrationPattern) {\n    case 'diagonal':\n      return baseAmplitude * 0.7 * Math.sqrt(2);\n    case 'circular':\n      return baseAmplitude;\n    case 'pulse':\n      return baseRadius * 0.1;\n    case 'horizontal':\n    case 'vertical':\n    default:\n      return baseAmplitude;\n  }\n}\n\nexport function computeEffectiveRadius(figure: FigureInstance, templates: FigureTemplate[], bombTemplate: FigureTemplate, canvasScale: number = 1): number {\n  const template = figure.templateId === 'bomb' \n    ? bombTemplate \n    : templates.find(t => t.id === figure.templateId);\n  \n  if (!template) return GAME_CONFIG.FIGURE_BASE_SIZE * figure.scale * canvasScale;\n  \n  const baseRadius = GAME_CONFIG.FIGURE_BASE_SIZE * figure.scale * canvasScale;\n  const envelope = getVibrationEnvelope(template, figure.scale, canvasScale);\n  \n  return baseRadius + envelope;\n}\n\nexport interface LevelConfig {\n  level: number;\n  name: string;\n  figuresCount: number;\n  startTime: number;\n  timeBonusPerFigure: number;\n  speedMultiplier: number;\n  sizeMultiplier: number;\n  areaShrinkRate: number;\n  isMilestone?: boolean;\n  isBreather?: boolean;\n}\n\nconst LEVEL_ARCS = [\n  { start: 1, end: 10, theme: 'Petri Lab', names: ['Petri Dish', 'Lab Sample', 'Culture Growth', 'First Colony', 'Cell Division', 'Micro World', 'Quiet Growth', 'Bacteria Bloom', 'Specimen A', 'Lab Graduation'] },\n  { start: 11, end: 20, theme: 'Containment', names: ['Containment', 'Sealed Chamber', 'Quarantine', 'Isolation Ward', 'Pressure Test', 'Locked Lab', 'Safe Zone', 'Protocol Alpha', 'Warning Signs', 'Containment Breach'] },\n  { start: 21, end: 30, theme: 'Outbreak', names: ['First Outbreak', 'Spreading Fast', 'Chain Reaction', 'Emergency', 'Red Alert', 'Critical Mass', 'Calm Storm', 'Viral Load', 'Infection Peak', 'Ground Zero'] },\n  { start: 31, end: 40, theme: 'Mutation', names: ['Mutation X', 'Genetic Drift', 'Evolution', 'Adaptation', 'New Strain', 'Resistance', 'Recovery Phase', 'Mutant Colony', 'DNA Shift', 'Mutation Master'] },\n  { start: 41, end: 50, theme: 'Epidemic', names: ['Epidemic Dawn', 'Wave Two', 'Hospital Chaos', 'Survival Mode', 'Last Stand', 'Hope Fading', 'Second Wind', 'Desperate Measures', 'Critical Hour', 'Epidemic End'] },\n  { start: 51, end: 60, theme: 'Global Crisis', names: ['Global Spread', 'Borders Fall', 'World Alert', 'International', 'Crisis Summit', 'United Front', 'Brief Respite', 'Counter Attack', 'Turning Point', 'Crisis Control'] },\n  { start: 61, end: 70, theme: 'Resistance', names: ['Resistance Forms', 'Immune Response', 'Fighting Back', 'Antibody War', 'Defense Line', 'Strong Hold', 'Battle Rest', 'Offensive Push', 'Victory Near', 'Resistance Victory'] },\n  { start: 71, end: 80, theme: 'Eradication', names: ['Eradication Start', 'Cleansing Wave', 'Purification', 'Sterilization', 'Clean Sweep', 'Final Push', 'Calm Before', 'Last Bacteria', 'Almost Done', 'Eradication Complete'] },\n  { start: 81, end: 90, theme: 'Aftermath', names: ['Aftermath', 'Recovery', 'Rebuilding', 'New Normal', 'Lessons Learned', 'Prevention', 'Rest & Heal', 'Vigilance', 'Forever Changed', 'Aftermath Master'] },\n  { start: 91, end: 100, theme: 'Apex', names: ['Apex Challenge', 'Ultimate Test', 'Grand Master', 'Legend Trial', 'Impossible Odds', 'Perfect Storm', 'Final Rest', 'Championship', 'Hall of Fame', 'Extinction Event'] },\n];\n\nconst MILESTONE_LEVELS = [10, 25, 50, 75, 100];\nconst BREATHER_LEVELS = [7, 17, 27, 37, 47, 57, 67, 77, 87, 97];\n\nfunction generateLevelConfig(level: number): LevelConfig {\n  const isMilestone = MILESTONE_LEVELS.includes(level);\n  const isBreather = BREATHER_LEVELS.includes(level);\n  \n  const arc = LEVEL_ARCS.find(a => level >= a.start && level <= a.end);\n  const nameIndex = arc ? level - arc.start : 0;\n  const name = arc?.names[nameIndex] || `Level ${level}`;\n  \n  let figuresCount = Math.round(8 + 30 * (1 - Math.exp(-0.045 * (level - 1))));\n  let startTime = Math.max(10, Math.min(22, 22 - 0.12 * level));\n  let speedMultiplier = 1 + 1.9 * (1 - Math.exp(-0.05 * level));\n  let sizeMultiplier = 0.9 + 0.55 * Math.min(1, Math.pow(level / 90, 1.4));\n  let areaShrinkRate = level <= 10 ? 0 : Math.pow(Math.max(0, 0.2 * (level - 10)), 0.75) / 2;\n  \n  let timeBonusPerFigure: number;\n  if (level <= 10) timeBonusPerFigure = 2;\n  else if (level <= 25) timeBonusPerFigure = 1.5;\n  else if (level <= 50) timeBonusPerFigure = 1;\n  else if (level <= 75) timeBonusPerFigure = 0.7;\n  else timeBonusPerFigure = 0.5;\n  \n  if (isBreather) {\n    figuresCount = Math.max(8, Math.round(figuresCount * 0.85));\n    startTime = Math.min(22, startTime * 1.15);\n    speedMultiplier = Math.max(1, speedMultiplier * 0.9);\n    timeBonusPerFigure = Math.min(2, timeBonusPerFigure * 1.2);\n  }\n  \n  if (isMilestone) {\n    figuresCount = Math.round(figuresCount * 1.15);\n    speedMultiplier = speedMultiplier * 1.1;\n    startTime = Math.max(10, startTime * 0.95);\n  }\n  \n  speedMultiplier = Math.min(2.9, speedMultiplier);\n  sizeMultiplier = Math.min(1.45, sizeMultiplier);\n  areaShrinkRate = Math.min(3.5, areaShrinkRate);\n  figuresCount = Math.min(40, figuresCount);\n  \n  return {\n    level,\n    name,\n    figuresCount: Math.round(figuresCount),\n    startTime: Math.round(startTime * 10) / 10,\n    timeBonusPerFigure: Math.round(timeBonusPerFigure * 10) / 10,\n    speedMultiplier: Math.round(speedMultiplier * 100) / 100,\n    sizeMultiplier: Math.round(sizeMultiplier * 100) / 100,\n    areaShrinkRate: Math.round(areaShrinkRate * 100) / 100,\n    isMilestone,\n    isBreather,\n  };\n}\n\nexport const LEVELS: LevelConfig[] = Array.from({ length: 100 }, (_, i) => generateLevelConfig(i + 1));\n\n// Creative funny-ugly bacteria figures with expressive faces\nexport const BACTERIA_TEMPLATES: FigureTemplate[] = [\n  // 1. Blobby - A goofy yellow slime\n  {\n    id: 'blobby',\n    name: 'Blobby',\n    baseScale: 1.0,\n    shapes: [\n      // Body - irregular blob shape made of overlapping circles\n      { type: 'circle', offsetX: 0, offsetY: 5, width: 50, height: 50, rotation: 0, color: '#FFE066', strokeColor: '#E6B800', strokeWidth: 3 },\n      { type: 'circle', offsetX: -15, offsetY: 0, width: 30, height: 30, rotation: 0, color: '#FFE066', strokeColor: '#E6B800', strokeWidth: 2 },\n      { type: 'circle', offsetX: 18, offsetY: 2, width: 28, height: 28, rotation: 0, color: '#FFE066', strokeColor: '#E6B800', strokeWidth: 2 },\n      // Big goofy eyes - different sizes\n      { type: 'circle', offsetX: -10, offsetY: -8, width: 22, height: 22, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: 12, offsetY: -5, width: 18, height: 18, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      // Pupils looking different directions\n      { type: 'circle', offsetX: -6, offsetY: -6, width: 10, height: 10, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 16, offsetY: -3, width: 8, height: 8, rotation: 0, color: '#000000' },\n      // Silly wide smile\n      { type: 'circle', offsetX: 0, offsetY: 12, width: 28, height: 16, rotation: 0, color: '#FF6B6B', strokeColor: '#CC4444', strokeWidth: 2 },\n      { type: 'circle', offsetX: 0, offsetY: 8, width: 28, height: 12, rotation: 0, color: '#FFE066' },\n      // Blush spots\n      { type: 'circle', offsetX: -22, offsetY: 5, width: 10, height: 8, rotation: 0, color: '#FFB3B3' },\n      { type: 'circle', offsetX: 22, offsetY: 5, width: 10, height: 8, rotation: 0, color: '#FFB3B3' },\n    ],\n    vibrationPattern: 'pulse',\n    vibrationSpeed: 5,\n    vibrationAmplitude: 8,\n    rarity: 'common',\n    coinValue: 12\n  },\n  // 2. Grumpus - An angry green square\n  {\n    id: 'grumpus',\n    name: 'Grumpus',\n    baseScale: 0.9,\n    shapes: [\n      // Blocky body\n      { type: 'square', offsetX: 0, offsetY: 0, width: 48, height: 48, rotation: 3, color: '#7FD17F', strokeColor: '#4CAF50', strokeWidth: 3 },\n      // Angry slanted eyes\n      { type: 'square', offsetX: -12, offsetY: -8, width: 14, height: 10, rotation: -15, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'square', offsetX: 12, offsetY: -8, width: 14, height: 10, rotation: 15, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: -10, offsetY: -6, width: 6, height: 6, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 14, offsetY: -6, width: 6, height: 6, rotation: 0, color: '#000000' },\n      // Angry eyebrows\n      { type: 'rect', offsetX: -14, offsetY: -16, width: 16, height: 4, rotation: 25, color: '#2E7D32' },\n      { type: 'rect', offsetX: 14, offsetY: -16, width: 16, height: 4, rotation: -25, color: '#2E7D32' },\n      // Grumpy frown\n      { type: 'rect', offsetX: 0, offsetY: 14, width: 24, height: 6, rotation: 0, color: '#4CAF50', strokeColor: '#2E7D32', strokeWidth: 2 },\n      // Little legs\n      { type: 'rect', offsetX: -14, offsetY: 28, width: 8, height: 12, rotation: 0, color: '#4CAF50', strokeColor: '#2E7D32', strokeWidth: 2 },\n      { type: 'rect', offsetX: 14, offsetY: 28, width: 8, height: 12, rotation: 0, color: '#4CAF50', strokeColor: '#2E7D32', strokeWidth: 2 },\n    ],\n    vibrationPattern: 'horizontal',\n    vibrationSpeed: 8,\n    vibrationAmplitude: 12,\n    rarity: 'common',\n    coinValue: 10\n  },\n  // 3. Wobbly - A wobbly blue teardrop\n  {\n    id: 'wobbly',\n    name: 'Wobbly',\n    baseScale: 1.1,\n    shapes: [\n      // Teardrop body\n      { type: 'circle', offsetX: 0, offsetY: 8, width: 55, height: 55, rotation: 0, color: '#64B5F6', strokeColor: '#1976D2', strokeWidth: 3 },\n      { type: 'triangle', offsetX: 0, offsetY: -25, width: 30, height: 35, rotation: 0, color: '#64B5F6', strokeColor: '#1976D2', strokeWidth: 3 },\n      // Worried eyes\n      { type: 'circle', offsetX: -12, offsetY: 0, width: 20, height: 24, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: 12, offsetY: 0, width: 20, height: 24, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: -12, offsetY: 4, width: 10, height: 10, rotation: 0, color: '#1565C0' },\n      { type: 'circle', offsetX: 12, offsetY: 4, width: 10, height: 10, rotation: 0, color: '#1565C0' },\n      // Worried eyebrows\n      { type: 'rect', offsetX: -12, offsetY: -14, width: 14, height: 3, rotation: -20, color: '#1976D2' },\n      { type: 'rect', offsetX: 12, offsetY: -14, width: 14, height: 3, rotation: 20, color: '#1976D2' },\n      // Small worried mouth\n      { type: 'circle', offsetX: 0, offsetY: 18, width: 14, height: 10, rotation: 0, color: '#1565C0' },\n      // Sweat drop\n      { type: 'circle', offsetX: 22, offsetY: -5, width: 8, height: 10, rotation: 0, color: '#90CAF9' },\n    ],\n    vibrationPattern: 'vertical',\n    vibrationSpeed: 6,\n    vibrationAmplitude: 14,\n    rarity: 'common',\n    coinValue: 10\n  },\n  // 4. Cyclops - A one-eyed purple monster\n  {\n    id: 'cyclops',\n    name: 'Cyclops',\n    baseScale: 1.2,\n    shapes: [\n      // Round body\n      { type: 'circle', offsetX: 0, offsetY: 0, width: 58, height: 58, rotation: 0, color: '#BA68C8', strokeColor: '#7B1FA2', strokeWidth: 3 },\n      // Horns\n      { type: 'triangle', offsetX: -20, offsetY: -28, width: 14, height: 20, rotation: -15, color: '#7B1FA2', strokeColor: '#4A148C', strokeWidth: 2 },\n      { type: 'triangle', offsetX: 20, offsetY: -28, width: 14, height: 20, rotation: 15, color: '#7B1FA2', strokeColor: '#4A148C', strokeWidth: 2 },\n      // Giant single eye\n      { type: 'circle', offsetX: 0, offsetY: -5, width: 36, height: 36, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 3 },\n      { type: 'circle', offsetX: 0, offsetY: -5, width: 18, height: 18, rotation: 0, color: '#E040FB' },\n      { type: 'circle', offsetX: 0, offsetY: -5, width: 8, height: 8, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: -5, offsetY: -10, width: 6, height: 6, rotation: 0, color: '#FFFFFF' },\n      // Wide toothy grin\n      { type: 'rect', offsetX: 0, offsetY: 18, width: 30, height: 12, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'rect', offsetX: -10, offsetY: 18, width: 3, height: 12, rotation: 0, color: '#4A148C' },\n      { type: 'rect', offsetX: 0, offsetY: 18, width: 3, height: 12, rotation: 0, color: '#4A148C' },\n      { type: 'rect', offsetX: 10, offsetY: 18, width: 3, height: 12, rotation: 0, color: '#4A148C' },\n    ],\n    vibrationPattern: 'circular',\n    vibrationSpeed: 4,\n    vibrationAmplitude: 10,\n    rarity: 'rare',\n    coinValue: 25\n  },\n  // 5. Squish - A pink squishy blob\n  {\n    id: 'squish',\n    name: 'Squish',\n    baseScale: 0.85,\n    shapes: [\n      // Squishy body\n      { type: 'oval', offsetX: 0, offsetY: 0, width: 55, height: 40, rotation: 0, color: '#F48FB1', strokeColor: '#EC407A', strokeWidth: 3 },\n      // Cute round eyes\n      { type: 'circle', offsetX: -14, offsetY: -5, width: 16, height: 18, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: 14, offsetY: -5, width: 16, height: 18, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: -12, offsetY: -3, width: 8, height: 8, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 16, offsetY: -3, width: 8, height: 8, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: -10, offsetY: -5, width: 3, height: 3, rotation: 0, color: '#FFFFFF' },\n      { type: 'circle', offsetX: 18, offsetY: -5, width: 3, height: 3, rotation: 0, color: '#FFFFFF' },\n      // Cat-like mouth\n      { type: 'triangle', offsetX: 0, offsetY: 8, width: 8, height: 6, rotation: 180, color: '#EC407A' },\n      // Rosy cheeks\n      { type: 'circle', offsetX: -22, offsetY: 2, width: 10, height: 8, rotation: 0, color: '#FF8A80' },\n      { type: 'circle', offsetX: 22, offsetY: 2, width: 10, height: 8, rotation: 0, color: '#FF8A80' },\n      // Little ears\n      { type: 'triangle', offsetX: -22, offsetY: -18, width: 14, height: 16, rotation: -20, color: '#F48FB1', strokeColor: '#EC407A', strokeWidth: 2 },\n      { type: 'triangle', offsetX: 22, offsetY: -18, width: 14, height: 16, rotation: 20, color: '#F48FB1', strokeColor: '#EC407A', strokeWidth: 2 },\n    ],\n    vibrationPattern: 'diagonal',\n    vibrationSpeed: 7,\n    vibrationAmplitude: 9,\n    rarity: 'common',\n    coinValue: 10\n  },\n  // 6. Chompy - An orange monster with big teeth\n  {\n    id: 'chompy',\n    name: 'Chompy',\n    baseScale: 1.0,\n    shapes: [\n      // Round body\n      { type: 'circle', offsetX: 0, offsetY: 0, width: 52, height: 52, rotation: 0, color: '#FF9800', strokeColor: '#E65100', strokeWidth: 3 },\n      // Small angry eyes\n      { type: 'circle', offsetX: -12, offsetY: -12, width: 14, height: 14, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: 12, offsetY: -12, width: 14, height: 14, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: -10, offsetY: -10, width: 6, height: 6, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 14, offsetY: -10, width: 6, height: 6, rotation: 0, color: '#000000' },\n      // Angry eyebrows\n      { type: 'rect', offsetX: -14, offsetY: -22, width: 14, height: 4, rotation: 20, color: '#E65100' },\n      { type: 'rect', offsetX: 14, offsetY: -22, width: 14, height: 4, rotation: -20, color: '#E65100' },\n      // HUGE mouth with teeth\n      { type: 'circle', offsetX: 0, offsetY: 8, width: 40, height: 30, rotation: 0, color: '#D32F2F', strokeColor: '#B71C1C', strokeWidth: 2 },\n      // Top teeth\n      { type: 'triangle', offsetX: -14, offsetY: 2, width: 8, height: 12, rotation: 180, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      { type: 'triangle', offsetX: -5, offsetY: 2, width: 10, height: 14, rotation: 180, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 5, offsetY: 2, width: 10, height: 14, rotation: 180, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 14, offsetY: 2, width: 8, height: 12, rotation: 180, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      // Bottom teeth\n      { type: 'triangle', offsetX: -10, offsetY: 18, width: 8, height: 10, rotation: 0, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 0, offsetY: 18, width: 10, height: 12, rotation: 0, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 10, offsetY: 18, width: 8, height: 10, rotation: 0, color: '#FFFFFF', strokeColor: '#DDD', strokeWidth: 1 },\n    ],\n    vibrationPattern: 'horizontal',\n    vibrationSpeed: 9,\n    vibrationAmplitude: 16,\n    rarity: 'rare',\n    coinValue: 28\n  },\n  // 7. Derp - A derpy looking creature\n  {\n    id: 'derp',\n    name: 'Derp',\n    baseScale: 0.95,\n    shapes: [\n      // Potato-shaped body\n      { type: 'oval', offsetX: 0, offsetY: 0, width: 50, height: 45, rotation: 8, color: '#A1887F', strokeColor: '#6D4C41', strokeWidth: 3 },\n      // Derpy misaligned eyes\n      { type: 'circle', offsetX: -14, offsetY: -8, width: 20, height: 16, rotation: -10, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'circle', offsetX: 10, offsetY: -2, width: 16, height: 20, rotation: 10, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      // Pupils looking different ways\n      { type: 'circle', offsetX: -18, offsetY: -6, width: 8, height: 8, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 6, offsetY: 2, width: 7, height: 7, rotation: 0, color: '#000000' },\n      // Crooked smile\n      { type: 'rect', offsetX: -5, offsetY: 14, width: 22, height: 6, rotation: 12, color: '#5D4037', strokeColor: '#3E2723', strokeWidth: 2 },\n      // Tongue sticking out\n      { type: 'circle', offsetX: 8, offsetY: 18, width: 10, height: 8, rotation: 0, color: '#EF5350' },\n      // Messy hair/bumps\n      { type: 'circle', offsetX: -12, offsetY: -25, width: 12, height: 10, rotation: 0, color: '#8D6E63' },\n      { type: 'circle', offsetX: 0, offsetY: -28, width: 10, height: 12, rotation: 0, color: '#8D6E63' },\n      { type: 'circle', offsetX: 14, offsetY: -24, width: 14, height: 10, rotation: 0, color: '#8D6E63' },\n    ],\n    vibrationPattern: 'diagonal',\n    vibrationSpeed: 5,\n    vibrationAmplitude: 11,\n    rarity: 'common',\n    coinValue: 10\n  },\n  // 8. Ghosty - A spooky but cute ghost\n  {\n    id: 'ghosty',\n    name: 'Ghosty',\n    baseScale: 1.05,\n    shapes: [\n      // Ghost body\n      { type: 'circle', offsetX: 0, offsetY: -8, width: 48, height: 48, rotation: 0, color: '#F5F5F5', strokeColor: '#BDBDBD', strokeWidth: 2 },\n      { type: 'rect', offsetX: 0, offsetY: 16, width: 48, height: 28, rotation: 0, color: '#F5F5F5', strokeColor: '#BDBDBD', strokeWidth: 2 },\n      // Wavy bottom\n      { type: 'circle', offsetX: -16, offsetY: 32, width: 16, height: 12, rotation: 0, color: '#F5F5F5' },\n      { type: 'circle', offsetX: 0, offsetY: 35, width: 16, height: 12, rotation: 0, color: '#F5F5F5' },\n      { type: 'circle', offsetX: 16, offsetY: 32, width: 16, height: 12, rotation: 0, color: '#F5F5F5' },\n      // Big spooky eyes\n      { type: 'circle', offsetX: -10, offsetY: -8, width: 18, height: 22, rotation: 0, color: '#212121' },\n      { type: 'circle', offsetX: 10, offsetY: -8, width: 18, height: 22, rotation: 0, color: '#212121' },\n      // Eye highlights\n      { type: 'circle', offsetX: -8, offsetY: -12, width: 6, height: 6, rotation: 0, color: '#FFFFFF' },\n      { type: 'circle', offsetX: 12, offsetY: -12, width: 6, height: 6, rotation: 0, color: '#FFFFFF' },\n      // Small surprised mouth\n      { type: 'circle', offsetX: 0, offsetY: 10, width: 12, height: 14, rotation: 0, color: '#424242' },\n      // Blush\n      { type: 'circle', offsetX: -20, offsetY: 0, width: 8, height: 6, rotation: 0, color: '#FFCDD2' },\n      { type: 'circle', offsetX: 20, offsetY: 0, width: 8, height: 6, rotation: 0, color: '#FFCDD2' },\n    ],\n    vibrationPattern: 'vertical',\n    vibrationSpeed: 4,\n    vibrationAmplitude: 12,\n    rarity: 'rare',\n    coinValue: 25\n  },\n  // 9. Spiky - A red spiky ball\n  {\n    id: 'spiky',\n    name: 'Spiky',\n    baseScale: 0.8,\n    shapes: [\n      // Core body\n      { type: 'circle', offsetX: 0, offsetY: 0, width: 40, height: 40, rotation: 0, color: '#EF5350', strokeColor: '#C62828', strokeWidth: 3 },\n      // Spikes around\n      { type: 'triangle', offsetX: 0, offsetY: -28, width: 12, height: 18, rotation: 0, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 20, offsetY: -20, width: 12, height: 16, rotation: 45, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 28, offsetY: 0, width: 12, height: 18, rotation: 90, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 20, offsetY: 20, width: 12, height: 16, rotation: 135, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: 0, offsetY: 28, width: 12, height: 18, rotation: 180, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: -20, offsetY: 20, width: 12, height: 16, rotation: 225, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: -28, offsetY: 0, width: 12, height: 18, rotation: 270, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      { type: 'triangle', offsetX: -20, offsetY: -20, width: 12, height: 16, rotation: 315, color: '#C62828', strokeColor: '#B71C1C', strokeWidth: 1 },\n      // Angry eyes\n      { type: 'circle', offsetX: -8, offsetY: -5, width: 12, height: 12, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 1 },\n      { type: 'circle', offsetX: 8, offsetY: -5, width: 12, height: 12, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 1 },\n      { type: 'circle', offsetX: -6, offsetY: -4, width: 5, height: 5, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 10, offsetY: -4, width: 5, height: 5, rotation: 0, color: '#000000' },\n      // Angry mouth\n      { type: 'rect', offsetX: 0, offsetY: 8, width: 16, height: 5, rotation: 0, color: '#B71C1C' },\n    ],\n    vibrationPattern: 'circular',\n    vibrationSpeed: 8,\n    vibrationAmplitude: 8,\n    rarity: 'common',\n    coinValue: 10\n  },\n  // 10. Gloop - A toxic green slime\n  {\n    id: 'gloop',\n    name: 'Gloop',\n    baseScale: 1.15,\n    shapes: [\n      // Main slime body\n      { type: 'circle', offsetX: 0, offsetY: 5, width: 55, height: 50, rotation: 0, color: '#8BC34A', strokeColor: '#558B2F', strokeWidth: 3 },\n      // Dripping parts\n      { type: 'circle', offsetX: -18, offsetY: 20, width: 14, height: 18, rotation: 0, color: '#8BC34A', strokeColor: '#558B2F', strokeWidth: 2 },\n      { type: 'circle', offsetX: 20, offsetY: 22, width: 12, height: 20, rotation: 0, color: '#8BC34A', strokeColor: '#558B2F', strokeWidth: 2 },\n      { type: 'circle', offsetX: 5, offsetY: 25, width: 10, height: 16, rotation: 0, color: '#9CCC65', strokeColor: '#558B2F', strokeWidth: 2 },\n      // Sleepy half-closed eyes\n      { type: 'rect', offsetX: -12, offsetY: -5, width: 16, height: 10, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      { type: 'rect', offsetX: 12, offsetY: -5, width: 16, height: 10, rotation: 0, color: '#FFFFFF', strokeColor: '#333', strokeWidth: 2 },\n      // Droopy eyelids\n      { type: 'rect', offsetX: -12, offsetY: -8, width: 16, height: 6, rotation: 0, color: '#689F38' },\n      { type: 'rect', offsetX: 12, offsetY: -8, width: 16, height: 6, rotation: 0, color: '#689F38' },\n      // Pupils\n      { type: 'circle', offsetX: -12, offsetY: -2, width: 6, height: 6, rotation: 0, color: '#000000' },\n      { type: 'circle', offsetX: 12, offsetY: -2, width: 6, height: 6, rotation: 0, color: '#000000' },\n      // Drooling mouth\n      { type: 'rect', offsetX: 0, offsetY: 10, width: 18, height: 6, rotation: 0, color: '#558B2F' },\n      { type: 'circle', offsetX: 8, offsetY: 16, width: 6, height: 10, rotation: 0, color: '#CDDC39' },\n    ],\n    vibrationPattern: 'pulse',\n    vibrationSpeed: 3,\n    vibrationAmplitude: 6,\n    rarity: 'epic',\n    coinValue: 55\n  },\n];\n\n// Bacteria Dossiers - Encyclopedia entries for each bacteria\nexport interface BacteriaDossier {\n  id: string;\n  name: string;\n  classification: string;\n  personality: string;\n  backstory: string;\n  quirk: string;\n  rival: string;\n  favoriteActivity: string;\n  dangerLevel: 1 | 2 | 3 | 4 | 5;\n}\n\nexport const BACTERIA_DOSSIERS: BacteriaDossier[] = [\n  {\n    id: 'blobby',\n    name: 'Blobby',\n    classification: 'Amorphous Gigglicus',\n    personality: 'Cheerful, unpredictable, easily amused',\n    backstory: 'Blobby was the first Kikteria discovered in Petri Dish Alpha. Despite being the \"patient zero\" of the outbreak, Blobby seems blissfully unaware of the chaos it causes. Scientists suspect its constant pulsing is actually... laughter.',\n    quirk: 'Blushes bright pink when other bacteria get too close',\n    rival: 'Grumpus (who finds Blobby insufferably cheerful)',\n    favoriteActivity: 'Wobbling to imaginary music',\n    dangerLevel: 2\n  },\n  {\n    id: 'grumpus',\n    name: 'Grumpus',\n    classification: 'Cubus Irritabilis',\n    personality: 'Perpetually annoyed, territorial, stompy',\n    backstory: 'Grumpus evolved its square shape as a form of protest against \"all those round, squishy idiots.\" It vibrates horizontally because it\\'s constantly shaking with rage. Lab reports indicate it has never smiled. Not once.',\n    quirk: 'Its angry eyebrows twitch more when someone mentions Blobby',\n    rival: 'Blobby (too happy) and Derp (too stupid)',\n    favoriteActivity: 'Glaring at things',\n    dangerLevel: 3\n  },\n  {\n    id: 'wobbly',\n    name: 'Wobbly',\n    classification: 'Teardropus Anxieticus',\n    personality: 'Nervous, sweaty, perpetually worried',\n    backstory: 'Wobbly developed its teardrop shape from crying too much. It worries about everything - collisions, the timer, whether the other bacteria like it. The sweat drop is permanent. Therapy has been... ineffective.',\n    quirk: 'Vibrates faster when the timer gets low',\n    rival: 'Nobody (too scared to have rivals)',\n    favoriteActivity: 'Panicking about hypothetical scenarios',\n    dangerLevel: 2\n  },\n  {\n    id: 'cyclops',\n    name: 'Cyclops',\n    classification: 'Monoculus Hornicus',\n    personality: 'Watchful, smug, intimidating',\n    backstory: 'Cyclops traded its second eye for horns in a deal that \"seemed like a good idea at the time.\" It spends most of its time rotating slowly, maintaining eye contact with everyone simultaneously. Unsettling.',\n    quirk: 'That one giant eye never blinks. NEVER.',\n    rival: 'Ghosty (who keeps disappearing when Cyclops tries to stare)',\n    favoriteActivity: 'Intense, unblinking observation',\n    dangerLevel: 4\n  },\n  {\n    id: 'squish',\n    name: 'Squish',\n    classification: 'Flatulus Elasticus',\n    personality: 'Laid-back, stretchy, goes with the flow',\n    backstory: 'Squish got stepped on once and just... never recovered its original shape. But it\\'s cool with that. Everything is cool with Squish. Too cool. Scientists worry it might be in denial about its trauma.',\n    quirk: 'Sometimes stretches so thin it nearly phases through containment',\n    rival: 'Spiky (polar opposites in texture philosophy)',\n    favoriteActivity: 'Being horizontal',\n    dangerLevel: 2\n  },\n  {\n    id: 'chompy',\n    name: 'Chompy',\n    classification: 'Bittus Everythingus',\n    personality: 'Hungry, bitey, no concept of personal space',\n    backstory: 'Chompy bit through its first containment unit on Day 2. Then Day 3. Then every day after. Its massive teeth are actually surprisingly gentle - it just likes the FEELING of biting things. Still terrifying.',\n    quirk: 'Makes \"nom nom\" motions even when nothing is nearby',\n    rival: 'The containment walls (they know what they did)',\n    favoriteActivity: 'Chewing on abstract concepts',\n    dangerLevel: 4\n  },\n  {\n    id: 'derp',\n    name: 'Derp',\n    classification: 'Confusicus Maximus',\n    personality: 'Bewildered, spacey, accidentally destructive',\n    backstory: 'Nobody knows how Derp escaped Lab 7. Derp doesn\\'t know either. Derp doesn\\'t know much of anything. Those crossed eyes aren\\'t a medical condition - Derp is just trying REALLY hard to think. Results pending.',\n    quirk: 'Frequently bumps into walls while looking at nothing',\n    rival: 'Grumpus (who hates how oblivious Derp is to insults)',\n    favoriteActivity: 'Forgetting what it was doing',\n    dangerLevel: 3\n  },\n  {\n    id: 'ghosty',\n    name: 'Ghosty',\n    classification: 'Transparentus Spookicus',\n    personality: 'Mysterious, ethereal, dramatic',\n    backstory: 'Ghosty isn\\'t actually dead - it just has a flair for the theatrical. The translucent body is a genetic quirk it leans into HEAVILY. Insists on being called \"The Specter\" but nobody respects that.',\n    quirk: 'Dramatically fades in and out for no reason',\n    rival: 'Cyclops (hates being watched)',\n    favoriteActivity: 'Appearing suddenly to startle the other bacteria',\n    dangerLevel: 3\n  },\n  {\n    id: 'spiky',\n    name: 'Spiky',\n    classification: 'Pointus Extremus',\n    personality: 'Defensive, prickly (literally and emotionally)',\n    backstory: 'Spiky grew all those spines for protection, but now nobody wants to get close to it. This has made Spiky more defensive, which grew more spines. It\\'s a vicious cycle. Literally.',\n    quirk: 'New tiny spikes appear when it feels threatened',\n    rival: 'Squish (infuriatingly soft and approachable)',\n    favoriteActivity: 'Keeping everyone at arm\\'s length (spike\\'s length?)',\n    dangerLevel: 4\n  },\n  {\n    id: 'gloop',\n    name: 'Gloop',\n    classification: 'Slimeus Droolicius',\n    personality: 'Sleepy, drooly, surprisingly wise',\n    backstory: 'Gloop is the oldest Kikteria in the facility. It\\'s seen things. It knows things. It also drools constantly and falls asleep mid-sentence. Those half-closed eyes have witnessed the rise and fall of empires. Probably.',\n    quirk: 'The drool is actually a defense mechanism (gross but effective)',\n    rival: 'Nobody (too respected/feared by the others)',\n    favoriteActivity: 'Ancient meditation techniques (or just napping)',\n    dangerLevel: 5\n  }\n];\n\n// Lab Chronicles - Story content from Chief Microbiologist Lyra Voss\nexport interface LabChronicle {\n  level: number;\n  title: string;\n  date: string;\n  content: string;\n  signature: string;\n}\n\nexport const LAB_CHRONICLES: LabChronicle[] = [\n  {\n    level: 1,\n    title: \"First Contact\",\n    date: \"Day 1 - 0800 hours\",\n    content: \"We've discovered something unprecedented. The organisms in Petri Dish Alpha are unlike anything in our databases. They vibrate constantly, as if dancing to music we cannot hear. Initial containment protocols engaged. I've nicknamed them 'Kikteria' - they seem to kick and squirm with personality. Each one appears unique. Must ensure they never touch - preliminary tests show... explosive reactions when they make contact.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 2,\n    title: \"Growing Concerns\",\n    date: \"Day 3 - 1430 hours\",\n    content: \"The lab samples are multiplying faster than anticipated. We've identified distinct personality types among the Kikteria. 'Blobby' is docile but unpredictable. 'Grumpus' seems perpetually agitated. They're more than microbes - they have faces, expressions, perhaps even emotions? The containment team is stretched thin. Every placement matters now. One wrong move and the chain reaction could compromise the entire facility.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 3,\n    title: \"Culture Shock\",\n    date: \"Day 7 - 0600 hours\",\n    content: \"The culture is growing beyond our control. New variants keep emerging - 'Wobbly' leaves trails of anxiety wherever it moves. 'Cyclops' watches everything with that single, unblinking eye. We've developed tactical bombs to clear overcrowded zones, but they're a last resort. The specimens seem to WANT to touch each other. Is it aggression? Loneliness? I haven't slept in 36 hours. The vibrations haunt my dreams.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 4,\n    title: \"Outbreak\",\n    date: \"Day 12 - 2200 hours\",\n    content: \"Containment breach in Sector 7. It's official - we have an outbreak. 'Spikeball' and 'Fuzzy' escaped their chambers and caused a cascade failure. Three labs quarantined. The Kikteria are faster now, more aggressive in their movements. We've deployed shields to absorb accidental collisions. Second chance protocols activated. Director Chen is demanding results. If we can't contain this... I don't want to think about the alternative.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 5,\n    title: \"Pandemic Protocol\",\n    date: \"Day 18 - 0315 hours\",\n    content: \"Pandemic-level protocols now in effect. The Kikteria have spread to every wing of the facility. 'Zappy' keeps short-circuiting our monitoring equipment with its electrical discharges. 'Chomper' actually BIT through a containment seal. They're evolving, adapting. But so are we. The team has developed new countermeasures. Precision. Speed. Anticipation. Every successful containment buys us time. We WILL survive this.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 6,\n    title: \"Biohazard\",\n    date: \"Day 25 - 1100 hours\",\n    content: \"Biohazard level MAXIMUM. We've lost contact with the eastern wing. 'Stinky' released toxic spores that corroded an entire airlock. 'Goopy' merged with the ventilation system. Only a handful of us remain operational. But there's hope - I've noticed patterns in their behavior. They're not mindless. They're playing a GAME. And if this is a game... we can win. Deploy everything. Shields. Bombs. Every second chance we've got.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist\"\n  },\n  {\n    level: 7,\n    title: \"Extinction Event\",\n    date: \"Day 31 - Final Entry\",\n    content: \"This is it. The final containment zone. Everything comes down to this moment. All ten Kikteria strains are present - Blobby, Grumpus, Wobbly, Cyclops, Spikeball, Fuzzy, Zappy, Chomper, Stinky, and Goopy. They're all here, dancing their chaotic dance. If we fail, it's extinction - for us, for them, for everything. But I believe in you, Containment Specialist. You've made it this far. Place them carefully. Keep them apart. Save us all. END TRANSMISSION.\",\n    signature: \"Dr. Lyra Voss, Chief Microbiologist - SIGNING OFF\"\n  }\n];\n\n// K.I.K. Announcer AI - Adaptive commentary system\nexport interface AnnouncerMessage {\n  trigger: string;\n  messages: string[];\n}\n\nexport const KIK_ANNOUNCER: Record<string, string[]> = {\n  // Placement feedback\n  goodPlacement: [\n    \"Nice placement!\",\n    \"Precision work!\",\n    \"That's the spot!\",\n    \"Clean placement.\",\n    \"Well calculated!\",\n    \"Containment specialist!\",\n  ],\n  closeCall: [\n    \"That was close!\",\n    \"Cutting it tight!\",\n    \"Risky move...\",\n    \"Living dangerously!\",\n    \"Barely fit!\",\n    \"Squeezed it in!\",\n  ],\n  perfectStreak: [\n    \"You're on fire!\",\n    \"Unstoppable!\",\n    \"Perfect streak!\",\n    \"Flawless execution!\",\n    \"Can't touch this!\",\n  ],\n  \n  // Time-based\n  lowTime: [\n    \"Time's running out!\",\n    \"Hurry!\",\n    \"Clock is ticking!\",\n    \"No time to waste!\",\n    \"Speed up!\",\n  ],\n  bonusTime: [\n    \"+TIME!\",\n    \"Bought some time!\",\n    \"Timer extended!\",\n  ],\n  \n  // Bomb usage\n  bombUsed: [\n    \"BOOM! Area cleared!\",\n    \"Explosive solution!\",\n    \"Tactical detonation!\",\n    \"That's one way to do it!\",\n    \"Cleanup crew!\",\n  ],\n  bombWasted: [\n    \"Empty zone...\",\n    \"Wasted bomb!\",\n    \"Nothing to clear!\",\n  ],\n  \n  // Shield activation\n  shieldSave: [\n    \"Shield absorbed it!\",\n    \"Protected!\",\n    \"Lucky save!\",\n    \"Shield deployed!\",\n    \"Crisis averted!\",\n  ],\n  \n  // Second chance\n  secondChanceUsed: [\n    \"Second chance!\",\n    \"Try again!\",\n    \"One more shot!\",\n    \"Back in action!\",\n    \"Undo successful!\",\n  ],\n  \n  // Progress milestones\n  halfwayDone: [\n    \"Halfway there!\",\n    \"Keep it up!\",\n    \"50% contained!\",\n    \"Going strong!\",\n  ],\n  almostDone: [\n    \"Almost there!\",\n    \"Just a few more!\",\n    \"Final stretch!\",\n    \"You've got this!\",\n  ],\n  lastOne: [\n    \"LAST ONE!\",\n    \"Final placement!\",\n    \"Don't mess up now!\",\n    \"This is it!\",\n  ],\n  \n  // Level start\n  levelStart: [\n    \"Containment initiated.\",\n    \"Let's do this!\",\n    \"Good luck!\",\n    \"Focus...\",\n    \"Ready? GO!\",\n  ],\n  \n  // Collision warnings\n  collisionClose: [\n    \"Watch out!\",\n    \"Too close!\",\n    \"Careful!\",\n    \"Danger zone!\",\n  ],\n  \n  // Game over reactions\n  gameOverCollision: [\n    \"They touched!\",\n    \"Containment breach!\",\n    \"Critical failure!\",\n  ],\n  gameOverTime: [\n    \"Time's up!\",\n    \"Too slow!\",\n    \"Out of time!\",\n  ],\n  \n  // Victory\n  victory: [\n    \"Level contained!\",\n    \"Mission complete!\",\n    \"Excellent work!\",\n    \"Flawless!\",\n  ],\n  victoryPerfect: [\n    \"PERFECT RUN!\",\n    \"Absolutely flawless!\",\n    \"Masterful!\",\n    \"Outstanding!\",\n  ],\n  \n  // Encouragement after failure\n  encouragement: [\n    \"You'll get it!\",\n    \"Try again!\",\n    \"Don't give up!\",\n    \"Almost had it!\",\n  ],\n};\n\nexport function getRandomKIKMessage(category: keyof typeof KIK_ANNOUNCER): string {\n  const messages = KIK_ANNOUNCER[category];\n  if (!messages || messages.length === 0) return '';\n  return messages[Math.floor(Math.random() * messages.length)];\n}\n\n// Mutation Events System\nexport interface MutationEvent {\n  id: string;\n  name: string;\n  description: string;\n  effect: 'vibration_increase' | 'size_increase' | 'speed_increase' | 'random_movement';\n  severity: 1 | 2 | 3;\n  countermeasures: MutationCountermeasure[];\n}\n\nexport interface MutationCountermeasure {\n  id: string;\n  name: string;\n  description: string;\n  cost: number; // time cost in seconds\n  effect: 'nullify' | 'reduce' | 'reverse';\n}\n\nexport const MUTATION_EVENTS: MutationEvent[] = [\n  {\n    id: 'hyperactive',\n    name: 'Hyperactive Strain',\n    description: 'Bacteria vibrations intensify dramatically!',\n    effect: 'vibration_increase',\n    severity: 2,\n    countermeasures: [\n      { id: 'stabilizer', name: 'Stabilizer Injection', description: 'Nullify the mutation completely', cost: 5, effect: 'nullify' },\n      { id: 'dampener', name: 'Vibration Dampener', description: 'Reduce effect by 50%', cost: 2, effect: 'reduce' },\n    ]\n  },\n  {\n    id: 'gigantism',\n    name: 'Gigantism Outbreak',\n    description: 'All bacteria grow 30% larger!',\n    effect: 'size_increase',\n    severity: 2,\n    countermeasures: [\n      { id: 'shrink_ray', name: 'Emergency Shrink Ray', description: 'Reverse: bacteria shrink 20%', cost: 4, effect: 'reverse' },\n      { id: 'containment', name: 'Containment Protocol', description: 'Reduce effect by 50%', cost: 2, effect: 'reduce' },\n    ]\n  },\n  {\n    id: 'accelerated',\n    name: 'Accelerated Metabolism',\n    description: 'Bacteria move faster and more erratically!',\n    effect: 'speed_increase',\n    severity: 3,\n    countermeasures: [\n      { id: 'cryo_burst', name: 'Cryo Burst', description: 'Slow all bacteria temporarily', cost: 6, effect: 'reverse' },\n      { id: 'sedative', name: 'Mass Sedative', description: 'Nullify the mutation', cost: 4, effect: 'nullify' },\n    ]\n  },\n  {\n    id: 'drift',\n    name: 'Spatial Drift',\n    description: 'Bacteria slowly drift in random directions!',\n    effect: 'random_movement',\n    severity: 1,\n    countermeasures: [\n      { id: 'anchor', name: 'Molecular Anchor', description: 'Lock bacteria in place', cost: 3, effect: 'nullify' },\n      { id: 'ignore', name: 'Risk It', description: 'Accept the challenge', cost: 0, effect: 'reduce' },\n    ]\n  },\n];\n\n// Level Mastery Goals\nexport interface MasteryGoal {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  check: (stats: LevelCompletionStats) => boolean;\n}\n\nexport interface LevelCompletionStats {\n  bombsUsed: number;\n  shieldsUsed: number;\n  secondChancesUsed: number;\n  timeRemaining: number;\n  totalTime: number;\n  perfectPlacements: number;\n  totalPlacements: number;\n}\n\nexport const MASTERY_GOALS: MasteryGoal[] = [\n  {\n    id: 'no_bombs',\n    name: 'Pacifist',\n    description: 'Complete without using any bombs',\n    icon: 'ðŸ•Šï¸',\n    check: (stats) => stats.bombsUsed === 0\n  },\n  {\n    id: 'speed_run',\n    name: 'Speed Demon',\n    description: 'Complete with 50%+ time remaining',\n    icon: 'âš¡',\n    check: (stats) => stats.timeRemaining >= stats.totalTime * 0.5\n  },\n  {\n    id: 'no_items',\n    name: 'Purist',\n    description: 'Complete without shields or second chances',\n    icon: 'ðŸŽ¯',\n    check: (stats) => stats.shieldsUsed === 0 && stats.secondChancesUsed === 0\n  },\n  {\n    id: 'perfect_streak',\n    name: 'Perfectionist',\n    description: 'Never trigger a close call warning',\n    icon: 'ðŸ’Ž',\n    check: (stats) => stats.perfectPlacements === stats.totalPlacements\n  },\n];\n\n// Endless Mode Boss Bacteria\nexport interface BossBacteria {\n  id: string;\n  name: string;\n  title: string;\n  health: number;\n  specialAbility: string;\n  warningMessage: string;\n}\n\nexport const BOSS_BACTERIA: BossBacteria[] = [\n  {\n    id: 'megablob',\n    name: 'MEGABLOB',\n    title: 'The Devourer',\n    health: 3,\n    specialAbility: 'Absorbs nearby bacteria on contact',\n    warningMessage: 'WARNING: MEGABLOB DETECTED!'\n  },\n  {\n    id: 'splitter',\n    name: 'MITOSIS',\n    title: 'The Divider',\n    health: 2,\n    specialAbility: 'Splits into two smaller bacteria when damaged',\n    warningMessage: 'ALERT: MITOSIS INCOMING!'\n  },\n  {\n    id: 'phantom',\n    name: 'PHANTOM',\n    title: 'The Invisible',\n    health: 1,\n    specialAbility: 'Phases in and out of visibility',\n    warningMessage: 'CAUTION: PHANTOM MATERIALIZING!'\n  },\n];\n\n// New Skill Consumables\nexport interface SkillConsumable {\n  id: string;\n  name: string;\n  description: string;\n  cost: number;\n  icon: string;\n  duration?: number;\n}\n\nexport const SKILL_CONSUMABLES: SkillConsumable[] = [\n  {\n    id: 'freeze',\n    name: 'Precision Freeze',\n    description: 'Freeze all bacteria vibrations for 5 seconds',\n    cost: 400,\n    icon: 'â„ï¸',\n    duration: 5000\n  },\n  {\n    id: 'cleanser',\n    name: 'Drag-Lasso Cleanser',\n    description: 'Draw a circle to remove all bacteria inside',\n    cost: 500,\n    icon: 'ðŸ”®',\n  },\n];\n\n// ==========================================\n// ENGAGEMENT & RETENTION SYSTEMS\n// ==========================================\n\n// Daily Lab Order Templates\nexport interface DailyOrderTemplate {\n  id: string;\n  title: string;\n  description: string;\n  difficulty: 'easy' | 'medium' | 'hard';\n  targetScore: number;\n  coinReward: number;\n  modifiers?: {\n    speedMultiplier?: number;\n    sizeMultiplier?: number;\n    timeLimit?: number;\n    restrictedBacteria?: string[];\n  };\n}\n\nexport const DAILY_ORDER_TEMPLATES: DailyOrderTemplate[] = [\n  {\n    id: 'speed_run',\n    title: 'Speed Containment',\n    description: 'Complete a round in record time! Faster placements earn more points.',\n    difficulty: 'medium',\n    targetScore: 150,\n    coinReward: 200,\n    modifiers: { timeLimit: 30, speedMultiplier: 1.5 }\n  },\n  {\n    id: 'big_bacteria',\n    title: 'Giant Outbreak',\n    description: 'Handle oversized bacteria in this challenging containment scenario.',\n    difficulty: 'hard',\n    targetScore: 200,\n    coinReward: 350,\n    modifiers: { sizeMultiplier: 1.4 }\n  },\n  {\n    id: 'calm_waters',\n    title: 'Calm Lab Day',\n    description: 'A relaxed day in the lab. Slower vibrations make placement easier.',\n    difficulty: 'easy',\n    targetScore: 100,\n    coinReward: 100,\n    modifiers: { speedMultiplier: 0.7 }\n  },\n  {\n    id: 'blobby_only',\n    title: 'Blobby Invasion',\n    description: 'Only Blobby bacteria today! Master their unique patterns.',\n    difficulty: 'easy',\n    targetScore: 120,\n    coinReward: 150,\n    modifiers: { restrictedBacteria: ['blobby'] }\n  },\n  {\n    id: 'mixed_chaos',\n    title: 'Lab Chaos',\n    description: 'Maximum variety, maximum challenge. Every bacteria type is active!',\n    difficulty: 'hard',\n    targetScore: 250,\n    coinReward: 400,\n    modifiers: { speedMultiplier: 1.2, sizeMultiplier: 1.1 }\n  },\n  {\n    id: 'precision_test',\n    title: 'Precision Protocol',\n    description: 'Tight spaces require perfect placement. No room for error.',\n    difficulty: 'medium',\n    targetScore: 180,\n    coinReward: 250,\n    modifiers: { sizeMultiplier: 1.25 }\n  },\n  {\n    id: 'time_crunch',\n    title: 'Emergency Response',\n    description: 'Limited time! Move fast or fail the containment protocol.',\n    difficulty: 'hard',\n    targetScore: 180,\n    coinReward: 300,\n    modifiers: { timeLimit: 20, speedMultiplier: 1.3 }\n  }\n];\n\n// Weekly Community Goal Templates\nexport interface WeeklyGoalTemplate {\n  id: string;\n  title: string;\n  description: string;\n  goalType: 'total_placements' | 'total_score' | 'levels_completed' | 'daily_orders_completed';\n  targetValue: number;\n  rewardType: 'coins' | 'cosmetic' | 'badge';\n  rewardData: {\n    amount?: number;\n    cosmeticId?: string;\n    cosmeticName?: string;\n    badgeId?: string;\n  };\n}\n\nexport const WEEKLY_GOAL_TEMPLATES: WeeklyGoalTemplate[] = [\n  {\n    id: 'mass_containment',\n    title: 'Mass Containment Protocol',\n    description: 'Community Goal: Place 50,000 bacteria together!',\n    goalType: 'total_placements',\n    targetValue: 50000,\n    rewardType: 'coins',\n    rewardData: { amount: 500 }\n  },\n  {\n    id: 'score_mountain',\n    title: 'Score Summit',\n    description: 'Community Goal: Reach 1,000,000 combined score!',\n    goalType: 'total_score',\n    targetValue: 1000000,\n    rewardType: 'cosmetic',\n    rewardData: { cosmeticId: 'neon_glow', cosmeticName: 'Neon Glow Effect' }\n  },\n  {\n    id: 'level_masters',\n    title: 'Level Conquest',\n    description: 'Community Goal: Complete 10,000 levels together!',\n    goalType: 'levels_completed',\n    targetValue: 10000,\n    rewardType: 'badge',\n    rewardData: { badgeId: 'community_champion' }\n  },\n  {\n    id: 'daily_dedication',\n    title: 'Daily Dedication',\n    description: 'Community Goal: Complete 5,000 daily orders this week!',\n    goalType: 'daily_orders_completed',\n    targetValue: 5000,\n    rewardType: 'coins',\n    rewardData: { amount: 750 }\n  }\n];\n\n// Achievement Definitions\nexport interface AchievementDef {\n  id: string;\n  name: string;\n  description: string;\n  category: 'mastery' | 'collection' | 'social' | 'challenge';\n  tier: 1 | 2 | 3; // bronze, silver, gold\n  requirement: number;\n  coinReward: number;\n  badgeIcon: string;\n  trackingKey: string; // what stat to track\n}\n\nexport const ACHIEVEMENTS: AchievementDef[] = [\n  // Mastery - Placement skills\n  { id: 'first_placement', name: 'First Contact', description: 'Place your first bacteria', category: 'mastery', tier: 1, requirement: 1, coinReward: 10, badgeIcon: 'ðŸ¦ ', trackingKey: 'totalPlacements' },\n  { id: 'placements_100', name: 'Lab Technician', description: 'Place 100 bacteria', category: 'mastery', tier: 1, requirement: 100, coinReward: 50, badgeIcon: 'ðŸ”¬', trackingKey: 'totalPlacements' },\n  { id: 'placements_500', name: 'Senior Researcher', description: 'Place 500 bacteria', category: 'mastery', tier: 2, requirement: 500, coinReward: 150, badgeIcon: 'ðŸ‘¨â€ðŸ”¬', trackingKey: 'totalPlacements' },\n  { id: 'placements_2000', name: 'Chief Scientist', description: 'Place 2000 bacteria', category: 'mastery', tier: 3, requirement: 2000, coinReward: 500, badgeIcon: 'ðŸ§¬', trackingKey: 'totalPlacements' },\n  \n  // Collection - Score achievements\n  { id: 'score_1000', name: 'Coin Collector', description: 'Earn 1,000 total coins', category: 'collection', tier: 1, requirement: 1000, coinReward: 100, badgeIcon: 'ðŸ’°', trackingKey: 'totalCoinsEarned' },\n  { id: 'score_5000', name: 'Treasure Hunter', description: 'Earn 5,000 total coins', category: 'collection', tier: 2, requirement: 5000, coinReward: 300, badgeIcon: 'ðŸ’Ž', trackingKey: 'totalCoinsEarned' },\n  { id: 'score_20000', name: 'Wealthy Scientist', description: 'Earn 20,000 total coins', category: 'collection', tier: 3, requirement: 20000, coinReward: 1000, badgeIcon: 'ðŸ‘‘', trackingKey: 'totalCoinsEarned' },\n  \n  // Challenge - Level completion\n  { id: 'level_1', name: 'Getting Started', description: 'Complete Level 1', category: 'challenge', tier: 1, requirement: 1, coinReward: 25, badgeIcon: 'â­', trackingKey: 'highestLevel' },\n  { id: 'level_3', name: 'Making Progress', description: 'Complete Level 3', category: 'challenge', tier: 1, requirement: 3, coinReward: 75, badgeIcon: 'ðŸŒŸ', trackingKey: 'highestLevel' },\n  { id: 'level_5', name: 'Lab Veteran', description: 'Complete Level 5', category: 'challenge', tier: 2, requirement: 5, coinReward: 200, badgeIcon: 'âœ¨', trackingKey: 'highestLevel' },\n  { id: 'level_7', name: 'Master Containment', description: 'Complete all 7 levels', category: 'challenge', tier: 3, requirement: 7, coinReward: 500, badgeIcon: 'ðŸ†', trackingKey: 'highestLevel' },\n  \n  // Social - Daily & Community\n  { id: 'daily_1', name: 'First Order', description: 'Complete your first daily order', category: 'social', tier: 1, requirement: 1, coinReward: 50, badgeIcon: 'ðŸ“‹', trackingKey: 'dailyOrdersCompleted' },\n  { id: 'daily_7', name: 'Weekly Regular', description: 'Complete 7 daily orders', category: 'social', tier: 2, requirement: 7, coinReward: 200, badgeIcon: 'ðŸ“…', trackingKey: 'dailyOrdersCompleted' },\n  { id: 'daily_30', name: 'Dedicated Scientist', description: 'Complete 30 daily orders', category: 'social', tier: 3, requirement: 30, coinReward: 750, badgeIcon: 'ðŸŽ–ï¸', trackingKey: 'dailyOrdersCompleted' },\n  \n  // Challenge - Special\n  { id: 'endless_10', name: 'Survivor', description: 'Reach wave 10 in Endless Mode', category: 'challenge', tier: 2, requirement: 10, coinReward: 300, badgeIcon: 'â™¾ï¸', trackingKey: 'endlessBestWave' },\n  { id: 'endless_25', name: 'Containment Expert', description: 'Reach wave 25 in Endless Mode', category: 'challenge', tier: 3, requirement: 25, coinReward: 1000, badgeIcon: 'ðŸ”¥', trackingKey: 'endlessBestWave' },\n  { id: 'bomb_master', name: 'Demolition Expert', description: 'Use 50 bombs', category: 'challenge', tier: 2, requirement: 50, coinReward: 200, badgeIcon: 'ðŸ’£', trackingKey: 'bombsUsed' },\n];\n\n// Bomb special figure\nexport const BOMB_TEMPLATE: FigureTemplate = {\n  id: 'bomb',\n  name: 'Bomb',\n  baseScale: 1.0,\n  shapes: [\n    { type: 'circle', offsetX: 0, offsetY: 0, width: 38, height: 38, rotation: 0, color: '#424242', strokeColor: '#212121', strokeWidth: 3 },\n    { type: 'rect', offsetX: 0, offsetY: -22, width: 10, height: 14, rotation: 0, color: '#795548', strokeColor: '#5D4037', strokeWidth: 2 },\n    { type: 'circle', offsetX: 0, offsetY: -32, width: 12, height: 12, rotation: 0, color: '#FF9800' },\n    { type: 'circle', offsetX: 0, offsetY: -32, width: 8, height: 8, rotation: 0, color: '#FFEB3B' },\n    { type: 'circle', offsetX: 0, offsetY: -32, width: 4, height: 4, rotation: 0, color: '#FFFFFF' },\n    // Highlight\n    { type: 'circle', offsetX: -8, offsetY: -8, width: 8, height: 8, rotation: 0, color: '#616161' },\n  ],\n  vibrationPattern: 'pulse',\n  vibrationSpeed: 6,\n  vibrationAmplitude: 3,\n  rarity: 'common',\n  coinValue: 0\n};\n","path":null,"size_bytes":54861,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"replit.md":{"content":"# Kikteria - Bacteria Placement Game\n\n## Overview\n\nKikteria is a bright, colorful puzzle game where players place funny-looking bacteria figures on a canvas without letting them touch. Built with React frontend and Express backend, featuring vibrating creatures with expressive faces. Current version: v10. Deployed version: d1.0.1.\n\n**Core Features:**\n- 100-level progressive difficulty campaign + Endless Mode\n- Google Sign-In authentication via Replit integration\n- Shop system with 10 upgrades + 4 consumable items\n- Achievement system with celebration pop-ups and confetti\n- Daily Lab Orders + Weekly Community Goals\n- Global leaderboard\n- Offline-first with automatic sync\n- Progressive Web App (PWA) for mobile install\n- Admin panel at `/admin`\n\n## PWA Support\n\nThe game is installable on mobile devices:\n- **manifest.json**: App configuration for install prompts\n- **sw.js**: Service worker for offline caching\n- **Icons**: SVG icons at 192x192 and 512x512\n- Users can \"Add to Home Screen\" on Android/iOS for app-like experience\n\n## User Preferences\n\n- **Communication style**: Simple, everyday language\n- **Do NOT request user feedback** without asking permission first\n- **Do NOT take screenshots** - user prefers faster execution\n- **Work silently**: No explanations unless asked, just execute\n- **Skip architect reviews** for small changes (< 20 lines)\n- **Trust decisions**: Make technical choices without asking, minimize clarifying questions\n- **Batch operations**: Combine related changes, use parallel tool calls\n- **Direct file access**: When user provides file paths, use them directly without searching\n\n## Key Files & Architecture\n\n### Frontend (client/)\n| File | Purpose |\n|------|---------|\n| `src/App.tsx` | Main app component, game state routing, win/lose screens |\n| `src/lib/store.ts` | Zustand store - all game state, upgrades, figures, timers |\n| `src/lib/game-constants.ts` | Bacteria templates, level configs, game config values |\n| `src/lib/api.ts` | React Query hooks for all API calls |\n| `src/lib/engagement-service.ts` | Achievement tracking, community contributions, celebrations |\n| `src/lib/offline-storage.ts` | LocalStorage persistence, pending sync queue |\n| `src/components/game/GameEngine.tsx` | Canvas rendering, collision detection, 60fps loop |\n| `src/components/game/HUD.tsx` | In-game UI (score, timer, bombs, consumables) |\n| `src/components/game/Shop.tsx` | Upgrade purchase interface |\n| `src/components/game/AchievementCelebration.tsx` | Achievement unlock modal with confetti |\n| `src/hooks/use-auth.ts` | Authentication hook, syncs auth to engagement service |\n\n### Backend (server/)\n| File | Purpose |\n|------|---------|\n| `routes.ts` | All API endpoints (~730 lines) |\n| `storage.ts` | IStorage interface + Drizzle implementations |\n| `google-docs.ts` | Google Docs API client for documentation generation |\n| `generate-docs.ts` | Documentation content and generation logic |\n| `replit_integrations/auth.ts` | Google OAuth via Replit |\n\n### Shared (shared/)\n| File | Purpose |\n|------|---------|\n| `schema.ts` | Drizzle ORM schema, Zod validators, types |\n| `models/auth.ts` | User type definitions |\n\n## Database Tables\n\n- `users` - OAuth user accounts\n- `playerProfiles` - Coins, high scores, upgrade levels\n- `leaderboard` - High score entries\n- `levelProgress` - Per-user level completion (unique on userId+levelNumber)\n- `userAnalytics` - Behavior tracking events\n- `errorLogs` - Client error reports\n- `appUpdatePolicy` - Version management\n- `dailyOrders` - Daily challenge definitions\n- `weeklyGoals` - Community goal tracking\n- `weeklyContributions` - Per-user weekly contributions (unique on goalId+visitorId)\n- `achievements` - Achievement definitions\n- `achievementProgress` - Per-user achievement status (unique on visitorId+achievementId)\n\n## API Endpoints Summary\n\n**Auth**: GET `/api/auth/user`, `/api/login`, `/api/logout`\n**Profile**: GET/PATCH `/api/profile`\n**Leaderboard**: GET/POST `/api/leaderboard`\n**Levels**: GET/POST `/api/levels/progress`\n**Daily Orders**: GET `/api/daily-order`, POST `/api/daily-order/complete`\n**Community**: GET `/api/community-goal`, POST `/api/community-goal/contribute`\n**Achievements**: GET `/api/achievements`, GET/POST `/api/achievements/progress`, POST `/api/achievements/claim`\n**Admin**: Various at `/api/admin/*` (requires ADMIN_USER_IDS)\n**Analytics/Errors**: POST `/api/analytics`, POST `/api/errors`\n**Version**: GET `/api/version`\n\n## Game Mechanics\n\n### Collision System\n- Canvas hit testing with 5px collision padding\n- Hysteresis: requires 3 consecutive collision frames before game over\n- Clean frame counter resets after 5 clean frames\n- Accounts for vibration envelope (max displacement)\n\n### Vibration Patterns\nHorizontal, Vertical, Circular, Pulse, Diagonal - each with different envelope calculations\n\n### Consumables\n- **Shield**: Forgives 1 collision, requires â‰¥1 charge\n- **2nd Chance**: After game over, removes last figure and resumes (works in Endless Mode via isEndlessMode flag)\n- **Freeze**: Pauses vibrations temporarily\n- **Cleanser**: Lasso tool to remove bacteria\n\n### Economy\n- Coins earned from level completion, rare bacteria bonuses, achievements, daily orders\n- 10 upgrade types with escalating costs\n- Achievement tiers: Bronze (1), Silver (2), Gold (3)\n\n## Integrations\n\n- **Google OAuth**: Replit auth integration (javascript_replit_auth)\n- **Google Docs**: For documentation generation (google-docs connection)\n- **PostgreSQL**: Replit database integration\n\n## Scripts\n\n- `npx tsx scripts/generate-docs-script.ts` - Regenerate Google Docs documentation\n- `npx vitest run` - Run all unit tests (190 tests)\n- `npx vitest` - Run tests in watch mode\n\n## Testing\n\nTest files are located in `__tests__` directories:\n- `client/src/lib/__tests__/game-constants.test.ts` - Vibration envelope, effective radius, level configs, bacteria templates\n- `client/src/lib/__tests__/offline-storage.test.ts` - Level progress, player stats, pending sync, session management\n- `client/src/lib/__tests__/store.test.ts` - Game state, notifications, level selection, endless mode, consumables\n- `client/src/lib/__tests__/upgrades.test.ts` - Upgrade costs, max levels, purchase validation, skill consumables\n- `client/src/lib/__tests__/endless-mode.test.ts` - Endless mode init, wave advancement, scoring, timer\n- `client/src/lib/__tests__/achievements.test.ts` - Achievement definitions, categories, tiers, tracking keys\n- `client/src/lib/__tests__/bomb-mechanics.test.ts` - Bomb targeting, detonation, blast radius, figure clearing\n- `server/__tests__/storage.test.ts` - Player profiles, leaderboard, level progress, admin methods\n\nConfig: `vitest.config.ts` with path aliases for `@` and `@shared`\n\n## Recent Fixes (v7.1)\n\n1. **Shield fix**: Now works with â‰¥1 shield instead of â‰¥2\n2. **2nd Chance Endless fix**: Uses isEndlessMode flag for proper detection, removes last figure instead of resetting\n3. **Achievement celebrations**: Pop-up modal with confetti, tier-based styling, user-scoped cache to prevent duplicates\n4. **Performance**: Throttled localStorage writes (1s max), immediate saves for high-value events\n5. **Database indexes**: Composite unique indexes on leaderboard, levelProgress, weeklyContributions, achievementProgress\n\n## Admin Access\n\nAdmin user IDs defined in `client/src/pages/Admin.tsx`:\n```\nconst ADMIN_USER_IDS = ['51476893'];\n```\n\n## Documentation Links\n\n- Player Guide: https://docs.google.com/document/d/1SRGokjha2vVbsrMyPYIC7lo_DlDtTGO1JZ8orDzWnKo/edit\n- API Reference: https://docs.google.com/document/d/1nlxhU51lUT8XuUtMOFKzwLP71Up4eg8PTBFGt5ewSzY/edit\n- Game Design Document: https://docs.google.com/document/d/1YufprTw_neSmfl_ly-82IfLDIzFgOb8bhbt_SOt3BgY/edit\n- Enterprise Admin Guide: https://docs.google.com/document/d/1eKgolSnrcaiNIDjey_8unmdGsYuRu44eBHup7d17Ggg/edit\n","path":null,"size_bytes":7842,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/game/Leaderboard.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '../ui/dialog';\nimport { useLeaderboard } from '../../lib/api';\nimport { Trophy, Medal, Award } from 'lucide-react';\nimport { Skeleton } from '../ui/skeleton';\nimport { offlineStorage } from '../../lib/offline-storage';\n\ninterface LeaderboardProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function Leaderboard({ open, onClose }: LeaderboardProps) {\n  const { data: serverLeaderboard, isLoading } = useLeaderboard(10);\n  const [cachedLeaderboard, setCachedLeaderboard] = useState<Array<{id: string; username: string; score: number; createdAt: Date}>>([]);\n\n  // Load cached leaderboard on mount\n  useEffect(() => {\n    const cached = offlineStorage.getLeaderboardCache();\n    if (cached.length > 0) {\n      setCachedLeaderboard(cached.map((entry, index) => ({\n        id: `cached-${index}`,\n        username: entry.username,\n        score: entry.score,\n        createdAt: new Date(),\n      })));\n    }\n  }, []);\n\n  // Cache server leaderboard when available\n  useEffect(() => {\n    if (serverLeaderboard && serverLeaderboard.length > 0) {\n      offlineStorage.setLeaderboardCache(\n        serverLeaderboard.map((entry, index) => ({\n          rank: index + 1,\n          username: entry.username,\n          score: entry.score,\n        }))\n      );\n    }\n  }, [serverLeaderboard]);\n\n  // Use server data if available, otherwise use cached\n  const leaderboard = serverLeaderboard && serverLeaderboard.length > 0 ? serverLeaderboard : cachedLeaderboard;\n\n  const getRankDisplay = (rank: number) => {\n    if (rank === 1) return { icon: <Trophy className=\"text-secondary\" size={20} />, color: 'text-secondary text-glow', bg: 'bg-secondary/10 border-secondary shadow-[0_0_15px_rgba(249,233,0,0.3)]' };\n    if (rank === 2) return { icon: <Medal className=\"text-muted-foreground\" size={20} />, color: 'text-foreground', bg: 'bg-muted border-border' };\n    if (rank === 3) return { icon: <Award className=\"text-accent\" size={20} />, color: 'text-accent', bg: 'bg-accent/10 border-accent/50' };\n    return { icon: <span className=\"font-display text-xs text-muted-foreground\">{rank}</span>, color: 'text-foreground', bg: 'border-border' };\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[450px] block-panel border-2 border-secondary/50 bg-card shadow-[0_0_40px_rgba(249,233,0,0.2)]\" data-testid=\"dialog-leaderboard\">\n        <DialogHeader>\n          <DialogTitle className=\"font-display text-xl flex items-center justify-center gap-3 text-secondary text-glow\" data-testid=\"text-leaderboard-title\">\n            <Trophy className=\"text-secondary\" />\n            TOP PLAYERS\n            <Trophy className=\"text-secondary\" />\n          </DialogTitle>\n          <DialogDescription className=\"font-ui text-xl text-center text-muted-foreground\" data-testid=\"text-leaderboard-description\">\n            Global Rankings\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-2 max-h-[400px] overflow-y-auto mt-4\">\n          {isLoading ? (\n            Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"block-panel p-3 flex items-center gap-4\">\n                <Skeleton className=\"h-8 w-8 bg-muted\" />\n                <Skeleton className=\"h-4 flex-1 bg-muted\" />\n                <Skeleton className=\"h-4 w-16 bg-muted\" />\n              </div>\n            ))\n          ) : leaderboard && leaderboard.length > 0 ? (\n            leaderboard.map((entry, index) => {\n              const rankInfo = getRankDisplay(index + 1);\n              return (\n                <div\n                  key={entry.id}\n                  className={`block-panel p-3 flex items-center gap-4 ${rankInfo.bg} border transition-colors`}\n                  data-testid={`leaderboard-entry-${index + 1}`}\n                >\n                  <div className=\"w-10 h-10 rounded-lg flex items-center justify-center bg-muted border border-border\">\n                    {rankInfo.icon}\n                  </div>\n                  <div className=\"flex-1\">\n                    <p className={`font-display text-xs ${rankInfo.color}`} data-testid={`text-username-${index + 1}`}>\n                      {entry.username}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-display text-sm text-secondary text-glow\" data-testid={`text-score-${index + 1}`}>\n                      {entry.score.toLocaleString()}\n                    </p>\n                    <p className=\"font-ui text-sm text-muted-foreground\">\n                      {new Date(entry.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n              );\n            })\n          ) : (\n            <div className=\"text-center py-8\" data-testid=\"text-no-entries\">\n              <Trophy size={48} className=\"mx-auto mb-4 text-muted-foreground\" />\n              <p className=\"font-display text-xs text-muted-foreground\">NO RECORDS YET</p>\n              <p className=\"font-ui text-lg text-muted-foreground mt-2\">Be the first champion!</p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":5315,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/lib/api.ts":{"content":"import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\n\n// Types\ninterface PlayerProfile {\n  id: string;\n  userId: string;\n  coins: number;\n  highScore: number;\n  speedUpgrade: number;\n  startSizeUpgrade: number;\n  magnetUpgrade: number;\n  updatedAt: Date;\n}\n\ninterface LeaderboardEntry {\n  id: string;\n  userId: string;\n  username: string;\n  score: number;\n  createdAt: Date;\n}\n\n// API functions\nasync function fetchJSON(url: string, options?: RequestInit) {\n  const response = await fetch(url, {\n    ...options,\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...options?.headers,\n    },\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({ error: 'Request failed' }));\n    throw new Error(`${response.status}: ${error.error || error.message || 'Request failed'}`);\n  }\n\n  return response.json();\n}\n\n// Profile API\nexport const profileAPI = {\n  getProfile: (): Promise<PlayerProfile> => fetchJSON('/api/profile'),\n\n  updateProfile: (updates: Partial<Omit<PlayerProfile, 'id' | 'userId' | 'updatedAt'>>) =>\n    fetchJSON('/api/profile', {\n      method: 'PATCH',\n      body: JSON.stringify(updates),\n    }),\n};\n\n// Leaderboard API\nexport const leaderboardAPI = {\n  getTopScores: (limit: number = 10): Promise<LeaderboardEntry[]> =>\n    fetchJSON(`/api/leaderboard?limit=${limit}`),\n\n  submitScore: (score: number) =>\n    fetchJSON('/api/leaderboard', {\n      method: 'POST',\n      body: JSON.stringify({ score }),\n    }),\n};\n\n// Level Progress types and API\ninterface LevelProgress {\n  id: string;\n  userId: string;\n  levelNumber: number;\n  bestScore: number;\n  isCompleted: number;\n}\n\nexport const levelProgressAPI = {\n  getProgress: (): Promise<LevelProgress[]> =>\n    fetchJSON('/api/levels/progress'),\n\n  updateProgress: (levelNumber: number, score: number, completed: boolean) =>\n    fetchJSON('/api/levels/progress', {\n      method: 'POST',\n      body: JSON.stringify({ levelNumber, score, completed }),\n    }),\n};\n\n// React Query Hooks\n\n// Profile Hooks\nexport function usePlayerProfile() {\n  return useQuery<PlayerProfile>({\n    queryKey: ['profile'],\n    queryFn: profileAPI.getProfile,\n    staleTime: 30000, // 30 seconds\n  });\n}\n\nexport function useUpdateProfile() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: (updates: Partial<Omit<PlayerProfile, 'id' | 'userId' | 'updatedAt'>>) =>\n      profileAPI.updateProfile(updates),\n    onSuccess: (updatedProfile) => {\n      queryClient.setQueryData(['profile'], updatedProfile);\n    },\n  });\n}\n\n// Leaderboard Hooks\nexport function useLeaderboard(limit: number = 10) {\n  return useQuery<LeaderboardEntry[]>({\n    queryKey: ['leaderboard', limit],\n    queryFn: () => leaderboardAPI.getTopScores(limit),\n    staleTime: 10000, // 10 seconds\n  });\n}\n\nexport function useSubmitScore() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: (score: number) => leaderboardAPI.submitScore(score),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['leaderboard'] });\n      queryClient.invalidateQueries({ queryKey: ['profile'] });\n    },\n  });\n}\n\n// Level Progress Hooks\nexport function useLevelProgress() {\n  return useQuery({\n    queryKey: ['levelProgress'],\n    queryFn: levelProgressAPI.getProgress,\n    staleTime: 30000,\n  });\n}\n\nexport function useUpdateLevelProgress() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: ({ levelNumber, score, completed }: { levelNumber: number; score: number; completed: boolean }) =>\n      levelProgressAPI.updateProgress(levelNumber, score, completed),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['levelProgress'] });\n    },\n  });\n}\n\n// Analytics/Metadata API - for user behavior tracking\ninterface AnalyticsEvent {\n  eventType: 'level_play' | 'level_success' | 'level_fail' | 'session_start' | 'session_end';\n  levelNumber?: number;\n  score?: number;\n  playDuration?: number;\n  eventDate: string;\n  eventTime: string;\n  sessionId: string;\n  deviceInfo: string;\n}\n\nexport const analyticsAPI = {\n  submitEvents: (events: AnalyticsEvent[]): Promise<{ success: boolean; count: number }> =>\n    fetchJSON('/api/analytics', {\n      method: 'POST',\n      body: JSON.stringify({ events }),\n    }),\n};\n\n// Error Logs API - for debugging\ninterface ErrorLogEntry {\n  severity: 'error' | 'warn' | 'info';\n  category: 'runtime' | 'api' | 'sync' | 'game' | 'asset';\n  message: string;\n  stack?: string;\n  component?: string;\n  currentScreen?: string;\n  gameState?: string;\n  apiInfo?: string;\n  sessionId: string;\n  deviceInfo: string;\n  networkStatus: string;\n  lastUserAction?: string;\n  eventTime: string;\n}\n\nexport const errorLogsAPI = {\n  submitLogs: (logs: ErrorLogEntry[]): Promise<{ success: boolean; count: number }> =>\n    fetchJSON('/api/errors', {\n      method: 'POST',\n      body: JSON.stringify({ logs }),\n    }),\n};\n\n// Version API - for update checking\ninterface UpdatePolicyResponse {\n  latestVersion: string;\n  minSupportedVersion: string;\n  downloadUrl: string;\n  releaseNotes: string | null;\n}\n\nexport const versionAPI = {\n  getUpdatePolicy: (): Promise<UpdatePolicyResponse> =>\n    fetchJSON('/api/version'),\n};\n\n// ==================== ENGAGEMENT API ====================\n\n// Daily Orders API\ninterface DailyOrder {\n  id: string;\n  orderDate: string;\n  title: string;\n  description: string;\n  difficulty: 'easy' | 'medium' | 'hard';\n  targetScore: number;\n  coinReward: number;\n  modifiers?: string;\n}\n\ninterface DailyOrderResponse {\n  order: DailyOrder;\n  completion: { scoreAchieved: number } | null;\n  isCompleted: boolean;\n}\n\nexport const dailyOrderAPI = {\n  getTodaysOrder: (): Promise<DailyOrderResponse> =>\n    fetchJSON('/api/daily-order'),\n\n  completeDailyOrder: (scoreAchieved: number): Promise<{ success: boolean; coinsAwarded: number }> =>\n    fetchJSON('/api/daily-order/complete', {\n      method: 'POST',\n      body: JSON.stringify({ scoreAchieved }),\n    }),\n};\n\n// Weekly Community Goals API\ninterface WeeklyGoal {\n  id: string;\n  weekStart: string;\n  title: string;\n  description: string;\n  targetValue: number;\n  currentValue: number;\n  goalType: string;\n  rewardType: string;\n  rewardData?: string;\n  isCompleted: number;\n}\n\ninterface WeeklyGoalResponse {\n  goal: WeeklyGoal;\n  userContribution: number;\n  progressPercentage: number;\n  isCompleted: boolean;\n}\n\nexport const communityGoalAPI = {\n  getCurrentGoal: (): Promise<WeeklyGoalResponse> =>\n    fetchJSON('/api/community-goal'),\n\n  contribute: (amount: number): Promise<{ contribution: any; goal: WeeklyGoal }> =>\n    fetchJSON('/api/community-goal/contribute', {\n      method: 'POST',\n      body: JSON.stringify({ amount }),\n    }),\n};\n\n// Achievements API\nexport const achievementsAPI = {\n  getProgress: (): Promise<any[]> =>\n    fetchJSON('/api/achievements/progress'),\n\n  updateProgress: (achievementId: string, progress: number): Promise<any> =>\n    fetchJSON('/api/achievements/progress', {\n      method: 'POST',\n      body: JSON.stringify({ achievementId, progress }),\n    }),\n\n  claim: (achievementId: string): Promise<{ claimed: any; coinsAwarded: number }> =>\n    fetchJSON('/api/achievements/claim', {\n      method: 'POST',\n      body: JSON.stringify({ achievementId }),\n    }),\n};\n\n// Engagement hooks\nexport function useContributeToGoal() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: (amount: number) => communityGoalAPI.contribute(amount),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['community-goal'] });\n    },\n  });\n}\n\nexport function useCompleteDailyOrder() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: (scoreAchieved: number) => dailyOrderAPI.completeDailyOrder(scoreAchieved),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['daily-order'] });\n      queryClient.invalidateQueries({ queryKey: ['profile'] });\n    },\n  });\n}\n","path":null,"size_bytes":7981,"size_tokens":null},"client/src/components/game/MainMenu.tsx":{"content":"import React, { useState } from 'react';\nimport { useGameStore } from '../../lib/store';\nimport { motion } from 'framer-motion';\nimport { Play, ShoppingBag, Trophy, LogIn, LogOut, User, Zap, Coins, BookOpen, Bug, Infinity, Calendar, Users, Award } from 'lucide-react';\nimport { usePlayerProfile } from '../../lib/api';\nimport { useAuth } from '../../hooks/use-auth';\nimport { Leaderboard } from './Leaderboard';\nimport { DailyLabOrders } from './DailyLabOrders';\nimport { WeeklyGoals } from './WeeklyGoals';\nimport { AchievementBoard } from './AchievementBoard';\nimport { offlineStorage } from '../../lib/offline-storage';\n\nexport function MainMenu() {\n  const { setGameState, highScore, maxUnlockedLevel, selectLevel, initializeGame, startTimer } = useGameStore();\n  const { user, login, logout } = useAuth();\n  const { data: profile } = usePlayerProfile();\n  const [showLeaderboard, setShowLeaderboard] = useState(false);\n  const [showDailyOrders, setShowDailyOrders] = useState(false);\n  const [showWeeklyGoals, setShowWeeklyGoals] = useState(false);\n  const [showAchievements, setShowAchievements] = useState(false);\n\n  const displayName = user?.firstName || user?.email?.split('@')[0] || 'Player';\n\n  const handleQuickStart = () => {\n    selectLevel(maxUnlockedLevel);\n    initializeGame();\n    startTimer();\n    setGameState('PLAYING');\n    offlineStorage.trackLevelPlay(maxUnlockedLevel);\n  };\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background flex flex-col items-center scanlines crt-vignette pb-8 scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n      \n      <div className=\"sticky top-0 w-full flex justify-end p-4 z-20 bg-background/80 backdrop-blur-sm\">\n        {user ? (\n          <>\n            <div className=\"flex items-center gap-3 block-panel px-4 py-2\" data-testid=\"text-user-info\">\n              {user.profileImageUrl ? (\n                <img src={user.profileImageUrl} alt=\"\" className=\"w-8 h-8 rounded-full border-2 border-primary\" />\n              ) : (\n                <div className=\"w-8 h-8 rounded-full bg-primary/20 border-2 border-primary flex items-center justify-center\">\n                  <User size={16} className=\"text-primary\" />\n                </div>\n              )}\n              <span className=\"font-ui text-xl text-foreground\">{displayName}</span>\n              {profile && (\n                <div className=\"flex items-center gap-1 coin-display font-ui text-xl\">\n                  <Coins size={18} />\n                  <span>{profile.coins}</span>\n                </div>\n              )}\n            </div>\n            <button\n              onClick={logout}\n              className=\"block-panel px-3 py-2 hover:border-destructive transition-colors flex items-center gap-2\"\n              data-testid=\"button-logout\"\n            >\n              <LogOut size={18} className=\"text-destructive\" />\n            </button>\n          </>\n        ) : (\n          <motion.button\n            whileHover={{ scale: 1.02 }}\n            onClick={login}\n            className=\"pixel-btn px-5 py-2 flex items-center gap-2\"\n            data-testid=\"button-login\"\n          >\n            <LogIn size={18} />\n            <span className=\"text-xs\">SIGN IN</span>\n          </motion.button>\n        )}\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-md px-4 flex flex-col items-center gap-4 mt-2\">\n        <div className=\"text-center\">\n          <motion.h1 \n            initial={{ y: -30, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            className=\"text-3xl sm:text-4xl md:text-5xl font-display animate-neon-flicker\"\n            style={{\n              color: '#22F2A2',\n              textShadow: '0 0 10px #22F2A2, 0 0 20px #22F2A2, 0 0 40px #22F2A2, 4px 4px 0px #0a5c3a'\n            }}\n          >\n            KIKTERIA\n          </motion.h1>\n          <motion.p \n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.3 }}\n            className=\"font-ui text-lg sm:text-xl text-secondary tracking-widest mt-1 text-glow\"\n          >\n            â˜… BACTERIA PUZZLE â˜…\n          </motion.p>\n        </div>\n\n        <motion.div \n          initial={{ scale: 0.8, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ delay: 0.2 }}\n          className=\"w-24 h-24 sm:w-32 sm:h-32 relative\"\n        >\n          <div className=\"absolute inset-0 rounded-full bg-primary/10 border-4 border-primary/50 animate-glow-pulse\" />\n          <div className=\"absolute inset-4 rounded-full bg-gradient-to-br from-primary/30 to-accent/30 animate-float\" />\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <span className=\"text-5xl sm:text-6xl animate-float drop-shadow-[0_0_20px_rgba(34,242,162,0.5)]\">ðŸ¦ </span>\n          </div>\n        </motion.div>\n\n        <motion.button\n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          transition={{ delay: 0.4 }}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={handleQuickStart}\n          className=\"w-full py-3 pixel-btn text-base flex items-center justify-center gap-2 animate-glow-pulse\"\n          data-testid=\"button-start\"\n        >\n          <Zap size={20} fill=\"currentColor\" />\n          <span>START LEVEL {maxUnlockedLevel}</span>\n        </motion.button>\n\n        <motion.button\n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          transition={{ delay: 0.5 }}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={() => setGameState('LEVEL_SELECT')}\n          className=\"w-full py-2 block-panel text-sm flex items-center justify-center gap-2 hover:border-primary transition-colors font-display\"\n          data-testid=\"button-level-select\"\n        >\n          <Play size={18} className=\"text-primary\" />\n          <span>SELECT LEVEL</span>\n        </motion.button>\n\n        <motion.div \n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          transition={{ delay: 0.6 }}\n          className=\"flex gap-2 w-full\"\n        >\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => useGameStore.getState().setGameState('SHOP')}\n            className=\"flex-1 py-3 pixel-btn-secondary flex flex-col items-center gap-1\"\n            data-testid=\"button-shop\"\n          >\n            <ShoppingBag size={20} />\n            <span className=\"text-xs font-display\">SHOP</span>\n          </motion.button>\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => setShowLeaderboard(true)}\n            className=\"flex-1 py-3 pixel-btn-accent flex flex-col items-center gap-1\"\n            data-testid=\"button-leaderboard\"\n          >\n            <Trophy size={20} />\n            <span className=\"text-xs font-display\">RANKS</span>\n          </motion.button>\n        </motion.div>\n        \n        <motion.div \n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          transition={{ delay: 0.65 }}\n          className=\"flex gap-2 w-full\"\n        >\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => useGameStore.getState().setGameState('CHRONICLES')}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-cyan-400 transition-colors\"\n            data-testid=\"button-chronicles\"\n          >\n            <BookOpen size={18} className=\"text-cyan-400\" />\n            <span className=\"text-xs font-display text-cyan-400\">STORY</span>\n          </motion.button>\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => useGameStore.getState().setGameState('CODEX')}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-pink-400 transition-colors\"\n            data-testid=\"button-codex\"\n          >\n            <Bug size={18} className=\"text-pink-400\" />\n            <span className=\"text-xs font-display text-pink-400\">CODEX</span>\n          </motion.button>\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => useGameStore.getState().setGameState('ENDLESS_MODE')}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-purple-400 transition-colors\"\n            data-testid=\"button-endless\"\n          >\n            <Infinity size={18} className=\"text-purple-400\" />\n            <span className=\"text-xs font-display text-purple-400\">ENDLESS</span>\n          </motion.button>\n        </motion.div>\n\n        <motion.div \n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          transition={{ delay: 0.7 }}\n          className=\"flex gap-2 w-full\"\n        >\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => setShowDailyOrders(true)}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-orange-400 transition-colors\"\n            data-testid=\"button-daily\"\n          >\n            <Calendar size={16} className=\"text-orange-400\" />\n            <span className=\"text-xs font-display text-orange-400\">DAILY</span>\n          </motion.button>\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => setShowWeeklyGoals(true)}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-cyan-400 transition-colors\"\n            data-testid=\"button-weekly\"\n          >\n            <Users size={16} className=\"text-cyan-400\" />\n            <span className=\"text-xs font-display text-cyan-400\">GOALS</span>\n          </motion.button>\n          <motion.button\n            whileHover={{ y: -2, scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => setShowAchievements(true)}\n            className=\"flex-1 py-2 block-panel flex flex-col items-center gap-1 hover:border-yellow-400 transition-colors\"\n            data-testid=\"button-achievements\"\n          >\n            <Award size={16} className=\"text-yellow-400\" />\n            <span className=\"text-xs font-display text-yellow-400\">BADGES</span>\n          </motion.button>\n        </motion.div>\n\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.75 }}\n          className=\"block-panel px-4 py-2 text-center w-full\"\n        >\n          <p className=\"font-ui text-base text-primary\">HOW TO PLAY</p>\n          <p className=\"font-ui text-sm text-foreground/70\">\n            Click to place bacteria. Don't let them touch!\n          </p>\n        </motion.div>\n\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.8 }}\n          className=\"flex gap-4 font-ui text-base\"\n        >\n          <div className=\"text-muted-foreground\">\n            HIGH SCORE: <span className=\"text-secondary text-glow\" data-testid=\"text-highscore\">{profile?.highScore || highScore}</span>\n          </div>\n          <div className=\"text-muted-foreground\">v8</div>\n        </motion.div>\n      </div>\n\n      <Leaderboard open={showLeaderboard} onClose={() => setShowLeaderboard(false)} />\n      <DailyLabOrders open={showDailyOrders} onClose={() => setShowDailyOrders(false)} />\n      <WeeklyGoals open={showWeeklyGoals} onClose={() => setShowWeeklyGoals(false)} />\n      <AchievementBoard open={showAchievements} onClose={() => setShowAchievements(false)} />\n    </div>\n  );\n}\n\n","path":null,"size_bytes":11977,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, registerAuthRoutes, isAuthenticated } from \"./replit_integrations/auth\";\nimport { z } from \"zod\";\nimport { fromZodError } from \"zod-validation-error\";\n\n// Achievement definitions for auto-seeding\nconst ACHIEVEMENT_DEFS = [\n  { id: 'first_placement', name: 'First Contact', description: 'Place your first bacteria', category: 'mastery', tier: 1, requirement: 1, coinReward: 10, badgeIcon: 'ðŸ¦ ' },\n  { id: 'placements_100', name: 'Lab Technician', description: 'Place 100 bacteria', category: 'mastery', tier: 1, requirement: 100, coinReward: 50, badgeIcon: 'ðŸ”¬' },\n  { id: 'placements_500', name: 'Senior Researcher', description: 'Place 500 bacteria', category: 'mastery', tier: 2, requirement: 500, coinReward: 150, badgeIcon: 'ðŸ‘¨â€ðŸ”¬' },\n  { id: 'placements_2000', name: 'Chief Scientist', description: 'Place 2000 bacteria', category: 'mastery', tier: 3, requirement: 2000, coinReward: 500, badgeIcon: 'ðŸ§¬' },\n  { id: 'score_1000', name: 'Coin Collector', description: 'Earn 1,000 total coins', category: 'collection', tier: 1, requirement: 1000, coinReward: 100, badgeIcon: 'ðŸ’°' },\n  { id: 'score_5000', name: 'Treasure Hunter', description: 'Earn 5,000 total coins', category: 'collection', tier: 2, requirement: 5000, coinReward: 300, badgeIcon: 'ðŸ’Ž' },\n  { id: 'score_20000', name: 'Wealthy Scientist', description: 'Earn 20,000 total coins', category: 'collection', tier: 3, requirement: 20000, coinReward: 1000, badgeIcon: 'ðŸ‘‘' },\n  { id: 'level_1', name: 'Getting Started', description: 'Complete Level 1', category: 'challenge', tier: 1, requirement: 1, coinReward: 25, badgeIcon: 'â­' },\n  { id: 'level_3', name: 'Making Progress', description: 'Complete Level 3', category: 'challenge', tier: 1, requirement: 3, coinReward: 75, badgeIcon: 'ðŸŒŸ' },\n  { id: 'level_5', name: 'Lab Veteran', description: 'Complete Level 5', category: 'challenge', tier: 2, requirement: 5, coinReward: 200, badgeIcon: 'âœ¨' },\n  { id: 'level_7', name: 'Master Containment', description: 'Complete all 7 levels', category: 'challenge', tier: 3, requirement: 7, coinReward: 500, badgeIcon: 'ðŸ†' },\n  { id: 'daily_1', name: 'First Order', description: 'Complete your first daily order', category: 'social', tier: 1, requirement: 1, coinReward: 50, badgeIcon: 'ðŸ“‹' },\n  { id: 'daily_7', name: 'Weekly Regular', description: 'Complete 7 daily orders', category: 'social', tier: 2, requirement: 7, coinReward: 200, badgeIcon: 'ðŸ“…' },\n  { id: 'daily_30', name: 'Dedicated Scientist', description: 'Complete 30 daily orders', category: 'social', tier: 3, requirement: 30, coinReward: 750, badgeIcon: 'ðŸŽ–ï¸' },\n  { id: 'endless_10', name: 'Survivor', description: 'Reach wave 10 in Endless Mode', category: 'challenge', tier: 2, requirement: 10, coinReward: 300, badgeIcon: 'â™¾ï¸' },\n  { id: 'endless_25', name: 'Containment Expert', description: 'Reach wave 25 in Endless Mode', category: 'challenge', tier: 3, requirement: 25, coinReward: 1000, badgeIcon: 'ðŸ”¥' },\n  { id: 'bomb_master', name: 'Demolition Expert', description: 'Use 50 bombs', category: 'challenge', tier: 2, requirement: 50, coinReward: 200, badgeIcon: 'ðŸ’£' },\n];\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Setup Replit Auth (BEFORE other routes)\n  await setupAuth(app);\n  registerAuthRoutes(app);\n  \n  // Auto-seed achievements on startup\n  try {\n    await storage.seedAchievements(ACHIEVEMENT_DEFS);\n    console.log('[achievements] Seeded achievements on startup');\n  } catch (e) {\n    console.error('[achievements] Failed to seed achievements:', e);\n  }\n\n  // ==================== PLAYER PROFILE ROUTES ====================\n\n  // Get player profile\n  app.get(\"/api/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const profile = await storage.getPlayerProfile(userId);\n      \n      if (!profile) {\n        // Create default profile if it doesn't exist\n        const newProfile = await storage.createPlayerProfile({\n          userId: userId,\n          coins: 500,\n          highScore: 0,\n          speedUpgrade: 1,\n          startSizeUpgrade: 1,\n          magnetUpgrade: 1,\n        });\n        return res.json(newProfile);\n      }\n      \n      res.json(profile);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Update player profile\n  app.patch(\"/api/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      // Validate updates\n      const updateSchema = z.object({\n        coins: z.number().optional(),\n        highScore: z.number().optional(),\n        speedUpgrade: z.number().optional(),\n        startSizeUpgrade: z.number().optional(),\n        magnetUpgrade: z.number().optional(),\n      });\n      \n      const result = updateSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ \n          error: fromZodError(result.error).message \n        });\n      }\n\n      const updatedProfile = await storage.updatePlayerProfile(userId, result.data);\n      res.json(updatedProfile);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== LEADERBOARD ROUTES ====================\n\n  // Get top scores\n  app.get(\"/api/leaderboard\", async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 10;\n      const topScores = await storage.getTopScores(limit);\n      res.json(topScores);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Submit score to leaderboard\n  app.post(\"/api/leaderboard\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const displayName = req.user?.claims?.first_name || req.user?.claims?.email?.split('@')[0] || 'Player';\n      \n      const scoreSchema = z.object({\n        score: z.number().min(0),\n      });\n      \n      const result = scoreSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ \n          error: fromZodError(result.error).message \n        });\n      }\n\n      const { score } = result.data;\n\n      // Add to leaderboard\n      const entry = await storage.addLeaderboardEntry({\n        userId: userId,\n        username: displayName,\n        score,\n      });\n\n      // Update high score in profile if this is a new record\n      const profile = await storage.getPlayerProfile(userId);\n      if (profile && score > profile.highScore) {\n        await storage.updatePlayerProfile(userId, { highScore: score });\n      }\n\n      res.json(entry);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== LEVEL PROGRESS ROUTES ====================\n\n  // Get user's level progress\n  app.get(\"/api/levels/progress\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const progress = await storage.getLevelProgressByUser(userId);\n      res.json(progress);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Update level progress\n  app.post(\"/api/levels/progress\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const progressSchema = z.object({\n        levelNumber: z.number().min(1),\n        score: z.number().min(0),\n        completed: z.boolean(),\n      });\n      \n      const result = progressSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ \n          error: fromZodError(result.error).message \n        });\n      }\n\n      const { levelNumber, score, completed } = result.data;\n      const progress = await storage.upsertLevelProgress(userId, levelNumber, score, completed);\n      res.json(progress);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== VERSION CHECK ROUTES ====================\n\n  // Get current update policy (public, no auth required)\n  app.get(\"/api/version\", async (_req, res) => {\n    try {\n      const policy = await storage.getActiveUpdatePolicy();\n      \n      if (!policy) {\n        return res.json({\n          latestVersion: \"1.2.0\",\n          minSupportedVersion: \"1.0.0\",\n          downloadUrl: \"/\",\n          releaseNotes: null,\n        });\n      }\n      \n      res.json({\n        latestVersion: policy.latestVersion,\n        minSupportedVersion: policy.minSupportedVersion,\n        downloadUrl: policy.downloadUrl,\n        releaseNotes: policy.releaseNotes,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== ANALYTICS/METADATA ROUTES ====================\n\n  // Submit error logs (synced then deleted from client)\n  app.post(\"/api/errors\", async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || null;\n      \n      const errorLogSchema = z.object({\n        severity: z.enum(['error', 'warn', 'info']),\n        category: z.enum(['runtime', 'api', 'sync', 'game', 'asset']),\n        message: z.string(),\n        stack: z.string().optional(),\n        component: z.string().optional(),\n        currentScreen: z.string().optional(),\n        gameState: z.string().optional(),\n        apiInfo: z.string().optional(),\n        sessionId: z.string(),\n        deviceInfo: z.string(),\n        networkStatus: z.string(),\n        lastUserAction: z.string().optional(),\n        eventTime: z.string(),\n      });\n      \n      const logsSchema = z.object({\n        logs: z.array(errorLogSchema),\n      });\n      \n      const result = logsSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ \n          error: fromZodError(result.error).message \n        });\n      }\n\n      const logsWithUser = result.data.logs.map(log => ({\n        userId,\n        severity: log.severity,\n        category: log.category,\n        message: log.message,\n        stack: log.stack ?? null,\n        component: log.component ?? null,\n        currentScreen: log.currentScreen ?? null,\n        gameState: log.gameState ?? null,\n        apiInfo: log.apiInfo ?? null,\n        sessionId: log.sessionId,\n        deviceInfo: log.deviceInfo,\n        networkStatus: log.networkStatus,\n        lastUserAction: log.lastUserAction ?? null,\n        eventTime: new Date(log.eventTime),\n      }));\n\n      await storage.insertErrorLogs(logsWithUser);\n      res.json({ success: true, count: logsWithUser.length });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Submit analytics events (metadata - synced then deleted from client)\n  app.post(\"/api/analytics\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const eventSchema = z.object({\n        eventType: z.enum(['level_play', 'level_success', 'level_fail', 'session_start', 'session_end']),\n        levelNumber: z.number().optional(),\n        score: z.number().optional(),\n        playDuration: z.number().optional(),\n        eventDate: z.string(),\n        eventTime: z.string(),\n        sessionId: z.string(),\n        deviceInfo: z.string(),\n      });\n      \n      const eventsSchema = z.object({\n        events: z.array(eventSchema),\n      });\n      \n      const result = eventsSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ \n          error: fromZodError(result.error).message \n        });\n      }\n\n      const eventsWithUser = result.data.events.map(event => ({\n        userId,\n        eventType: event.eventType,\n        levelNumber: event.levelNumber ?? null,\n        score: event.score ?? null,\n        playDuration: event.playDuration ?? null,\n        eventDate: event.eventDate,\n        eventTime: new Date(event.eventTime),\n        sessionId: event.sessionId,\n        deviceInfo: event.deviceInfo,\n      }));\n\n      await storage.insertAnalyticsEvents(eventsWithUser);\n      res.json({ success: true, count: eventsWithUser.length });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== ADMIN ROUTES ====================\n  \n  const ADMIN_USER_IDS = ['51476893'];\n  \n  const isAdmin = (req: any, res: any, next: any) => {\n    if (!req.user?.claims?.sub) {\n      return res.status(401).json({ message: 'Unauthorized' });\n    }\n    if (!ADMIN_USER_IDS.includes(req.user.claims.sub)) {\n      return res.status(403).json({ message: 'Forbidden: Admin access required' });\n    }\n    next();\n  };\n\n  app.get(\"/api/admin/stats\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const stats = await storage.getAdminStats();\n      res.json(stats);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/users\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/profiles\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const profiles = await storage.getAllProfiles();\n      res.json(profiles);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/levels\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const levels = await storage.getAllLevelProgress();\n      res.json(levels);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/leaderboard\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const entries = await storage.getTopScores(100);\n      res.json(entries);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/analytics\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 100;\n      const analytics = await storage.getAllAnalytics(limit);\n      res.json(analytics);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/errors\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 100;\n      const errors = await storage.getAllErrorLogs(limit);\n      res.json(errors);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/admin/update-policy\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const policy = await storage.getActiveUpdatePolicy();\n      res.json(policy || { latestVersion: '1.3.0', minSupportedVersion: '1.0.0', downloadUrl: '/', releaseNotes: null });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/admin/update-policy\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const policySchema = z.object({\n        latestVersion: z.string(),\n        minSupportedVersion: z.string(),\n        downloadUrl: z.string(),\n        releaseNotes: z.string().optional(),\n      });\n      \n      const result = policySchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      const policy = await storage.upsertUpdatePolicy(result.data);\n      res.json(policy);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/user/:userId\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      await storage.deleteUserData(req.params.userId);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== DAILY LAB ORDERS ROUTES ====================\n\n  app.get(\"/api/daily-order\", async (req: any, res) => {\n    try {\n      let order = await storage.getTodaysDailyOrder();\n      \n      // Auto-generate daily order if none exists\n      if (!order) {\n        const templates = [\n          { id: 'speed_run', title: 'Speed Containment', description: 'Complete a round in record time!', difficulty: 'medium', targetScore: 150, coinReward: 200, modifiers: JSON.stringify({ timeLimit: 30, speedMultiplier: 1.5 }) },\n          { id: 'big_bacteria', title: 'Giant Outbreak', description: 'Handle oversized bacteria!', difficulty: 'hard', targetScore: 200, coinReward: 350, modifiers: JSON.stringify({ sizeMultiplier: 1.4 }) },\n          { id: 'calm_waters', title: 'Calm Lab Day', description: 'Slower vibrations make placement easier.', difficulty: 'easy', targetScore: 100, coinReward: 100, modifiers: JSON.stringify({ speedMultiplier: 0.7 }) },\n        ];\n        const today = new Date().toISOString().split('T')[0];\n        const dayIndex = new Date().getDay();\n        const template = templates[dayIndex % templates.length];\n        \n        order = await storage.createDailyOrder({\n          orderDate: today,\n          ...template,\n        });\n      }\n      \n      // Check if user has completed today's order\n      const userId = req.user?.claims?.sub;\n      let completion = null;\n      if (userId) {\n        completion = await storage.getDailyOrderCompletion(userId, order.orderDate);\n      }\n      \n      res.json({ order, completion, isCompleted: !!completion });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/daily-order/complete\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const schema = z.object({\n        scoreAchieved: z.number().min(0),\n      });\n      \n      const result = schema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      const order = await storage.getTodaysDailyOrder();\n      if (!order) {\n        return res.status(404).json({ error: 'No daily order available today' });\n      }\n      \n      // Check if already completed\n      const existing = await storage.getDailyOrderCompletion(userId, order.orderDate);\n      if (existing) {\n        return res.status(400).json({ error: 'Already completed today\\'s order' });\n      }\n      \n      const completion = await storage.completeDailyOrder({\n        userId,\n        orderDate: order.orderDate,\n        scoreAchieved: result.data.scoreAchieved,\n      });\n      \n      // Award coins if target reached\n      let coinsAwarded = 0;\n      if (result.data.scoreAchieved >= order.targetScore) {\n        coinsAwarded = order.coinReward;\n        const profile = await storage.getPlayerProfile(userId);\n        if (profile) {\n          await storage.updatePlayerProfile(userId, { coins: profile.coins + coinsAwarded });\n        }\n      }\n      \n      res.json({ completion, coinsAwarded, success: result.data.scoreAchieved >= order.targetScore });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== WEEKLY COMMUNITY GOALS ROUTES ====================\n\n  app.get(\"/api/community-goal\", async (req: any, res) => {\n    try {\n      let goal = await storage.getCurrentWeeklyGoal();\n      \n      // Auto-generate weekly goal if none exists\n      if (!goal) {\n        const now = new Date();\n        const day = now.getDay();\n        const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n        const monday = new Date(now.setDate(diff));\n        const weekStart = monday.toISOString().split('T')[0];\n        \n        const templates = [\n          { title: 'Mass Containment Protocol', description: 'Community Goal: Place 50,000 bacteria together!', goalType: 'total_placements', targetValue: 50000, rewardType: 'coins', rewardData: JSON.stringify({ amount: 500 }) },\n          { title: 'Score Summit', description: 'Community Goal: Reach 1,000,000 combined score!', goalType: 'total_score', targetValue: 1000000, rewardType: 'cosmetic', rewardData: JSON.stringify({ cosmeticId: 'neon_glow', cosmeticName: 'Neon Glow Effect' }) },\n        ];\n        const weekIndex = Math.floor(now.getTime() / (7 * 24 * 60 * 60 * 1000)) % templates.length;\n        const template = templates[weekIndex];\n        \n        goal = await storage.createWeeklyGoal({\n          weekStart,\n          ...template,\n          currentValue: 0,\n          isCompleted: 0,\n        });\n      }\n      \n      // Get user's contribution if authenticated\n      const userId = req.user?.claims?.sub;\n      let userContribution = null;\n      if (userId) {\n        userContribution = await storage.getUserWeeklyContribution(userId, goal.weekStart);\n      }\n      \n      const progressPercentage = Math.min(100, (goal.currentValue / goal.targetValue) * 100);\n      \n      res.json({ \n        goal, \n        userContribution: userContribution?.contribution || 0,\n        progressPercentage,\n        isCompleted: goal.isCompleted === 1\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/community-goal/contribute\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const schema = z.object({\n        amount: z.number().min(1),\n      });\n      \n      const result = schema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      const goal = await storage.getCurrentWeeklyGoal();\n      if (!goal) {\n        return res.status(404).json({ error: 'No weekly goal available' });\n      }\n      \n      // Record user's contribution\n      const contribution = await storage.recordUserContribution(userId, goal.weekStart, result.data.amount);\n      \n      // Update global goal progress\n      const updatedGoal = await storage.contributeToWeeklyGoal(goal.weekStart, result.data.amount);\n      \n      res.json({ contribution, goal: updatedGoal });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==================== ACHIEVEMENTS ROUTES ====================\n\n  app.get(\"/api/achievements\", async (_req, res) => {\n    try {\n      const achievementsList = await storage.getAllAchievements();\n      res.json(achievementsList);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/achievements/progress\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const progress = await storage.getUserAchievementProgress(userId);\n      res.json(progress);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/achievements/progress\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const schema = z.object({\n        achievementId: z.string(),\n        progress: z.number().min(0),\n      });\n      \n      const result = schema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      // Get previous state to check if newly unlocked\n      const existingProgress = await storage.getUserAchievementProgress(userId);\n      const previousState = existingProgress.find(p => p.achievementId === result.data.achievementId);\n      const wasUnlocked = previousState?.isUnlocked === 1;\n      \n      const updated = await storage.updateAchievementProgress(userId, result.data.achievementId, result.data.progress);\n      const newlyUnlocked = updated.isUnlocked === 1 && !wasUnlocked;\n      \n      // Get achievement details if newly unlocked\n      let achievementDetails = null;\n      if (newlyUnlocked) {\n        const allAchievements = await storage.getAllAchievements();\n        achievementDetails = allAchievements.find(a => a.id === result.data.achievementId);\n      }\n      \n      res.json({ \n        ...updated, \n        newlyUnlocked,\n        achievementDetails\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/achievements/claim\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      \n      const schema = z.object({\n        achievementId: z.string(),\n      });\n      \n      const result = schema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      const claimed = await storage.claimAchievement(userId, result.data.achievementId);\n      if (!claimed) {\n        return res.status(400).json({ error: 'Achievement cannot be claimed' });\n      }\n      \n      // Get achievement details for coin reward\n      const achievements = await storage.getAllAchievements();\n      const achievement = achievements.find(a => a.id === result.data.achievementId);\n      \n      if (achievement) {\n        const profile = await storage.getPlayerProfile(userId);\n        if (profile) {\n          await storage.updatePlayerProfile(userId, { coins: profile.coins + achievement.coinReward });\n        }\n      }\n      \n      res.json({ claimed, coinsAwarded: achievement?.coinReward || 0 });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Generate documentation to Google Docs\n  app.post(\"/api/admin/generate-docs\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const { generateAllDocumentation } = await import('./generate-docs');\n      const urls = await generateAllDocumentation();\n      res.json({ success: true, documents: urls });\n    } catch (error: any) {\n      console.error('[docs] Failed to generate documentation:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Seed achievements on startup (admin only but useful for initial setup)\n  app.post(\"/api/admin/seed-achievements\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const achievementDefs = [\n        { id: 'first_placement', name: 'First Contact', description: 'Place your first bacteria', category: 'mastery', tier: 1, requirement: 1, coinReward: 10, badgeIcon: 'ðŸ¦ ' },\n        { id: 'placements_100', name: 'Lab Technician', description: 'Place 100 bacteria', category: 'mastery', tier: 1, requirement: 100, coinReward: 50, badgeIcon: 'ðŸ”¬' },\n        { id: 'placements_500', name: 'Senior Researcher', description: 'Place 500 bacteria', category: 'mastery', tier: 2, requirement: 500, coinReward: 150, badgeIcon: 'ðŸ‘¨â€ðŸ”¬' },\n        { id: 'placements_2000', name: 'Chief Scientist', description: 'Place 2000 bacteria', category: 'mastery', tier: 3, requirement: 2000, coinReward: 500, badgeIcon: 'ðŸ§¬' },\n        { id: 'score_1000', name: 'Coin Collector', description: 'Earn 1,000 total coins', category: 'collection', tier: 1, requirement: 1000, coinReward: 100, badgeIcon: 'ðŸ’°' },\n        { id: 'score_5000', name: 'Treasure Hunter', description: 'Earn 5,000 total coins', category: 'collection', tier: 2, requirement: 5000, coinReward: 300, badgeIcon: 'ðŸ’Ž' },\n        { id: 'level_1', name: 'Getting Started', description: 'Complete Level 1', category: 'challenge', tier: 1, requirement: 1, coinReward: 25, badgeIcon: 'â­' },\n        { id: 'level_7', name: 'Master Containment', description: 'Complete all 7 levels', category: 'challenge', tier: 3, requirement: 7, coinReward: 500, badgeIcon: 'ðŸ†' },\n        { id: 'daily_1', name: 'First Order', description: 'Complete your first daily order', category: 'social', tier: 1, requirement: 1, coinReward: 50, badgeIcon: 'ðŸ“‹' },\n        { id: 'endless_10', name: 'Survivor', description: 'Reach wave 10 in Endless Mode', category: 'challenge', tier: 2, requirement: 10, coinReward: 300, badgeIcon: 'â™¾ï¸' },\n      ];\n      \n      await storage.seedAchievements(achievementDefs);\n      res.json({ success: true, count: achievementDefs.length });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":28498,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/App.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { Route, Switch } from \"wouter\";\nimport { useGameStore, UPGRADE_COSTS } from \"./lib/store\";\nimport { GameEngine } from \"./components/game/GameEngine\";\nimport { HUD } from \"./components/game/HUD\";\nimport { MainMenu } from \"./components/game/MainMenu\";\nimport { Shop } from \"./components/game/Shop\";\nimport { LevelSelect } from \"./components/game/LevelSelect\";\nimport { LabChronicles } from \"./components/game/LabChronicles\";\nimport { BacteriaCodex } from \"./components/game/BacteriaCodex\";\nimport { MutationChoice } from \"./components/game/MutationChoice\";\nimport { EndlessMode } from \"./components/game/EndlessMode\";\nimport { UpdateModal } from \"./components/game/UpdateModal\";\nimport { AdminPage } from \"./pages/Admin\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { usePlayerProfile, useUpdateProfile, useSubmitScore, useUpdateLevelProgress, useLevelProgress } from \"./lib/api\";\nimport { useAuth } from \"./hooks/use-auth\";\nimport { LEVELS } from \"./lib/game-constants\";\nimport { playGameOverSound } from \"./lib/sounds\";\nimport { offlineStorage } from \"./lib/offline-storage\";\nimport { useNetworkStatus } from \"./lib/network\";\nimport { initGlobalErrorHandlers, trackUserAction } from \"./lib/error-logger\";\nimport { AchievementCelebration } from \"./components/game/AchievementCelebration\";\n\ninterface WinScreenProps {\n  score: number;\n  currentLevel: number;\n  maxUnlockedLevel: number;\n  user: { id: string } | null | undefined;\n  profile: { coins: number; highScore: number } | null | undefined;\n  onReplay: () => void;\n  onNextLevel: () => void;\n  onMenu: () => void;\n  onSaveProgress: () => Promise<void>;\n}\n\nfunction WinScreen({ score, currentLevel, maxUnlockedLevel, user, profile, onReplay, onNextLevel, onMenu, onSaveProgress }: WinScreenProps) {\n  const hasNextLevel = currentLevel < LEVELS.length;\n  const isLastLevel = currentLevel >= LEVELS.length;\n  const saveCalledRef = useRef(false);\n  const [progressSaved, setProgressSaved] = useState(false);\n  const { setGameState } = useGameStore();\n  \n  useEffect(() => {\n    if (!saveCalledRef.current) {\n      saveCalledRef.current = true;\n      onSaveProgress().then(() => setProgressSaved(true)).catch(console.error);\n    }\n  }, []);\n\n  const handleLevelSelect = () => {\n    setGameState('LEVEL_SELECT');\n  };\n\n  return (\n    <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/95 scanlines crt-vignette\">\n      <div className=\"absolute inset-0 grid-bg opacity-20\" />\n      <div className=\"block-panel p-8 text-center max-w-sm w-full mx-4 border-2 border-primary shadow-[0_0_40px_rgba(34,242,162,0.4)] relative z-10\">\n        <div className=\"absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 bg-primary text-black font-display text-xs\">\n          {isLastLevel ? 'GAME COMPLETE!' : 'SUCCESS'}\n        </div>\n        <h2 className=\"text-xl font-display text-primary text-glow mb-2 mt-2\">\n          {isLastLevel ? 'ALL LEVELS' : `LEVEL ${currentLevel}`}\n        </h2>\n        <h3 className=\"text-2xl font-display text-secondary text-glow mb-4\">\n          {isLastLevel ? 'ðŸ† CHAMPION! ðŸ†' : 'â˜… COMPLETE! â˜…'}\n        </h3>\n        <p className=\"font-ui text-xl text-muted-foreground mb-6\">\n          {isLastLevel ? 'You conquered all levels!' : 'All bacteria placed!'}\n        </p>\n        \n        <div className=\"space-y-3 mb-6 bg-muted p-4 rounded-lg border border-border\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"font-ui text-lg text-muted-foreground\">SCORE</span>\n            <span className=\"font-display text-lg text-secondary text-glow\" data-testid=\"text-win-score\">\n              {score.toLocaleString()}\n            </span>\n          </div>\n          {user && (\n            <div className=\"flex justify-between items-center\">\n              <span className=\"font-ui text-lg text-muted-foreground\">BONUS</span>\n              <span className=\"font-display text-lg coin-display\" data-testid=\"text-win-bonus\">\n                +{score} G\n              </span>\n            </div>\n          )}\n        </div>\n        \n        <div className=\"space-y-3\">\n          {isLastLevel ? (\n            <button \n              onClick={handleLevelSelect}\n              className=\"w-full py-4 pixel-btn font-display text-sm animate-glow-pulse\"\n              data-testid=\"button-level-select\"\n            >\n              VIEW ALL LEVELS\n            </button>\n          ) : hasNextLevel && (\n            <button \n              onClick={onNextLevel}\n              className=\"w-full py-4 pixel-btn font-display text-sm animate-glow-pulse\"\n              data-testid=\"button-next-level\"\n            >\n              NEXT LEVEL â†’\n            </button>\n          )}\n          <button \n            onClick={onReplay}\n            className=\"w-full py-3 block-panel font-display text-sm hover:border-primary transition-colors\"\n            data-testid=\"button-replay\"\n          >\n            REPLAY LEVEL\n          </button>\n          <button \n            onClick={onMenu}\n            className=\"w-full py-3 block-panel font-display text-sm hover:border-secondary transition-colors\"\n            data-testid=\"button-main-menu\"\n          >\n            MAIN MENU\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  const [updateCheckComplete, setUpdateCheckComplete] = useState(false);\n  const { \n    gameState, \n    setGameState, \n    score, \n    coins,\n    collectCoin, \n    syncWithProfile, \n    stopTimer, \n    notification,\n    currentLevel,\n    maxUnlockedLevel,\n    recordLevelCompletion,\n    setLevelProgress,\n    selectLevel,\n    initializeGame,\n    startTimer,\n    currentLevelConfig,\n    buyUpgrade,\n  } = useGameStore();\n  const { user } = useAuth();\n  const { data: profile } = usePlayerProfile();\n  const { data: levelProgressData } = useLevelProgress();\n  const updateProfile = useUpdateProfile();\n  const submitScore = useSubmitScore();\n  const updateLevelProgress = useUpdateLevelProgress();\n  \n  // Network sync for metadata\n  useNetworkStatus();\n  \n  // Track session start on app mount and initialize error handlers\n  const sessionStartedRef = useRef(false);\n  useEffect(() => {\n    if (!sessionStartedRef.current) {\n      sessionStartedRef.current = true;\n      offlineStorage.trackSessionStart();\n      initGlobalErrorHandlers();\n    }\n  }, []);\n  \n  // Track level start time for play duration calculation\n  const levelStartTimeRef = useRef<number>(0);\n  useEffect(() => {\n    if (gameState === 'PLAYING') {\n      levelStartTimeRef.current = Date.now();\n    }\n  }, [gameState]);\n  \n  // Toggle body class for game playing states (disable scroll during gameplay)\n  useEffect(() => {\n    const isPlaying = gameState === 'PLAYING' || gameState === 'ENDLESS_PLAYING';\n    if (isPlaying) {\n      document.body.classList.add('game-playing');\n    } else {\n      document.body.classList.remove('game-playing');\n    }\n    return () => document.body.classList.remove('game-playing');\n  }, [gameState]);\n\n  // Load from local storage on first mount (before server data arrives)\n  useEffect(() => {\n    useGameStore.getState().loadFromLocalStorage();\n  }, []);\n\n  useEffect(() => {\n    if (levelProgressData && user) {\n      const formattedProgress = levelProgressData.map(p => ({\n        levelNumber: p.levelNumber,\n        bestScore: p.bestScore,\n        isCompleted: p.isCompleted === 1,\n      }));\n      setLevelProgress(formattedProgress);\n      offlineStorage.mergeServerProgress(levelProgressData);\n    } else if (!user) {\n      const localProgress = offlineStorage.getLevelProgress();\n      if (localProgress.length > 0) {\n        setLevelProgress(localProgress);\n      }\n    }\n  }, [levelProgressData, user, setLevelProgress]);\n\n  useEffect(() => {\n    if (profile) {\n      syncWithProfile(profile);\n    }\n  }, [profile, syncWithProfile]);\n\n  const handleGameOver = async () => {\n    stopTimer();\n    playGameOverSound();\n    setGameState('GAME_OVER');\n\n    const finalScore = useGameStore.getState().score;\n    offlineStorage.updateHighScore(finalScore);\n    \n    // Track metadata: level failure\n    const playDuration = Math.floor((Date.now() - levelStartTimeRef.current) / 1000);\n    offlineStorage.trackLevelFail(currentLevel, finalScore, playDuration);\n\n    if (user && profile) {\n      const coinsEarned = Math.floor(finalScore / 2);\n      \n      collectCoin(coinsEarned);\n      \n      try {\n        await updateProfile.mutateAsync({\n          coins: profile.coins + coinsEarned,\n        });\n\n        await submitScore.mutateAsync(finalScore);\n      } catch (error) {\n        console.error('Failed to save game progress:', error);\n      }\n    }\n  };\n\n  const isGameScreen = gameState === 'PLAYING' || gameState === 'ENDLESS_PLAYING' || gameState === 'GAME_OVER' || gameState === 'WIN';\n  \n  return (\n    <div className={`min-h-screen w-full bg-background ${isGameScreen ? 'fixed inset-0 overflow-hidden' : ''}`}>\n      <UpdateModal onReady={() => setUpdateCheckComplete(true)} />\n      \n      {updateCheckComplete && gameState === 'MENU' && (\n        <MainMenu />\n      )}\n      \n      {updateCheckComplete && gameState === 'SHOP' && (\n        <Shop />\n      )}\n\n      {updateCheckComplete && gameState === 'CHRONICLES' && (\n        <LabChronicles />\n      )}\n\n      {updateCheckComplete && gameState === 'CODEX' && (\n        <BacteriaCodex />\n      )}\n\n      {updateCheckComplete && gameState === 'ENDLESS_MODE' && (\n        <EndlessMode />\n      )}\n\n      {updateCheckComplete && gameState === 'MUTATION_CHOICE' && (\n        <MutationChoice />\n      )}\n\n      {updateCheckComplete && gameState === 'ENDLESS_PLAYING' && (\n        <div className=\"relative w-full h-full bg-background scanlines\">\n          <div className=\"absolute inset-0 grid-bg opacity-30\" />\n          <HUD />\n          <div className=\"absolute left-24 top-16 right-0 bottom-0 flex items-center justify-center\">\n            <GameEngine onGameOver={handleGameOver} />\n          </div>\n        </div>\n      )}\n\n      {updateCheckComplete && gameState === 'LEVEL_SELECT' && (\n        <LevelSelect />\n      )}\n\n      {updateCheckComplete && (gameState === 'PLAYING' || gameState === 'CELEBRATING' || gameState === 'GAME_OVER') && (\n        <div className=\"relative w-full h-full bg-background scanlines\">\n          <div className=\"absolute inset-0 grid-bg opacity-30\" />\n          <HUD />\n          <div className=\"absolute left-24 top-16 right-0 bottom-0 flex items-center justify-center\">\n            <GameEngine onGameOver={handleGameOver} />\n          </div>\n        </div>\n      )}\n\n      {updateCheckComplete && gameState === 'GAME_OVER' && (\n        <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/95 scanlines crt-vignette\">\n          <div className=\"absolute inset-0 grid-bg opacity-20\" />\n          <div className=\"block-panel p-8 text-center max-w-sm w-full mx-4 border-2 border-destructive shadow-[0_0_40px_rgba(255,68,68,0.4)] relative z-10\">\n            <div className=\"absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 bg-destructive text-white font-display text-xs\">\n              GAME OVER\n            </div>\n            <h2 className=\"text-xl font-display text-destructive mb-3 mt-2\" style={{ textShadow: '0 0 10px rgba(255,68,68,0.5)' }}>\n              {notification === 'TIME OUT!' ? 'TIME OUT!' : \n               notification === 'TOUCHED BOUNDARY!' ? 'OUT OF BOUNDS!' : \n               'COLLISION!'}\n            </h2>\n            <p className=\"font-ui text-xl text-muted-foreground mb-6\">\n              {notification === 'TIME OUT!' ? 'You ran out of time!' : \n               notification === 'TOUCHED BOUNDARY!' ? 'Figure touched the boundary!' : \n               'Two bacteria touched!'}\n            </p>\n            \n            <div className=\"space-y-3 mb-6 bg-muted p-4 rounded-lg border border-border\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"font-ui text-lg text-muted-foreground\">SCORE</span>\n                <span className=\"font-display text-lg text-secondary text-glow\" data-testid=\"text-final-score\">\n                  {score.toLocaleString()}\n                </span>\n              </div>\n              {user && (\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"font-ui text-lg text-muted-foreground\">GOLD</span>\n                  <span className=\"font-display text-lg coin-display\" data-testid=\"text-coins-earned\">\n                    +{Math.floor(score / 2)} G\n                  </span>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"space-y-3\">\n              {/* Second Chance Button */}\n              {(() => {\n                const gameState = useGameStore.getState();\n                const hasSecondChance = gameState.upgrades.secondChance > 0 && !gameState.secondChanceUsed;\n                const canBuySecondChance = coins >= UPGRADE_COSTS.secondChance;\n                \n                if (hasSecondChance) {\n                  return (\n                    <button \n                      onClick={() => {\n                        trackUserAction('click:second_chance');\n                        const success = useGameStore.getState().useSecondChance();\n                        if (success) {\n                          setGameState('PLAYING');\n                          useGameStore.getState().resumeTimer();\n                        }\n                      }}\n                      className=\"w-full py-4 font-display text-sm bg-orange-500 text-black rounded-lg hover:bg-orange-400 transition-colors animate-pulse\"\n                      style={{ boxShadow: '0 0 20px rgba(249,115,22,0.6)' }}\n                      data-testid=\"button-second-chance\"\n                    >\n                      ðŸ”„ USE SECOND CHANCE ({gameState.upgrades.secondChance} left)\n                    </button>\n                  );\n                } else if (canBuySecondChance && !gameState.secondChanceUsed) {\n                  return (\n                    <button \n                      onClick={() => {\n                        trackUserAction('click:buy_second_chance');\n                        const bought = buyUpgrade('secondChance');\n                        if (bought) {\n                          const success = useGameStore.getState().useSecondChance();\n                          if (success) {\n                            setGameState('PLAYING');\n                            useGameStore.getState().resumeTimer();\n                          }\n                        }\n                      }}\n                      className=\"w-full py-4 font-display text-sm bg-orange-500/80 text-black rounded-lg hover:bg-orange-400 transition-colors border-2 border-orange-400\"\n                      style={{ boxShadow: '0 0 15px rgba(249,115,22,0.4)' }}\n                      data-testid=\"button-buy-second-chance\"\n                    >\n                      ðŸ”„ BUY & USE 2ND CHANCE ({UPGRADE_COSTS.secondChance}G)\n                    </button>\n                  );\n                }\n                return null;\n              })()}\n              \n              <button \n                onClick={() => {\n                  trackUserAction('click:retry_level');\n                  initializeGame();\n                  setGameState('PLAYING');\n                  startTimer();\n                  offlineStorage.trackLevelPlay(currentLevel);\n                }}\n                className=\"w-full py-4 pixel-btn font-display text-sm\"\n                data-testid=\"button-retry\"\n              >\n                RETRY LEVEL\n              </button>\n              <button \n                onClick={() => {\n                  trackUserAction('click:main_menu');\n                  setGameState('MENU');\n                }}\n                className=\"w-full py-3 block-panel font-display text-sm hover:border-secondary transition-colors\"\n                data-testid=\"button-main-menu\"\n              >\n                MAIN MENU\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {updateCheckComplete && gameState === 'WIN' && (\n        <WinScreen \n          score={score}\n          currentLevel={currentLevel}\n          maxUnlockedLevel={maxUnlockedLevel}\n          user={user}\n          profile={profile}\n          onReplay={() => {\n            initializeGame();\n            setGameState('PLAYING');\n            startTimer();\n            offlineStorage.trackLevelPlay(currentLevel);\n          }}\n          onNextLevel={() => {\n            const nextLevel = currentLevel + 1;\n            if (nextLevel <= LEVELS.length) {\n              const levelIndex = nextLevel - 1;\n              const levelConfig = LEVELS[levelIndex];\n              useGameStore.setState({ \n                currentLevel: nextLevel,\n                currentLevelConfig: levelConfig,\n                selectedLevel: nextLevel,\n              });\n              initializeGame();\n              setGameState('PLAYING');\n              startTimer();\n              offlineStorage.trackLevelPlay(nextLevel);\n            }\n          }}\n          onMenu={() => setGameState('MENU')}\n          onSaveProgress={async () => {\n            // Track metadata: level success\n            const playDuration = Math.floor((Date.now() - levelStartTimeRef.current) / 1000);\n            offlineStorage.trackLevelSuccess(currentLevel, score, playDuration);\n            \n            recordLevelCompletion(currentLevel, score);\n            if (user && profile) {\n              try {\n                await updateLevelProgress.mutateAsync({\n                  levelNumber: currentLevel,\n                  score,\n                  completed: true,\n                });\n                await updateProfile.mutateAsync({\n                  coins: profile.coins + score,\n                });\n                await submitScore.mutateAsync(score);\n              } catch (error) {\n                console.error('Failed to save progress:', error);\n              }\n            }\n          }}\n        />\n      )}\n\n      <Toaster />\n      <AchievementCelebration />\n    </div>\n  );\n}\n\nfunction AppRouter() {\n  return (\n    <Switch>\n      <Route path=\"/admin\" component={AdminPage} />\n      <Route path=\"/\" component={App} />\n    </Switch>\n  );\n}\n\nexport default AppRouter;\n","path":null,"size_bytes":18354,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"server/storage.ts":{"content":"import { \n  playerProfiles,\n  leaderboard,\n  levelProgress,\n  userAnalytics,\n  errorLogs,\n  appUpdatePolicy,\n  users,\n  dailyLabOrders,\n  dailyOrderCompletions,\n  weeklyGoals,\n  weeklyGoalContributions,\n  achievements,\n  userAchievementProgress,\n  type PlayerProfile,\n  type InsertPlayerProfile,\n  type Leaderboard,\n  type InsertLeaderboard,\n  type LevelProgress,\n  type InsertLevelProgress,\n  type InsertUserAnalytics,\n  type InsertErrorLog,\n  type AppUpdatePolicy,\n  type User,\n  type InsertAppUpdatePolicy,\n  type DailyLabOrder,\n  type InsertDailyLabOrder,\n  type DailyOrderCompletion,\n  type InsertDailyOrderCompletion,\n  type WeeklyGoal,\n  type InsertWeeklyGoal,\n  type WeeklyGoalContribution,\n  type Achievement,\n  type InsertAchievement,\n  type UserAchievementProgress,\n  type InsertUserAchievementProgress\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Player Profile Management\n  getPlayerProfile(userId: string): Promise<PlayerProfile | undefined>;\n  createPlayerProfile(profile: InsertPlayerProfile): Promise<PlayerProfile>;\n  updatePlayerProfile(userId: string, updates: Partial<InsertPlayerProfile>): Promise<PlayerProfile>;\n  \n  // Leaderboard Management\n  getTopScores(limit: number): Promise<Leaderboard[]>;\n  addLeaderboardEntry(entry: InsertLeaderboard): Promise<Leaderboard>;\n  getUserBestScore(userId: string): Promise<number>;\n  \n  // Level Progress Management\n  getLevelProgressByUser(userId: string): Promise<LevelProgress[]>;\n  upsertLevelProgress(userId: string, levelNumber: number, score: number, completed: boolean): Promise<LevelProgress>;\n  \n  // Analytics/Metadata Management\n  insertAnalyticsEvents(events: InsertUserAnalytics[]): Promise<void>;\n  \n  // Error Logs Management\n  insertErrorLogs(logs: InsertErrorLog[]): Promise<void>;\n  \n  // App Update Policy\n  getActiveUpdatePolicy(): Promise<AppUpdatePolicy | undefined>;\n  upsertUpdatePolicy(policy: Omit<InsertAppUpdatePolicy, 'isActive'>): Promise<AppUpdatePolicy>;\n  \n  // Admin Methods\n  getAllUsers(): Promise<User[]>;\n  getAllProfiles(): Promise<(PlayerProfile & { email?: string; firstName?: string; lastName?: string })[]>;\n  getAllLevelProgress(): Promise<LevelProgress[]>;\n  getAllAnalytics(limit?: number): Promise<any[]>;\n  getAllErrorLogs(limit?: number): Promise<any[]>;\n  getAdminStats(): Promise<{ totalUsers: number; totalGamesPlayed: number; totalErrors: number }>;\n  deleteUserData(userId: string): Promise<void>;\n  \n  // Daily Lab Orders\n  getTodaysDailyOrder(): Promise<DailyLabOrder | undefined>;\n  createDailyOrder(order: InsertDailyLabOrder): Promise<DailyLabOrder>;\n  getDailyOrderCompletion(userId: string, orderDate: string): Promise<DailyOrderCompletion | undefined>;\n  completeDailyOrder(completion: InsertDailyOrderCompletion): Promise<DailyOrderCompletion>;\n  \n  // Weekly Community Goals\n  getCurrentWeeklyGoal(): Promise<WeeklyGoal | undefined>;\n  createWeeklyGoal(goal: InsertWeeklyGoal): Promise<WeeklyGoal>;\n  contributeToWeeklyGoal(weekStart: string, amount: number): Promise<WeeklyGoal | undefined>;\n  getUserWeeklyContribution(userId: string, weekStart: string): Promise<WeeklyGoalContribution | undefined>;\n  recordUserContribution(userId: string, weekStart: string, amount: number): Promise<WeeklyGoalContribution>;\n  \n  // Achievements\n  getAllAchievements(): Promise<Achievement[]>;\n  seedAchievements(achievementsList: InsertAchievement[]): Promise<void>;\n  getUserAchievementProgress(userId: string): Promise<UserAchievementProgress[]>;\n  updateAchievementProgress(userId: string, achievementId: string, progress: number): Promise<UserAchievementProgress>;\n  claimAchievement(userId: string, achievementId: string): Promise<UserAchievementProgress | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Player Profile Methods\n  async getPlayerProfile(userId: string): Promise<PlayerProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(playerProfiles)\n      .where(eq(playerProfiles.userId, userId));\n    return profile || undefined;\n  }\n  \n  async createPlayerProfile(profile: InsertPlayerProfile): Promise<PlayerProfile> {\n    const [newProfile] = await db\n      .insert(playerProfiles)\n      .values(profile)\n      .returning();\n    return newProfile;\n  }\n  \n  async updatePlayerProfile(userId: string, updates: Partial<InsertPlayerProfile>): Promise<PlayerProfile> {\n    const [updatedProfile] = await db\n      .update(playerProfiles)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(playerProfiles.userId, userId))\n      .returning();\n    return updatedProfile;\n  }\n  \n  // Leaderboard Methods\n  async getTopScores(limit: number = 10): Promise<Leaderboard[]> {\n    return await db\n      .select()\n      .from(leaderboard)\n      .orderBy(desc(leaderboard.score))\n      .limit(limit);\n  }\n  \n  async addLeaderboardEntry(entry: InsertLeaderboard): Promise<Leaderboard> {\n    // Check if user already has a leaderboard entry\n    const [existing] = await db\n      .select()\n      .from(leaderboard)\n      .where(eq(leaderboard.userId, entry.userId));\n    \n    if (existing) {\n      // Only update if new score is higher\n      if (entry.score > existing.score) {\n        const [updated] = await db\n          .update(leaderboard)\n          .set({ \n            score: entry.score, \n            createdAt: new Date() \n          })\n          .where(eq(leaderboard.id, existing.id))\n          .returning();\n        return updated;\n      }\n      return existing;\n    }\n    \n    // Create new entry\n    const [newEntry] = await db\n      .insert(leaderboard)\n      .values(entry)\n      .returning();\n    return newEntry;\n  }\n  \n  async getUserBestScore(userId: string): Promise<number> {\n    const [result] = await db\n      .select()\n      .from(leaderboard)\n      .where(eq(leaderboard.userId, userId))\n      .orderBy(desc(leaderboard.score))\n      .limit(1);\n    return result?.score || 0;\n  }\n  \n  // Level Progress Methods\n  async getLevelProgressByUser(userId: string): Promise<LevelProgress[]> {\n    return await db\n      .select()\n      .from(levelProgress)\n      .where(eq(levelProgress.userId, userId))\n      .orderBy(levelProgress.levelNumber);\n  }\n  \n  async upsertLevelProgress(userId: string, levelNumber: number, score: number, completed: boolean): Promise<LevelProgress> {\n    const [existing] = await db\n      .select()\n      .from(levelProgress)\n      .where(and(eq(levelProgress.userId, userId), eq(levelProgress.levelNumber, levelNumber)));\n    \n    if (existing) {\n      const [updated] = await db\n        .update(levelProgress)\n        .set({\n          bestScore: score > existing.bestScore ? score : existing.bestScore,\n          isCompleted: completed ? 1 : existing.isCompleted,\n        })\n        .where(eq(levelProgress.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(levelProgress)\n        .values({\n          userId,\n          levelNumber,\n          bestScore: score,\n          isCompleted: completed ? 1 : 0,\n        })\n        .returning();\n      return created;\n    }\n  }\n  \n  // Analytics/Metadata Methods\n  async insertAnalyticsEvents(events: InsertUserAnalytics[]): Promise<void> {\n    if (events.length === 0) return;\n    await db.insert(userAnalytics).values(events);\n  }\n  \n  // Error Logs Methods\n  async insertErrorLogs(logs: InsertErrorLog[]): Promise<void> {\n    if (logs.length === 0) return;\n    await db.insert(errorLogs).values(logs);\n  }\n  \n  // App Update Policy Methods\n  async getActiveUpdatePolicy(): Promise<AppUpdatePolicy | undefined> {\n    const [policy] = await db\n      .select()\n      .from(appUpdatePolicy)\n      .where(eq(appUpdatePolicy.isActive, 1))\n      .limit(1);\n    return policy;\n  }\n  \n  async upsertUpdatePolicy(policy: Omit<InsertAppUpdatePolicy, 'isActive'>): Promise<AppUpdatePolicy> {\n    await db.update(appUpdatePolicy).set({ isActive: 0 });\n    \n    const [created] = await db\n      .insert(appUpdatePolicy)\n      .values({ ...policy, isActive: 1 })\n      .returning();\n    return created;\n  }\n  \n  // Admin Methods\n  async getAllUsers(): Promise<User[]> {\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  }\n  \n  async getAllProfiles(): Promise<(PlayerProfile & { email?: string; firstName?: string; lastName?: string })[]> {\n    const results = await db\n      .select({\n        id: playerProfiles.id,\n        userId: playerProfiles.userId,\n        coins: playerProfiles.coins,\n        highScore: playerProfiles.highScore,\n        speedUpgrade: playerProfiles.speedUpgrade,\n        startSizeUpgrade: playerProfiles.startSizeUpgrade,\n        magnetUpgrade: playerProfiles.magnetUpgrade,\n        updatedAt: playerProfiles.updatedAt,\n        email: users.email,\n        firstName: users.firstName,\n        lastName: users.lastName,\n      })\n      .from(playerProfiles)\n      .leftJoin(users, eq(playerProfiles.userId, users.id))\n      .orderBy(desc(playerProfiles.highScore));\n    return results.map(r => ({\n      ...r,\n      email: r.email || undefined,\n      firstName: r.firstName || undefined,\n      lastName: r.lastName || undefined,\n    }));\n  }\n  \n  async getAllLevelProgress(): Promise<LevelProgress[]> {\n    return db.select().from(levelProgress).orderBy(desc(levelProgress.bestScore));\n  }\n  \n  async getAllAnalytics(limit = 100): Promise<any[]> {\n    return db\n      .select()\n      .from(userAnalytics)\n      .orderBy(desc(userAnalytics.createdAt))\n      .limit(limit);\n  }\n  \n  async getAllErrorLogs(limit = 100): Promise<any[]> {\n    return db\n      .select()\n      .from(errorLogs)\n      .orderBy(desc(errorLogs.createdAt))\n      .limit(limit);\n  }\n  \n  async getAdminStats(): Promise<{ totalUsers: number; totalGamesPlayed: number; totalErrors: number }> {\n    const [userCount] = await db.select({ count: sql<number>`count(*)` }).from(users);\n    const [gamesCount] = await db.select({ count: sql<number>`count(*)` }).from(userAnalytics).where(eq(userAnalytics.eventType, 'level_play'));\n    const [errorsCount] = await db.select({ count: sql<number>`count(*)` }).from(errorLogs);\n    \n    return {\n      totalUsers: Number(userCount?.count || 0),\n      totalGamesPlayed: Number(gamesCount?.count || 0),\n      totalErrors: Number(errorsCount?.count || 0),\n    };\n  }\n  \n  async deleteUserData(userId: string): Promise<void> {\n    await db.delete(levelProgress).where(eq(levelProgress.userId, userId));\n    await db.delete(leaderboard).where(eq(leaderboard.userId, userId));\n    await db.delete(playerProfiles).where(eq(playerProfiles.userId, userId));\n    await db.delete(userAnalytics).where(eq(userAnalytics.userId, userId));\n  }\n  \n  // Daily Lab Orders Methods\n  async getTodaysDailyOrder(): Promise<DailyLabOrder | undefined> {\n    const today = new Date().toISOString().split('T')[0];\n    const [order] = await db\n      .select()\n      .from(dailyLabOrders)\n      .where(eq(dailyLabOrders.orderDate, today));\n    return order || undefined;\n  }\n  \n  async createDailyOrder(order: InsertDailyLabOrder): Promise<DailyLabOrder> {\n    const [created] = await db.insert(dailyLabOrders).values(order).returning();\n    return created;\n  }\n  \n  async getDailyOrderCompletion(userId: string, orderDate: string): Promise<DailyOrderCompletion | undefined> {\n    const [completion] = await db\n      .select()\n      .from(dailyOrderCompletions)\n      .where(and(\n        eq(dailyOrderCompletions.userId, userId),\n        eq(dailyOrderCompletions.orderDate, orderDate)\n      ));\n    return completion || undefined;\n  }\n  \n  async completeDailyOrder(completion: InsertDailyOrderCompletion): Promise<DailyOrderCompletion> {\n    const [created] = await db.insert(dailyOrderCompletions).values(completion).returning();\n    return created;\n  }\n  \n  // Weekly Community Goals Methods\n  async getCurrentWeeklyGoal(): Promise<WeeklyGoal | undefined> {\n    // Get the Monday of current week\n    const now = new Date();\n    const day = now.getDay();\n    const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n    const monday = new Date(now.setDate(diff));\n    const weekStart = monday.toISOString().split('T')[0];\n    \n    const [goal] = await db\n      .select()\n      .from(weeklyGoals)\n      .where(eq(weeklyGoals.weekStart, weekStart));\n    return goal || undefined;\n  }\n  \n  async createWeeklyGoal(goal: InsertWeeklyGoal): Promise<WeeklyGoal> {\n    const [created] = await db.insert(weeklyGoals).values(goal).returning();\n    return created;\n  }\n  \n  async contributeToWeeklyGoal(weekStart: string, amount: number): Promise<WeeklyGoal | undefined> {\n    const [goal] = await db\n      .select()\n      .from(weeklyGoals)\n      .where(eq(weeklyGoals.weekStart, weekStart));\n    \n    if (!goal) return undefined;\n    \n    const newValue = goal.currentValue + amount;\n    const isCompleted = newValue >= goal.targetValue ? 1 : 0;\n    \n    const [updated] = await db\n      .update(weeklyGoals)\n      .set({ currentValue: newValue, isCompleted })\n      .where(eq(weeklyGoals.id, goal.id))\n      .returning();\n    return updated;\n  }\n  \n  async getUserWeeklyContribution(userId: string, weekStart: string): Promise<WeeklyGoalContribution | undefined> {\n    const [contribution] = await db\n      .select()\n      .from(weeklyGoalContributions)\n      .where(and(\n        eq(weeklyGoalContributions.userId, userId),\n        eq(weeklyGoalContributions.weekStart, weekStart)\n      ));\n    return contribution || undefined;\n  }\n  \n  async recordUserContribution(userId: string, weekStart: string, amount: number): Promise<WeeklyGoalContribution> {\n    const existing = await this.getUserWeeklyContribution(userId, weekStart);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(weeklyGoalContributions)\n        .set({ \n          contribution: existing.contribution + amount,\n          lastUpdated: new Date()\n        })\n        .where(eq(weeklyGoalContributions.id, existing.id))\n        .returning();\n      return updated;\n    }\n    \n    const [created] = await db\n      .insert(weeklyGoalContributions)\n      .values({ userId, weekStart, contribution: amount })\n      .returning();\n    return created;\n  }\n  \n  // Achievement Methods\n  async getAllAchievements(): Promise<Achievement[]> {\n    return db.select().from(achievements).orderBy(achievements.tier, achievements.category);\n  }\n  \n  async seedAchievements(achievementsList: InsertAchievement[]): Promise<void> {\n    for (const achievement of achievementsList) {\n      const [existing] = await db.select().from(achievements).where(eq(achievements.id, achievement.id));\n      if (!existing) {\n        await db.insert(achievements).values(achievement);\n      }\n    }\n  }\n  \n  async getUserAchievementProgress(userId: string): Promise<UserAchievementProgress[]> {\n    return db\n      .select()\n      .from(userAchievementProgress)\n      .where(eq(userAchievementProgress.userId, userId));\n  }\n  \n  async updateAchievementProgress(userId: string, achievementId: string, progress: number): Promise<UserAchievementProgress> {\n    const [existing] = await db\n      .select()\n      .from(userAchievementProgress)\n      .where(and(\n        eq(userAchievementProgress.userId, userId),\n        eq(userAchievementProgress.achievementId, achievementId)\n      ));\n    \n    // Get the achievement to check if unlocked\n    const [achievement] = await db.select().from(achievements).where(eq(achievements.id, achievementId));\n    const isUnlocked = achievement && progress >= achievement.requirement ? 1 : 0;\n    \n    if (existing) {\n      const [updated] = await db\n        .update(userAchievementProgress)\n        .set({ \n          currentProgress: progress,\n          isUnlocked,\n          unlockedAt: isUnlocked && !existing.isUnlocked ? new Date() : existing.unlockedAt\n        })\n        .where(eq(userAchievementProgress.id, existing.id))\n        .returning();\n      return updated;\n    }\n    \n    const [created] = await db\n      .insert(userAchievementProgress)\n      .values({ \n        userId, \n        achievementId, \n        currentProgress: progress,\n        isUnlocked,\n        unlockedAt: isUnlocked ? new Date() : null\n      })\n      .returning();\n    return created;\n  }\n  \n  async claimAchievement(userId: string, achievementId: string): Promise<UserAchievementProgress | undefined> {\n    const [progress] = await db\n      .select()\n      .from(userAchievementProgress)\n      .where(and(\n        eq(userAchievementProgress.userId, userId),\n        eq(userAchievementProgress.achievementId, achievementId)\n      ));\n    \n    if (!progress || !progress.isUnlocked || progress.isClaimed) {\n      return undefined;\n    }\n    \n    const [updated] = await db\n      .update(userAchievementProgress)\n      .set({ isClaimed: 1, claimedAt: new Date() })\n      .where(eq(userAchievementProgress.id, progress.id))\n      .returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":16910,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/lib/store.ts":{"content":"import { create } from 'zustand';\nimport { GameState, FigureInstance, BACTERIA_TEMPLATES, BOMB_TEMPLATE, GAME_CONFIG, LEVELS, LevelConfig, computeEffectiveRadius, KIK_ANNOUNCER, MutationEvent, MUTATION_EVENTS, LevelCompletionStats, MASTERY_GOALS } from './game-constants';\nimport { playPlacementSound, playSuccessSound, playGameOverSound } from './sounds';\nimport { offlineStorage } from './offline-storage';\nimport { engagementService } from './engagement-service';\n\ninterface LevelProgressData {\n  levelNumber: number;\n  bestScore: number;\n  isCompleted: boolean;\n}\n\ninterface GameStore {\n  gameState: GameState;\n  score: number;\n  highScore: number;\n  coins: number;\n  \n  // Level system\n  currentLevel: number;\n  currentLevelConfig: LevelConfig;\n  selectedLevel: number;\n  \n  // Level progress (unlocked levels and best scores)\n  levelProgress: LevelProgressData[];\n  maxUnlockedLevel: number;\n  \n  // Figure placement state\n  placedFigures: FigureInstance[];\n  figureQueue: string[];\n  currentFigureId: string | null;\n  bombsRemaining: number;\n  figuresPlaced: number;\n  totalFigures: number;\n  \n  // Timer\n  timeRemaining: number;\n  timerInterval: number | null;\n  \n  // Upgrades\n  upgrades: {\n    bombCount: number;\n    figureSize: number;\n    queueSize: number;\n    timeBonus: number;\n    placementBonus: number;\n    slowMo: number;\n    shield: number;\n    coinBoost: number;\n    lucky: number;\n    secondChance: number;\n  };\n  \n  // Second Chance tracking\n  secondChanceUsed: boolean;\n  lastPlacedFigure: FigureInstance | null;\n  \n  // Shield (collision forgiveness) tracking\n  shieldUsed: boolean;\n  shieldCooldownUntil: number;\n  \n  notification: string | null;\n  \n  // K.I.K. Announcer\n  kikMessage: string | null;\n  consecutivePlacements: number;\n  \n  // Bomb targeting mode\n  bombTargetingMode: boolean;\n  \n  // Mutation Events\n  activeMutation: MutationEvent | null;\n  mutationModifiers: {\n    vibrationMultiplier: number;\n    sizeMultiplier: number;\n    speedMultiplier: number;\n    driftEnabled: boolean;\n  };\n  \n  // Mastery Tracking\n  levelStats: LevelCompletionStats;\n  closeCallCount: number;\n  \n  // Endless Mode\n  isEndlessMode: boolean;\n  endlessWave: number;\n  endlessScore: number;\n  endlessHighScore: number;\n  endlessBestWave: number;\n  \n  // New Skill Consumables\n  freezeCount: number;\n  cleanserCount: number;\n  isFrozen: boolean;\n  isLassoMode: boolean;\n  lassoPoints: { x: number; y: number }[];\n  \n  // Canvas scaling for responsive sizing\n  canvasScale: number;\n  \n  // Actions\n  setGameState: (state: GameState) => void;\n  setCanvasScale: (scale: number) => void;\n  toggleBombTargeting: () => void;\n  detonateBombAt: (x: number, y: number) => { cleared: number; success: boolean };\n  addScore: (amount: number) => void;\n  resetGame: () => void;\n  collectCoin: (amount: number) => void;\n  buyUpgrade: (type: keyof typeof UPGRADE_COSTS) => boolean;\n  useShield: () => boolean;\n  useSecondChance: () => boolean;\n  setNotification: (msg: string | null) => void;\n  setKikMessage: (msg: string | null) => void;\n  triggerKikAnnouncement: (category: string) => void;\n  \n  // Timer actions\n  startTimer: () => void;\n  resumeTimer: () => void;\n  stopTimer: () => void;\n  tickTimer: () => void;\n  \n  // Level actions\n  setLevel: (level: number) => void;\n  selectLevel: (level: number) => void;\n  advanceLevel: () => void;\n  \n  // Level progress actions\n  setLevelProgress: (progress: LevelProgressData[]) => void;\n  recordLevelCompletion: (levelNumber: number, score: number) => void;\n  \n  // Figure placement actions\n  placeFigure: (x: number, y: number) => FigureInstance | null;\n  nextFigure: () => void;\n  checkCollision: (figure: FigureInstance) => boolean;\n  removeFigure: (figureId: string) => void;\n  initializeGame: () => void;\n  \n  syncWithProfile: (profile: {\n    coins: number;\n    highScore: number;\n    speedUpgrade: number;\n    startSizeUpgrade: number;\n    magnetUpgrade: number;\n  }) => void;\n  \n  loadFromLocalStorage: () => void;\n  \n  // Mutation actions\n  triggerMutation: () => void;\n  applyCountermeasure: (countermeasureId: string, cost: number) => void;\n  \n  // Endless mode actions\n  startEndlessMode: () => void;\n  advanceEndlessWave: () => void;\n  \n  // New consumable actions\n  useFreeze: () => boolean;\n  toggleLassoMode: () => void;\n  addLassoPoint: (x: number, y: number) => void;\n  executeLasso: () => number;\n  buySkillConsumable: (type: 'freeze' | 'cleanser') => boolean;\n}\n\nexport const UPGRADE_MAX_LEVELS = {\n  bombCount: 5,\n  figureSize: 5,\n  queueSize: 4,\n  timeBonus: 3,\n  placementBonus: 3,\n  slowMo: 3,\n  shield: 99, // Consumable - no practical limit\n  coinBoost: 4,\n  lucky: 3,\n  secondChance: 99, // Consumable - no practical limit\n};\n\n// Tiered pricing: Core (80-180), Power (150-300), Premium (220-400)\nexport const UPGRADE_COSTS = {\n  // Core Utility tier\n  queueSize: 80,      // Core - low priority\n  timeBonus: 100,     // Core\n  coinBoost: 120,     // Core\n  // Power tier\n  figureSize: 150,    // Power - reduces difficulty\n  placementBonus: 160, // Power\n  lucky: 180,         // Power - more bombs\n  slowMo: 200,        // Power - slows game\n  // Premium tier\n  bombCount: 220,     // Premium - powerful utility\n  // Consumables (value hierarchy: 2nd Chance > Shield > Bomb)\n  shield: 220,        // High value consumable\n  secondChance: 360,  // Most valuable - full revival\n};\n\n// Consumable prices for skill items\nexport const SKILL_COSTS = {\n  freeze: 180,        // Situational utility\n  cleanser: 160,      // Tactical removal\n};\n\nfunction generateRandomTemplateId(): string {\n  const templates = BACTERIA_TEMPLATES;\n  const weights = templates.map(t => t.rarity === 'common' ? 3 : t.rarity === 'rare' ? 2 : 1);\n  const totalWeight = weights.reduce((a, b) => a + b, 0);\n  let random = Math.random() * totalWeight;\n  \n  for (let i = 0; i < templates.length; i++) {\n    random -= weights[i];\n    if (random <= 0) {\n      return templates[i].id;\n    }\n  }\n  return templates[0].id;\n}\n\nfunction generateQueue(size: number, includesBomb: boolean = false, luckyLevel: number = 1): string[] {\n  const queue: string[] = [];\n  const bombChance = 0.05 + (luckyLevel - 1) * 0.03;\n  \n  for (let i = 0; i < size; i++) {\n    if (includesBomb && i === Math.floor(size / 2)) {\n      queue.push('bomb');\n    } else if (Math.random() < bombChance) {\n      queue.push('bomb');\n    } else {\n      queue.push(generateRandomTemplateId());\n    }\n  }\n  return queue;\n}\n\nfunction getInitialState() {\n  const localProgress = offlineStorage.getLevelProgress();\n  const localStats = offlineStorage.getPlayerStats();\n  const maxUnlocked = offlineStorage.getUnlockedLevels();\n  \n  const hasStoredData = localStats.lastUpdated > 0;\n  \n  return {\n    levelProgress: localProgress,\n    maxUnlockedLevel: Math.max(1, maxUnlocked),\n    highScore: localStats.highScore,\n    coins: hasStoredData ? localStats.coins : 500,\n    upgrades: {\n      bombCount: localStats.bombCount ?? 1,\n      figureSize: localStats.figureSize ?? 1,\n      queueSize: localStats.queueSize ?? 1,\n      timeBonus: localStats.timeBonus ?? 1,\n      placementBonus: localStats.placementBonus ?? 1,\n      slowMo: localStats.slowMo ?? 1,\n      shield: localStats.shield ?? 0,\n      coinBoost: localStats.coinBoost ?? 1,\n      lucky: localStats.lucky ?? 1,\n      secondChance: localStats.secondChance ?? 0,\n    },\n  };\n}\n\nconst initialState = getInitialState();\n\nexport const useGameStore = create<GameStore>((set, get) => ({\n  gameState: 'MENU',\n  score: 0,\n  highScore: initialState.highScore,\n  coins: initialState.coins,\n  \n  // Level system - start at level 1\n  currentLevel: 1,\n  currentLevelConfig: LEVELS[0],\n  selectedLevel: 1,\n  \n  // Level progress - hydrate from offline storage\n  levelProgress: initialState.levelProgress,\n  maxUnlockedLevel: initialState.maxUnlockedLevel,\n  \n  placedFigures: [],\n  figureQueue: [],\n  currentFigureId: null,\n  bombsRemaining: GAME_CONFIG.STARTING_BOMBS,\n  figuresPlaced: 0,\n  totalFigures: LEVELS[0].figuresCount,\n  \n  timeRemaining: LEVELS[0].startTime,\n  timerInterval: null,\n  \n  upgrades: initialState.upgrades,\n  shieldUsed: false,\n  shieldCooldownUntil: 0,\n  secondChanceUsed: false,\n  lastPlacedFigure: null,\n  \n  notification: null,\n  kikMessage: null,\n  consecutivePlacements: 0,\n  bombTargetingMode: false,\n  \n  // Mutation Events\n  activeMutation: null,\n  mutationModifiers: {\n    vibrationMultiplier: 1,\n    sizeMultiplier: 1,\n    speedMultiplier: 1,\n    driftEnabled: false,\n  },\n  \n  // Mastery Tracking\n  levelStats: {\n    bombsUsed: 0,\n    shieldsUsed: 0,\n    secondChancesUsed: 0,\n    timeRemaining: 0,\n    totalTime: 0,\n    perfectPlacements: 0,\n    totalPlacements: 0,\n  },\n  closeCallCount: 0,\n  \n  // Endless Mode\n  isEndlessMode: false,\n  endlessWave: 1,\n  endlessScore: 0,\n  endlessHighScore: 0,\n  endlessBestWave: 1,\n  \n  // New Skill Consumables\n  freezeCount: 0,\n  cleanserCount: 0,\n  isFrozen: false,\n  isLassoMode: false,\n  lassoPoints: [],\n  \n  // Canvas scaling for responsive sizing\n  canvasScale: 1,\n  \n  setGameState: (state) => set({ gameState: state }),\n  setCanvasScale: (scale) => set({ canvasScale: scale }),\n  setNotification: (msg) => set({ notification: msg }),\n  setKikMessage: (msg) => {\n    set({ kikMessage: msg });\n    if (msg) {\n      setTimeout(() => set({ kikMessage: null }), 2000);\n    }\n  },\n  triggerKikAnnouncement: (category: string) => {\n    const messages = KIK_ANNOUNCER[category as keyof typeof KIK_ANNOUNCER];\n    if (messages && messages.length > 0) {\n      const randomMsg = messages[Math.floor(Math.random() * messages.length)];\n      set({ kikMessage: randomMsg });\n      setTimeout(() => set({ kikMessage: null }), 2000);\n    }\n  },\n  \n  toggleBombTargeting: () => {\n    const state = get();\n    if (state.bombsRemaining <= 0) return;\n    set({ bombTargetingMode: !state.bombTargetingMode });\n  },\n  \n  detonateBombAt: (x: number, y: number) => {\n    const state = get();\n    if (state.bombsRemaining <= 0 || !state.bombTargetingMode) {\n      return { cleared: 0, success: false };\n    }\n    \n    const blastRadius = GAME_CONFIG.BOMB_BLAST_RADIUS * state.canvasScale;\n    \n    const nearbyFigures = state.placedFigures.filter(f => {\n      const dx = f.x - x;\n      const dy = f.y - y;\n      return Math.sqrt(dx * dx + dy * dy) < blastRadius;\n    });\n    \n    const remainingFigures = state.placedFigures.filter(f => !nearbyFigures.includes(f));\n    const clearedCount = nearbyFigures.length;\n    \n    set({\n      placedFigures: remainingFigures,\n      bombsRemaining: state.bombsRemaining - 1,\n      bombTargetingMode: false,\n      figuresPlaced: Math.max(0, state.figuresPlaced - clearedCount),\n      notification: clearedCount > 0 \n        ? `BOOM! ${clearedCount} figure${clearedCount > 1 ? 's' : ''} cleared!` \n        : 'BOOM! Area cleared!'\n    });\n    \n    playPlacementSound('bomb');\n    \n    setTimeout(() => set({ notification: null }), 1500);\n    return { cleared: clearedCount, success: true };\n  },\n  \n  startTimer: () => {\n    const state = get();\n    if (state.timerInterval) {\n      window.clearInterval(state.timerInterval);\n    }\n    \n    // Use level-based start time + TIME+ bonus\n    const timeBonusUpgrade = (state.upgrades.timeBonus - 1) * 3;\n    set({ timeRemaining: state.currentLevelConfig.startTime + timeBonusUpgrade });\n    \n    const interval = window.setInterval(() => {\n      const currentState = get();\n      if (currentState.gameState !== 'PLAYING' && currentState.gameState !== 'ENDLESS_PLAYING') {\n        window.clearInterval(interval);\n        set({ timerInterval: null });\n        return;\n      }\n      \n      const newTime = currentState.timeRemaining - 1;\n      \n      if (newTime <= 0) {\n        window.clearInterval(interval);\n        playGameOverSound();\n        const s = get();\n        const updates: any = { timerInterval: null, timeRemaining: 0, gameState: 'GAME_OVER', notification: 'TIME OUT!' };\n        if (s.isEndlessMode) {\n          if (s.endlessScore > s.endlessHighScore) updates.endlessHighScore = s.endlessScore;\n          if (s.endlessWave > s.endlessBestWave) updates.endlessBestWave = s.endlessWave;\n        }\n        set(updates);\n        setTimeout(() => get().triggerKikAnnouncement('gameOverTime'), 300);\n      } else {\n        set({ timeRemaining: newTime });\n        if (newTime === 10) {\n          get().triggerKikAnnouncement('lowTime');\n        }\n      }\n    }, 1000);\n    \n    set({ timerInterval: interval });\n  },\n  \n  resumeTimer: () => {\n    const state = get();\n    if (state.timerInterval) {\n      window.clearInterval(state.timerInterval);\n    }\n    \n    // Resume from current time without resetting\n    const interval = window.setInterval(() => {\n      const currentState = get();\n      if (currentState.gameState !== 'PLAYING' && currentState.gameState !== 'ENDLESS_PLAYING') {\n        window.clearInterval(interval);\n        set({ timerInterval: null });\n        return;\n      }\n      \n      const newTime = currentState.timeRemaining - 1;\n      \n      if (newTime <= 0) {\n        window.clearInterval(interval);\n        playGameOverSound();\n        const s = get();\n        const updates: any = { timerInterval: null, timeRemaining: 0, gameState: 'GAME_OVER', notification: 'TIME OUT!' };\n        if (s.isEndlessMode) {\n          if (s.endlessScore > s.endlessHighScore) updates.endlessHighScore = s.endlessScore;\n          if (s.endlessWave > s.endlessBestWave) updates.endlessBestWave = s.endlessWave;\n        }\n        set(updates);\n        setTimeout(() => get().triggerKikAnnouncement('gameOverTime'), 300);\n      } else {\n        set({ timeRemaining: newTime });\n        if (newTime === 10) {\n          get().triggerKikAnnouncement('lowTime');\n        }\n      }\n    }, 1000);\n    \n    set({ timerInterval: interval });\n  },\n  \n  setLevel: (level: number) => {\n    const levelIndex = Math.min(level - 1, LEVELS.length - 1);\n    const levelConfig = LEVELS[levelIndex];\n    set({ \n      currentLevel: level,\n      currentLevelConfig: levelConfig,\n    });\n  },\n  \n  selectLevel: (level: number) => {\n    const state = get();\n    if (level > state.maxUnlockedLevel) return;\n    const levelIndex = Math.min(level - 1, LEVELS.length - 1);\n    const levelConfig = LEVELS[levelIndex];\n    set({ \n      selectedLevel: level,\n      currentLevel: level,\n      currentLevelConfig: levelConfig,\n    });\n  },\n  \n  advanceLevel: () => {\n    const state = get();\n    const nextLevel = state.currentLevel + 1;\n    const levelIndex = Math.min(nextLevel - 1, LEVELS.length - 1);\n    const levelConfig = LEVELS[levelIndex];\n    set({ \n      currentLevel: nextLevel,\n      currentLevelConfig: levelConfig,\n      notification: `Level ${nextLevel}: ${levelConfig.name}!`\n    });\n    setTimeout(() => set({ notification: null }), 2000);\n  },\n  \n  setLevelProgress: (progress: { levelNumber: number; bestScore: number; isCompleted: boolean }[]) => {\n    const maxCompleted = progress.reduce((max, p) => {\n      if (p.isCompleted && p.levelNumber > max) return p.levelNumber;\n      return max;\n    }, 0);\n    set({ \n      levelProgress: progress,\n      maxUnlockedLevel: Math.max(1, maxCompleted + 1),\n    });\n  },\n  \n  recordLevelCompletion: (levelNumber: number, score: number) => {\n    const state = get();\n    const existingProgress = state.levelProgress.find(p => p.levelNumber === levelNumber);\n    \n    let updatedProgress: { levelNumber: number; bestScore: number; isCompleted: boolean }[];\n    if (existingProgress) {\n      updatedProgress = state.levelProgress.map(p => \n        p.levelNumber === levelNumber \n          ? { ...p, bestScore: Math.max(p.bestScore, score), isCompleted: true }\n          : p\n      );\n    } else {\n      updatedProgress = [...state.levelProgress, { levelNumber, bestScore: score, isCompleted: true }];\n    }\n    \n    const maxCompleted = updatedProgress.reduce((max, p) => {\n      if (p.isCompleted && p.levelNumber > max) return p.levelNumber;\n      return max;\n    }, 0);\n    \n    set({\n      levelProgress: updatedProgress,\n      maxUnlockedLevel: Math.min(LEVELS.length, maxCompleted + 1),\n    });\n    \n    offlineStorage.updateLevelProgress(levelNumber, score, true);\n    offlineStorage.updateHighScore(state.score);\n    \n    // Track engagement\n    engagementService.recordLevelComplete(levelNumber, score);\n  },\n  \n  stopTimer: () => {\n    const state = get();\n    if (state.timerInterval) {\n      window.clearInterval(state.timerInterval);\n      set({ timerInterval: null });\n    }\n  },\n  \n  tickTimer: () => {\n    // Timer logic moved to startTimer interval\n  },\n  \n  addScore: (amount) => set((state) => {\n    const newScore = state.score + amount;\n    return {\n      score: newScore,\n      highScore: Math.max(newScore, state.highScore),\n    };\n  }),\n  \n  collectCoin: (amount) => {\n    const newCoins = get().coins + amount;\n    set({ coins: newCoins });\n    offlineStorage.setPlayerStats({ coins: newCoins });\n  },\n  \n  buyUpgrade: (type) => {\n    const state = get();\n    const currentLevel = state.upgrades[type];\n    const maxLevel = UPGRADE_MAX_LEVELS[type];\n    const isConsumable = type === 'secondChance' || type === 'shield';\n    \n    if (!isConsumable && currentLevel >= maxLevel) {\n      return false;\n    }\n    \n    // Consumables have flat cost, leveled upgrades scale with level\n    const cost = isConsumable \n      ? UPGRADE_COSTS[type] \n      : UPGRADE_COSTS[type] * currentLevel;\n    \n    if (state.coins >= cost) {\n      const newCoins = state.coins - cost;\n      const newUpgrades = {\n        ...state.upgrades,\n        [type]: currentLevel + 1\n      };\n      set({\n        coins: newCoins,\n        upgrades: newUpgrades,\n      });\n      offlineStorage.setPlayerStats({\n        coins: newCoins,\n        ...newUpgrades,\n      });\n      return true;\n    }\n    return false;\n  },\n  \n  useShield: () => {\n    const state = get();\n    // Check if already used this game session or no shields available\n    if (state.shieldUsed || state.upgrades.shield <= 0) {\n      return false;\n    }\n    \n    // Decrement shield count\n    const newShieldCount = state.upgrades.shield - 1;\n    const newUpgrades = {\n      ...state.upgrades,\n      shield: newShieldCount,\n    };\n    \n    const cooldownDuration = 2000;\n    set({ \n      shieldUsed: true, \n      shieldCooldownUntil: Date.now() + cooldownDuration,\n      upgrades: newUpgrades,\n      notification: 'SHIELD ACTIVATED!',\n      consecutivePlacements: 0, // Reset streak on shield use\n    });\n    \n    // Save to local storage\n    offlineStorage.setPlayerStats({\n      ...newUpgrades,\n    });\n    \n    // K.I.K. shield announcement\n    setTimeout(() => get().triggerKikAnnouncement('shieldSave'), 300);\n    \n    setTimeout(() => set({ notification: null }), 1500);\n    return true;\n  },\n  \n  useSecondChance: () => {\n    const state = get();\n    // Check if already used this game session or no second chances available\n    if (state.secondChanceUsed || state.upgrades.secondChance <= 0) {\n      return false;\n    }\n    \n    // Remove the last placed figure if exists\n    const lastFigure = state.lastPlacedFigure;\n    let newPlacedFigures = state.placedFigures;\n    let newFiguresPlaced = state.figuresPlaced;\n    \n    if (lastFigure) {\n      newPlacedFigures = state.placedFigures.filter(f => f.id !== lastFigure.id);\n      newFiguresPlaced = Math.max(0, state.figuresPlaced - 1);\n    }\n    \n    // Decrement second chance count and mark as used this session\n    const newSecondChanceCount = state.upgrades.secondChance - 1;\n    const newUpgrades = {\n      ...state.upgrades,\n      secondChance: newSecondChanceCount,\n    };\n    \n    // Determine which game state to resume based on the mode flag\n    const resumeState = state.isEndlessMode ? 'ENDLESS_PLAYING' : 'PLAYING';\n    \n    // Restore the game state and resume play\n    set({ \n      secondChanceUsed: true,\n      placedFigures: newPlacedFigures,\n      figuresPlaced: newFiguresPlaced,\n      timeRemaining: Math.max(5, state.timeRemaining + 3), // Give 3 extra seconds, minimum 5\n      upgrades: newUpgrades,\n      notification: 'SECOND CHANCE!',\n      consecutivePlacements: 0, // Reset streak\n      gameState: resumeState,\n    });\n    \n    // Resume the timer\n    get().resumeTimer();\n    \n    // Save to local storage\n    offlineStorage.setPlayerStats({\n      ...newUpgrades,\n    });\n    \n    // K.I.K. second chance announcement\n    setTimeout(() => get().triggerKikAnnouncement('secondChanceUsed'), 300);\n    \n    setTimeout(() => set({ notification: null }), 1500);\n    return true;\n  },\n  \n  initializeGame: () => {\n    const state = get();\n    const levelConfig = state.currentLevelConfig;\n    const queueSize = GAME_CONFIG.QUEUE_SIZE + (state.upgrades.queueSize - 1);\n    const bombCount = GAME_CONFIG.STARTING_BOMBS + (state.upgrades.bombCount - 1);\n    const luckyLevel = state.upgrades.lucky;\n    const queue = generateQueue(queueSize + levelConfig.figuresCount, true, luckyLevel);\n    \n    set({\n      placedFigures: [],\n      figureQueue: queue.slice(1),\n      currentFigureId: queue[0],\n      bombsRemaining: bombCount,\n      figuresPlaced: 0,\n      totalFigures: levelConfig.figuresCount,\n      score: 0,\n      notification: null,\n      kikMessage: null,\n      consecutivePlacements: 0,\n      shieldUsed: false,\n      shieldCooldownUntil: 0,\n      secondChanceUsed: false,\n      lastPlacedFigure: null,\n      bombTargetingMode: false,\n    });\n    \n    // K.I.K. level start announcement\n    setTimeout(() => get().triggerKikAnnouncement('levelStart'), 500);\n  },\n  \n  placeFigure: (x: number, y: number) => {\n    const state = get();\n    if (!state.currentFigureId) return null;\n    \n    const template = state.currentFigureId === 'bomb' \n      ? BOMB_TEMPLATE \n      : BACTERIA_TEMPLATES.find(t => t.id === state.currentFigureId);\n    \n    if (!template) return null;\n    \n    // Apply template baseScale, upgrade size reduction (5% per level, max 25%), and level size multiplier\n    const upgradeMultiplier = 1 - (state.upgrades.figureSize - 1) * 0.05;\n    const levelSizeMultiplier = state.currentLevelConfig.sizeMultiplier;\n    const finalScale = template.baseScale * upgradeMultiplier * levelSizeMultiplier;\n    \n    const newFigure: FigureInstance = {\n      id: `figure-${Date.now()}-${Math.random()}`,\n      templateId: state.currentFigureId,\n      x,\n      y,\n      rotation: Math.random() * Math.PI * 2,\n      scale: finalScale,\n      vibrationOffset: Math.random() * Math.PI * 2,\n      isPlaced: true,\n    };\n    \n    // Handle bomb placement - wipes out area where bomb is placed (bombs can be placed anywhere)\n    if (state.currentFigureId === 'bomb') {\n      const blastRadius = 150; // Large blast radius\n      \n      // Remove all figures within blast radius\n      const nearbyFigures = state.placedFigures.filter(f => {\n        const dx = f.x - x;\n        const dy = f.y - y;\n        return Math.sqrt(dx * dx + dy * dy) < blastRadius;\n      });\n      \n      const remainingFigures = state.placedFigures.filter(f => !nearbyFigures.includes(f));\n      const clearedCount = nearbyFigures.length;\n      \n      set({\n        placedFigures: remainingFigures,\n        currentFigureId: state.figureQueue[0] || null,\n        figureQueue: state.figureQueue.slice(1),\n        notification: clearedCount > 0 \n          ? `BOOM! ${clearedCount} figure${clearedCount > 1 ? 's' : ''} cleared!` \n          : 'BOOM! Area cleared!'\n      });\n      \n      // Play bomb sound\n      playPlacementSound('bomb');\n      \n      // Track engagement - bomb usage\n      engagementService.recordBombUsed();\n      \n      // K.I.K. bomb announcement\n      setTimeout(() => get().triggerKikAnnouncement(clearedCount > 0 ? 'bombUsed' : 'bombWasted'), 300);\n      \n      // Replenish queue after bomb placement if running low\n      const afterBombState = get();\n      const remainingAfterBomb = afterBombState.totalFigures - afterBombState.figuresPlaced;\n      if (afterBombState.figureQueue.length < 3 && remainingAfterBomb > 0) {\n        const luckyLevel = afterBombState.upgrades.lucky;\n        const additionalFigures = generateQueue(Math.max(5, remainingAfterBomb + 3), true, luckyLevel);\n        set({ figureQueue: [...afterBombState.figureQueue, ...additionalFigures] });\n      }\n      \n      setTimeout(() => set({ notification: null }), 1500);\n      return newFigure;\n    }\n    \n    // Check for collision with existing figures (only for non-bomb figures)\n    if (state.checkCollision(newFigure)) {\n      return null; // Collision detected - cannot place here\n    }\n    \n    // Check for close call (very close but still valid placement)\n    const effectiveRadius = computeEffectiveRadius(newFigure, BACTERIA_TEMPLATES, BOMB_TEMPLATE, state.canvasScale);\n    let isCloseCall = false;\n    for (const placed of state.placedFigures) {\n      const placedEffectiveRadius = computeEffectiveRadius(placed, BACTERIA_TEMPLATES, BOMB_TEMPLATE, state.canvasScale);\n      const dx = newFigure.x - placed.x;\n      const dy = newFigure.y - placed.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      const minDistance = effectiveRadius + placedEffectiveRadius + 1;\n      // Close call if within 20% extra margin\n      if (distance < minDistance * 1.2) {\n        isCloseCall = true;\n        break;\n      }\n    }\n    \n    // Increment streak BEFORE calculating coins so this placement benefits\n    const newConsecutive = state.consecutivePlacements + 1;\n    \n    // Add coins for placing and apply upgrade bonuses + streak bonus\n    const coinBoostMultiplier = 1 + (state.upgrades.coinBoost - 1) * 0.1;\n    // Streak bonus: +10% per consecutive placement, caps at +50% (5 placements)\n    const streakBonus = Math.min(newConsecutive * 0.1, 0.5);\n    const coinValue = Math.floor(template.coinValue * coinBoostMultiplier * (1 + streakBonus));\n    const baseBonusTime = state.currentLevelConfig.timeBonusPerFigure;\n    const placementBonusExtra = (state.upgrades.placementBonus - 1) * 0.3;\n    const timeBonus = baseBonusTime + placementBonusExtra;\n    \n    const newCoins = state.coins + coinValue;\n    set({\n      placedFigures: [...state.placedFigures, newFigure],\n      currentFigureId: state.figureQueue[0] || null,\n      figureQueue: state.figureQueue.slice(1),\n      figuresPlaced: state.figuresPlaced + 1,\n      score: state.score + coinValue,\n      coins: newCoins,\n      timeRemaining: state.timeRemaining + timeBonus,\n      lastPlacedFigure: newFigure,\n      consecutivePlacements: newConsecutive,\n    });\n    \n    // Save coins to local storage after each placement\n    offlineStorage.setPlayerStats({ coins: newCoins });\n    \n    // Track engagement - record placement and coins\n    engagementService.recordPlacement();\n    if (coinValue > 0) {\n      engagementService.recordCoinsEarned(coinValue);\n    }\n    \n    // Play placement sound for this bacteria type\n    playPlacementSound(template.id);\n    \n    const newState = get();\n    \n    // Replenish queue if running low (applies to both regular and endless mode)\n    const remainingToPlace = newState.totalFigures - newState.figuresPlaced;\n    if (newState.figureQueue.length < 3 && remainingToPlace > 0) {\n      const luckyLevel = newState.upgrades.lucky;\n      const additionalFigures = generateQueue(Math.max(5, remainingToPlace + 3), true, luckyLevel);\n      set({ figureQueue: [...newState.figureQueue, ...additionalFigures] });\n    }\n    \n    // In endless mode, keep generating new figures and skip win condition\n    if (newState.isEndlessMode) {\n      // Add new figures to queue to keep it populated (maintain at least 3 in queue)\n      if (newState.figureQueue.length < 3) {\n        const newFigures: string[] = [];\n        const templates = BACTERIA_TEMPLATES;\n        for (let i = 0; i < 5; i++) {\n          const randomTemplate = templates[Math.floor(Math.random() * templates.length)];\n          newFigures.push(randomTemplate.id);\n        }\n        set({ figureQueue: [...newState.figureQueue, ...newFigures] });\n      }\n      \n      // K.I.K. announcements for endless mode\n      if (newConsecutive >= 5 && newConsecutive % 5 === 0) {\n        setTimeout(() => get().triggerKikAnnouncement('perfectStreak'), 200);\n      } else if (isCloseCall) {\n        setTimeout(() => get().triggerKikAnnouncement('closeCall'), 200);\n      } else if (Math.random() < 0.15) {\n        setTimeout(() => get().triggerKikAnnouncement('goodPlacement'), 200);\n      }\n      \n      // Update endless score\n      set({ endlessScore: newState.endlessScore + coinValue });\n      \n      return newFigure;\n    }\n    \n    // Regular level mode - check win condition\n    const remaining = newState.totalFigures - newState.figuresPlaced;\n    const progress = newState.figuresPlaced / newState.totalFigures;\n    \n    // K.I.K. progress announcements (priority order)\n    if (remaining === 0) {\n      // Win - announced separately\n    } else if (remaining === 1) {\n      setTimeout(() => get().triggerKikAnnouncement('lastOne'), 200);\n    } else if (progress >= 0.8 && progress < 0.85) {\n      setTimeout(() => get().triggerKikAnnouncement('almostDone'), 200);\n    } else if (progress >= 0.5 && progress < 0.55) {\n      setTimeout(() => get().triggerKikAnnouncement('halfwayDone'), 200);\n    } else if (newConsecutive >= 5 && newConsecutive % 5 === 0) {\n      setTimeout(() => get().triggerKikAnnouncement('perfectStreak'), 200);\n    } else if (isCloseCall) {\n      setTimeout(() => get().triggerKikAnnouncement('closeCall'), 200);\n    } else if (Math.random() < 0.15) {\n      setTimeout(() => get().triggerKikAnnouncement('goodPlacement'), 200);\n    }\n    \n    if (newState.figuresPlaced >= newState.totalFigures) {\n      // Award level completion bonus + time bonus\n      const levelNum = newState.currentLevel;\n      const isMilestone = [10, 25, 50, 75, 100].includes(levelNum);\n      const baseLevelBonus = 50 + levelNum; // Base bonus scales with level (50-150)\n      const milestoneMultiplier = isMilestone ? 1.5 : 1;\n      const levelCompletionBonus = Math.floor(baseLevelBonus * milestoneMultiplier);\n      \n      // Time bonus: 25 coins per second remaining\n      const timeBonus = Math.floor(newState.timeRemaining * 25);\n      const totalBonus = levelCompletionBonus + timeBonus;\n      const finalCoins = newState.coins + totalBonus;\n      const finalScore = newState.score + timeBonus;\n      \n      // Start celebration animation, then show WIN screen after delay\n      playSuccessSound();\n      set({ \n        coins: finalCoins,\n        score: finalScore,\n        highScore: Math.max(finalScore, newState.highScore),\n        gameState: 'CELEBRATING',\n        consecutivePlacements: 0, // Reset streak for next level\n        notification: isMilestone \n          ? `ðŸ† MILESTONE! +${totalBonus} (â±${timeBonus})` \n          : `COMPLETE! +${totalBonus} (â±${timeBonus})`\n      });\n      \n      // Save bonus coins and update high score\n      offlineStorage.setPlayerStats({ coins: finalCoins });\n      offlineStorage.updateHighScore(finalScore);\n      engagementService.recordCoinsEarned(totalBonus);\n      \n      setTimeout(() => get().triggerKikAnnouncement('victory'), 300);\n      setTimeout(() => {\n        set({ gameState: 'WIN', notification: null });\n      }, 2500);\n    }\n    \n    return newFigure;\n  },\n  \n  nextFigure: () => {\n    const state = get();\n    if (state.figureQueue.length === 0) {\n      set({ currentFigureId: null });\n      return;\n    }\n    \n    set({\n      currentFigureId: state.figureQueue[0],\n      figureQueue: state.figureQueue.slice(1),\n    });\n  },\n  \n  checkCollision: (figure: FigureInstance) => {\n    const state = get();\n    const effectiveRadius = computeEffectiveRadius(figure, BACTERIA_TEMPLATES, BOMB_TEMPLATE, state.canvasScale);\n    \n    for (const placed of state.placedFigures) {\n      const placedEffectiveRadius = computeEffectiveRadius(placed, BACTERIA_TEMPLATES, BOMB_TEMPLATE, state.canvasScale);\n      const dx = figure.x - placed.x;\n      const dy = figure.y - placed.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      const minDistance = effectiveRadius + placedEffectiveRadius + 1;\n      \n      if (distance < minDistance) {\n        return true;\n      }\n    }\n    return false;\n  },\n  \n  removeFigure: (figureId: string) => {\n    set((state) => ({\n      placedFigures: state.placedFigures.filter(f => f.id !== figureId)\n    }));\n  },\n  \n  resetGame: () => {\n    const state = get();\n    state.stopTimer();\n    set({\n      gameState: 'MENU',\n      score: 0,\n      placedFigures: [],\n      figureQueue: [],\n      currentFigureId: null,\n      figuresPlaced: 0,\n      notification: null,\n      timeRemaining: GAME_CONFIG.GAME_TIME,\n      isEndlessMode: false,\n      isFrozen: false,\n      isLassoMode: false,\n    });\n  },\n\n  syncWithProfile: (profile) => {\n    const state = get();\n    const upgrades = {\n      ...state.upgrades,\n      bombCount: profile.speedUpgrade,\n      figureSize: profile.startSizeUpgrade,\n      queueSize: profile.magnetUpgrade,\n    };\n    set({\n      coins: profile.coins,\n      highScore: profile.highScore,\n      upgrades,\n    });\n    offlineStorage.setPlayerStats({\n      coins: profile.coins,\n      highScore: profile.highScore,\n      ...upgrades,\n    });\n  },\n\n  loadFromLocalStorage: () => {\n    const stats = offlineStorage.getPlayerStats();\n    const levelProgress = offlineStorage.getLevelProgress();\n    const maxUnlocked = offlineStorage.getUnlockedLevels();\n    \n    set({\n      coins: stats.coins,\n      highScore: stats.highScore,\n      upgrades: {\n        bombCount: stats.bombCount,\n        figureSize: stats.figureSize,\n        queueSize: stats.queueSize,\n        timeBonus: stats.timeBonus,\n        placementBonus: stats.placementBonus,\n        slowMo: stats.slowMo,\n        shield: stats.shield,\n        coinBoost: stats.coinBoost,\n        lucky: stats.lucky,\n        secondChance: stats.secondChance,\n      },\n      levelProgress: levelProgress,\n      maxUnlockedLevel: maxUnlocked,\n    });\n  },\n  \n  // Mutation Event Actions\n  triggerMutation: () => {\n    const randomMutation = MUTATION_EVENTS[Math.floor(Math.random() * MUTATION_EVENTS.length)];\n    set({ \n      activeMutation: randomMutation,\n      gameState: 'MUTATION_CHOICE'\n    });\n  },\n  \n  applyCountermeasure: (countermeasureId: string, cost: number) => {\n    const state = get();\n    if (!state.activeMutation) return;\n    \n    const countermeasure = state.activeMutation.countermeasures.find(c => c.id === countermeasureId);\n    if (!countermeasure) return;\n    \n    let newModifiers = { ...state.mutationModifiers };\n    \n    if (countermeasure.effect === 'nullify') {\n      // No effect applied\n    } else if (countermeasure.effect === 'reduce') {\n      // Apply 50% of mutation effect\n      switch (state.activeMutation.effect) {\n        case 'vibration_increase':\n          newModifiers.vibrationMultiplier = 1.25;\n          break;\n        case 'size_increase':\n          newModifiers.sizeMultiplier = 1.15;\n          break;\n        case 'speed_increase':\n          newModifiers.speedMultiplier = 1.25;\n          break;\n        case 'random_movement':\n          newModifiers.driftEnabled = true;\n          break;\n      }\n    } else if (countermeasure.effect === 'reverse') {\n      // Reverse effect - beneficial\n      switch (state.activeMutation.effect) {\n        case 'size_increase':\n          newModifiers.sizeMultiplier = 0.8;\n          break;\n        case 'speed_increase':\n          newModifiers.speedMultiplier = 0.7;\n          break;\n      }\n    }\n    \n    set({\n      activeMutation: null,\n      mutationModifiers: newModifiers,\n      timeRemaining: Math.max(1, state.timeRemaining - cost),\n      gameState: 'PLAYING'\n    });\n    \n    get().triggerKikAnnouncement('goodPlacement');\n  },\n  \n  // Endless Mode Actions\n  startEndlessMode: () => {\n    const state = get();\n    if (state.timerInterval) {\n      window.clearInterval(state.timerInterval);\n    }\n    \n    const queueSize = GAME_CONFIG.QUEUE_SIZE + (state.upgrades.queueSize - 1);\n    const bombCount = GAME_CONFIG.STARTING_BOMBS + (state.upgrades.bombCount - 1);\n    const luckyLevel = state.upgrades.lucky;\n    const queue = generateQueue(queueSize + 50, true, luckyLevel);\n    const timeBonusUpgrade = (state.upgrades.timeBonus - 1) * 3;\n    const startTime = 60 + timeBonusUpgrade;\n    \n    set({\n      isEndlessMode: true,\n      endlessWave: 1,\n      endlessScore: 0,\n      gameState: 'ENDLESS_PLAYING',\n      placedFigures: [],\n      figureQueue: queue.slice(1),\n      currentFigureId: queue[0],\n      bombsRemaining: bombCount,\n      figuresPlaced: 0,\n      totalFigures: 999999,\n      score: 0,\n      notification: 'ENDLESS MODE - SURVIVE!',\n      timeRemaining: startTime,\n      shieldUsed: false,\n      shieldCooldownUntil: 0,\n      secondChanceUsed: false,\n      lastPlacedFigure: null,\n      bombTargetingMode: false,\n      mutationModifiers: {\n        vibrationMultiplier: 1,\n        sizeMultiplier: 1,\n        speedMultiplier: 1,\n        driftEnabled: false,\n      },\n    });\n    \n    // Start endless mode timer\n    const interval = window.setInterval(() => {\n      const currentState = get();\n      if (currentState.gameState !== 'ENDLESS_PLAYING') {\n        window.clearInterval(interval);\n        set({ timerInterval: null });\n        return;\n      }\n      \n      const newTime = currentState.timeRemaining - 1;\n      \n      if (newTime <= 0) {\n        window.clearInterval(interval);\n        playGameOverSound();\n        const s = get();\n        const updates: any = { \n          timerInterval: null, \n          timeRemaining: 0, \n          gameState: 'GAME_OVER', \n          notification: 'TIME OUT!' \n        };\n        if (s.endlessScore > s.endlessHighScore) updates.endlessHighScore = s.endlessScore;\n        if (s.endlessWave > s.endlessBestWave) updates.endlessBestWave = s.endlessWave;\n        set(updates);\n        setTimeout(() => get().triggerKikAnnouncement('gameOverTime'), 300);\n      } else {\n        set({ timeRemaining: newTime });\n        if (newTime === 10) {\n          get().triggerKikAnnouncement('lowTime');\n        }\n      }\n    }, 1000);\n    \n    set({ timerInterval: interval });\n    setTimeout(() => set({ notification: null }), 2000);\n  },\n  \n  advanceEndlessWave: () => {\n    const state = get();\n    const nextWave = state.endlessWave + 1;\n    const luckyLevel = state.upgrades.lucky;\n    const additionalFigures = generateQueue(15, true, luckyLevel);\n    \n    set({\n      endlessWave: nextWave,\n      endlessScore: state.endlessScore + state.score,\n      figureQueue: [...state.figureQueue, ...additionalFigures],\n      totalFigures: state.totalFigures + 10 + Math.floor(nextWave / 2),\n      notification: `WAVE ${nextWave}!`,\n      timeRemaining: state.timeRemaining + 30,\n    });\n    \n    // Track engagement - endless wave progress\n    engagementService.recordEndlessWave(nextWave);\n    \n    // Trigger mutation every 3 waves\n    if (nextWave % 3 === 0) {\n      setTimeout(() => get().triggerMutation(), 1000);\n    }\n    \n    get().triggerKikAnnouncement('perfectStreak');\n    setTimeout(() => set({ notification: null }), 2000);\n  },\n  \n  // New Consumable Actions\n  useFreeze: () => {\n    const state = get();\n    if (state.freezeCount <= 0 || state.isFrozen) return false;\n    \n    set({ \n      freezeCount: state.freezeCount - 1,\n      isFrozen: true,\n      notification: 'FREEZE ACTIVATED!'\n    });\n    \n    // Unfreeze after 5 seconds\n    setTimeout(() => {\n      set({ isFrozen: false });\n    }, 5000);\n    \n    setTimeout(() => set({ notification: null }), 1500);\n    return true;\n  },\n  \n  toggleLassoMode: () => {\n    const state = get();\n    if (state.cleanserCount <= 0 && !state.isLassoMode) return;\n    set({ \n      isLassoMode: !state.isLassoMode,\n      lassoPoints: []\n    });\n  },\n  \n  addLassoPoint: (x: number, y: number) => {\n    const state = get();\n    if (!state.isLassoMode) return;\n    set({ lassoPoints: [...state.lassoPoints, { x, y }] });\n  },\n  \n  executeLasso: () => {\n    const state = get();\n    if (!state.isLassoMode || state.lassoPoints.length < 3) {\n      set({ isLassoMode: false, lassoPoints: [] });\n      return 0;\n    }\n    \n    // Check which figures are inside the lasso polygon\n    const insideFigures = state.placedFigures.filter(figure => {\n      return isPointInPolygon(figure.x, figure.y, state.lassoPoints);\n    });\n    \n    const remainingFigures = state.placedFigures.filter(f => !insideFigures.includes(f));\n    const clearedCount = insideFigures.length;\n    \n    set({\n      placedFigures: remainingFigures,\n      figuresPlaced: Math.max(0, state.figuresPlaced - clearedCount),\n      cleanserCount: state.cleanserCount - 1,\n      isLassoMode: false,\n      lassoPoints: [],\n      notification: clearedCount > 0 ? `CLEANSED ${clearedCount} BACTERIA!` : 'NO BACTERIA CAUGHT!'\n    });\n    \n    setTimeout(() => set({ notification: null }), 1500);\n    return clearedCount;\n  },\n  \n  buySkillConsumable: (type: 'freeze' | 'cleanser') => {\n    const state = get();\n    const cost = SKILL_COSTS[type];\n    \n    if (state.coins < cost) return false;\n    \n    const newCoins = state.coins - cost;\n    if (type === 'freeze') {\n      set({ coins: newCoins, freezeCount: state.freezeCount + 1 });\n    } else {\n      set({ coins: newCoins, cleanserCount: state.cleanserCount + 1 });\n    }\n    \n    offlineStorage.setPlayerStats({ coins: newCoins });\n    return true;\n  },\n}));\n\n// Helper function to check if point is inside polygon\nfunction isPointInPolygon(x: number, y: number, polygon: { x: number; y: number }[]): boolean {\n  let inside = false;\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const xi = polygon[i].x, yi = polygon[i].y;\n    const xj = polygon[j].x, yj = polygon[j].y;\n    \n    if (((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi)) {\n      inside = !inside;\n    }\n  }\n  return inside;\n}\n","path":null,"size_bytes":41715,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/components/game/LevelSelect.tsx":{"content":"import { useEffect } from 'react';\nimport { useGameStore } from '../../lib/store';\nimport { motion } from 'framer-motion';\nimport { ArrowLeft, Lock, Star, Trophy } from 'lucide-react';\nimport { LEVELS } from '../../lib/game-constants';\nimport { useLevelProgress } from '../../lib/api';\nimport { useAuth } from '../../hooks/use-auth';\nimport { offlineStorage } from '../../lib/offline-storage';\n\nexport function LevelSelect() {\n  const { \n    setGameState, \n    selectLevel, \n    initializeGame, \n    startTimer, \n    maxUnlockedLevel,\n    levelProgress,\n    setLevelProgress \n  } = useGameStore();\n  \n  const { user } = useAuth();\n  const { data: progressData } = useLevelProgress();\n  \n  useEffect(() => {\n    if (progressData && user) {\n      const formattedProgress = progressData.map(p => ({\n        levelNumber: p.levelNumber,\n        bestScore: p.bestScore,\n        isCompleted: p.isCompleted === 1,\n      }));\n      setLevelProgress(formattedProgress);\n    }\n  }, [progressData, user, setLevelProgress]);\n\n  const handleLevelSelect = (levelNumber: number) => {\n    if (levelNumber > maxUnlockedLevel) return;\n    selectLevel(levelNumber);\n    initializeGame();\n    setGameState('PLAYING');\n    startTimer();\n    // Track metadata: level play event\n    offlineStorage.trackLevelPlay(levelNumber);\n  };\n\n  const getLevelProgress = (levelNumber: number) => {\n    return levelProgress.find(p => p.levelNumber === levelNumber);\n  };\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background scanlines crt-vignette scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n\n      <motion.button\n        initial={{ x: -20, opacity: 0 }}\n        animate={{ x: 0, opacity: 1 }}\n        onClick={() => setGameState('MENU')}\n        className=\"fixed top-6 left-6 block-panel px-4 py-2 hover:border-primary transition-colors flex items-center gap-2 z-20\"\n        data-testid=\"button-back\"\n      >\n        <ArrowLeft size={18} className=\"text-primary\" />\n        <span className=\"font-ui text-lg\">BACK</span>\n      </motion.button>\n\n      <div className=\"relative z-10 w-full max-w-4xl mx-auto px-6 py-20 flex flex-col items-center gap-6\">\n        <div className=\"text-center\">\n          <motion.h1 \n            initial={{ y: -30, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            className=\"text-3xl md:text-4xl font-display\"\n            style={{\n              color: '#22F2A2',\n              textShadow: '0 0 10px #22F2A2, 0 0 20px #22F2A2, 3px 3px 0px #0a5c3a'\n            }}\n          >\n            SELECT LEVEL\n          </motion.h1>\n          <motion.p \n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.2 }}\n            className=\"font-ui text-xl text-secondary text-glow tracking-widest mt-2\"\n          >\n            Complete levels to unlock more!\n          </motion.p>\n        </div>\n\n        <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 w-full pb-8\">\n          {LEVELS.map((level, index) => {\n            const levelNumber = index + 1;\n            const isUnlocked = levelNumber <= maxUnlockedLevel;\n            const progress = getLevelProgress(levelNumber);\n            const isCompleted = progress?.isCompleted;\n            \n            return (\n              <motion.button\n                key={level.level}\n                initial={{ scale: 0.8, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                transition={{ delay: Math.min(index * 0.02, 0.5) }}\n                whileHover={isUnlocked ? { scale: 1.05, y: -4 } : {}}\n                whileTap={isUnlocked ? { scale: 0.98 } : {}}\n                onClick={() => handleLevelSelect(levelNumber)}\n                disabled={!isUnlocked}\n                className={`\n                  relative block-panel p-2 sm:p-3 flex flex-col items-center gap-1 transition-all rounded-lg\n                  ${isUnlocked \n                    ? 'hover:border-primary cursor-pointer' \n                    : 'opacity-40 cursor-not-allowed'\n                  }\n                  ${isCompleted ? 'border-primary shadow-[0_0_15px_rgba(34,242,162,0.3)]' : ''}\n                  ${level.isMilestone ? 'ring-2 ring-secondary/50' : ''}\n                `}\n                data-testid={`button-level-${levelNumber}`}\n              >\n                {!isUnlocked && (\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 z-10 rounded-lg\">\n                    <Lock size={20} className=\"text-muted-foreground\" />\n                  </div>\n                )}\n                \n                {isCompleted && (\n                  <div className=\"absolute top-1 right-1\">\n                    <Star size={14} className=\"text-secondary fill-secondary drop-shadow-[0_0_6px_rgba(249,233,0,0.5)]\" />\n                  </div>\n                )}\n\n                <div className={`w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center ${isCompleted ? 'bg-primary/20' : 'bg-muted'}`}>\n                  <span className={`font-display text-base sm:text-lg ${isCompleted ? 'text-primary text-glow' : 'text-foreground'}`}>\n                    {levelNumber}\n                  </span>\n                </div>\n                <span className=\"font-ui text-xs sm:text-sm text-foreground/80 text-center leading-tight line-clamp-1\">\n                  {level.name}\n                </span>\n\n                {progress && progress.bestScore > 0 && (\n                  <div className=\"flex items-center gap-1 text-secondary font-ui text-xs\">\n                    <Trophy size={10} />\n                    <span>{progress.bestScore}</span>\n                  </div>\n                )}\n              </motion.button>\n            );\n          })}\n        </div>\n\n        {!user && (\n          <motion.div \n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.5 }}\n            className=\"block-panel px-6 py-3 text-center\"\n          >\n            <p className=\"font-ui text-lg text-muted-foreground\">\n              Sign in to save your progress!\n            </p>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6241,"size_tokens":null},"client/src/lib/sounds.ts":{"content":"// Sound effects for Kikteria using Web Audio API\n\nlet audioContext: AudioContext | null = null;\n\nfunction getAudioContext(): AudioContext {\n  if (!audioContext) {\n    audioContext = new AudioContext();\n  }\n  return audioContext;\n}\n\n// Sound definitions for each bacteria type\nconst BACTERIA_SOUNDS: Record<string, () => void> = {\n  blobby: () => playBlobbySound(),\n  grumpus: () => playGrumpusSound(),\n  wobbly: () => playWobblySound(),\n  cyclops: () => playCyclopsSound(),\n  squish: () => playSquishSound(),\n  chompy: () => playChompySound(),\n  derp: () => playDerpSound(),\n  ghosty: () => playGhostySound(),\n  spiky: () => playSpikySound(),\n  gloop: () => playGloopSound(),\n  bomb: () => playBombPlaceSound(),\n};\n\n// Blobby - silly wet plop sound\nfunction playBlobbySound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(300, ctx.currentTime);\n  osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.15);\n  \n  gain.gain.setValueAtTime(0.4, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.2);\n}\n\n// Grumpus - angry grunt\nfunction playGrumpusSound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'sawtooth';\n  osc.frequency.setValueAtTime(80, ctx.currentTime);\n  osc.frequency.setValueAtTime(70, ctx.currentTime + 0.05);\n  osc.frequency.setValueAtTime(60, ctx.currentTime + 0.1);\n  \n  gain.gain.setValueAtTime(0.3, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.15);\n}\n\n// Wobbly - worried wobble sound\nfunction playWobblySound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  const lfo = ctx.createOscillator();\n  const lfoGain = ctx.createGain();\n  \n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(400, ctx.currentTime);\n  \n  lfo.type = 'sine';\n  lfo.frequency.setValueAtTime(20, ctx.currentTime);\n  lfoGain.gain.setValueAtTime(50, ctx.currentTime);\n  \n  lfo.connect(lfoGain);\n  lfoGain.connect(osc.frequency);\n  \n  gain.gain.setValueAtTime(0.3, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  lfo.start(ctx.currentTime);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.3);\n  lfo.stop(ctx.currentTime + 0.3);\n}\n\n// Cyclops - alien bleep\nfunction playCyclopsSound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'square';\n  osc.frequency.setValueAtTime(600, ctx.currentTime);\n  osc.frequency.setValueAtTime(800, ctx.currentTime + 0.05);\n  osc.frequency.setValueAtTime(500, ctx.currentTime + 0.1);\n  \n  gain.gain.setValueAtTime(0.2, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.15);\n}\n\n// Squish - cute squeak\nfunction playSquishSound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(800, ctx.currentTime);\n  osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.08);\n  osc.frequency.exponentialRampToValueAtTime(600, ctx.currentTime + 0.15);\n  \n  gain.gain.setValueAtTime(0.25, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.18);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.18);\n}\n\n// Chompy - chomping bite sound\nfunction playChompySound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'sawtooth';\n  osc.frequency.setValueAtTime(200, ctx.currentTime);\n  osc.frequency.setValueAtTime(100, ctx.currentTime + 0.03);\n  osc.frequency.setValueAtTime(150, ctx.currentTime + 0.06);\n  osc.frequency.setValueAtTime(80, ctx.currentTime + 0.1);\n  \n  gain.gain.setValueAtTime(0.3, ctx.currentTime);\n  gain.gain.setValueAtTime(0.1, ctx.currentTime + 0.03);\n  gain.gain.setValueAtTime(0.25, ctx.currentTime + 0.06);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.12);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.12);\n}\n\n// Derp - confused \"boing\" sound\nfunction playDerpSound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'triangle';\n  osc.frequency.setValueAtTime(150, ctx.currentTime);\n  osc.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);\n  osc.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);\n  \n  gain.gain.setValueAtTime(0.35, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.25);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.25);\n}\n\n// Ghosty - spooky whoosh\nfunction playGhostySound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  const filter = ctx.createBiquadFilter();\n  \n  osc.type = 'sine';\n  osc.frequency.setValueAtTime(300, ctx.currentTime);\n  osc.frequency.exponentialRampToValueAtTime(500, ctx.currentTime + 0.15);\n  osc.frequency.exponentialRampToValueAtTime(250, ctx.currentTime + 0.3);\n  \n  filter.type = 'lowpass';\n  filter.frequency.setValueAtTime(800, ctx.currentTime);\n  \n  gain.gain.setValueAtTime(0.25, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.35);\n  \n  osc.connect(filter);\n  filter.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.35);\n}\n\n// Spiky - sharp zap sound\nfunction playSpikySound() {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  \n  osc.type = 'sawtooth';\n  osc.frequency.setValueAtTime(1000, ctx.currentTime);\n  osc.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.08);\n  \n  gain.gain.setValueAtTime(0.25, ctx.currentTime);\n  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);\n  \n  osc.connect(gain);\n  gain.connect(ctx.destination);\n  osc.start(ctx.currentTime);\n  osc.stop(ctx.currentTime + 0.1);\n}\n\n// Gloop - bubbly gloop sound\nfunction playGloopSound() {\n  const ctx = getAudioContext();\n  \n  for (let i = 0; i < 3; i++) {\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    const delay = i * 0.05;\n    \n    osc.type = 'sine';\n    osc.frequency.setValueAtTime(200 + i * 50, ctx.currentTime + delay);\n    osc.frequency.exponentialRampToValueAtTime(100 + i * 30, ctx.currentTime + delay + 0.1);\n    \n    gain.gain.setValueAtTime(0.2, ctx.currentTime + delay);\n    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + delay + 0.12);\n    \n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start(ctx.currentTime + delay);\n    osc.stop(ctx.currentTime + delay + 0.12);\n  }\n}\n\n// Bomb placement sound - Bomberman/Super Nintendo style explosion\nfunction playBombPlaceSound() {\n  const ctx = getAudioContext();\n  \n  // Initial attack - sharp noise burst like SNES explosions\n  const noiseBuffer = ctx.createBuffer(1, ctx.sampleRate * 0.08, ctx.sampleRate);\n  const noiseData = noiseBuffer.getChannelData(0);\n  for (let i = 0; i < noiseData.length; i++) {\n    // Decaying noise\n    const decay = 1 - (i / noiseData.length);\n    noiseData[i] = (Math.random() * 2 - 1) * decay;\n  }\n  const noiseSource = ctx.createBufferSource();\n  noiseSource.buffer = noiseBuffer;\n  const noiseFilter = ctx.createBiquadFilter();\n  noiseFilter.type = 'lowpass';\n  noiseFilter.frequency.setValueAtTime(2000, ctx.currentTime);\n  noiseFilter.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.08);\n  const noiseGain = ctx.createGain();\n  noiseGain.gain.setValueAtTime(0.4, ctx.currentTime);\n  noiseGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.08);\n  noiseSource.connect(noiseFilter);\n  noiseFilter.connect(noiseGain);\n  noiseGain.connect(ctx.destination);\n  noiseSource.start(ctx.currentTime);\n  \n  // Deep bass punch - like Bomberman explosion\n  const bassOsc = ctx.createOscillator();\n  const bassGain = ctx.createGain();\n  bassOsc.type = 'sine';\n  bassOsc.frequency.setValueAtTime(150, ctx.currentTime);\n  bassOsc.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.15);\n  bassGain.gain.setValueAtTime(0.5, ctx.currentTime);\n  bassGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);\n  bassOsc.connect(bassGain);\n  bassGain.connect(ctx.destination);\n  bassOsc.start(ctx.currentTime);\n  bassOsc.stop(ctx.currentTime + 0.2);\n  \n  // Mid-frequency \"pow\" - gives it that 16-bit punch\n  const midOsc = ctx.createOscillator();\n  const midGain = ctx.createGain();\n  midOsc.type = 'square';\n  midOsc.frequency.setValueAtTime(200, ctx.currentTime);\n  midOsc.frequency.exponentialRampToValueAtTime(80, ctx.currentTime + 0.1);\n  midGain.gain.setValueAtTime(0.15, ctx.currentTime);\n  midGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.12);\n  midOsc.connect(midGain);\n  midGain.connect(ctx.destination);\n  midOsc.start(ctx.currentTime);\n  midOsc.stop(ctx.currentTime + 0.12);\n}\n\nexport function playPlacementSound(templateId: string) {\n  const soundFn = BACTERIA_SOUNDS[templateId];\n  if (soundFn) {\n    try {\n      soundFn();\n    } catch (e) {\n      // Audio context might not be available\n      console.log('Sound not available');\n    }\n  }\n}\n\n// Retro 8-bit victory fanfare like classic arcade games\nexport function playSuccessSound() {\n  const ctx = getAudioContext();\n  \n  // Classic victory melody - ascending triumphant notes\n  const melody = [\n    { freq: 392, time: 0, duration: 0.1 },      // G4\n    { freq: 523.25, time: 0.1, duration: 0.1 }, // C5\n    { freq: 659.25, time: 0.2, duration: 0.1 }, // E5\n    { freq: 783.99, time: 0.3, duration: 0.15 }, // G5\n    { freq: 659.25, time: 0.45, duration: 0.1 }, // E5\n    { freq: 783.99, time: 0.55, duration: 0.3 }, // G5 (held)\n  ];\n  \n  melody.forEach(({ freq, time, duration }) => {\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    \n    osc.type = 'square'; // 8-bit retro sound\n    osc.frequency.setValueAtTime(freq, ctx.currentTime + time);\n    \n    gain.gain.setValueAtTime(0.15, ctx.currentTime + time);\n    gain.gain.setValueAtTime(0.15, ctx.currentTime + time + duration - 0.05);\n    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + time + duration);\n    \n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start(ctx.currentTime + time);\n    osc.stop(ctx.currentTime + time + duration);\n  });\n  \n  // Add sparkle/twinkle effect\n  for (let i = 0; i < 5; i++) {\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    const time = 0.6 + i * 0.08;\n    const freq = 1500 + Math.random() * 1000;\n    \n    osc.type = 'sine';\n    osc.frequency.setValueAtTime(freq, ctx.currentTime + time);\n    \n    gain.gain.setValueAtTime(0.1, ctx.currentTime + time);\n    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + time + 0.1);\n    \n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start(ctx.currentTime + time);\n    osc.stop(ctx.currentTime + time + 0.1);\n  }\n}\n\n// Sad but funny game over sound - like a deflating balloon with a comedic \"wah wah\"\nexport function playGameOverSound() {\n  const ctx = getAudioContext();\n  \n  // Descending \"wah wah wahhh\" - classic cartoon fail sound\n  const notes = [\n    { freq: 440, time: 0, duration: 0.25 },     // A4\n    { freq: 392, time: 0.3, duration: 0.25 },   // G4\n    { freq: 349.23, time: 0.6, duration: 0.5 }, // F4 (long sad note)\n  ];\n  \n  notes.forEach(({ freq, time, duration }) => {\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    \n    osc.type = 'triangle';\n    osc.frequency.setValueAtTime(freq, ctx.currentTime + time);\n    // Add slight vibrato for comedic effect\n    osc.frequency.setValueAtTime(freq * 0.98, ctx.currentTime + time + duration * 0.3);\n    osc.frequency.setValueAtTime(freq, ctx.currentTime + time + duration * 0.6);\n    \n    gain.gain.setValueAtTime(0.25, ctx.currentTime + time);\n    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + time + duration);\n    \n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start(ctx.currentTime + time);\n    osc.stop(ctx.currentTime + time + duration);\n  });\n  \n  // Funny descending slide whistle effect at the end\n  const slideOsc = ctx.createOscillator();\n  const slideGain = ctx.createGain();\n  \n  slideOsc.type = 'sine';\n  slideOsc.frequency.setValueAtTime(600, ctx.currentTime + 1.0);\n  slideOsc.frequency.exponentialRampToValueAtTime(80, ctx.currentTime + 1.5);\n  \n  slideGain.gain.setValueAtTime(0.2, ctx.currentTime + 1.0);\n  slideGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1.5);\n  \n  slideOsc.connect(slideGain);\n  slideGain.connect(ctx.destination);\n  slideOsc.start(ctx.currentTime + 1.0);\n  slideOsc.stop(ctx.currentTime + 1.5);\n  \n  // Add a comedic \"boing\" at the very end\n  const boingOsc = ctx.createOscillator();\n  const boingGain = ctx.createGain();\n  \n  boingOsc.type = 'sine';\n  boingOsc.frequency.setValueAtTime(150, ctx.currentTime + 1.5);\n  boingOsc.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 1.6);\n  boingOsc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 1.8);\n  \n  boingGain.gain.setValueAtTime(0.2, ctx.currentTime + 1.5);\n  boingGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1.8);\n  \n  boingOsc.connect(boingGain);\n  boingGain.connect(ctx.destination);\n  boingOsc.start(ctx.currentTime + 1.5);\n  boingOsc.stop(ctx.currentTime + 1.8);\n}\n","path":null,"size_bytes":14228,"size_tokens":null},"server/replit_integrations/auth/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { authStorage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await authStorage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  // Keep track of registered strategies\n  const registeredStrategies = new Set<string>();\n\n  // Helper function to ensure strategy exists for a domain\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4474,"size_tokens":null},"client/src/lib/network.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { offlineStorage } from './offline-storage';\nimport { levelProgressAPI, leaderboardAPI, profileAPI, analyticsAPI, errorLogsAPI } from './api';\n\nexport function useNetworkStatus() {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [isSyncing, setIsSyncing] = useState(false);\n\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  const syncToServer = useCallback(async () => {\n    if (!navigator.onLine) return false;\n    \n    const pending = offlineStorage.getPendingSync();\n    const hasMetadata = offlineStorage.hasMetadataToSync();\n    const hasErrorLogs = offlineStorage.hasErrorLogsToSync();\n    const hasMasterdata = pending.levelProgress.length > 0 || pending.highScore !== null || pending.profile !== null;\n    \n    // Exit early only if there's nothing to sync at all\n    if (!hasMasterdata && !hasMetadata && !hasErrorLogs) {\n      return true;\n    }\n\n    setIsSyncing(true);\n    \n    try {\n      const remainingProgress = [...pending.levelProgress];\n      let highScoreSynced = pending.highScore === null;\n      let profileSynced = pending.profile === null;\n      let metadataSynced = !hasMetadata;\n      \n      // Sync level progress\n      for (let i = 0; i < remainingProgress.length; i++) {\n        const progress = remainingProgress[i];\n        try {\n          await levelProgressAPI.updateProgress(\n            progress.levelNumber,\n            progress.bestScore,\n            progress.isCompleted\n          );\n          remainingProgress.splice(i, 1);\n          i--;\n        } catch (error) {\n          console.warn(`Failed to sync level ${progress.levelNumber}:`, error);\n        }\n      }\n\n      // Sync high score to leaderboard\n      if (pending.highScore !== null) {\n        try {\n          await leaderboardAPI.submitScore(pending.highScore);\n          highScoreSynced = true;\n        } catch (error) {\n          console.warn('Failed to sync high score:', error);\n        }\n      }\n\n      // Sync profile (coins, upgrades)\n      if (pending.profile !== null) {\n        try {\n          const updates: Record<string, number> = {};\n          if (pending.profile.coins !== null) updates.coins = pending.profile.coins;\n          if (pending.profile.speedUpgrade !== null) updates.speedUpgrade = pending.profile.speedUpgrade;\n          if (pending.profile.startSizeUpgrade !== null) updates.startSizeUpgrade = pending.profile.startSizeUpgrade;\n          if (pending.profile.magnetUpgrade !== null) updates.magnetUpgrade = pending.profile.magnetUpgrade;\n          \n          if (Object.keys(updates).length > 0) {\n            await profileAPI.updateProfile(updates);\n          }\n          profileSynced = true;\n        } catch (error) {\n          console.warn('Failed to sync profile:', error);\n        }\n      }\n\n      // Update pending sync state for masterdata\n      if (remainingProgress.length === 0 && highScoreSynced && profileSynced) {\n        offlineStorage.clearPendingSync();\n      } else {\n        const newPending = {\n          levelProgress: remainingProgress,\n          highScore: highScoreSynced ? null : pending.highScore,\n          profile: profileSynced ? null : pending.profile,\n          timestamp: Date.now(),\n        };\n        localStorage.setItem('kikteria_pending_sync', JSON.stringify(newPending));\n      }\n\n      // Sync metadata (user behavior analytics) - delete after successful sync\n      if (hasMetadata) {\n        const metadata = offlineStorage.getMetadata();\n        try {\n          await analyticsAPI.submitEvents(metadata);\n          // Delete metadata from local storage after successful sync\n          offlineStorage.clearMetadata();\n          metadataSynced = true;\n        } catch (error) {\n          console.warn('Failed to sync metadata:', error);\n          // Metadata remains in local storage for next sync attempt\n        }\n      }\n\n      // Sync error logs - delete after successful sync\n      let errorLogsSynced = !hasErrorLogs;\n      if (hasErrorLogs) {\n        const errorLogs = offlineStorage.getErrorLogs();\n        try {\n          await errorLogsAPI.submitLogs(errorLogs);\n          // Delete error logs from local storage after successful sync\n          offlineStorage.clearErrorLogs();\n          errorLogsSynced = true;\n        } catch (error) {\n          console.warn('Failed to sync error logs:', error);\n          // Error logs remain in local storage for next sync attempt\n        }\n      }\n      \n      const masterdataSynced = remainingProgress.length === 0 && highScoreSynced && profileSynced;\n      return masterdataSynced && metadataSynced && errorLogsSynced;\n    } finally {\n      setIsSyncing(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    // Sync masterdata, metadata, and error logs when online\n    if (isOnline && (offlineStorage.hasPendingSync() || offlineStorage.hasMetadataToSync() || offlineStorage.hasErrorLogsToSync())) {\n      syncToServer();\n    }\n  }, [isOnline, syncToServer]);\n\n  return { isOnline, isSyncing, syncToServer };\n}\n\nexport function useOfflineAwareLevelProgress() {\n  const localProgress = offlineStorage.getLevelProgress();\n  const maxUnlocked = offlineStorage.getUnlockedLevels();\n  \n  return {\n    data: localProgress,\n    maxUnlockedLevel: maxUnlocked,\n  };\n}\n","path":null,"size_bytes":5598,"size_tokens":null},"client/src/lib/auth-utils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\n// Redirect to login with a toast notification\nexport function redirectToLogin(toast?: (options: { title: string; description: string; variant: string }) => void) {\n  if (toast) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n  }\n  setTimeout(() => {\n    window.location.href = \"/api/login\";\n  }, 500);\n}\n","path":null,"size_bytes":517,"size_tokens":null},"server/github.ts":{"content":"// GitHub integration for Kikteria\n// Uses Replit's GitHub connection for authentication\n\nimport { Octokit } from '@octokit/rest';\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=github',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('GitHub not connected');\n  }\n  return accessToken;\n}\n\nexport async function getGitHubClient() {\n  const accessToken = await getAccessToken();\n  return new Octokit({ auth: accessToken });\n}\n\nexport async function createRepository(name: string, description: string) {\n  const octokit = await getGitHubClient();\n  \n  try {\n    const response = await octokit.repos.createForAuthenticatedUser({\n      name,\n      description,\n      private: false,\n      auto_init: false,\n    });\n    return response.data;\n  } catch (error: any) {\n    if (error.status === 422) {\n      // Repository might already exist\n      const user = await octokit.users.getAuthenticated();\n      const existingRepo = await octokit.repos.get({\n        owner: user.data.login,\n        repo: name,\n      });\n      return existingRepo.data;\n    }\n    throw error;\n  }\n}\n\nexport async function getAuthenticatedUser() {\n  const octokit = await getGitHubClient();\n  const response = await octokit.users.getAuthenticated();\n  return response.data;\n}\n","path":null,"size_bytes":2249,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport type { User } from \"@shared/models/auth\";\nimport { engagementService } from \"../lib/engagement-service\";\n\nasync function fetchUser(): Promise<User | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n\n  if (response.status === 401) {\n    return null;\n  }\n\n  if (!response.ok) {\n    throw new Error(`${response.status}: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\nexport function useAuth() {\n  const queryClient = useQueryClient();\n\n  const { data: user, isLoading } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  });\n\n  // Sync auth status to engagement service\n  useEffect(() => {\n    engagementService.setAuthenticated(!!user, user?.id);\n  }, [user]);\n\n  const login = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const logout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    login,\n    logout,\n  };\n}\n","path":null,"size_bytes":1160,"size_tokens":null},"server/replit_integrations/auth/storage.ts":{"content":"import { users, type User, type UpsertUser } from \"@shared/models/auth\";\nimport { db } from \"../../db\";\nimport { eq } from \"drizzle-orm\";\n\n// Interface for auth storage operations\n// (IMPORTANT) These user operations are mandatory for Replit Auth.\nexport interface IAuthStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n}\n\nclass AuthStorage implements IAuthStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n}\n\nexport const authStorage = new AuthStorage();\n","path":null,"size_bytes":943,"size_tokens":null},"scripts/push-to-github.ts":{"content":"// Script to push project to GitHub using Contents API\n// Usage: npx tsx scripts/push-to-github.ts <version>\n\nimport { getGitHubClient, getAuthenticatedUser } from '../server/github';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst IGNORE_PATTERNS = [\n  'node_modules',\n  '.git',\n  'dist',\n  '.replit',\n  '.cache',\n  '.config',\n  '.upm',\n  'generated-icon.png',\n  '.breakpoints',\n  'replit.nix',\n  '.gitignore',\n  'package-lock.json',\n];\n\nfunction shouldIgnore(filePath: string): boolean {\n  return IGNORE_PATTERNS.some(pattern => filePath.includes(pattern));\n}\n\nfunction getAllFiles(dir: string, baseDir: string = dir): string[] {\n  const files: string[] = [];\n  const items = fs.readdirSync(dir);\n  \n  for (const item of items) {\n    const fullPath = path.join(dir, item);\n    const relativePath = path.relative(baseDir, fullPath);\n    \n    if (shouldIgnore(relativePath)) continue;\n    \n    const stat = fs.statSync(fullPath);\n    if (stat.isDirectory()) {\n      files.push(...getAllFiles(fullPath, baseDir));\n    } else {\n      files.push(relativePath);\n    }\n  }\n  \n  return files;\n}\n\nasync function pushToGitHub(version: string) {\n  console.log(`Pushing Kikteria ${version} to GitHub...`);\n  \n  try {\n    const octokit = await getGitHubClient();\n    const user = await getAuthenticatedUser();\n    console.log(`Authenticated as: ${user.login}`);\n    \n    const repoName = 'kikteria';\n    \n    // Get or create repository\n    let repo;\n    try {\n      const existingRepo = await octokit.repos.get({\n        owner: user.login,\n        repo: repoName,\n      });\n      repo = existingRepo.data;\n      console.log(`Using existing repository: ${repo.html_url}`);\n    } catch (e) {\n      const response = await octokit.repos.createForAuthenticatedUser({\n        name: repoName,\n        description: 'Kikteria - A colorful bacteria placement puzzle game',\n        private: false,\n        auto_init: false,\n      });\n      repo = response.data;\n      console.log(`Created new repository: ${repo.html_url}`);\n    }\n    \n    const projectDir = process.cwd();\n    const files = getAllFiles(projectDir);\n    console.log(`Found ${files.length} files to upload`);\n    \n    // Upload README first to initialize the repo\n    console.log('Initializing repository with README...');\n    const readmeContent = fs.readFileSync(path.join(projectDir, 'replit.md'), 'utf-8');\n    try {\n      await octokit.repos.createOrUpdateFileContents({\n        owner: user.login,\n        repo: repoName,\n        path: 'README.md',\n        message: 'Initial commit - Add README',\n        content: Buffer.from(readmeContent).toString('base64'),\n      });\n    } catch (e: any) {\n      // File might already exist, update it\n      if (e.status === 422) {\n        const existing = await octokit.repos.getContent({\n          owner: user.login,\n          repo: repoName,\n          path: 'README.md',\n        });\n        await octokit.repos.createOrUpdateFileContents({\n          owner: user.login,\n          repo: repoName,\n          path: 'README.md',\n          message: `${version}: Update README`,\n          content: Buffer.from(readmeContent).toString('base64'),\n          sha: (existing.data as any).sha,\n        });\n      }\n    }\n    \n    // Wait for repo to be ready\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    // Now use Git Data API\n    console.log('Getting main branch...');\n    const mainRef = await octokit.git.getRef({\n      owner: user.login,\n      repo: repoName,\n      ref: 'heads/main',\n    });\n    const mainSha = mainRef.data.object.sha;\n    \n    // Create blobs for all files\n    console.log('Creating file blobs...');\n    const treeItems: { path: string; mode: '100644'; type: 'blob'; sha: string }[] = [];\n    \n    let count = 0;\n    for (const file of files) {\n      const filePath = path.join(projectDir, file);\n      const content = fs.readFileSync(filePath);\n      const base64Content = content.toString('base64');\n      \n      const blob = await octokit.git.createBlob({\n        owner: user.login,\n        repo: repoName,\n        content: base64Content,\n        encoding: 'base64',\n      });\n      \n      treeItems.push({\n        path: file,\n        mode: '100644',\n        type: 'blob',\n        sha: blob.data.sha,\n      });\n      \n      count++;\n      if (count % 10 === 0) {\n        process.stdout.write(`\\r${count}/${files.length} files uploaded`);\n      }\n    }\n    console.log(`\\n${count} blobs created`);\n    \n    // Create tree\n    console.log('Creating tree...');\n    const tree = await octokit.git.createTree({\n      owner: user.login,\n      repo: repoName,\n      tree: treeItems,\n    });\n    \n    // Create commit\n    console.log('Creating commit...');\n    const commitMessage = `${version}: Kikteria bacteria puzzle game\\n\\nFeatures:\\n- Unique sound effects for each bacteria type\\n- Retro Bomberman-style bomb explosion\\n- 8-bit victory fanfare\\n- Quick START button\\n- 7-level progression system`;\n    const commit = await octokit.git.createCommit({\n      owner: user.login,\n      repo: repoName,\n      message: commitMessage,\n      tree: tree.data.sha,\n      parents: [mainSha],\n    });\n    \n    // Update main branch reference\n    console.log('Updating main branch...');\n    await octokit.git.updateRef({\n      owner: user.login,\n      repo: repoName,\n      ref: 'heads/main',\n      sha: commit.data.sha,\n      force: true,\n    });\n    \n    // Create version tag\n    console.log(`Creating tag ${version}...`);\n    try {\n      await octokit.git.deleteRef({\n        owner: user.login,\n        repo: repoName,\n        ref: `tags/${version}`,\n      });\n    } catch (e) {\n      // Tag might not exist\n    }\n    \n    await octokit.git.createRef({\n      owner: user.login,\n      repo: repoName,\n      ref: `refs/tags/${version}`,\n      sha: commit.data.sha,\n    });\n    \n    console.log(`\\n========================================`);\n    console.log(`Successfully pushed ${version} to GitHub!`);\n    console.log(`Repository: ${repo.html_url}`);\n    console.log(`Tag: ${version}`);\n    console.log(`========================================`);\n    \n  } catch (error) {\n    console.error('Error pushing to GitHub:', error);\n    throw error;\n  }\n}\n\nconst version = process.argv[2] || 'v0.5';\npushToGitHub(version);\n","path":null,"size_bytes":6249,"size_tokens":null},"server/replit_integrations/auth/index.ts":{"content":"export { setupAuth, isAuthenticated, getSession } from \"./replitAuth\";\nexport { authStorage, type IAuthStorage } from \"./storage\";\nexport { registerAuthRoutes } from \"./routes\";\n","path":null,"size_bytes":178,"size_tokens":null},"server/replit_integrations/auth/routes.ts":{"content":"import type { Express } from \"express\";\nimport { authStorage } from \"./storage\";\nimport { isAuthenticated } from \"./replitAuth\";\n\n// Register auth-specific routes\nexport function registerAuthRoutes(app: Express): void {\n  // Get current authenticated user\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await authStorage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n}\n","path":null,"size_bytes":609,"size_tokens":null},"shared/models/auth.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar } from \"drizzle-orm/pg-core\";\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\n// User storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":1010,"size_tokens":null},"client/src/lib/offline-storage.ts":{"content":"const STORAGE_KEYS = {\n  LEVEL_PROGRESS: 'kikteria_level_progress',\n  BEST_SCORES: 'kikteria_best_scores',\n  UNLOCKED_LEVELS: 'kikteria_unlocked_levels',\n  PLAYER_STATS: 'kikteria_player_stats',\n  PENDING_SYNC: 'kikteria_pending_sync',\n  SETTINGS: 'kikteria_settings',\n  LEADERBOARD_CACHE: 'kikteria_leaderboard_cache',\n  METADATA: 'kikteria_metadata',\n  SESSION_ID: 'kikteria_session_id',\n  ERROR_LOGS: 'kikteria_error_logs',\n  LAST_USER_ACTION: 'kikteria_last_action',\n} as const;\n\nconst MAX_ERROR_LOGS = 50;\n\nexport interface LocalLevelProgress {\n  levelNumber: number;\n  bestScore: number;\n  isCompleted: boolean;\n}\n\nexport interface LocalPlayerStats {\n  coins: number;\n  highScore: number;\n  bombCount: number;\n  figureSize: number;\n  queueSize: number;\n  timeBonus: number;\n  placementBonus: number;\n  slowMo: number;\n  shield: number;\n  coinBoost: number;\n  lucky: number;\n  secondChance: number;\n  lastUpdated: number;\n}\n\nexport interface PendingProfileSync {\n  coins: number | null;\n  speedUpgrade: number | null;\n  startSizeUpgrade: number | null;\n  magnetUpgrade: number | null;\n}\n\nexport interface PendingSync {\n  levelProgress: LocalLevelProgress[];\n  highScore: number | null;\n  profile: PendingProfileSync | null;\n  timestamp: number;\n}\n\nexport interface LeaderboardEntry {\n  rank: number;\n  username: string;\n  score: number;\n}\n\n// Metadata - user behavior tracking (synced then deleted)\nexport interface MetadataEvent {\n  id: string;\n  eventType: 'level_play' | 'level_success' | 'level_fail' | 'session_start' | 'session_end';\n  levelNumber?: number;\n  score?: number;\n  playDuration?: number;\n  eventDate: string;\n  eventTime: string;\n  sessionId: string;\n  deviceInfo: string;\n}\n\n// Error Logs - for debugging (synced then deleted)\nexport interface ErrorLogEntry {\n  id: string;\n  severity: 'error' | 'warn' | 'info';\n  category: 'runtime' | 'api' | 'sync' | 'game' | 'asset';\n  message: string;\n  stack?: string;\n  component?: string;\n  currentScreen?: string;\n  gameState?: string;\n  apiInfo?: string;\n  sessionId: string;\n  deviceInfo: string;\n  networkStatus: 'online' | 'offline';\n  lastUserAction?: string;\n  eventTime: string;\n}\n\nfunction safeGet<T>(key: string, defaultValue: T): T {\n  try {\n    const item = localStorage.getItem(key);\n    if (item) {\n      return JSON.parse(item) as T;\n    }\n  } catch (e) {\n    console.warn(`Failed to read ${key} from localStorage:`, e);\n  }\n  return defaultValue;\n}\n\nfunction safeSet(key: string, value: unknown): boolean {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n    return true;\n  } catch (e) {\n    console.warn(`Failed to write ${key} to localStorage:`, e);\n    return false;\n  }\n}\n\nexport const offlineStorage = {\n  getLevelProgress(): LocalLevelProgress[] {\n    return safeGet(STORAGE_KEYS.LEVEL_PROGRESS, []);\n  },\n\n  setLevelProgress(progress: LocalLevelProgress[]): void {\n    safeSet(STORAGE_KEYS.LEVEL_PROGRESS, progress);\n  },\n\n  updateLevelProgress(levelNumber: number, score: number, completed: boolean): void {\n    const progress = this.getLevelProgress();\n    const existing = progress.find(p => p.levelNumber === levelNumber);\n    \n    if (existing) {\n      existing.bestScore = Math.max(existing.bestScore, score);\n      existing.isCompleted = existing.isCompleted || completed;\n    } else {\n      progress.push({ levelNumber, bestScore: score, isCompleted: completed });\n    }\n    \n    this.setLevelProgress(progress);\n    \n    if (completed) {\n      this.unlockLevel(levelNumber + 1);\n    }\n    \n    this.addPendingSync({ levelNumber, bestScore: score, isCompleted: completed });\n  },\n\n  getUnlockedLevels(): number {\n    return safeGet(STORAGE_KEYS.UNLOCKED_LEVELS, 1);\n  },\n\n  unlockLevel(level: number): void {\n    const current = this.getUnlockedLevels();\n    if (level > current) {\n      safeSet(STORAGE_KEYS.UNLOCKED_LEVELS, level);\n    }\n  },\n\n  getPlayerStats(): LocalPlayerStats {\n    const stored = safeGet<Partial<LocalPlayerStats>>(STORAGE_KEYS.PLAYER_STATS, {});\n    // Merge with defaults to handle missing properties from old saves\n    return {\n      coins: stored.coins ?? 0,\n      highScore: stored.highScore ?? 0,\n      bombCount: stored.bombCount ?? 1,\n      figureSize: stored.figureSize ?? 1,\n      queueSize: stored.queueSize ?? 1,\n      timeBonus: stored.timeBonus ?? 1,\n      placementBonus: stored.placementBonus ?? 1,\n      slowMo: stored.slowMo ?? 1,\n      shield: stored.shield ?? 0,\n      coinBoost: stored.coinBoost ?? 1,\n      lucky: stored.lucky ?? 1,\n      secondChance: stored.secondChance ?? 0,\n      lastUpdated: stored.lastUpdated ?? 0,\n    };\n  },\n\n  setPlayerStats(stats: Partial<LocalPlayerStats>): void {\n    const current = this.getPlayerStats();\n    safeSet(STORAGE_KEYS.PLAYER_STATS, { \n      ...current, \n      ...stats, \n      lastUpdated: Date.now() \n    });\n  },\n\n  updateHighScore(score: number): void {\n    const stats = this.getPlayerStats();\n    if (score > stats.highScore) {\n      this.setPlayerStats({ highScore: score });\n      this.addPendingHighScore(score);\n    }\n  },\n\n  getPendingSync(): PendingSync {\n    return safeGet(STORAGE_KEYS.PENDING_SYNC, {\n      levelProgress: [],\n      highScore: null,\n      profile: null,\n      timestamp: 0,\n    });\n  },\n\n  addPendingSync(progress: LocalLevelProgress): void {\n    const pending = this.getPendingSync();\n    const existing = pending.levelProgress.find(p => p.levelNumber === progress.levelNumber);\n    \n    if (existing) {\n      existing.bestScore = Math.max(existing.bestScore, progress.bestScore);\n      existing.isCompleted = existing.isCompleted || progress.isCompleted;\n    } else {\n      pending.levelProgress.push(progress);\n    }\n    \n    pending.timestamp = Date.now();\n    safeSet(STORAGE_KEYS.PENDING_SYNC, pending);\n  },\n\n  addPendingHighScore(score: number): void {\n    const pending = this.getPendingSync();\n    pending.highScore = Math.max(pending.highScore || 0, score);\n    pending.timestamp = Date.now();\n    safeSet(STORAGE_KEYS.PENDING_SYNC, pending);\n  },\n\n  addPendingProfileSync(updates: Partial<PendingProfileSync>): void {\n    const pending = this.getPendingSync();\n    pending.profile = {\n      coins: updates.coins ?? pending.profile?.coins ?? null,\n      speedUpgrade: updates.speedUpgrade ?? pending.profile?.speedUpgrade ?? null,\n      startSizeUpgrade: updates.startSizeUpgrade ?? pending.profile?.startSizeUpgrade ?? null,\n      magnetUpgrade: updates.magnetUpgrade ?? pending.profile?.magnetUpgrade ?? null,\n    };\n    pending.timestamp = Date.now();\n    safeSet(STORAGE_KEYS.PENDING_SYNC, pending);\n  },\n\n  clearPendingSync(): void {\n    safeSet(STORAGE_KEYS.PENDING_SYNC, {\n      levelProgress: [],\n      highScore: null,\n      profile: null,\n      timestamp: 0,\n    });\n  },\n\n  clearPendingProfileSync(): void {\n    const pending = this.getPendingSync();\n    pending.profile = null;\n    safeSet(STORAGE_KEYS.PENDING_SYNC, pending);\n  },\n\n  hasPendingSync(): boolean {\n    const pending = this.getPendingSync();\n    return pending.levelProgress.length > 0 || pending.highScore !== null || pending.profile !== null;\n  },\n\n  getLeaderboardCache(): LeaderboardEntry[] {\n    return safeGet(STORAGE_KEYS.LEADERBOARD_CACHE, []);\n  },\n\n  setLeaderboardCache(entries: LeaderboardEntry[]): void {\n    safeSet(STORAGE_KEYS.LEADERBOARD_CACHE, entries);\n  },\n\n  mergeServerProgress(serverProgress: { levelNumber: number; bestScore: number; isCompleted: number }[]): void {\n    const local = this.getLevelProgress();\n    const currentMaxUnlocked = this.getUnlockedLevels();\n    \n    for (const server of serverProgress) {\n      const localEntry = local.find(l => l.levelNumber === server.levelNumber);\n      if (localEntry) {\n        localEntry.bestScore = Math.max(localEntry.bestScore, server.bestScore);\n        localEntry.isCompleted = localEntry.isCompleted || server.isCompleted === 1;\n      } else {\n        local.push({\n          levelNumber: server.levelNumber,\n          bestScore: server.bestScore,\n          isCompleted: server.isCompleted === 1,\n        });\n      }\n    }\n    \n    this.setLevelProgress(local);\n    \n    const newMaxUnlocked = local\n      .filter(l => l.isCompleted)\n      .reduce((max, l) => Math.max(max, l.levelNumber + 1), 1);\n    \n    const finalMaxUnlocked = Math.max(currentMaxUnlocked, newMaxUnlocked);\n    if (finalMaxUnlocked > currentMaxUnlocked) {\n      this.unlockLevel(finalMaxUnlocked);\n    }\n  },\n\n  getSettings(): { soundEnabled: boolean; musicEnabled: boolean } {\n    return safeGet(STORAGE_KEYS.SETTINGS, {\n      soundEnabled: true,\n      musicEnabled: true,\n    });\n  },\n\n  setSettings(settings: { soundEnabled?: boolean; musicEnabled?: boolean }): void {\n    const current = this.getSettings();\n    safeSet(STORAGE_KEYS.SETTINGS, { ...current, ...settings });\n  },\n\n  // Metadata functions - user behavior tracking\n  getSessionId(): string {\n    let sessionId = safeGet<string | null>(STORAGE_KEYS.SESSION_ID, null);\n    if (!sessionId) {\n      sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      safeSet(STORAGE_KEYS.SESSION_ID, sessionId);\n    }\n    return sessionId;\n  },\n\n  generateNewSession(): string {\n    const sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    safeSet(STORAGE_KEYS.SESSION_ID, sessionId);\n    return sessionId;\n  },\n\n  getDeviceInfo(): string {\n    const ua = navigator.userAgent;\n    const isMobile = /Mobile|Android|iPhone|iPad/.test(ua);\n    const browser = /Chrome/.test(ua) ? 'Chrome' : /Firefox/.test(ua) ? 'Firefox' : /Safari/.test(ua) ? 'Safari' : 'Other';\n    return `${isMobile ? 'Mobile' : 'Desktop'}-${browser}`;\n  },\n\n  getMetadata(): MetadataEvent[] {\n    return safeGet(STORAGE_KEYS.METADATA, []);\n  },\n\n  addMetadataEvent(event: Omit<MetadataEvent, 'id' | 'eventDate' | 'eventTime' | 'sessionId' | 'deviceInfo'>): void {\n    const metadata = this.getMetadata();\n    const now = new Date();\n    \n    metadata.push({\n      ...event,\n      id: `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      eventDate: now.toISOString().split('T')[0],\n      eventTime: now.toISOString(),\n      sessionId: this.getSessionId(),\n      deviceInfo: this.getDeviceInfo(),\n    });\n    \n    safeSet(STORAGE_KEYS.METADATA, metadata);\n  },\n\n  trackLevelPlay(levelNumber: number): void {\n    this.addMetadataEvent({ eventType: 'level_play', levelNumber });\n  },\n\n  trackLevelSuccess(levelNumber: number, score: number, playDuration: number): void {\n    this.addMetadataEvent({ eventType: 'level_success', levelNumber, score, playDuration });\n  },\n\n  trackLevelFail(levelNumber: number, score: number, playDuration: number): void {\n    this.addMetadataEvent({ eventType: 'level_fail', levelNumber, score, playDuration });\n  },\n\n  trackSessionStart(): void {\n    this.generateNewSession();\n    this.addMetadataEvent({ eventType: 'session_start' });\n  },\n\n  trackSessionEnd(): void {\n    this.addMetadataEvent({ eventType: 'session_end' });\n  },\n\n  hasMetadataToSync(): boolean {\n    return this.getMetadata().length > 0;\n  },\n\n  clearMetadata(): void {\n    safeSet(STORAGE_KEYS.METADATA, []);\n  },\n\n  // Error log functions\n  getErrorLogs(): ErrorLogEntry[] {\n    return safeGet(STORAGE_KEYS.ERROR_LOGS, []);\n  },\n\n  addErrorLog(entry: Omit<ErrorLogEntry, 'id' | 'sessionId' | 'deviceInfo' | 'networkStatus' | 'eventTime' | 'lastUserAction'>): void {\n    const logs = this.getErrorLogs();\n    \n    logs.push({\n      ...entry,\n      id: `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      sessionId: this.getSessionId(),\n      deviceInfo: this.getDeviceInfo(),\n      networkStatus: navigator.onLine ? 'online' : 'offline',\n      lastUserAction: this.getLastUserAction(),\n      eventTime: new Date().toISOString(),\n    });\n    \n    // Keep only the most recent logs to prevent storage overflow\n    while (logs.length > MAX_ERROR_LOGS) {\n      logs.shift();\n    }\n    \n    safeSet(STORAGE_KEYS.ERROR_LOGS, logs);\n  },\n\n  hasErrorLogsToSync(): boolean {\n    return this.getErrorLogs().length > 0;\n  },\n\n  clearErrorLogs(): void {\n    safeSet(STORAGE_KEYS.ERROR_LOGS, []);\n  },\n\n  // Track user actions for error context\n  setLastUserAction(action: string): void {\n    safeSet(STORAGE_KEYS.LAST_USER_ACTION, action);\n  },\n\n  getLastUserAction(): string | undefined {\n    return safeGet<string | undefined>(STORAGE_KEYS.LAST_USER_ACTION, undefined);\n  },\n\n  clearAll(): void {\n    Object.values(STORAGE_KEYS).forEach(key => {\n      try {\n        localStorage.removeItem(key);\n      } catch (e) {\n        console.warn(`Failed to remove ${key}:`, e);\n      }\n    });\n  },\n};\n","path":null,"size_bytes":12571,"size_tokens":null},"client/src/components/game/UpdateModal.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { versionAPI } from '@/lib/api';\nimport { CURRENT_VERSION, isUpdateRequired, isUpdateAvailable, type UpdatePolicy } from '@/lib/version';\nimport { offlineStorage } from '@/lib/offline-storage';\n\nconst UPDATE_DISMISSED_KEY = 'kikteria_update_dismissed';\nconst CACHE_KEY = 'kikteria_update_policy_cache';\n\ninterface UpdateModalProps {\n  onReady: () => void;\n}\n\nexport function UpdateModal({ onReady }: UpdateModalProps) {\n  const [policy, setPolicy] = useState<UpdatePolicy | null>(null);\n  const [updateType, setUpdateType] = useState<'mandatory' | 'optional' | null>(null);\n  const [isOpen, setIsOpen] = useState(false);\n  const [isChecking, setIsChecking] = useState(true);\n\n  useEffect(() => {\n    checkForUpdates();\n  }, []);\n\n  async function checkForUpdates() {\n    try {\n      const response = await versionAPI.getUpdatePolicy();\n      const updatePolicy: UpdatePolicy = {\n        latestVersion: response.latestVersion,\n        minSupportedVersion: response.minSupportedVersion,\n        downloadUrl: response.downloadUrl,\n        releaseNotes: response.releaseNotes || undefined,\n      };\n      \n      localStorage.setItem(CACHE_KEY, JSON.stringify(updatePolicy));\n      \n      setPolicy(updatePolicy);\n      evaluateUpdate(updatePolicy);\n    } catch (error) {\n      const cached = localStorage.getItem(CACHE_KEY);\n      if (cached) {\n        try {\n          const cachedPolicy = JSON.parse(cached) as UpdatePolicy;\n          setPolicy(cachedPolicy);\n          evaluateUpdate(cachedPolicy);\n        } catch {\n          setIsChecking(false);\n          onReady();\n        }\n      } else {\n        setIsChecking(false);\n        onReady();\n      }\n    }\n  }\n\n  function evaluateUpdate(updatePolicy: UpdatePolicy) {\n    setIsChecking(false);\n    \n    if (isUpdateRequired(updatePolicy)) {\n      setUpdateType('mandatory');\n      setIsOpen(true);\n      return;\n    }\n    \n    if (isUpdateAvailable(updatePolicy)) {\n      const dismissed = sessionStorage.getItem(UPDATE_DISMISSED_KEY);\n      if (dismissed !== updatePolicy.latestVersion) {\n        setUpdateType('optional');\n        setIsOpen(true);\n        return;\n      }\n    }\n    \n    onReady();\n  }\n\n  function handleUpdate() {\n    if (policy?.downloadUrl) {\n      if (policy.downloadUrl === '/' || policy.downloadUrl === window.location.origin) {\n        window.location.reload();\n      } else {\n        window.open(policy.downloadUrl, '_blank');\n        window.location.reload();\n      }\n    }\n  }\n\n  function handleSkip() {\n    if (policy && updateType === 'optional') {\n      sessionStorage.setItem(UPDATE_DISMISSED_KEY, policy.latestVersion);\n      setIsOpen(false);\n      onReady();\n    }\n  }\n\n  function handleExit() {\n    window.close();\n    document.body.innerHTML = '<div style=\"display:flex;align-items:center;justify-content:center;height:100vh;background:#1a1a2e;color:#fff;font-family:sans-serif;text-align:center;padding:20px;\"><div><h1>Update Required</h1><p>Please update the app to continue playing.</p></div></div>';\n  }\n\n  if (isChecking) {\n    return (\n      <div className=\"fixed inset-0 bg-background/95 flex items-center justify-center z-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-pulse text-2xl font-display text-primary mb-4\">KIKTERIA</div>\n          <p className=\"text-foreground/60 font-ui\">Checking for updates...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isOpen || !policy) {\n    return null;\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={() => {}}>\n      <DialogContent className=\"block-panel border-4 border-primary max-w-md\" onPointerDownOutside={(e) => e.preventDefault()}>\n        <DialogHeader>\n          <DialogTitle className=\"font-display text-2xl text-center text-primary\">\n            {updateType === 'mandatory' ? 'Update Required' : 'Update Available'}\n          </DialogTitle>\n          <DialogDescription className=\"text-center font-ui text-lg mt-4\">\n            {updateType === 'mandatory' ? (\n              <>\n                A new version is required to continue playing.\n                <br />\n                <span className=\"text-foreground/60\">\n                  Current: v{CURRENT_VERSION} â†’ Required: v{policy.minSupportedVersion}+\n                </span>\n              </>\n            ) : (\n              <>\n                A new version is available!\n                <br />\n                <span className=\"text-foreground/60\">\n                  Current: v{CURRENT_VERSION} â†’ Latest: v{policy.latestVersion}\n                </span>\n              </>\n            )}\n          </DialogDescription>\n        </DialogHeader>\n\n        {policy.releaseNotes && (\n          <div className=\"my-4 p-3 bg-background/50 border-2 border-foreground/20 text-sm font-ui max-h-32 overflow-y-auto\">\n            <p className=\"text-foreground/80 font-semibold mb-1\">What's new:</p>\n            <p className=\"text-foreground/60\">{policy.releaseNotes}</p>\n          </div>\n        )}\n\n        <DialogFooter className=\"flex flex-col gap-3 mt-6\">\n          <Button \n            onClick={handleUpdate}\n            className=\"w-full pixel-btn font-display\"\n            data-testid=\"button-update\"\n          >\n            UPDATE NOW\n          </Button>\n          \n          {updateType === 'optional' ? (\n            <Button \n              onClick={handleSkip}\n              variant=\"outline\"\n              className=\"w-full font-display\"\n              data-testid=\"button-skip-update\"\n            >\n              SKIP FOR NOW\n            </Button>\n          ) : (\n            <Button \n              onClick={handleExit}\n              variant=\"destructive\"\n              className=\"w-full font-display\"\n              data-testid=\"button-exit-game\"\n            >\n              EXIT GAME\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6053,"size_tokens":null},"client/src/lib/error-logger.ts":{"content":"import { offlineStorage, type ErrorLogEntry } from './offline-storage';\nimport { useGameStore } from './store';\n\ntype ErrorSeverity = 'error' | 'warn' | 'info';\ntype ErrorCategory = 'runtime' | 'api' | 'sync' | 'game' | 'asset';\n\nconst SENSITIVE_KEYS = [\n  'password', 'token', 'secret', 'auth', 'key', 'credential',\n  'email', 'phone', 'address', 'ssn', 'credit', 'card',\n  'cookie', 'session', 'bearer', 'oauth', 'jwt'\n];\n\nfunction sanitizeString(str: string): string {\n  let result = str;\n  for (const key of SENSITIVE_KEYS) {\n    const regex = new RegExp(`(${key}[\\\\s]*[=:]?[\\\\s]*)([^\\\\s,;\\\\n\"'\\\\]\\\\}]+)`, 'gi');\n    result = result.replace(regex, '$1[REDACTED]');\n  }\n  return result;\n}\n\nfunction sanitizeStack(stack: string | undefined): string | undefined {\n  if (!stack) return undefined;\n  return sanitizeString(stack).slice(0, 2000);\n}\n\nfunction getCurrentScreen(): string {\n  if (typeof window === 'undefined') return 'unknown';\n  return window.location.pathname || '/';\n}\n\nfunction getSanitizedGameState(): string {\n  try {\n    const state = useGameStore.getState();\n    return JSON.stringify({\n      gameState: state.gameState,\n      currentLevel: state.currentLevel,\n      score: state.score,\n      figuresPlaced: state.figuresPlaced,\n      totalFigures: state.totalFigures,\n      bombsRemaining: state.bombsRemaining,\n      timeRemaining: state.timeRemaining,\n      queueLength: state.figureQueue?.length || 0,\n    });\n  } catch {\n    return '{}';\n  }\n}\n\ninterface LogOptions {\n  severity?: ErrorSeverity;\n  category?: ErrorCategory;\n  component?: string;\n  apiInfo?: {\n    method?: string;\n    endpoint?: string;\n    status?: number;\n    latency?: number;\n  };\n}\n\nexport const errorLogger = {\n  log(message: string, options: LogOptions = {}): void {\n    const { severity = 'error', category = 'runtime', component, apiInfo } = options;\n    \n    offlineStorage.addErrorLog({\n      severity,\n      category,\n      message: sanitizeString(message).slice(0, 500),\n      component,\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n      apiInfo: apiInfo ? JSON.stringify(apiInfo) : undefined,\n    });\n  },\n\n  logError(error: Error, options: LogOptions = {}): void {\n    const { severity = 'error', category = 'runtime', component, apiInfo } = options;\n    \n    offlineStorage.addErrorLog({\n      severity,\n      category,\n      message: sanitizeString(error.message).slice(0, 500),\n      stack: sanitizeStack(error.stack),\n      component,\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n      apiInfo: apiInfo ? JSON.stringify(apiInfo) : undefined,\n    });\n  },\n\n  logApiError(endpoint: string, method: string, status: number, message: string, latency?: number): void {\n    offlineStorage.addErrorLog({\n      severity: status >= 500 ? 'error' : 'warn',\n      category: 'api',\n      message: sanitizeString(message).slice(0, 500),\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n      apiInfo: JSON.stringify({ method, endpoint, status, latency }),\n    });\n  },\n\n  logGameError(message: string, component?: string): void {\n    offlineStorage.addErrorLog({\n      severity: 'error',\n      category: 'game',\n      message: sanitizeString(message).slice(0, 500),\n      component,\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n    });\n  },\n\n  logAssetError(assetUrl: string, message: string): void {\n    offlineStorage.addErrorLog({\n      severity: 'warn',\n      category: 'asset',\n      message: `Asset load failed: ${sanitizeString(assetUrl).slice(0, 200)} - ${sanitizeString(message).slice(0, 200)}`,\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n    });\n  },\n\n  logSyncError(message: string): void {\n    offlineStorage.addErrorLog({\n      severity: 'error',\n      category: 'sync',\n      message: sanitizeString(message).slice(0, 500),\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n    });\n  },\n};\n\nexport function initGlobalErrorHandlers(): void {\n  if (typeof window === 'undefined') return;\n\n  window.onerror = (message, source, lineno, colno, error) => {\n    const errorMessage = typeof message === 'string' ? message : 'Unknown error';\n    offlineStorage.addErrorLog({\n      severity: 'error',\n      category: 'runtime',\n      message: sanitizeString(errorMessage).slice(0, 500),\n      stack: error ? sanitizeStack(error.stack) : `${source}:${lineno}:${colno}`,\n      component: 'window.onerror',\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n    });\n    return false;\n  };\n\n  window.onunhandledrejection = (event) => {\n    const reason = event.reason;\n    let message = 'Unhandled promise rejection';\n    let stack: string | undefined;\n    \n    if (reason instanceof Error) {\n      message = reason.message;\n      stack = reason.stack;\n    } else if (typeof reason === 'string') {\n      message = reason;\n    } else if (reason && typeof reason === 'object' && 'message' in reason) {\n      message = String(reason.message);\n    }\n    \n    offlineStorage.addErrorLog({\n      severity: 'error',\n      category: 'runtime',\n      message: sanitizeString(message).slice(0, 500),\n      stack: sanitizeStack(stack),\n      component: 'window.onunhandledrejection',\n      currentScreen: getCurrentScreen(),\n      gameState: getSanitizedGameState(),\n    });\n  };\n}\n\nexport function trackUserAction(action: string): void {\n  offlineStorage.setLastUserAction(action);\n}\n","path":null,"size_bytes":5525,"size_tokens":null},"client/src/lib/version.ts":{"content":"export const CURRENT_VERSION = \"1.3.0\";\n\nexport interface UpdatePolicy {\n  latestVersion: string;\n  minSupportedVersion: string;\n  downloadUrl: string;\n  releaseNotes?: string;\n}\n\nexport interface VersionComparison {\n  major: number;\n  minor: number;\n  patch: number;\n}\n\nexport function parseVersion(version: string): VersionComparison {\n  const parts = version.split('.').map(Number);\n  return {\n    major: parts[0] || 0,\n    minor: parts[1] || 0,\n    patch: parts[2] || 0,\n  };\n}\n\nexport function compareVersions(a: string, b: string): number {\n  const vA = parseVersion(a);\n  const vB = parseVersion(b);\n  \n  if (vA.major !== vB.major) return vA.major - vB.major;\n  if (vA.minor !== vB.minor) return vA.minor - vB.minor;\n  return vA.patch - vB.patch;\n}\n\nexport function isVersionLessThan(current: string, target: string): boolean {\n  return compareVersions(current, target) < 0;\n}\n\nexport function isUpdateRequired(policy: UpdatePolicy): boolean {\n  return isVersionLessThan(CURRENT_VERSION, policy.minSupportedVersion);\n}\n\nexport function isUpdateAvailable(policy: UpdatePolicy): boolean {\n  return isVersionLessThan(CURRENT_VERSION, policy.latestVersion);\n}\n","path":null,"size_bytes":1163,"size_tokens":null},"client/src/pages/Admin.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '@/hooks/use-auth';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useToast } from '@/hooks/use-toast';\n\nconst ADMIN_USER_IDS = ['51476893'];\n\ninterface AdminStats {\n  totalUsers: number;\n  totalGamesPlayed: number;\n  totalErrors: number;\n}\n\ninterface User {\n  id: string;\n  email: string | null;\n  firstName: string | null;\n  lastName: string | null;\n  createdAt: string;\n}\n\ninterface Profile {\n  id: string;\n  userId: string;\n  coins: number;\n  highScore: number;\n  speedUpgrade: number;\n  startSizeUpgrade: number;\n  magnetUpgrade: number;\n  email?: string;\n  firstName?: string;\n  lastName?: string;\n}\n\ninterface UpdatePolicy {\n  latestVersion: string;\n  minSupportedVersion: string;\n  downloadUrl: string;\n  releaseNotes: string | null;\n}\n\nasync function fetchJSON<T>(url: string, options?: RequestInit): Promise<T> {\n  const res = await fetch(url, {\n    headers: { 'Content-Type': 'application/json' },\n    credentials: 'include',\n    ...options,\n  });\n  if (!res.ok) {\n    const error = await res.json().catch(() => ({ message: 'Request failed' }));\n    throw new Error(error.message || error.error || 'Request failed');\n  }\n  return res.json();\n}\n\nexport function AdminPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [stats, setStats] = useState<AdminStats | null>(null);\n  const [users, setUsers] = useState<User[]>([]);\n  const [profiles, setProfiles] = useState<Profile[]>([]);\n  const [analytics, setAnalytics] = useState<any[]>([]);\n  const [errors, setErrors] = useState<any[]>([]);\n  const [updatePolicy, setUpdatePolicy] = useState<UpdatePolicy>({\n    latestVersion: '1.3.0',\n    minSupportedVersion: '1.0.0',\n    downloadUrl: '/',\n    releaseNotes: '',\n  });\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState('dashboard');\n\n  const isAdmin = user && ADMIN_USER_IDS.includes(user.id);\n\n  useEffect(() => {\n    if (isAdmin) {\n      loadData();\n    } else {\n      setLoading(false);\n    }\n  }, [isAdmin]);\n\n  async function loadData() {\n    try {\n      const [statsData, usersData, profilesData, analyticsData, errorsData, policyData] = await Promise.all([\n        fetchJSON<AdminStats>('/api/admin/stats'),\n        fetchJSON<User[]>('/api/admin/users'),\n        fetchJSON<Profile[]>('/api/admin/profiles'),\n        fetchJSON<any[]>('/api/admin/analytics?limit=50'),\n        fetchJSON<any[]>('/api/admin/errors?limit=50'),\n        fetchJSON<UpdatePolicy>('/api/admin/update-policy'),\n      ]);\n      setStats(statsData);\n      setUsers(usersData);\n      setProfiles(profilesData);\n      setAnalytics(analyticsData);\n      setErrors(errorsData);\n      setUpdatePolicy(policyData);\n    } catch (error: any) {\n      toast({ title: 'Error', description: error.message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function saveUpdatePolicy() {\n    try {\n      await fetchJSON('/api/admin/update-policy', {\n        method: 'POST',\n        body: JSON.stringify(updatePolicy),\n      });\n      toast({ title: 'Success', description: 'Update policy saved' });\n    } catch (error: any) {\n      toast({ title: 'Error', description: error.message, variant: 'destructive' });\n    }\n  }\n\n  async function deleteUserData(userId: string) {\n    if (!confirm('Are you sure? This will delete all game data for this user.')) return;\n    try {\n      await fetchJSON(`/api/admin/user/${userId}`, { method: 'DELETE' });\n      toast({ title: 'Success', description: 'User data deleted' });\n      loadData();\n    } catch (error: any) {\n      toast({ title: 'Error', description: error.message, variant: 'destructive' });\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-pulse text-2xl font-display text-primary\">Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Access Denied</CardTitle>\n            <CardDescription>You do not have admin privileges.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button onClick={() => window.location.href = '/'} data-testid=\"button-back-home\">\n              Back to Game\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-3xl font-display text-primary\">Admin Panel</h1>\n          <Button variant=\"outline\" onClick={() => window.location.href = '/'} data-testid=\"button-back-game\">\n            Back to Game\n          </Button>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-4\">\n          <TabsList className=\"grid grid-cols-5 w-full max-w-2xl\">\n            <TabsTrigger value=\"dashboard\" data-testid=\"tab-dashboard\">Dashboard</TabsTrigger>\n            <TabsTrigger value=\"users\" data-testid=\"tab-users\">Users</TabsTrigger>\n            <TabsTrigger value=\"analytics\" data-testid=\"tab-analytics\">Analytics</TabsTrigger>\n            <TabsTrigger value=\"errors\" data-testid=\"tab-errors\">Errors</TabsTrigger>\n            <TabsTrigger value=\"settings\" data-testid=\"tab-settings\">Settings</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"dashboard\" className=\"space-y-4\">\n            <div className=\"grid grid-cols-3 gap-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardDescription>Total Users</CardDescription>\n                  <CardTitle className=\"text-4xl text-primary\" data-testid=\"stat-users\">{stats?.totalUsers || 0}</CardTitle>\n                </CardHeader>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardDescription>Games Played</CardDescription>\n                  <CardTitle className=\"text-4xl text-secondary\" data-testid=\"stat-games\">{stats?.totalGamesPlayed || 0}</CardTitle>\n                </CardHeader>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardDescription>Error Logs</CardDescription>\n                  <CardTitle className=\"text-4xl text-destructive\" data-testid=\"stat-errors\">{stats?.totalErrors || 0}</CardTitle>\n                </CardHeader>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Top Players</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {profiles.slice(0, 5).map((p, i) => (\n                    <div key={p.id} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                      <span>#{i + 1} {p.firstName || p.email || p.userId}</span>\n                      <span className=\"font-bold\">{p.highScore} pts</span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"users\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Users ({users.length})</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[500px]\">\n                  <div className=\"space-y-2\">\n                    {users.map(u => (\n                      <div key={u.id} className=\"flex justify-between items-center p-3 bg-muted rounded\" data-testid={`user-row-${u.id}`}>\n                        <div>\n                          <div className=\"font-medium\">{u.firstName} {u.lastName}</div>\n                          <div className=\"text-sm text-muted-foreground\">{u.email}</div>\n                          <div className=\"text-xs text-muted-foreground\">ID: {u.id}</div>\n                        </div>\n                        <Button \n                          variant=\"destructive\" \n                          size=\"sm\"\n                          onClick={() => deleteUserData(u.id)}\n                          data-testid={`delete-user-${u.id}`}\n                        >\n                          Delete Data\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Player Profiles ({profiles.length})</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[400px]\">\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"border-b\">\n                        <th className=\"text-left p-2\">User</th>\n                        <th className=\"text-right p-2\">Coins</th>\n                        <th className=\"text-right p-2\">High Score</th>\n                        <th className=\"text-right p-2\">Upgrades</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {profiles.map(p => (\n                        <tr key={p.id} className=\"border-b\">\n                          <td className=\"p-2\">{p.firstName || p.email || p.userId}</td>\n                          <td className=\"text-right p-2\">{p.coins}</td>\n                          <td className=\"text-right p-2\">{p.highScore}</td>\n                          <td className=\"text-right p-2\">{p.speedUpgrade}/{p.startSizeUpgrade}/{p.magnetUpgrade}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"analytics\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>User Analytics (Last 50)</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[600px]\">\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"border-b\">\n                        <th className=\"text-left p-2\">Event</th>\n                        <th className=\"text-left p-2\">Level</th>\n                        <th className=\"text-right p-2\">Score</th>\n                        <th className=\"text-right p-2\">Duration</th>\n                        <th className=\"text-left p-2\">Date</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {analytics.map((a, i) => (\n                        <tr key={i} className=\"border-b\">\n                          <td className=\"p-2\">{a.eventType}</td>\n                          <td className=\"p-2\">{a.levelNumber || '-'}</td>\n                          <td className=\"text-right p-2\">{a.score || '-'}</td>\n                          <td className=\"text-right p-2\">{a.playDuration ? `${a.playDuration}s` : '-'}</td>\n                          <td className=\"p-2\">{a.eventDate}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"errors\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Error Logs (Last 50)</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[600px]\">\n                  <div className=\"space-y-2\">\n                    {errors.map((e, i) => (\n                      <div key={i} className={`p-3 rounded border ${e.severity === 'error' ? 'border-destructive bg-destructive/10' : 'border-yellow-500 bg-yellow-500/10'}`}>\n                        <div className=\"flex justify-between\">\n                          <span className=\"font-medium\">[{e.severity?.toUpperCase()}] {e.category}</span>\n                          <span className=\"text-xs text-muted-foreground\">{new Date(e.eventTime).toLocaleString()}</span>\n                        </div>\n                        <div className=\"text-sm mt-1\">{e.message}</div>\n                        {e.component && <div className=\"text-xs text-muted-foreground mt-1\">Component: {e.component}</div>}\n                        {e.currentScreen && <div className=\"text-xs text-muted-foreground\">Screen: {e.currentScreen}</div>}\n                      </div>\n                    ))}\n                    {errors.length === 0 && <div className=\"text-muted-foreground text-center py-8\">No errors logged</div>}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"settings\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Update Policy</CardTitle>\n                <CardDescription>Configure version requirements for the game</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"latestVersion\">Latest Version</Label>\n                    <Input \n                      id=\"latestVersion\"\n                      value={updatePolicy.latestVersion}\n                      onChange={e => setUpdatePolicy(p => ({ ...p, latestVersion: e.target.value }))}\n                      placeholder=\"1.3.0\"\n                      data-testid=\"input-latest-version\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"minVersion\">Min Supported Version</Label>\n                    <Input \n                      id=\"minVersion\"\n                      value={updatePolicy.minSupportedVersion}\n                      onChange={e => setUpdatePolicy(p => ({ ...p, minSupportedVersion: e.target.value }))}\n                      placeholder=\"1.0.0\"\n                      data-testid=\"input-min-version\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"downloadUrl\">Download URL</Label>\n                  <Input \n                    id=\"downloadUrl\"\n                    value={updatePolicy.downloadUrl}\n                    onChange={e => setUpdatePolicy(p => ({ ...p, downloadUrl: e.target.value }))}\n                    placeholder=\"/\"\n                    data-testid=\"input-download-url\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"releaseNotes\">Release Notes</Label>\n                  <Input \n                    id=\"releaseNotes\"\n                    value={updatePolicy.releaseNotes || ''}\n                    onChange={e => setUpdatePolicy(p => ({ ...p, releaseNotes: e.target.value }))}\n                    placeholder=\"What's new in this version...\"\n                    data-testid=\"input-release-notes\"\n                  />\n                </div>\n                <Button onClick={saveUpdatePolicy} data-testid=\"button-save-policy\">\n                  Save Update Policy\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16089,"size_tokens":null},"client/src/components/game/MutationChoice.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { AlertTriangle, Clock, Zap, Shield } from 'lucide-react';\nimport { useGameStore } from '../../lib/store';\n\nexport function MutationChoice() {\n  const { activeMutation, applyCountermeasure, timeRemaining } = useGameStore();\n\n  if (!activeMutation) return null;\n\n  const getSeverityColor = (severity: number) => {\n    switch (severity) {\n      case 1: return 'text-yellow-400 border-yellow-400';\n      case 2: return 'text-orange-400 border-orange-400';\n      case 3: return 'text-red-400 border-red-400';\n      default: return 'text-primary border-primary';\n    }\n  };\n\n  return (\n    <div className=\"absolute inset-0 bg-background/95 flex items-center justify-center z-50 scanlines\">\n      <motion.div \n        initial={{ scale: 0.8, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        className=\"w-full max-w-md p-6\"\n      >\n        <motion.div \n          initial={{ y: -20 }}\n          animate={{ y: 0 }}\n          className=\"text-center mb-6\"\n        >\n          <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border-2 ${getSeverityColor(activeMutation.severity)} bg-background`}>\n            <AlertTriangle className=\"animate-pulse\" size={24} />\n            <span className=\"font-display text-lg\">MUTATION DETECTED</span>\n          </div>\n        </motion.div>\n\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.2 }}\n          className=\"block-panel p-4 mb-6\"\n        >\n          <h2 \n            className=\"font-display text-xl mb-2\"\n            style={{\n              color: '#FF6AD5',\n              textShadow: '0 0 10px #FF6AD5'\n            }}\n          >\n            {activeMutation.name}\n          </h2>\n          <p className=\"font-ui text-foreground/80 mb-4\">\n            {activeMutation.description}\n          </p>\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <Clock size={16} />\n            <span>Time remaining: {timeRemaining.toFixed(0)}s</span>\n          </div>\n        </motion.div>\n\n        <div className=\"space-y-3\">\n          <p className=\"font-ui text-sm text-center text-muted-foreground mb-2\">\n            Choose your countermeasure:\n          </p>\n          \n          {activeMutation.countermeasures.map((countermeasure, index) => (\n            <motion.button\n              key={countermeasure.id}\n              initial={{ x: -30, opacity: 0 }}\n              animate={{ x: 0, opacity: 1 }}\n              transition={{ delay: 0.3 + index * 0.1 }}\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => applyCountermeasure(countermeasure.id, countermeasure.cost)}\n              className=\"w-full block-panel p-4 text-left hover:border-primary transition-all\"\n              data-testid={`countermeasure-${countermeasure.id}`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    {countermeasure.effect === 'nullify' && <Shield size={18} className=\"text-cyan-400\" />}\n                    {countermeasure.effect === 'reduce' && <Zap size={18} className=\"text-yellow-400\" />}\n                    {countermeasure.effect === 'reverse' && <Zap size={18} className=\"text-green-400\" />}\n                    <span className=\"font-display text-foreground\">{countermeasure.name}</span>\n                  </div>\n                  <p className=\"font-ui text-sm text-muted-foreground\">\n                    {countermeasure.description}\n                  </p>\n                </div>\n                <div className=\"flex items-center gap-1 text-destructive font-display\">\n                  <Clock size={14} />\n                  <span>-{countermeasure.cost}s</span>\n                </div>\n              </div>\n            </motion.button>\n          ))}\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4055,"size_tokens":null},"client/src/components/game/BacteriaCodex.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { ArrowLeft, Bug, AlertTriangle, Heart, Zap, Users } from 'lucide-react';\nimport { useGameStore } from '../../lib/store';\nimport { BACTERIA_DOSSIERS, BACTERIA_TEMPLATES } from '../../lib/game-constants';\n\nexport function BacteriaCodex() {\n  const { setGameState } = useGameStore();\n  const [selectedBacteria, setSelectedBacteria] = React.useState<string | null>(null);\n\n  const getDangerColor = (level: number) => {\n    switch (level) {\n      case 1: return 'text-green-400';\n      case 2: return 'text-yellow-400';\n      case 3: return 'text-orange-400';\n      case 4: return 'text-red-400';\n      case 5: return 'text-purple-400';\n      default: return 'text-muted-foreground';\n    }\n  };\n\n  const getDangerBg = (level: number) => {\n    switch (level) {\n      case 1: return 'bg-green-500/20 border-green-500/50';\n      case 2: return 'bg-yellow-500/20 border-yellow-500/50';\n      case 3: return 'bg-orange-500/20 border-orange-500/50';\n      case 4: return 'bg-red-500/20 border-red-500/50';\n      case 5: return 'bg-purple-500/20 border-purple-500/50';\n      default: return 'bg-muted border-border';\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background flex flex-col items-center p-4 scanlines crt-vignette scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n      \n      <div className=\"w-full max-w-2xl flex justify-between items-center mb-6 relative z-10 sticky top-0 bg-background/80 backdrop-blur-sm py-2\">\n        <motion.button \n          initial={{ x: -20, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          onClick={() => setGameState('MENU')}\n          className=\"block-panel p-2 hover:border-primary transition-colors\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"text-primary\" size={20} />\n        </motion.button>\n        <motion.div \n          initial={{ y: -20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          className=\"flex items-center gap-2\"\n        >\n          <Bug className=\"text-pink-400\" size={24} />\n          <h1 \n            className=\"text-xl font-display\"\n            style={{\n              color: '#FF6AD5',\n              textShadow: '0 0 10px #FF6AD5, 0 0 20px #FF6AD5'\n            }}\n          >\n            BACTERIA CODEX\n          </h1>\n        </motion.div>\n        <div className=\"w-10\" />\n      </div>\n\n      <motion.p \n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        className=\"text-center text-muted-foreground font-ui mb-6 max-w-lg relative z-10\"\n      >\n        Classified dossiers on all known Kikteria specimens\n      </motion.p>\n\n      {selectedBacteria === null ? (\n        <div className=\"w-full max-w-2xl grid grid-cols-2 gap-3 relative z-10 pb-4\">\n          {BACTERIA_DOSSIERS.map((dossier, index) => {\n            const template = BACTERIA_TEMPLATES.find(t => t.id === dossier.id);\n            const mainColor = template?.shapes[0]?.color || '#888';\n            \n            return (\n              <motion.button\n                key={dossier.id}\n                initial={{ scale: 0.9, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                transition={{ delay: index * 0.05 }}\n                whileHover={{ scale: 1.02 }}\n                onClick={() => setSelectedBacteria(dossier.id)}\n                className=\"block-panel p-4 text-left hover:border-pink-400 hover:shadow-[0_0_15px_rgba(255,106,213,0.3)] transition-all cursor-pointer\"\n                data-testid={`codex-${dossier.id}`}\n              >\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <div \n                    className=\"w-10 h-10 rounded-full flex items-center justify-center text-2xl\"\n                    style={{ \n                      backgroundColor: mainColor + '30',\n                      border: `2px solid ${mainColor}`,\n                      boxShadow: `0 0 10px ${mainColor}40`\n                    }}\n                  >\n                    ðŸ¦ \n                  </div>\n                  <div>\n                    <h3 className=\"font-display text-sm\" style={{ color: mainColor }}>\n                      {dossier.name}\n                    </h3>\n                    <p className=\"font-ui text-xs text-muted-foreground italic\">\n                      {dossier.classification}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-ui text-xs text-muted-foreground\">\n                    {dossier.personality.split(',')[0]}\n                  </span>\n                  <div className={`flex items-center gap-1 px-2 py-0.5 rounded text-xs ${getDangerBg(dossier.dangerLevel)}`}>\n                    <AlertTriangle size={12} className={getDangerColor(dossier.dangerLevel)} />\n                    <span className={getDangerColor(dossier.dangerLevel)}>LV.{dossier.dangerLevel}</span>\n                  </div>\n                </div>\n              </motion.button>\n            );\n          })}\n        </div>\n      ) : (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"w-full max-w-2xl relative z-10 pb-4\"\n        >\n          {(() => {\n            const dossier = BACTERIA_DOSSIERS.find(d => d.id === selectedBacteria);\n            const template = BACTERIA_TEMPLATES.find(t => t.id === selectedBacteria);\n            if (!dossier || !template) return null;\n            const mainColor = template.shapes[0]?.color || '#888';\n            \n            return (\n              <div \n                className=\"block-panel p-6 border-pink-500/30 shadow-[0_0_20px_rgba(255,106,213,0.2)]\"\n              >\n                <div className=\"flex items-start gap-4 mb-6\">\n                  <div \n                    className=\"w-16 h-16 rounded-full flex items-center justify-center text-4xl flex-shrink-0\"\n                    style={{ \n                      backgroundColor: mainColor + '30',\n                      border: `3px solid ${mainColor}`,\n                      boxShadow: `0 0 20px ${mainColor}50`\n                    }}\n                  >\n                    ðŸ¦ \n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <h2 className=\"font-display text-2xl\" style={{ color: mainColor, textShadow: `0 0 10px ${mainColor}50` }}>\n                        {dossier.name}\n                      </h2>\n                      <div className={`flex items-center gap-1 px-3 py-1 rounded border ${getDangerBg(dossier.dangerLevel)}`}>\n                        <AlertTriangle size={14} className={getDangerColor(dossier.dangerLevel)} />\n                        <span className={`font-display text-sm ${getDangerColor(dossier.dangerLevel)}`}>\n                          DANGER LV.{dossier.dangerLevel}\n                        </span>\n                      </div>\n                    </div>\n                    <p className=\"font-ui text-sm text-pink-400 italic mb-2\">{dossier.classification}</p>\n                    <p className=\"font-ui text-sm text-muted-foreground\">{dossier.personality}</p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <div className=\"bg-muted/50 rounded-lg p-4 border border-border\">\n                    <h3 className=\"font-display text-xs text-pink-400 mb-2 flex items-center gap-2\">\n                      <Bug size={14} /> BACKSTORY\n                    </h3>\n                    <p className=\"font-ui text-sm text-foreground leading-relaxed\">\n                      {dossier.backstory}\n                    </p>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div className=\"bg-muted/50 rounded-lg p-3 border border-border\">\n                      <h3 className=\"font-display text-xs text-yellow-400 mb-1 flex items-center gap-2\">\n                        <Zap size={12} /> QUIRK\n                      </h3>\n                      <p className=\"font-ui text-xs text-foreground\">{dossier.quirk}</p>\n                    </div>\n                    <div className=\"bg-muted/50 rounded-lg p-3 border border-border\">\n                      <h3 className=\"font-display text-xs text-red-400 mb-1 flex items-center gap-2\">\n                        <Users size={12} /> RIVAL\n                      </h3>\n                      <p className=\"font-ui text-xs text-foreground\">{dossier.rival}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"bg-muted/50 rounded-lg p-3 border border-border\">\n                    <h3 className=\"font-display text-xs text-green-400 mb-1 flex items-center gap-2\">\n                      <Heart size={12} /> FAVORITE ACTIVITY\n                    </h3>\n                    <p className=\"font-ui text-xs text-foreground\">{dossier.favoriteActivity}</p>\n                  </div>\n                </div>\n                \n                <div className=\"flex gap-3 mt-6\">\n                  <button\n                    onClick={() => setSelectedBacteria(null)}\n                    className=\"flex-1 py-3 block-panel font-display text-sm hover:border-primary transition-colors\"\n                    data-testid=\"button-back-to-list\"\n                  >\n                    BACK TO CODEX\n                  </button>\n                  {(() => {\n                    const currentIndex = BACTERIA_DOSSIERS.findIndex(d => d.id === selectedBacteria);\n                    const nextDossier = BACTERIA_DOSSIERS[currentIndex + 1];\n                    if (nextDossier) {\n                      return (\n                        <button\n                          onClick={() => setSelectedBacteria(nextDossier.id)}\n                          className=\"flex-1 py-3 pixel-btn font-display text-sm\"\n                          data-testid=\"button-next-entry\"\n                        >\n                          NEXT ENTRY â†’\n                        </button>\n                      );\n                    }\n                    return null;\n                  })()}\n                </div>\n              </div>\n            );\n          })()}\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":10430,"size_tokens":null},"client/src/components/game/LabChronicles.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { ArrowLeft, Lock, BookOpen, FileText } from 'lucide-react';\nimport { useGameStore } from '../../lib/store';\nimport { LAB_CHRONICLES } from '../../lib/game-constants';\n\nexport function LabChronicles() {\n  const { setGameState, maxUnlockedLevel } = useGameStore();\n  const [selectedLog, setSelectedLog] = React.useState<number | null>(null);\n\n  const unlockedChronicles = LAB_CHRONICLES.filter(c => c.level <= maxUnlockedLevel);\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background flex flex-col items-center p-4 scanlines crt-vignette scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n      \n      <div className=\"w-full max-w-2xl flex justify-between items-center mb-6 relative z-10 sticky top-0 bg-background/80 backdrop-blur-sm py-2\">\n        <motion.button \n          initial={{ x: -20, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          onClick={() => setGameState('MENU')}\n          className=\"block-panel p-2 hover:border-primary transition-colors\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"text-primary\" size={20} />\n        </motion.button>\n        <motion.div \n          initial={{ y: -20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          className=\"flex items-center gap-2\"\n        >\n          <BookOpen className=\"text-cyan-400\" size={24} />\n          <h1 \n            className=\"text-xl font-display\"\n            style={{\n              color: '#22F2A2',\n              textShadow: '0 0 10px #22F2A2, 0 0 20px #22F2A2'\n            }}\n          >\n            LAB CHRONICLES\n          </h1>\n        </motion.div>\n        <div className=\"w-10\" />\n      </div>\n\n      <motion.p \n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        className=\"text-center text-muted-foreground font-ui mb-6 max-w-lg relative z-10\"\n      >\n        Classified holo-logs from Dr. Lyra Voss documenting the Kikteria containment effort\n      </motion.p>\n\n      {selectedLog === null ? (\n        <div className=\"w-full max-w-2xl grid grid-cols-1 gap-3 relative z-10 pb-4\">\n          {LAB_CHRONICLES.map((chronicle, index) => {\n            const isUnlocked = chronicle.level <= maxUnlockedLevel;\n            \n            return (\n              <motion.button\n                key={chronicle.level}\n                initial={{ x: -30, opacity: 0 }}\n                animate={{ x: 0, opacity: 1 }}\n                transition={{ delay: index * 0.05 }}\n                whileHover={isUnlocked ? { scale: 1.01 } : {}}\n                onClick={() => isUnlocked && setSelectedLog(chronicle.level)}\n                disabled={!isUnlocked}\n                className={`block-panel p-4 text-left relative overflow-hidden transition-all\n                  ${isUnlocked \n                    ? 'hover:border-cyan-400 hover:shadow-[0_0_15px_rgba(6,182,212,0.3)] cursor-pointer' \n                    : 'opacity-50 cursor-not-allowed'\n                  }`}\n                data-testid={`chronicle-${chronicle.level}`}\n              >\n                <div className=\"flex items-center gap-4\">\n                  <div \n                    className={`w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0\n                      ${isUnlocked ? 'bg-cyan-500/20 border border-cyan-500/50' : 'bg-muted border border-border'}`}\n                    style={isUnlocked ? { boxShadow: '0 0 15px rgba(6,182,212,0.3)' } : {}}\n                  >\n                    {isUnlocked ? (\n                      <FileText size={24} className=\"text-cyan-400\" />\n                    ) : (\n                      <Lock size={24} className=\"text-muted-foreground\" />\n                    )}\n                  </div>\n                  \n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex justify-between items-center mb-1\">\n                      <h3 className=\"font-display text-sm text-foreground\">\n                        {isUnlocked ? chronicle.title : '???'}\n                      </h3>\n                      <span className=\"font-ui text-xs text-muted-foreground\">\n                        LOG #{chronicle.level}\n                      </span>\n                    </div>\n                    <p className=\"font-ui text-sm text-muted-foreground\">\n                      {isUnlocked ? chronicle.date : 'Complete level to unlock'}\n                    </p>\n                  </div>\n                </div>\n              </motion.button>\n            );\n          })}\n        </div>\n      ) : (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"w-full max-w-2xl relative z-10 pb-4\"\n        >\n          {(() => {\n            const chronicle = LAB_CHRONICLES.find(c => c.level === selectedLog);\n            if (!chronicle) return null;\n            \n            return (\n              <div className=\"block-panel p-6 border-cyan-500/30 shadow-[0_0_20px_rgba(6,182,212,0.2)]\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-cyan-500/20 border border-cyan-500/50 flex items-center justify-center\">\n                      <FileText size={20} className=\"text-cyan-400\" />\n                    </div>\n                    <div>\n                      <h2 className=\"font-display text-lg text-cyan-400\" style={{ textShadow: '0 0 10px rgba(6,182,212,0.5)' }}>\n                        {chronicle.title}\n                      </h2>\n                      <p className=\"font-ui text-xs text-muted-foreground\">{chronicle.date}</p>\n                    </div>\n                  </div>\n                  <span className=\"font-display text-xs text-muted-foreground bg-muted px-2 py-1 rounded\">\n                    LOG #{chronicle.level}\n                  </span>\n                </div>\n                \n                <div className=\"bg-muted/50 rounded-lg p-4 mb-4 border border-border\">\n                  <p className=\"font-ui text-sm text-foreground leading-relaxed whitespace-pre-line\">\n                    {chronicle.content}\n                  </p>\n                </div>\n                \n                <p className=\"font-ui text-xs text-cyan-400 italic text-right\">\n                  â€” {chronicle.signature}\n                </p>\n                \n                <div className=\"flex gap-3 mt-6\">\n                  <button\n                    onClick={() => setSelectedLog(null)}\n                    className=\"flex-1 py-3 block-panel font-display text-sm hover:border-primary transition-colors\"\n                    data-testid=\"button-back-to-list\"\n                  >\n                    BACK TO LOGS\n                  </button>\n                  {selectedLog < LAB_CHRONICLES.length && selectedLog < maxUnlockedLevel && (\n                    <button\n                      onClick={() => setSelectedLog(selectedLog + 1)}\n                      className=\"flex-1 py-3 pixel-btn font-display text-sm\"\n                      data-testid=\"button-next-log\"\n                    >\n                      NEXT LOG â†’\n                    </button>\n                  )}\n                </div>\n              </div>\n            );\n          })()}\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":7401,"size_tokens":null},"client/src/components/game/DailyLabOrders.tsx":{"content":"import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Calendar, Clock, Target, Coins, Check, Play } from 'lucide-react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useAuth } from '../../hooks/use-auth';\nimport { useGameStore } from '../../lib/store';\nimport { offlineStorage } from '../../lib/offline-storage';\n\ninterface DailyOrder {\n  id: string;\n  orderDate: string;\n  title: string;\n  description: string;\n  difficulty: 'easy' | 'medium' | 'hard';\n  targetScore: number;\n  coinReward: number;\n  modifiers?: string;\n}\n\ninterface DailyOrderResponse {\n  order: DailyOrder;\n  completion: { scoreAchieved: number } | null;\n  isCompleted: boolean;\n}\n\nconst difficultyColors = {\n  easy: 'text-green-400 border-green-400',\n  medium: 'text-yellow-400 border-yellow-400',\n  hard: 'text-red-400 border-red-400',\n};\n\nconst difficultyLabels = {\n  easy: 'EASY',\n  medium: 'MEDIUM',\n  hard: 'HARD',\n};\n\nexport function DailyLabOrders({ open, onClose }: { open: boolean; onClose: () => void }) {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const { selectLevel, initializeGame, startTimer, setGameState } = useGameStore();\n  \n  const { data, isLoading } = useQuery<DailyOrderResponse>({\n    queryKey: ['daily-order'],\n    queryFn: async () => {\n      const res = await fetch('/api/daily-order', { credentials: 'include' });\n      if (!res.ok) throw new Error('Failed to fetch daily order');\n      return res.json();\n    },\n    enabled: open,\n  });\n\n  const getTimeUntilReset = () => {\n    const now = new Date();\n    const tomorrow = new Date(now);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    tomorrow.setHours(0, 0, 0, 0);\n    const diff = tomorrow.getTime() - now.getTime();\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    return `${hours}h ${minutes}m`;\n  };\n\n  const handleStartDaily = () => {\n    if (!data?.order) return;\n    \n    selectLevel(1);\n    initializeGame();\n    startTimer();\n    setGameState('PLAYING');\n    offlineStorage.trackLevelPlay(1);\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ scale: 0.9, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.9, opacity: 0 }}\n            className=\"block-panel w-full max-w-md p-6 relative\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button\n              onClick={onClose}\n              className=\"absolute top-4 right-4 text-muted-foreground hover:text-foreground\"\n              data-testid=\"button-close-daily\"\n            >\n              <X size={24} />\n            </button>\n\n            <div className=\"flex items-center gap-3 mb-6\">\n              <Calendar className=\"text-primary\" size={28} />\n              <h2 className=\"font-display text-2xl text-primary\">DAILY LAB ORDER</h2>\n            </div>\n\n            {isLoading && user ? (\n              <div className=\"text-center py-8\">\n                <p className=\"font-ui text-lg text-muted-foreground\">Loading...</p>\n              </div>\n            ) : data?.order ? (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className={`px-3 py-1 border rounded font-ui text-sm ${difficultyColors[data.order.difficulty]}`}>\n                    {difficultyLabels[data.order.difficulty]}\n                  </span>\n                  <div className=\"flex items-center gap-2 text-muted-foreground\">\n                    <Clock size={16} />\n                    <span className=\"font-ui text-sm\">Resets in {getTimeUntilReset()}</span>\n                  </div>\n                </div>\n\n                <div className=\"bg-background/50 rounded-lg p-4 border border-primary/20\">\n                  <h3 className=\"font-display text-xl text-secondary mb-2\">{data.order.title}</h3>\n                  <p className=\"font-ui text-base text-foreground/80\">{data.order.description}</p>\n                </div>\n\n                <div className=\"flex items-center justify-between bg-background/30 rounded-lg p-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Target size={18} className=\"text-accent\" />\n                    <span className=\"font-ui text-base\">Target Score:</span>\n                  </div>\n                  <span className=\"font-display text-xl text-accent\">{data.order.targetScore}</span>\n                </div>\n\n                <div className=\"flex items-center justify-between bg-background/30 rounded-lg p-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Coins size={18} className=\"text-yellow-400\" />\n                    <span className=\"font-ui text-base\">Reward:</span>\n                  </div>\n                  <span className=\"font-display text-xl text-yellow-400\">{data.order.coinReward} G</span>\n                </div>\n\n                {data.isCompleted ? (\n                  <div className=\"flex items-center justify-center gap-3 py-4 bg-green-400/20 rounded-lg border border-green-400/50\">\n                    <Check size={24} className=\"text-green-400\" />\n                    <span className=\"font-display text-lg text-green-400\">COMPLETED TODAY!</span>\n                  </div>\n                ) : (\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={handleStartDaily}\n                    className=\"w-full py-4 pixel-btn flex items-center justify-center gap-3\"\n                    data-testid=\"button-start-daily\"\n                  >\n                    <Play size={20} />\n                    <span>START DAILY ORDER</span>\n                  </motion.button>\n                )}\n\n                {!user && (\n                  <p className=\"text-center font-ui text-sm text-muted-foreground\">\n                    Sign in to track your daily progress and earn rewards!\n                  </p>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"font-ui text-lg text-muted-foreground\">No daily order available</p>\n              </div>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":6681,"size_tokens":null},"client/src/lib/engagement-service.ts":{"content":"import { communityGoalAPI, achievementsAPI } from './api';\n\nexport interface UnlockedAchievement {\n  id: string;\n  name: string;\n  description: string;\n  badgeIcon: string;\n  coinReward: number;\n  tier: number;\n}\n\ntype AchievementCallback = (achievement: UnlockedAchievement) => void;\n\nclass EngagementService {\n  private totalPlacements = 0;\n  private totalCoinsEarned = 0;\n  private highestLevel = 0;\n  private dailyOrdersCompleted = 0;\n  private endlessBestWave = 0;\n  private bombsUsed = 0;\n  private pendingContributions = 0;\n  private contributionTimer: number | null = null;\n  private saveTimer: number | null = null;\n  private isDirty = false;\n  private isAuthenticated = false;\n  private currentUserId: string | null = null;\n  private achievementCallbacks: AchievementCallback[] = [];\n  private celebratedAchievements: Set<string> = new Set();\n\n  initialize() {\n    const saved = localStorage.getItem('engagement_stats');\n    if (saved) {\n      try {\n        const stats = JSON.parse(saved);\n        this.totalPlacements = stats.totalPlacements || 0;\n        this.totalCoinsEarned = stats.totalCoinsEarned || 0;\n        this.highestLevel = stats.highestLevel || 0;\n        this.dailyOrdersCompleted = stats.dailyOrdersCompleted || 0;\n        this.endlessBestWave = stats.endlessBestWave || 0;\n        this.bombsUsed = stats.bombsUsed || 0;\n      } catch {\n        // Reset to defaults on parse error\n      }\n    }\n  }\n\n  private getCelebratedCacheKey(): string {\n    return this.currentUserId ? `celebrated_achievements_${this.currentUserId}` : 'celebrated_achievements';\n  }\n\n  private loadCelebratedCache() {\n    this.celebratedAchievements = new Set();\n    const cacheKey = this.getCelebratedCacheKey();\n    const celebratedCache = localStorage.getItem(cacheKey);\n    if (celebratedCache) {\n      try {\n        const ids = JSON.parse(celebratedCache);\n        this.celebratedAchievements = new Set(ids);\n      } catch {\n        // Reset to empty set on parse error\n      }\n    }\n  }\n\n  private saveCelebratedCache() {\n    const cacheKey = this.getCelebratedCacheKey();\n    localStorage.setItem(cacheKey, JSON.stringify([...this.celebratedAchievements]));\n  }\n\n  setAuthenticated(authenticated: boolean, userId?: string) {\n    const userChanged = userId !== this.currentUserId;\n    this.isAuthenticated = authenticated;\n    this.currentUserId = userId || null;\n    \n    if (userChanged) {\n      this.loadCelebratedCache();\n    }\n    \n    if (!authenticated) {\n      this.currentUserId = null;\n      this.celebratedAchievements = new Set();\n    }\n  }\n\n  onAchievementUnlocked(callback: AchievementCallback) {\n    this.achievementCallbacks.push(callback);\n    return () => {\n      this.achievementCallbacks = this.achievementCallbacks.filter(cb => cb !== callback);\n    };\n  }\n\n  private notifyAchievementUnlocked(achievement: UnlockedAchievement) {\n    if (this.celebratedAchievements.has(achievement.id)) {\n      return;\n    }\n    this.celebratedAchievements.add(achievement.id);\n    this.saveCelebratedCache();\n    this.achievementCallbacks.forEach(cb => cb(achievement));\n  }\n\n  private saveStats() {\n    this.isDirty = true;\n    \n    // Throttle localStorage writes to once per second max\n    if (!this.saveTimer) {\n      this.saveTimer = window.setTimeout(() => {\n        this.flushSave();\n      }, 1000);\n    }\n  }\n\n  private flushSave() {\n    if (this.saveTimer) {\n      clearTimeout(this.saveTimer);\n      this.saveTimer = null;\n    }\n    \n    if (this.isDirty) {\n      this.isDirty = false;\n      localStorage.setItem('engagement_stats', JSON.stringify({\n        totalPlacements: this.totalPlacements,\n        totalCoinsEarned: this.totalCoinsEarned,\n        highestLevel: this.highestLevel,\n        dailyOrdersCompleted: this.dailyOrdersCompleted,\n        endlessBestWave: this.endlessBestWave,\n        bombsUsed: this.bombsUsed,\n      }));\n    }\n  }\n\n  recordPlacement() {\n    this.totalPlacements++;\n    this.saveStats();\n    \n    // Only batch contributions if authenticated and online\n    if (!this.isAuthenticated || !navigator.onLine) return;\n    \n    this.pendingContributions++;\n    \n    if (this.pendingContributions >= 10) {\n      this.flushContributions();\n    } else if (!this.contributionTimer) {\n      this.contributionTimer = window.setTimeout(() => {\n        // Re-check online status when timer fires\n        if (navigator.onLine && this.isAuthenticated) {\n          this.flushContributions();\n        }\n      }, 5000);\n    }\n  }\n\n  private async flushContributions() {\n    if (this.contributionTimer) {\n      clearTimeout(this.contributionTimer);\n      this.contributionTimer = null;\n    }\n    \n    if (this.pendingContributions > 0 && this.isAuthenticated && navigator.onLine) {\n      const amount = this.pendingContributions;\n      this.pendingContributions = 0;\n      try {\n        await communityGoalAPI.contribute(amount);\n      } catch (e) {\n        // Silently fail - contributions are best-effort\n      }\n    }\n  }\n\n  async recordLevelComplete(levelNumber: number, _score: number) {\n    if (levelNumber > this.highestLevel) {\n      this.highestLevel = levelNumber;\n    }\n    this.saveStats();\n    this.flushSave(); // Important event - save immediately\n    \n    // Flush any pending contributions if authenticated and online\n    if (this.isAuthenticated && navigator.onLine) {\n      await this.flushContributions();\n      await this.syncAchievements();\n    }\n  }\n\n  async recordCoinsEarned(amount: number) {\n    this.totalCoinsEarned += amount;\n    this.saveStats();\n    this.flushSave(); // High-value event - save immediately\n    if (this.isAuthenticated && navigator.onLine) {\n      await this.syncAchievements();\n    }\n  }\n\n  async recordEndlessWave(wave: number) {\n    if (wave > this.endlessBestWave) {\n      this.endlessBestWave = wave;\n      this.saveStats();\n      this.flushSave(); // High-value event - save immediately\n      if (this.isAuthenticated && navigator.onLine) {\n        await this.syncAchievements();\n      }\n    }\n  }\n\n  async recordBombUsed() {\n    this.bombsUsed++;\n    this.saveStats();\n    this.flushSave(); // High-value event - save immediately\n    if (this.isAuthenticated && navigator.onLine) {\n      await this.syncAchievements();\n    }\n  }\n\n  async recordDailyOrderComplete() {\n    this.dailyOrdersCompleted++;\n    this.saveStats();\n    this.flushSave(); // High-value event - save immediately\n    if (this.isAuthenticated && navigator.onLine) {\n      await this.syncAchievements();\n    }\n  }\n\n  getStats() {\n    return {\n      totalPlacements: this.totalPlacements,\n      totalCoinsEarned: this.totalCoinsEarned,\n      highestLevel: this.highestLevel,\n      dailyOrdersCompleted: this.dailyOrdersCompleted,\n      endlessBestWave: this.endlessBestWave,\n      bombsUsed: this.bombsUsed,\n    };\n  }\n\n  private async syncAchievements() {\n    if (!this.isAuthenticated || !navigator.onLine) return;\n    \n    const stats = this.getStats();\n    const achievementMappings = [\n      { id: 'first_placement', key: 'totalPlacements' },\n      { id: 'placements_100', key: 'totalPlacements' },\n      { id: 'placements_500', key: 'totalPlacements' },\n      { id: 'placements_2000', key: 'totalPlacements' },\n      { id: 'score_1000', key: 'totalCoinsEarned' },\n      { id: 'score_5000', key: 'totalCoinsEarned' },\n      { id: 'score_20000', key: 'totalCoinsEarned' },\n      { id: 'level_1', key: 'highestLevel' },\n      { id: 'level_3', key: 'highestLevel' },\n      { id: 'level_5', key: 'highestLevel' },\n      { id: 'level_7', key: 'highestLevel' },\n      { id: 'daily_1', key: 'dailyOrdersCompleted' },\n      { id: 'daily_7', key: 'dailyOrdersCompleted' },\n      { id: 'daily_30', key: 'dailyOrdersCompleted' },\n      { id: 'endless_10', key: 'endlessBestWave' },\n      { id: 'endless_25', key: 'endlessBestWave' },\n      { id: 'bomb_master', key: 'bombsUsed' },\n    ];\n\n    for (const mapping of achievementMappings) {\n      if (this.celebratedAchievements.has(mapping.id)) {\n        continue;\n      }\n      \n      const value = stats[mapping.key as keyof typeof stats];\n      if (value > 0) {\n        try {\n          const result = await achievementsAPI.updateProgress(mapping.id, value);\n          if (result.newlyUnlocked && result.achievementDetails) {\n            this.notifyAchievementUnlocked({\n              id: result.achievementDetails.id,\n              name: result.achievementDetails.name,\n              description: result.achievementDetails.description,\n              badgeIcon: result.achievementDetails.badgeIcon,\n              coinReward: result.achievementDetails.coinReward,\n              tier: result.achievementDetails.tier,\n            });\n          }\n        } catch (e) {\n          // Silently fail\n        }\n      }\n    }\n  }\n}\n\nexport const engagementService = new EngagementService();\nengagementService.initialize();\n","path":null,"size_bytes":8815,"size_tokens":null},"client/src/components/game/LevelMastery.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { Check, X } from 'lucide-react';\nimport { MASTERY_GOALS, LevelCompletionStats } from '../../lib/game-constants';\n\ninterface LevelMasteryProps {\n  stats: LevelCompletionStats;\n  levelNumber: number;\n}\n\nexport function LevelMastery({ stats, levelNumber }: LevelMasteryProps) {\n  return (\n    <motion.div \n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: 0.3 }}\n      className=\"w-full max-w-sm mt-4\"\n    >\n      <h3 className=\"font-display text-sm text-muted-foreground mb-2 text-center\">\n        MASTERY GOALS\n      </h3>\n      <div className=\"grid grid-cols-2 gap-2\">\n        {MASTERY_GOALS.map((goal, index) => {\n          const achieved = goal.check(stats);\n          \n          return (\n            <motion.div\n              key={goal.id}\n              initial={{ scale: 0.9, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              transition={{ delay: 0.4 + index * 0.1 }}\n              className={`block-panel p-2 flex items-center gap-2 ${\n                achieved \n                  ? 'border-secondary shadow-[0_0_10px_rgba(249,233,0,0.3)]' \n                  : 'opacity-60'\n              }`}\n            >\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                achieved ? 'bg-secondary/20' : 'bg-muted'\n              }`}>\n                {achieved ? (\n                  <span className=\"text-lg\">{goal.icon}</span>\n                ) : (\n                  <X size={16} className=\"text-muted-foreground\" />\n                )}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className={`font-display text-xs ${achieved ? 'text-secondary' : 'text-muted-foreground'}`}>\n                  {goal.name}\n                </div>\n                <div className=\"font-ui text-xs text-muted-foreground truncate\">\n                  {goal.description}\n                </div>\n              </div>\n              {achieved && (\n                <Check size={14} className=\"text-secondary flex-shrink-0\" />\n              )}\n            </motion.div>\n          );\n        })}\n      </div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":2240,"size_tokens":null},"client/src/components/game/AchievementBoard.tsx":{"content":"import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Award, Lock, Check, Coins, Star } from 'lucide-react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useAuth } from '../../hooks/use-auth';\nimport { ACHIEVEMENTS, AchievementDef } from '../../lib/game-constants';\n\ninterface UserProgress {\n  achievementId: string;\n  currentProgress: number;\n  isUnlocked: number;\n  isClaimed: number;\n}\n\nconst tierColors = {\n  1: { bg: 'from-amber-700 to-amber-600', border: 'border-amber-500', text: 'text-amber-400', label: 'BRONZE' },\n  2: { bg: 'from-gray-400 to-gray-300', border: 'border-gray-300', text: 'text-gray-300', label: 'SILVER' },\n  3: { bg: 'from-yellow-500 to-yellow-400', border: 'border-yellow-400', text: 'text-yellow-400', label: 'GOLD' },\n};\n\nconst categoryLabels = {\n  mastery: 'Mastery',\n  collection: 'Collection',\n  social: 'Social',\n  challenge: 'Challenge',\n};\n\nexport function AchievementBoard({ open, onClose }: { open: boolean; onClose: () => void }) {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n\n  const { data: userProgress = [], isLoading } = useQuery<UserProgress[]>({\n    queryKey: ['achievement-progress'],\n    queryFn: async () => {\n      const res = await fetch('/api/achievements/progress', { credentials: 'include' });\n      if (!res.ok) return [];\n      return res.json();\n    },\n    enabled: open && !!user,\n  });\n\n  const claimMutation = useMutation({\n    mutationFn: async (achievementId: string) => {\n      const res = await fetch('/api/achievements/claim', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ achievementId }),\n      });\n      if (!res.ok) throw new Error('Failed to claim');\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['achievement-progress'] });\n      queryClient.invalidateQueries({ queryKey: ['profile'] });\n    },\n  });\n\n  const getProgressForAchievement = (id: string) => {\n    return userProgress.find(p => p.achievementId === id);\n  };\n\n  const categories = Array.from(new Set(ACHIEVEMENTS.map(a => a.category)));\n  const filteredAchievements = selectedCategory \n    ? ACHIEVEMENTS.filter(a => a.category === selectedCategory)\n    : ACHIEVEMENTS;\n\n  const unlockedCount = userProgress.filter(p => p.isUnlocked).length;\n  const totalCount = ACHIEVEMENTS.length;\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ scale: 0.9, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.9, opacity: 0 }}\n            className=\"block-panel w-full max-w-lg max-h-[80vh] overflow-hidden flex flex-col relative\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"p-6 border-b border-primary/20\">\n              <button\n                onClick={onClose}\n                className=\"absolute top-4 right-4 text-muted-foreground hover:text-foreground\"\n                data-testid=\"button-close-achievements\"\n              >\n                <X size={24} />\n              </button>\n\n              <div className=\"flex items-center gap-3 mb-4\">\n                <Award className=\"text-yellow-400\" size={28} />\n                <h2 className=\"font-display text-2xl text-yellow-400\">ACHIEVEMENT BOARD</h2>\n              </div>\n\n              <div className=\"flex items-center justify-between mb-4\">\n                <span className=\"font-ui text-sm text-muted-foreground\">\n                  Progress: {unlockedCount} / {totalCount} unlocked\n                </span>\n                <div className=\"h-2 w-32 bg-background/50 rounded-full overflow-hidden\">\n                  <div \n                    className=\"h-full bg-yellow-400\"\n                    style={{ width: `${(unlockedCount / totalCount) * 100}%` }}\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-2 flex-wrap\">\n                <button\n                  onClick={() => setSelectedCategory(null)}\n                  className={`px-3 py-1 rounded font-ui text-sm transition-colors ${\n                    selectedCategory === null \n                      ? 'bg-primary text-background' \n                      : 'bg-background/30 text-muted-foreground hover:text-foreground'\n                  }`}\n                  data-testid=\"button-filter-all\"\n                >\n                  All\n                </button>\n                {categories.map(cat => (\n                  <button\n                    key={cat}\n                    onClick={() => setSelectedCategory(cat)}\n                    className={`px-3 py-1 rounded font-ui text-sm transition-colors ${\n                      selectedCategory === cat \n                        ? 'bg-primary text-background' \n                        : 'bg-background/30 text-muted-foreground hover:text-foreground'\n                    }`}\n                    data-testid={`button-filter-${cat}`}\n                  >\n                    {categoryLabels[cat as keyof typeof categoryLabels]}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n              {!user ? (\n                <div className=\"text-center py-8\">\n                  <Lock size={48} className=\"mx-auto text-muted-foreground mb-4\" />\n                  <p className=\"font-ui text-lg text-muted-foreground\">Sign in to track achievements!</p>\n                </div>\n              ) : isLoading ? (\n                <div className=\"text-center py-8\">\n                  <p className=\"font-ui text-lg text-muted-foreground\">Loading...</p>\n                </div>\n              ) : (\n                filteredAchievements.map((achievement) => {\n                  const progress = getProgressForAchievement(achievement.id);\n                  const isUnlocked = progress?.isUnlocked === 1;\n                  const isClaimed = progress?.isClaimed === 1;\n                  const currentProgress = progress?.currentProgress || 0;\n                  const progressPercent = Math.min(100, (currentProgress / achievement.requirement) * 100);\n                  const tier = tierColors[achievement.tier as 1 | 2 | 3];\n\n                  return (\n                    <motion.div\n                      key={achievement.id}\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className={`p-4 rounded-lg border ${\n                        isUnlocked \n                          ? isClaimed \n                            ? 'bg-background/30 border-green-400/30' \n                            : 'bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border-yellow-400/50'\n                          : 'bg-background/20 border-muted-foreground/20'\n                      }`}\n                      data-testid={`achievement-${achievement.id}`}\n                    >\n                      <div className=\"flex items-start gap-3\">\n                        <div className={`text-3xl ${isUnlocked ? '' : 'grayscale opacity-50'}`}>\n                          {achievement.badgeIcon}\n                        </div>\n                        \n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <span className={`font-display text-lg ${isUnlocked ? tier.text : 'text-muted-foreground'}`}>\n                              {achievement.name}\n                            </span>\n                            <span className={`px-2 py-0.5 rounded text-xs font-ui ${tier.border} border bg-background/30 ${tier.text}`}>\n                              {tier.label}\n                            </span>\n                          </div>\n                          \n                          <p className=\"font-ui text-sm text-foreground/70 mb-2\">{achievement.description}</p>\n                          \n                          {!isUnlocked && (\n                            <div className=\"space-y-1\">\n                              <div className=\"h-2 bg-background/50 rounded-full overflow-hidden\">\n                                <div \n                                  className=\"h-full bg-primary/50\"\n                                  style={{ width: `${progressPercent}%` }}\n                                />\n                              </div>\n                              <span className=\"font-ui text-xs text-muted-foreground\">\n                                {currentProgress} / {achievement.requirement}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n\n                        <div className=\"flex flex-col items-end gap-2\">\n                          <div className=\"flex items-center gap-1 text-yellow-400\">\n                            <Coins size={14} />\n                            <span className=\"font-ui text-sm\">{achievement.coinReward}</span>\n                          </div>\n                          \n                          {isUnlocked && !isClaimed && (\n                            <motion.button\n                              whileHover={{ scale: 1.05 }}\n                              whileTap={{ scale: 0.95 }}\n                              onClick={() => claimMutation.mutate(achievement.id)}\n                              disabled={claimMutation.isPending}\n                              className=\"px-3 py-1 pixel-btn text-xs\"\n                              data-testid={`button-claim-${achievement.id}`}\n                            >\n                              CLAIM\n                            </motion.button>\n                          )}\n                          \n                          {isClaimed && (\n                            <div className=\"flex items-center gap-1 text-green-400\">\n                              <Check size={16} />\n                              <span className=\"font-ui text-xs\">CLAIMED</span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </motion.div>\n                  );\n                })\n              )}\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":10765,"size_tokens":null},"client/src/components/game/EndlessMode.tsx":{"content":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { ArrowLeft, Play, Infinity, Trophy, Zap, Skull } from 'lucide-react';\nimport { useGameStore } from '../../lib/store';\nimport { BOSS_BACTERIA } from '../../lib/game-constants';\n\nexport function EndlessMode() {\n  const { setGameState, startEndlessMode, endlessHighScore, endlessBestWave, coins } = useGameStore();\n\n  return (\n    <div className=\"min-h-screen overflow-y-auto bg-background flex flex-col items-center p-4 scanlines crt-vignette scrollable-screen\">\n      <div className=\"fixed inset-0 grid-bg opacity-50 pointer-events-none\" />\n      \n      <div className=\"w-full max-w-lg flex justify-between items-center mb-6 relative z-10\">\n        <motion.button \n          initial={{ x: -20, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          onClick={() => setGameState('MENU')}\n          className=\"block-panel p-2 hover:border-primary transition-colors\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"text-primary\" size={20} />\n        </motion.button>\n        <motion.div \n          initial={{ y: -20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          className=\"flex items-center gap-2\"\n        >\n          <Infinity className=\"text-purple-400\" size={28} />\n          <h1 \n            className=\"text-xl font-display\"\n            style={{\n              color: '#A855F7',\n              textShadow: '0 0 10px #A855F7, 0 0 20px #A855F7'\n            }}\n          >\n            CONTAINMENT NEXUS\n          </h1>\n        </motion.div>\n        <div className=\"w-10\" />\n      </div>\n\n      <motion.div \n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        className=\"text-center mb-6 relative z-10\"\n      >\n        <p className=\"font-ui text-muted-foreground max-w-md\">\n          Survive endless waves of mutating bacteria. How long can you maintain containment?\n        </p>\n      </motion.div>\n\n      <motion.div \n        initial={{ scale: 0.9, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        transition={{ delay: 0.2 }}\n        className=\"block-panel p-6 mb-6 w-full max-w-md relative z-10\"\n      >\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <Trophy className=\"text-secondary\" size={20} />\n            <span className=\"font-ui text-muted-foreground\">Best Wave:</span>\n          </div>\n          <span className=\"font-display text-xl text-secondary\">{endlessBestWave}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Zap className=\"text-primary\" size={20} />\n            <span className=\"font-ui text-muted-foreground\">High Score:</span>\n          </div>\n          <span className=\"font-display text-xl text-primary\">{endlessHighScore}</span>\n        </div>\n      </motion.div>\n\n      <motion.div \n        initial={{ y: 20, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.3 }}\n        className=\"w-full max-w-md mb-6 relative z-10\"\n      >\n        <h3 className=\"font-display text-sm text-muted-foreground mb-3 flex items-center gap-2\">\n          <Skull size={16} className=\"text-red-400\" />\n          BOSS ENCOUNTERS\n        </h3>\n        <div className=\"space-y-2\">\n          {BOSS_BACTERIA.map((boss, index) => (\n            <motion.div\n              key={boss.id}\n              initial={{ x: -20, opacity: 0 }}\n              animate={{ x: 0, opacity: 1 }}\n              transition={{ delay: 0.4 + index * 0.1 }}\n              className=\"block-panel p-3 flex items-center gap-3\"\n            >\n              <div className=\"w-10 h-10 rounded-full bg-red-500/20 border-2 border-red-500/50 flex items-center justify-center\">\n                <span className=\"text-lg\">ðŸ‘¹</span>\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"font-display text-sm text-red-400\">{boss.name}</div>\n                <div className=\"font-ui text-xs text-muted-foreground\">{boss.title}</div>\n              </div>\n              <div className=\"text-xs text-muted-foreground\">Wave {(index + 1) * 5}+</div>\n            </motion.div>\n          ))}\n        </div>\n      </motion.div>\n\n      <motion.button\n        initial={{ y: 20, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.6 }}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n        onClick={startEndlessMode}\n        className=\"w-full max-w-md py-4 pixel-btn text-lg flex items-center justify-center gap-3 relative z-10\"\n        style={{\n          background: 'linear-gradient(135deg, #A855F7 0%, #7C3AED 100%)',\n          boxShadow: '0 0 20px rgba(168, 85, 247, 0.5)'\n        }}\n        data-testid=\"button-start-endless\"\n      >\n        <Play size={24} fill=\"currentColor\" />\n        <span>ENTER THE NEXUS</span>\n      </motion.button>\n\n      <motion.p \n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ delay: 0.7 }}\n        className=\"mt-4 font-ui text-xs text-muted-foreground text-center relative z-10\"\n      >\n        Mutations occur every 3 waves. Boss bacteria appear every 5 waves.\n      </motion.p>\n    </div>\n  );\n}\n","path":null,"size_bytes":5295,"size_tokens":null},"client/src/components/game/WeeklyGoals.tsx":{"content":"import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Users, Target, Award, TrendingUp } from 'lucide-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useAuth } from '../../hooks/use-auth';\n\ninterface WeeklyGoal {\n  id: string;\n  weekStart: string;\n  title: string;\n  description: string;\n  targetValue: number;\n  currentValue: number;\n  goalType: string;\n  rewardType: string;\n  rewardData?: string;\n  isCompleted: number;\n}\n\ninterface WeeklyGoalResponse {\n  goal: WeeklyGoal;\n  userContribution: number;\n  progressPercentage: number;\n  isCompleted: boolean;\n}\n\nexport function WeeklyGoals({ open, onClose }: { open: boolean; onClose: () => void }) {\n  const { user } = useAuth();\n  \n  const { data, isLoading } = useQuery<WeeklyGoalResponse>({\n    queryKey: ['community-goal'],\n    queryFn: async () => {\n      const res = await fetch('/api/community-goal', { credentials: 'include' });\n      if (!res.ok) throw new Error('Failed to fetch community goal');\n      return res.json();\n    },\n    enabled: open,\n  });\n\n  const getTimeUntilWeekEnd = () => {\n    const now = new Date();\n    const dayOfWeek = now.getDay();\n    const daysUntilSunday = dayOfWeek === 0 ? 0 : 7 - dayOfWeek;\n    const sunday = new Date(now);\n    sunday.setDate(sunday.getDate() + daysUntilSunday);\n    sunday.setHours(23, 59, 59, 999);\n    const diff = sunday.getTime() - now.getTime();\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n    return `${days}d ${hours}h`;\n  };\n\n  const parseRewardData = (rewardData?: string) => {\n    if (!rewardData) return null;\n    try {\n      return JSON.parse(rewardData);\n    } catch {\n      return null;\n    }\n  };\n\n  const formatNumber = (num: number) => {\n    if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;\n    if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;\n    return num.toString();\n  };\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ scale: 0.9, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.9, opacity: 0 }}\n            className=\"block-panel w-full max-w-md p-6 relative\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button\n              onClick={onClose}\n              className=\"absolute top-4 right-4 text-muted-foreground hover:text-foreground\"\n              data-testid=\"button-close-weekly\"\n            >\n              <X size={24} />\n            </button>\n\n            <div className=\"flex items-center gap-3 mb-6\">\n              <Users className=\"text-cyan-400\" size={28} />\n              <h2 className=\"font-display text-2xl text-cyan-400\">COMMUNITY GOAL</h2>\n            </div>\n\n            {isLoading && user ? (\n              <div className=\"text-center py-8\">\n                <p className=\"font-ui text-lg text-muted-foreground\">Loading...</p>\n              </div>\n            ) : data?.goal ? (\n              <div className=\"space-y-5\">\n                <div className=\"text-center mb-2\">\n                  <span className=\"font-ui text-sm text-muted-foreground\">Time Remaining: {getTimeUntilWeekEnd()}</span>\n                </div>\n\n                <div className=\"bg-background/50 rounded-lg p-4 border border-cyan-400/20\">\n                  <h3 className=\"font-display text-xl text-secondary mb-2\">{data.goal.title}</h3>\n                  <p className=\"font-ui text-base text-foreground/80\">{data.goal.description}</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between font-ui text-sm\">\n                    <span className=\"text-muted-foreground\">Community Progress</span>\n                    <span className=\"text-cyan-400\">\n                      {formatNumber(data.goal.currentValue)} / {formatNumber(data.goal.targetValue)}\n                    </span>\n                  </div>\n                  \n                  <div className=\"h-6 bg-background/50 rounded-full overflow-hidden border border-cyan-400/30\">\n                    <motion.div\n                      initial={{ width: 0 }}\n                      animate={{ width: `${data.progressPercentage}%` }}\n                      transition={{ duration: 1, ease: 'easeOut' }}\n                      className=\"h-full bg-gradient-to-r from-cyan-500 to-cyan-400 relative\"\n                      style={{ \n                        boxShadow: '0 0 10px rgba(6,182,212,0.5), inset 0 0 20px rgba(255,255,255,0.2)'\n                      }}\n                    >\n                      <div className=\"absolute inset-0 bg-gradient-to-b from-white/20 to-transparent\" />\n                    </motion.div>\n                  </div>\n                  \n                  <div className=\"text-center\">\n                    <span className=\"font-display text-2xl text-cyan-400\">\n                      {data.progressPercentage.toFixed(1)}%\n                    </span>\n                  </div>\n                </div>\n\n                {user && (\n                  <div className=\"flex items-center justify-between bg-background/30 rounded-lg p-3 border border-primary/20\">\n                    <div className=\"flex items-center gap-2\">\n                      <TrendingUp size={18} className=\"text-primary\" />\n                      <span className=\"font-ui text-base\">Your Contribution:</span>\n                    </div>\n                    <span className=\"font-display text-lg text-primary\">{formatNumber(data.userContribution)}</span>\n                  </div>\n                )}\n\n                <div className=\"bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-lg p-4 border border-purple-400/30\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Award size={20} className=\"text-purple-400\" />\n                    <span className=\"font-display text-lg text-purple-400\">COMMUNITY REWARD</span>\n                  </div>\n                  {(() => {\n                    const reward = parseRewardData(data.goal.rewardData);\n                    if (data.goal.rewardType === 'coins' && reward?.amount) {\n                      return (\n                        <p className=\"font-ui text-base text-foreground/80\">\n                          Everyone earns <span className=\"text-yellow-400 font-bold\">{reward.amount} G</span> when goal is reached!\n                        </p>\n                      );\n                    } else if (data.goal.rewardType === 'cosmetic' && reward?.cosmeticName) {\n                      return (\n                        <p className=\"font-ui text-base text-foreground/80\">\n                          Unlock the <span className=\"text-purple-400 font-bold\">{reward.cosmeticName}</span> for everyone!\n                        </p>\n                      );\n                    }\n                    return <p className=\"font-ui text-base text-foreground/80\">Special reward awaits!</p>;\n                  })()}\n                </div>\n\n                {data.isCompleted && (\n                  <motion.div\n                    initial={{ scale: 0.9 }}\n                    animate={{ scale: 1 }}\n                    className=\"flex items-center justify-center gap-3 py-4 bg-green-400/20 rounded-lg border border-green-400/50\"\n                  >\n                    <Award size={24} className=\"text-green-400\" />\n                    <span className=\"font-display text-lg text-green-400\">GOAL COMPLETED!</span>\n                  </motion.div>\n                )}\n\n                {!user && (\n                  <p className=\"text-center font-ui text-sm text-muted-foreground\">\n                    Sign in to contribute and track your progress!\n                  </p>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"font-ui text-lg text-muted-foreground\">No community goal this week</p>\n              </div>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":8334,"size_tokens":null},"client/src/components/game/AchievementCelebration.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport confetti from 'canvas-confetti';\nimport { engagementService, type UnlockedAchievement } from '@/lib/engagement-service';\n\nconst TIER_COLORS = {\n  1: { bg: 'from-amber-700 to-amber-900', border: 'border-amber-500', text: 'text-amber-400', name: 'BRONZE' },\n  2: { bg: 'from-gray-400 to-gray-600', border: 'border-gray-300', text: 'text-gray-200', name: 'SILVER' },\n  3: { bg: 'from-yellow-400 to-yellow-600', border: 'border-yellow-300', text: 'text-yellow-200', name: 'GOLD' },\n};\n\nconst CELEBRATION_MESSAGES = [\n  \"ACHIEVEMENT UNLOCKED!\",\n  \"YOU DID IT!\",\n  \"BADGE EARNED!\",\n  \"INCREDIBLE!\",\n  \"WELL DONE!\",\n];\n\nexport function AchievementCelebration() {\n  const [currentAchievement, setCurrentAchievement] = useState<UnlockedAchievement | null>(null);\n  const [queue, setQueue] = useState<UnlockedAchievement[]>([]);\n  const [celebrationMessage] = useState(() => CELEBRATION_MESSAGES[Math.floor(Math.random() * CELEBRATION_MESSAGES.length)]);\n  const dismissTimerRef = useRef<number | null>(null);\n  const confettiAnimationRef = useRef<number | null>(null);\n  const confettiEndTimeRef = useRef<number>(0);\n\n  useEffect(() => {\n    const unsubscribe = engagementService.onAchievementUnlocked((achievement) => {\n      setQueue(prev => [...prev, achievement]);\n    });\n    return () => {\n      unsubscribe();\n      if (dismissTimerRef.current) {\n        clearTimeout(dismissTimerRef.current);\n      }\n      if (confettiAnimationRef.current) {\n        cancelAnimationFrame(confettiAnimationRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!currentAchievement && queue.length > 0) {\n      const [next, ...rest] = queue;\n      setCurrentAchievement(next);\n      setQueue(rest);\n      \n      // Clear any existing timers\n      if (dismissTimerRef.current) {\n        clearTimeout(dismissTimerRef.current);\n      }\n      if (confettiAnimationRef.current) {\n        cancelAnimationFrame(confettiAnimationRef.current);\n      }\n      \n      // Fire confetti\n      const duration = 2000;\n      confettiEndTimeRef.current = Date.now() + duration;\n      \n      const frame = () => {\n        if (Date.now() >= confettiEndTimeRef.current) {\n          confettiAnimationRef.current = null;\n          return;\n        }\n        \n        confetti({\n          particleCount: 3,\n          angle: 60,\n          spread: 55,\n          origin: { x: 0, y: 0.7 },\n          colors: ['#FFD700', '#FFA500', '#FF6347', '#00FF00', '#00BFFF'],\n        });\n        confetti({\n          particleCount: 3,\n          angle: 120,\n          spread: 55,\n          origin: { x: 1, y: 0.7 },\n          colors: ['#FFD700', '#FFA500', '#FF6347', '#00FF00', '#00BFFF'],\n        });\n        \n        confettiAnimationRef.current = requestAnimationFrame(frame);\n      };\n      confettiAnimationRef.current = requestAnimationFrame(frame);\n      \n      // Auto-dismiss after 4 seconds\n      dismissTimerRef.current = window.setTimeout(() => {\n        dismissTimerRef.current = null;\n        setCurrentAchievement(null);\n      }, 4000);\n    }\n  }, [currentAchievement, queue]);\n\n  const dismiss = () => {\n    if (dismissTimerRef.current) {\n      clearTimeout(dismissTimerRef.current);\n      dismissTimerRef.current = null;\n    }\n    if (confettiAnimationRef.current) {\n      cancelAnimationFrame(confettiAnimationRef.current);\n      confettiAnimationRef.current = null;\n    }\n    confettiEndTimeRef.current = 0;\n    setCurrentAchievement(null);\n  };\n\n  const tierStyle = currentAchievement ? TIER_COLORS[currentAchievement.tier as keyof typeof TIER_COLORS] || TIER_COLORS[1] : TIER_COLORS[1];\n\n  return (\n    <AnimatePresence>\n      {currentAchievement && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/70\"\n          onClick={dismiss}\n          data-testid=\"achievement-celebration-overlay\"\n        >\n          <motion.div\n            initial={{ scale: 0, rotate: -180 }}\n            animate={{ scale: 1, rotate: 0 }}\n            exit={{ scale: 0, rotate: 180 }}\n            transition={{ type: 'spring', damping: 15, stiffness: 300 }}\n            className={`relative p-8 rounded-2xl border-4 ${tierStyle.border} bg-gradient-to-br ${tierStyle.bg} shadow-2xl max-w-md mx-4`}\n            onClick={(e) => e.stopPropagation()}\n            data-testid=\"achievement-celebration-card\"\n          >\n            <motion.div\n              initial={{ y: -20, opacity: 0 }}\n              animate={{ y: 0, opacity: 1 }}\n              transition={{ delay: 0.2 }}\n              className=\"text-center\"\n            >\n              <div className={`text-sm font-bold ${tierStyle.text} mb-1`}>\n                {tierStyle.name} BADGE\n              </div>\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.3, type: 'spring', damping: 10 }}\n                className=\"text-6xl mb-4\"\n              >\n                {currentAchievement.badgeIcon}\n              </motion.div>\n              \n              <motion.h2\n                initial={{ y: 20, opacity: 0 }}\n                animate={{ y: 0, opacity: 1 }}\n                transition={{ delay: 0.4 }}\n                className=\"text-2xl font-display text-white mb-1\"\n              >\n                {celebrationMessage}\n              </motion.h2>\n              \n              <motion.h3\n                initial={{ y: 20, opacity: 0 }}\n                animate={{ y: 0, opacity: 1 }}\n                transition={{ delay: 0.5 }}\n                className=\"text-xl font-bold text-white mb-2\"\n              >\n                {currentAchievement.name}\n              </motion.h3>\n              \n              <motion.p\n                initial={{ y: 20, opacity: 0 }}\n                animate={{ y: 0, opacity: 1 }}\n                transition={{ delay: 0.6 }}\n                className=\"text-white/80 mb-4\"\n              >\n                {currentAchievement.description}\n              </motion.p>\n              \n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.7, type: 'spring' }}\n                className=\"inline-flex items-center gap-2 px-4 py-2 bg-black/30 rounded-full\"\n              >\n                <span className=\"text-yellow-400 text-xl\">ðŸª™</span>\n                <span className=\"text-yellow-400 font-bold text-lg\">\n                  +{currentAchievement.coinReward} coins reward!\n                </span>\n              </motion.div>\n              \n              <motion.p\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 1 }}\n                className=\"text-white/50 text-sm mt-4\"\n              >\n                Tap to continue\n              </motion.p>\n            </motion.div>\n            \n            <motion.div\n              className=\"absolute -inset-1 rounded-2xl pointer-events-none\"\n              style={{\n                background: `linear-gradient(45deg, transparent, ${tierStyle.text.includes('yellow') ? 'rgba(255,215,0,0.3)' : tierStyle.text.includes('gray') ? 'rgba(192,192,192,0.3)' : 'rgba(205,127,50,0.3)'}, transparent)`,\n              }}\n              animate={{\n                rotate: [0, 360],\n              }}\n              transition={{\n                duration: 3,\n                repeat: Infinity,\n                ease: 'linear',\n              }}\n            />\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":7717,"size_tokens":null},"scripts/generate-docs-script.ts":{"content":"import { generateAllDocumentation } from '../server/generate-docs';\n\nasync function main() {\n  console.log('Starting documentation generation...');\n  console.log('This will create 3 Google Docs in your Drive:\\n');\n  \n  try {\n    const urls = await generateAllDocumentation();\n    \n    console.log('\\n=== Documentation Generated Successfully ===\\n');\n    console.log('Player Guide:');\n    console.log(`  ${urls.playerGuide}\\n`);\n    console.log('API Reference:');\n    console.log(`  ${urls.apiReference}\\n`);\n    console.log('Game Design Document:');\n    console.log(`  ${urls.gdd}\\n`);\n    console.log('=============================================');\n    \n  } catch (error) {\n    console.error('Failed to generate documentation:', error);\n    process.exit(1);\n  }\n}\n\nmain();\n","path":null,"size_bytes":776,"size_tokens":null},"server/generate-docs.ts":{"content":"import { createDocument } from './google-docs';\n\nconst PLAYER_GUIDE = `# Kikteria - Player Guide\nVersion 7.1\n\n## Welcome to Kikteria!\n\nKikteria is a fun puzzle game where you place quirky bacteria on a petri dish without letting them touch each other. The bacteria wiggle and vibrate, making placement a delightful challenge!\n\n## How to Play\n\n### Basic Gameplay\n1. Bacteria appear in your queue on the right side of the screen\n2. Tap or click on the petri dish to place the current bacteria\n3. Bacteria vibrate and move slightly - plan your placements carefully!\n4. Place all bacteria without any of them touching to win the level\n5. If two bacteria touch, it's game over!\n\n### Controls\n- Tap/Click: Place the current bacteria at that location\n- Bomb Button (left panel): Activate bomb targeting mode, then tap near bacteria to remove them\n- Freeze Button: Temporarily stop all bacteria from vibrating\n- Lasso Button: Draw a circle to remove bacteria inside it\n\n## Game Modes\n\n### Story Mode (7 Levels)\nProgress through 7 increasingly challenging levels:\n- Level 1: Tutorial - Learn the basics\n- Level 2-3: Getting harder with more bacteria\n- Level 4-5: Smaller play area and faster vibrations\n- Level 6-7: Master difficulty with rapid bacteria\n\nEach level unlocks story content in the Lab Chronicles!\n\n### Endless Mode\n- Survive as long as possible\n- Bacteria spawn in waves\n- Each wave adds more bacteria\n- Compete for the highest wave record\n\n## Items & Upgrades\n\n### Consumable Items\n| Item | Effect |\n|------|--------|\n| Shield | Forgives one collision (bacteria bounce apart instead of game over) |\n| 2nd Chance | After game over, removes the last bacteria and lets you continue |\n| Freeze | Pauses all bacteria vibration for a few seconds |\n| Cleanser | Draw a lasso to remove bacteria inside it |\n\n### Upgrades (Buy in Shop)\n| Upgrade | Effect |\n|---------|--------|\n| Bomb Count | Start with more tactical bombs |\n| Figure Size | Bacteria start smaller (easier to fit) |\n| Queue Size | See more upcoming bacteria |\n| Time Bonus | More time per bacteria placed |\n| Placement Bonus | Earn more coins per placement |\n| Slow-Mo | Bacteria vibrate more slowly |\n| Coin Boost | Bonus coins multiplier |\n| Lucky | Higher chance for rare bacteria (worth more coins!) |\n\n## The Bacteria Cast\n\nMeet the 10 unique bacteria characters:\n\n| Name | Personality | Rarity |\n|------|-------------|--------|\n| Blobby | Friendly blob, loves everyone | Common |\n| Grumpus | Grouchy but secretly caring | Common |\n| Wobbly | Anxious wobbler, always worried | Common |\n| Cyclops | One-eyed observer, very perceptive | Common |\n| Squish | Squishy and stretchy | Rare |\n| Chompy | Always hungry, big appetite | Rare |\n| Derp | Confused but happy | Rare |\n| Ghosty | Shy and translucent | Epic |\n| Spiky | Prickly exterior, soft inside | Epic |\n| Gloop | Oozy and mysterious | Epic |\n\nLearn more about each bacteria in the Codex!\n\n## Earning Coins\n\n- Complete levels to earn coins based on your score\n- Place bacteria quickly for combo bonuses\n- Rare bacteria are worth more coins\n- Complete Daily Lab Orders for bonus rewards\n- Contribute to Weekly Community Goals\n- Unlock Achievements for coin rewards\n\n## Tips for Success\n\n1. Start from the edges and work inward\n2. Leave space for vibration - bacteria wiggle!\n3. Use bombs strategically on crowded areas\n4. Save your Shield for tricky situations\n5. Watch the timer - frozen bacteria don't count down!\n6. Study each bacteria's vibration pattern in the Codex\n\n## Achievements\n\nUnlock badges by reaching milestones:\n- First Contact: Place your first bacteria\n- Lab Technician: Place 100 bacteria\n- Master Containment: Complete all 7 levels\n- Survivor: Reach wave 10 in Endless Mode\n- And many more!\n\nVisit the Achievement Board to see your progress and claim rewards!\n\n## Daily Lab Orders\n\nEvery day, receive a special order with requirements like:\n- Place a specific number of bacteria\n- Complete certain levels\n- Use specific items\n\nComplete daily orders for bonus coins!\n\n## Community Goals\n\nWork together with all players to reach weekly targets. When the community goal is reached, everyone earns bonus rewards!\n\n## Need Help?\n\n- Check the Lab Chronicles for story and hints\n- Visit the Codex to learn about bacteria\n- Practice in earlier levels to master placement\n- The K.I.K. AI provides real-time tips during gameplay\n\nGood luck, and happy bacteria placing!\n`;\n\nconst API_REFERENCE = `# Kikteria - API Reference\nVersion 7.1\n\n## Overview\n\nKikteria uses a RESTful API built with Express.js. All endpoints require authentication unless noted otherwise.\n\n## Authentication\n\nAuthentication is handled via Google OAuth through Replit's auth integration.\n\n### Endpoints\n\n#### GET /api/auth/user\nReturns the currently authenticated user.\n\nResponse:\n{\n  \"id\": \"string\",\n  \"email\": \"string\",\n  \"firstName\": \"string\",\n  \"lastName\": \"string\",\n  \"profileImageUrl\": \"string | null\",\n  \"createdAt\": \"ISO date string\",\n  \"updatedAt\": \"ISO date string\"\n}\n\n#### GET /api/login\nRedirects to Google OAuth login flow.\n\n#### GET /api/logout\nLogs out the current user and redirects to home.\n\n---\n\n## Player Profile\n\n### GET /api/profile\nReturns the player's profile with coins, scores, and upgrades.\n\nResponse:\n{\n  \"id\": \"string\",\n  \"userId\": \"string\",\n  \"coins\": number,\n  \"highScore\": number,\n  \"speedUpgrade\": number,\n  \"startSizeUpgrade\": number,\n  \"magnetUpgrade\": number,\n  \"updatedAt\": \"ISO date string\"\n}\n\n### PATCH /api/profile\nUpdates the player's profile.\n\nRequest Body:\n{\n  \"coins\": number (optional),\n  \"highScore\": number (optional),\n  \"speedUpgrade\": number (optional),\n  \"startSizeUpgrade\": number (optional),\n  \"magnetUpgrade\": number (optional)\n}\n\n---\n\n## Leaderboard\n\n### GET /api/leaderboard\nReturns the top scores.\n\nQuery Parameters:\n- limit: number (default: 10, max: 100)\n\nResponse:\n[\n  {\n    \"id\": \"string\",\n    \"userId\": \"string\",\n    \"username\": \"string\",\n    \"score\": number,\n    \"createdAt\": \"ISO date string\"\n  }\n]\n\n### POST /api/leaderboard\nSubmits a new score.\n\nRequest Body:\n{\n  \"score\": number\n}\n\n---\n\n## Level Progress\n\n### GET /api/levels/progress\nReturns the user's progress for all levels.\n\nResponse:\n[\n  {\n    \"id\": \"string\",\n    \"userId\": \"string\",\n    \"levelNumber\": number,\n    \"bestScore\": number,\n    \"isCompleted\": number (0 or 1)\n  }\n]\n\n### POST /api/levels/progress\nUpdates progress for a specific level.\n\nRequest Body:\n{\n  \"levelNumber\": number,\n  \"score\": number,\n  \"completed\": boolean\n}\n\n---\n\n## Daily Lab Orders\n\n### GET /api/daily-order\nReturns today's daily order.\n\nResponse:\n{\n  \"id\": \"string\",\n  \"orderDate\": \"YYYY-MM-DD\",\n  \"description\": \"string\",\n  \"requirement\": number,\n  \"rewardCoins\": number,\n  \"completedBy\": [\"userId1\", \"userId2\"]\n}\n\n### POST /api/daily-order/complete\nMarks the daily order as completed for the current user.\n\nResponse:\n{\n  \"success\": true,\n  \"coinsAwarded\": number\n}\n\n---\n\n## Community Goals\n\n### GET /api/community-goal\nReturns the current weekly community goal.\n\nResponse:\n{\n  \"id\": \"string\",\n  \"weekStart\": \"YYYY-MM-DD\",\n  \"description\": \"string\",\n  \"targetAmount\": number,\n  \"currentAmount\": number,\n  \"rewardCoins\": number,\n  \"isCompleted\": boolean\n}\n\n### POST /api/community-goal/contribute\nContributes to the community goal.\n\nRequest Body:\n{\n  \"amount\": number\n}\n\n---\n\n## Achievements\n\n### GET /api/achievements\nReturns all available achievements.\n\nResponse:\n[\n  {\n    \"id\": \"string\",\n    \"name\": \"string\",\n    \"description\": \"string\",\n    \"category\": \"mastery\" | \"collection\" | \"challenge\" | \"social\",\n    \"tier\": 1 | 2 | 3,\n    \"requirement\": number,\n    \"coinReward\": number,\n    \"badgeIcon\": \"emoji string\"\n  }\n]\n\n### GET /api/achievements/progress\nReturns the current user's achievement progress.\n\nResponse:\n[\n  {\n    \"id\": \"string\",\n    \"achievementId\": \"string\",\n    \"userId\": \"string\",\n    \"progress\": number,\n    \"isUnlocked\": 0 | 1,\n    \"isClaimed\": 0 | 1,\n    \"unlockedAt\": \"ISO date string | null\"\n  }\n]\n\n### POST /api/achievements/progress\nUpdates progress for a specific achievement.\n\nRequest Body:\n{\n  \"achievementId\": \"string\",\n  \"progress\": number\n}\n\nResponse includes newlyUnlocked flag if achievement was just unlocked.\n\n### POST /api/achievements/claim\nClaims the coin reward for an unlocked achievement.\n\nRequest Body:\n{\n  \"achievementId\": \"string\"\n}\n\n---\n\n## Analytics\n\n### POST /api/analytics\nSubmits user behavior analytics (metadata).\n\nRequest Body:\n{\n  \"events\": [\n    {\n      \"eventType\": \"level_play\" | \"level_success\" | \"level_fail\" | \"session_start\" | \"session_end\",\n      \"levelNumber\": number (optional),\n      \"score\": number (optional),\n      \"playDuration\": number (optional),\n      \"eventDate\": \"YYYY-MM-DD\",\n      \"eventTime\": \"HH:MM:SS\",\n      \"sessionId\": \"string\",\n      \"deviceInfo\": \"string\"\n    }\n  ]\n}\n\n---\n\n## Error Logging\n\n### POST /api/errors\nSubmits error logs for debugging.\n\nRequest Body:\n{\n  \"errors\": [\n    {\n      \"severity\": \"error\" | \"warn\" | \"info\",\n      \"category\": \"runtime\" | \"api\" | \"sync\" | \"game\" | \"asset\",\n      \"message\": \"string\",\n      \"stack\": \"string (optional)\",\n      \"component\": \"string (optional)\",\n      \"currentScreen\": \"string (optional)\",\n      \"gameState\": \"string (optional)\",\n      \"sessionId\": \"string\",\n      \"deviceInfo\": \"string\",\n      \"networkStatus\": \"online\" | \"offline\",\n      \"eventTime\": \"ISO date string\"\n    }\n  ]\n}\n\n---\n\n## Version & Updates\n\n### GET /api/version\nReturns the current version policy.\n\nResponse:\n{\n  \"latestVersion\": \"string (semver)\",\n  \"minSupportedVersion\": \"string (semver)\",\n  \"downloadUrl\": \"string\",\n  \"releaseNotes\": \"string | null\"\n}\n\n---\n\n## Admin Endpoints\n\nAll admin endpoints require the user to be in the ADMIN_USER_IDS list.\n\n### GET /api/admin/stats\nReturns dashboard statistics.\n\n### GET /api/admin/users\nReturns all users with pagination.\n\n### GET /api/admin/profiles\nReturns all player profiles.\n\n### GET /api/admin/analytics\nReturns analytics data.\n\n### GET /api/admin/errors\nReturns error logs.\n\n### DELETE /api/admin/user/:userId\nDeletes a user and their associated data.\n\n### PUT /api/admin/update-policy\nUpdates the version policy.\n\n### POST /api/admin/seed-achievements\nSeeds the achievements table with default values.\n\n---\n\n## Error Responses\n\nAll endpoints may return error responses:\n\n{\n  \"error\": \"Error message description\"\n}\n\nCommon HTTP Status Codes:\n- 200: Success\n- 304: Not Modified (cached)\n- 400: Bad Request (validation error)\n- 401: Unauthorized\n- 403: Forbidden (not admin)\n- 404: Not Found\n- 500: Internal Server Error\n\n---\n\n## Database Schema\n\n### Tables\n\n- users: User accounts from OAuth\n- playerProfiles: Game progress (coins, upgrades, high scores)\n- leaderboard: High score entries\n- levelProgress: Per-level completion status\n- userAnalytics: Behavior tracking events\n- errorLogs: Error reports\n- appUpdatePolicy: Version management\n- dailyOrders: Daily challenge definitions\n- weeklyGoals: Community goal tracking\n- weeklyContributions: Per-user weekly contributions\n- achievements: Achievement definitions\n- achievementProgress: Per-user achievement status\n\n### Indexes\n\nOptimized indexes exist for:\n- leaderboard (score DESC, createdAt DESC)\n- levelProgress (userId, levelNumber unique)\n- weeklyContributions (goalId, unique per user)\n- achievementProgress (unique per userId + achievementId)\n`;\n\nconst GAME_DESIGN_DOCUMENT = `# Kikteria - Game Design Document\nVersion 7.1\n\n## Game Overview\n\n### Concept\nKikteria is a puzzle game where players strategically place vibrating bacteria on a petri dish. The challenge comes from the bacteria's constant movement - players must account for vibration patterns when placing each piece.\n\n### Target Audience\n- Casual puzzle game enthusiasts\n- All ages (family-friendly)\n- Mobile-first, desktop-compatible\n\n### Core Loop\n1. Receive bacteria in queue\n2. Plan placement considering vibration\n3. Tap to place\n4. Earn coins and progress\n5. Unlock upgrades and achievements\n6. Repeat\n\n---\n\n## Game Mechanics\n\n### Bacteria Placement\n\n#### Collision Detection\n- Uses canvas-based hit testing\n- Accounts for vibration envelope (max displacement)\n- 5px collision padding for safety margin\n- Hysteresis system prevents false positives (requires 3 consecutive collision frames)\n- Clean frame counter resets collision state after 5 clean frames\n\n#### Vibration Patterns\n| Pattern | Description | Envelope Calculation |\n|---------|-------------|---------------------|\n| Horizontal | Side-to-side movement | amplitude |\n| Vertical | Up-down movement | amplitude |\n| Circular | Rotational orbit | amplitude |\n| Pulse | Grow/shrink in place | baseRadius * 0.1 |\n| Diagonal | 45-degree oscillation | amplitude * 0.7 * sqrt(2) |\n\n### Figure System\n\n#### Base Configuration\n- FIGURE_BASE_SIZE: 35 pixels\n- COLLISION_PADDING: 5 pixels\n- QUEUE_SIZE: 3 bacteria visible\n\n#### Bacteria Templates\nEach bacteria has:\n- Unique visual shape composition\n- Vibration pattern type\n- Vibration speed (cycles/second)\n- Vibration amplitude (pixels)\n- Base scale multiplier\n- Rarity tier (common/rare/epic)\n- Coin value\n\n### Rarity Distribution\n| Rarity | Spawn Weight | Coin Multiplier |\n|--------|--------------|-----------------|\n| Common | 70% | 1x |\n| Rare | 25% | 1.5x |\n| Epic | 5% | 3x |\n\nLucky upgrade increases rare/epic spawn rates.\n\n---\n\n## Level Design\n\n### Level Structure\n| Level | Bacteria Count | Time (sec) | Area Shrink | Speed Multi |\n|-------|---------------|------------|-------------|-------------|\n| 1 | 8 | 60 | 0% | 1.0x |\n| 2 | 10 | 55 | 5% | 1.1x |\n| 3 | 12 | 50 | 10% | 1.2x |\n| 4 | 14 | 45 | 15% | 1.3x |\n| 5 | 16 | 40 | 20% | 1.4x |\n| 6 | 18 | 35 | 25% | 1.5x |\n| 7 | 20 | 30 | 30% | 1.6x |\n\n### Endless Mode\n- Starts with wave 1 (5 bacteria)\n- Each wave adds 2 more bacteria\n- Speed increases 5% per wave\n- No time limit\n- Continues until collision\n\n---\n\n## Economy Design\n\n### Coin Sources\n| Source | Amount |\n|--------|--------|\n| Level completion | Score = bacteria placed * 10 |\n| Rare bacteria bonus | +50% coin value |\n| Epic bacteria bonus | +200% coin value |\n| Daily order | 50-200 coins |\n| Achievement unlock | 10-1000 coins |\n| Community goal | Shared bonus |\n\n### Upgrade Costs (Coins)\n| Upgrade | Level 1 | Level 2 | Level 3 | Level 4 | Level 5 | Max |\n|---------|---------|---------|---------|---------|---------|-----|\n| Bomb Count | 100 | 200 | 400 | 800 | 1600 | 5 |\n| Figure Size | 150 | 300 | 600 | 1200 | - | 4 |\n| Queue Size | 200 | 400 | 800 | - | - | 3 |\n| Time Bonus | 100 | 200 | 400 | 800 | - | 4 |\n| Placement Bonus | 150 | 300 | 600 | 1200 | - | 4 |\n| Slow-Mo | 200 | 400 | 800 | 1600 | - | 4 |\n| Shield | 300 | 600 | 1200 | - | - | 3 |\n| Coin Boost | 250 | 500 | 1000 | - | - | 3 |\n| Lucky | 200 | 400 | 800 | - | - | 3 |\n| 2nd Chance | 500 | 1000 | - | - | - | 2 |\n\n### Consumable Items\n| Item | Cost | Effect |\n|------|------|--------|\n| Shield Charge | 300 | Forgives 1 collision |\n| 2nd Chance | 500 | Resume after game over |\n| Freeze | 200 | 5 second vibration pause |\n| Cleanser | 250 | Lasso removal tool |\n\n---\n\n## Progression Systems\n\n### Level Unlocks\n- Level 1: Always available\n- Levels 2-7: Unlock by completing previous level\n- Completion persists across sessions\n\n### Achievement Categories\n\n#### Mastery (Placement Milestones)\n- First Contact: 1 placement (Tier 1, 10 coins)\n- Lab Technician: 100 placements (Tier 1, 50 coins)\n- Senior Researcher: 500 placements (Tier 2, 150 coins)\n- Chief Scientist: 2000 placements (Tier 3, 500 coins)\n\n#### Collection (Coin Milestones)\n- Coin Collector: 1,000 coins (Tier 1, 100 coins)\n- Treasure Hunter: 5,000 coins (Tier 2, 300 coins)\n- Wealthy Scientist: 20,000 coins (Tier 3, 1000 coins)\n\n#### Challenge (Level Milestones)\n- Getting Started: Complete Level 1 (Tier 1, 25 coins)\n- Making Progress: Complete Level 3 (Tier 1, 75 coins)\n- Lab Veteran: Complete Level 5 (Tier 2, 200 coins)\n- Master Containment: Complete Level 7 (Tier 3, 500 coins)\n\n#### Social (Engagement)\n- First Order: Complete 1 daily order (Tier 1, 50 coins)\n- Weekly Regular: Complete 7 daily orders (Tier 2, 200 coins)\n- Dedicated Scientist: Complete 30 daily orders (Tier 3, 500 coins)\n\n### Achievement Tiers\n| Tier | Badge Style | Typical Reward |\n|------|-------------|----------------|\n| Bronze (1) | Amber colors | 10-100 coins |\n| Silver (2) | Gray/silver colors | 100-300 coins |\n| Gold (3) | Yellow/gold colors | 300-1000 coins |\n\n---\n\n## Engagement Features\n\n### Daily Lab Orders\n- Refreshes daily at midnight UTC\n- Random requirements from pool\n- Must be claimed within 24 hours\n- Example: \"Place 50 bacteria today\"\n\n### Weekly Community Goals\n- Shared target across all players\n- Progress from all player placements\n- 7-day duration\n- Bonus coins when goal reached\n\n### K.I.K. Announcer\nContext-aware commentary system providing:\n- Placement feedback (\"Nice spot!\")\n- Progress milestones (\"Halfway there!\")\n- Time warnings (\"Running low on time!\")\n- Item usage reactions\n- Game outcome messages\n\n---\n\n## Technical Specifications\n\n### Rendering\n- Canvas 2D API at 60fps\n- Vibration calculated per-frame\n- Shapes composited from primitives\n- Particle effects for explosions/confetti\n\n### State Management\n- Zustand for client state\n- React Query for server state\n- LocalStorage for offline persistence\n- Automatic sync when online\n\n### Performance Targets\n- 60fps gameplay\n- <100ms input latency\n- <2s initial load\n- Offline-first architecture\n\n---\n\n## Future Considerations\n\n### Potential Features\n- Multiplayer competitive mode\n- Custom bacteria creator\n- Level editor\n- Seasonal events\n- Battle pass progression\n- Social sharing\n\n### Balancing Notes\n- Monitor average session length\n- Track level completion rates\n- Analyze economy inflation\n- Adjust spawn rates based on data\n`;\n\nconst ENTERPRISE_ADMIN_GUIDE = `# Kikteria - Enterprise Admin Guide\nVersion 7.1\n\n## System Architecture Overview\n\nThis document provides enterprise administrators with comprehensive information about the Kikteria system architecture, deployment configuration, and administrative operations.\n\n---\n\n## Architecture Diagram\n\n\\`\\`\\`\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                           KIKTERIA SYSTEM ARCHITECTURE                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚   Browser    â”‚    â”‚   Browser    â”‚    â”‚         Browser              â”‚   â”‚\nâ”‚  â”‚  (Player 1)  â”‚    â”‚  (Player 2)  â”‚    â”‚         (Admin)              â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚         â”‚                   â”‚                           â”‚                    â”‚\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚\nâ”‚                             â”‚                                                â”‚\nâ”‚                             â–¼                                                â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚                        FRONTEND (React + Vite)                        â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚\nâ”‚  â”‚  â”‚  Game       â”‚  â”‚   Shop      â”‚  â”‚ Leaderboard â”‚  â”‚   Admin     â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  Engine     â”‚  â”‚   System    â”‚  â”‚   Display   â”‚  â”‚   Panel     â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  (Canvas)   â”‚  â”‚             â”‚  â”‚             â”‚  â”‚  (/admin)   â”‚  â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚\nâ”‚  â”‚                                                                       â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚              STATE MANAGEMENT (Zustand + React Query)           â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  â€¢ Game State    â€¢ Offline Storage    â€¢ Sync Queue              â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                             â”‚                                                â”‚\nâ”‚                             â”‚ HTTP/REST                                      â”‚\nâ”‚                             â–¼                                                â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚                    BACKEND (Express.js + Node.js)                     â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚\nâ”‚  â”‚  â”‚   Auth      â”‚  â”‚   Game      â”‚  â”‚   Admin     â”‚  â”‚  Analytics  â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚   Routes    â”‚  â”‚   Routes    â”‚  â”‚   Routes    â”‚  â”‚   Routes    â”‚  â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚\nâ”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚\nâ”‚  â”‚                           â–¼               â–¼                           â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚                   STORAGE LAYER (Drizzle ORM)                   â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                             â”‚                                                â”‚\nâ”‚                             â–¼                                                â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚                    DATABASE (PostgreSQL - Neon)                       â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚\nâ”‚  â”‚  â”‚   users   â”‚ â”‚  profiles â”‚ â”‚ leaderbd  â”‚ â”‚ analytics â”‚             â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚\nâ”‚  â”‚  â”‚ levelProg â”‚ â”‚dailyOrder â”‚ â”‚ weekGoals â”‚ â”‚ achievmnt â”‚             â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚  â”‚  EXTERNAL INTEGRATIONS  â”‚    â”‚           REPLIT PLATFORM               â”‚ â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚\nâ”‚  â”‚  â”‚  Google OAuth   â”‚    â”‚    â”‚  â”‚  Auth Svc   â”‚  â”‚   Deployment    â”‚   â”‚ â”‚\nâ”‚  â”‚  â”‚  (Sign-In)      â”‚    â”‚    â”‚  â”‚  (Replit)   â”‚  â”‚   (Auto-scale)  â”‚   â”‚ â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚\nâ”‚  â”‚  â”‚  Google Docs    â”‚    â”‚    â”‚  â”‚  Secrets    â”‚  â”‚   Checkpoints   â”‚   â”‚ â”‚\nâ”‚  â”‚  â”‚  (Docs Gen)     â”‚    â”‚    â”‚  â”‚  Manager    â”‚  â”‚   (Rollback)    â”‚   â”‚ â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚                                                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\\`\\`\\`\n\n---\n\n## Database Schema\n\n### Core Tables\n\n| Table | Purpose | Key Fields |\n|-------|---------|------------|\n| users | OAuth user accounts | id, email, name, profileImageUrl |\n| playerProfiles | Player progress & economy | userId, coins, highScore, upgradelevels |\n| leaderboard | Global rankings | id, username, score, timestamp |\n| levelProgress | Per-level completion | userId, levelNumber, completed, stars |\n\n### Engagement Tables\n\n| Table | Purpose | Key Fields |\n|-------|---------|------------|\n| dailyOrders | Daily challenge definitions | id, requirement, rewardCoins, date |\n| weeklyGoals | Community goal tracking | id, targetAmount, currentProgress, endDate |\n| weeklyContributions | Per-user contributions | goalId, visitorId, amount |\n| achievements | Achievement definitions | id, name, requirement, coinReward |\n| achievementProgress | Per-user achievement status | userId, achievementId, progress, isUnlocked |\n\n### System Tables\n\n| Table | Purpose | Key Fields |\n|-------|---------|------------|\n| userAnalytics | Behavior tracking | userId, eventType, eventData, timestamp |\n| errorLogs | Client error reports | id, errorMessage, stackTrace, timestamp |\n| appUpdatePolicy | Version management | id, minVersion, currentVersion |\n\n---\n\n## Admin Panel Access\n\n### Location\nAccess the admin panel at: \\`/admin\\`\n\n### Authorization\nAdmin access is controlled by a whitelist of user IDs:\n\\`\\`\\`javascript\nconst ADMIN_USER_IDS = ['51476893'];\n\\`\\`\\`\n\nTo add new administrators, edit \\`client/src/pages/Admin.tsx\\` and add user IDs to this array.\n\n### Admin Capabilities\n\n#### User Management\n- View all registered users\n- View player profiles and statistics\n- Monitor user activity\n\n#### Analytics Dashboard\n- Active user counts (DAU/MAU)\n- Session duration metrics\n- Level completion rates\n- Economy flow analysis\n\n#### Content Management\n- Create/edit daily orders\n- Set weekly community goals\n- Manage achievement definitions\n- Update app version policy\n\n#### System Operations\n- View error logs\n- Clear cached data\n- Force leaderboard refresh\n- Trigger documentation regeneration\n\n---\n\n## API Endpoints Reference\n\n### Authentication Endpoints\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| GET | /api/auth/user | Get current authenticated user |\n| GET | /api/login | Initiate Google OAuth flow |\n| GET | /api/logout | End user session |\n\n### Player Data Endpoints\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| GET | /api/profile | Get player profile |\n| PATCH | /api/profile | Update player profile |\n| GET | /api/leaderboard | Get global rankings |\n| POST | /api/leaderboard | Submit new score |\n\n### Progress Endpoints\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| GET | /api/levels/progress | Get level completion status |\n| POST | /api/levels/progress | Update level progress |\n| GET | /api/achievements/progress | Get achievement progress |\n| POST | /api/achievements/progress | Update achievement progress |\n| POST | /api/achievements/claim | Claim achievement reward |\n\n### Engagement Endpoints\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| GET | /api/daily-order | Get current daily order |\n| POST | /api/daily-order/complete | Mark daily order complete |\n| GET | /api/community-goal | Get weekly community goal |\n| POST | /api/community-goal/contribute | Add contribution |\n\n### Admin Endpoints (Requires Admin Auth)\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| GET | /api/admin/users | List all users |\n| GET | /api/admin/analytics | Get analytics summary |\n| GET | /api/admin/errors | Get error logs |\n| POST | /api/admin/daily-order | Create daily order |\n| POST | /api/admin/weekly-goal | Create weekly goal |\n| DELETE | /api/admin/leaderboard/:id | Remove leaderboard entry |\n\n---\n\n## Security Configuration\n\n### Authentication Flow\n1. User clicks \"Sign In with Google\"\n2. Redirect to Replit OAuth endpoint\n3. User authenticates with Google\n4. Callback with session token\n5. Session stored in secure HTTP-only cookie\n\n### Session Management\n- Sessions stored server-side\n- 7-day expiration\n- Automatic refresh on activity\n- Secure cookie flags in production\n\n### Rate Limiting\n- 100 requests/minute per IP\n- 1000 requests/hour per authenticated user\n- Stricter limits on write operations\n\n### Data Protection\n- All sensitive data encrypted at rest\n- HTTPS enforced in production\n- No secrets in client-side code\n- Environment variables for configuration\n\n---\n\n## Deployment Configuration\n\n### Environment Variables\n\n| Variable | Description | Required |\n|----------|-------------|----------|\n| DATABASE_URL | PostgreSQL connection string | Yes |\n| SESSION_SECRET | Session encryption key | Yes |\n| ADMIN_USER_IDS | Comma-separated admin IDs | No |\n\n### Scaling Considerations\n- Stateless backend (horizontal scaling)\n- Database connection pooling\n- CDN for static assets\n- Redis for session storage (optional)\n\n### Health Checks\n- GET /api/health - Application health\n- GET /api/version - Current version\n\n---\n\n## Monitoring & Observability\n\n### Metrics to Track\n- Request latency (p50, p95, p99)\n- Error rates by endpoint\n- Database query times\n- Active WebSocket connections\n\n### Log Categories\n| Category | Description |\n|----------|-------------|\n| [auth] | Authentication events |\n| [game] | Game state changes |\n| [api] | API request/response |\n| [error] | Application errors |\n| [admin] | Admin operations |\n\n### Alerts Configuration\n- Error rate > 5% in 5 minutes\n- Response time > 500ms average\n- Database connection failures\n- Authentication failures spike\n\n---\n\n## Backup & Recovery\n\n### Database Backups\n- Automatic daily backups via Neon\n- Point-in-time recovery available\n- 7-day retention period\n\n### Rollback Procedures\n1. Access Replit Checkpoints\n2. Select checkpoint before issue\n3. Review changes to be reverted\n4. Confirm rollback operation\n\n### Data Export\nAdmin can export:\n- User data (GDPR compliance)\n- Analytics reports\n- Error log summaries\n\n---\n\n## Testing Infrastructure\n\n### Test Suite\nRun tests with: \\`npx vitest run\\`\n\n| Test Category | Count | Location |\n|---------------|-------|----------|\n| Game Constants | 33 | client/src/lib/__tests__/game-constants.test.ts |\n| Offline Storage | 39 | client/src/lib/__tests__/offline-storage.test.ts |\n| Game Store | 33 | client/src/lib/__tests__/store.test.ts |\n| Upgrades | 15 | client/src/lib/__tests__/upgrades.test.ts |\n| Endless Mode | 18 | client/src/lib/__tests__/endless-mode.test.ts |\n| Achievements | 22 | client/src/lib/__tests__/achievements.test.ts |\n| Bomb Mechanics | 15 | client/src/lib/__tests__/bomb-mechanics.test.ts |\n| Storage Layer | 15 | server/__tests__/storage.test.ts |\n| **Total** | **190** | |\n\n### CI/CD Pipeline\n- Tests run on every commit\n- Build validation before deploy\n- Automatic staging deployment\n- Manual production promotion\n\n---\n\n## Support & Escalation\n\n### Issue Tiers\n\n| Tier | Response Time | Examples |\n|------|---------------|----------|\n| P1 - Critical | < 1 hour | Service down, data loss |\n| P2 - High | < 4 hours | Major feature broken |\n| P3 - Medium | < 24 hours | Minor bugs, UI issues |\n| P4 - Low | < 1 week | Feature requests, improvements |\n\n### Contact Points\n- Technical Issues: Check error logs first\n- Database Issues: Neon dashboard\n- Authentication Issues: Replit integrations\n- Billing Issues: Replit support\n\n---\n\n## Version History\n\n| Version | Date | Changes |\n|---------|------|---------|\n| 7.1 | Dec 2024 | Shield fix, 2nd Chance endless fix, achievement celebrations |\n| 7.0 | Dec 2024 | Achievement system, daily orders, community goals |\n| 6.0 | Nov 2024 | Endless mode, upgrades system |\n| 5.0 | Nov 2024 | Leaderboard, offline sync |\n| 1.0 | Oct 2024 | Initial release |\n\n---\n\n## Quick Reference Commands\n\n\\`\\`\\`bash\n# Run development server\nnpm run dev\n\n# Run tests\nnpx vitest run\n\n# Generate documentation\nnpx tsx scripts/generate-docs-script.ts\n\n# Database migrations\nnpx drizzle-kit push\n\n# View logs\n# Check Replit workflow logs\n\\`\\`\\`\n\n---\n\nDocument generated automatically. For updates, run the documentation generator script.\n`;\n\nexport async function generateEnterpriseAdminDoc(): Promise<string> {\n  console.log('[docs] Generating Enterprise Admin Guide...');\n  const result = await createDocument('Kikteria - Enterprise Admin Guide v8', ENTERPRISE_ADMIN_GUIDE);\n  console.log('[docs] Enterprise Admin Guide created:', result.url);\n  return result.url;\n}\n\nexport async function generateAllDocumentation(): Promise<{ playerGuide: string; apiReference: string; gdd: string; enterpriseAdmin?: string }> {\n  console.log('[docs] Generating Player Guide...');\n  const playerGuide = await createDocument('Kikteria - Player Guide v8', PLAYER_GUIDE);\n  console.log('[docs] Player Guide created:', playerGuide.url);\n  \n  console.log('[docs] Generating API Reference...');\n  const apiReference = await createDocument('Kikteria - API Reference v8', API_REFERENCE);\n  console.log('[docs] API Reference created:', apiReference.url);\n  \n  console.log('[docs] Generating Game Design Document...');\n  const gdd = await createDocument('Kikteria - Game Design Document v8', GAME_DESIGN_DOCUMENT);\n  console.log('[docs] GDD created:', gdd.url);\n  \n  return {\n    playerGuide: playerGuide.url,\n    apiReference: apiReference.url,\n    gdd: gdd.url,\n  };\n}\n","path":null,"size_bytes":37176,"size_tokens":null},"server/google-docs.ts":{"content":"import { google } from 'googleapis';\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=google-docs',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('Google Docs not connected');\n  }\n  return accessToken;\n}\n\nexport async function getUncachableGoogleDocsClient() {\n  const accessToken = await getAccessToken();\n\n  const oauth2Client = new google.auth.OAuth2();\n  oauth2Client.setCredentials({\n    access_token: accessToken\n  });\n\n  return google.docs({ version: 'v1', auth: oauth2Client });\n}\n\nexport async function createDocument(title: string, content: string): Promise<{ documentId: string; url: string }> {\n  const docs = await getUncachableGoogleDocsClient();\n  \n  const createResponse = await docs.documents.create({\n    requestBody: {\n      title: title,\n    },\n  });\n  \n  const documentId = createResponse.data.documentId!;\n  \n  const requests: any[] = [];\n  let index = 1;\n  \n  const lines = content.split('\\n');\n  \n  for (const line of lines) {\n    if (line.startsWith('# ')) {\n      requests.push({\n        insertText: {\n          location: { index },\n          text: line.substring(2) + '\\n',\n        },\n      });\n      requests.push({\n        updateParagraphStyle: {\n          range: { startIndex: index, endIndex: index + line.length - 1 },\n          paragraphStyle: { namedStyleType: 'HEADING_1' },\n          fields: 'namedStyleType',\n        },\n      });\n      index += line.length - 1;\n    } else if (line.startsWith('## ')) {\n      requests.push({\n        insertText: {\n          location: { index },\n          text: line.substring(3) + '\\n',\n        },\n      });\n      requests.push({\n        updateParagraphStyle: {\n          range: { startIndex: index, endIndex: index + line.length - 2 },\n          paragraphStyle: { namedStyleType: 'HEADING_2' },\n          fields: 'namedStyleType',\n        },\n      });\n      index += line.length - 2;\n    } else if (line.startsWith('### ')) {\n      requests.push({\n        insertText: {\n          location: { index },\n          text: line.substring(4) + '\\n',\n        },\n      });\n      requests.push({\n        updateParagraphStyle: {\n          range: { startIndex: index, endIndex: index + line.length - 3 },\n          paragraphStyle: { namedStyleType: 'HEADING_3' },\n          fields: 'namedStyleType',\n        },\n      });\n      index += line.length - 3;\n    } else {\n      requests.push({\n        insertText: {\n          location: { index },\n          text: line + '\\n',\n        },\n      });\n      index += line.length + 1;\n    }\n  }\n  \n  if (requests.length > 0) {\n    await docs.documents.batchUpdate({\n      documentId,\n      requestBody: {\n        requests,\n      },\n    });\n  }\n  \n  return {\n    documentId,\n    url: `https://docs.google.com/document/d/${documentId}/edit`,\n  };\n}\n","path":null,"size_bytes":3748,"size_tokens":null},"client/src/lib/__tests__/store.test.ts":{"content":"import { describe, it, expect, beforeEach, vi } from 'vitest';\n\nconst mockStorage: Record<string, string> = {};\nconst mockLocalStorage = {\n  getItem: vi.fn((key: string) => mockStorage[key] || null),\n  setItem: vi.fn((key: string, value: string) => { mockStorage[key] = value; }),\n  removeItem: vi.fn((key: string) => { delete mockStorage[key]; }),\n  clear: vi.fn(() => { Object.keys(mockStorage).forEach(k => delete mockStorage[k]); }),\n  length: 0,\n  key: vi.fn(),\n};\n\nvi.stubGlobal('localStorage', mockLocalStorage);\nvi.stubGlobal('navigator', { userAgent: 'Mozilla/5.0 (Test) Chrome/100.0' });\n\nvi.mock('../engagement-service', () => ({\n  engagementService: {\n    initialize: vi.fn(),\n    setAuthenticated: vi.fn(),\n    onAchievementUnlocked: vi.fn(() => () => {}),\n    recordPlacement: vi.fn(),\n    recordLevelComplete: vi.fn(),\n    recordCoinsEarned: vi.fn(),\n    recordEndlessWave: vi.fn(),\n    recordBombUsed: vi.fn(),\n    recordDailyOrderComplete: vi.fn(),\n  },\n}));\n\nimport { useGameStore } from '../store';\nimport { LEVELS } from '../game-constants';\n\ndescribe('useGameStore', () => {\n  beforeEach(() => {\n    const store = useGameStore.getState();\n    store.setGameState('MENU');\n    Object.keys(mockStorage).forEach(k => delete mockStorage[k]);\n  });\n\n  describe('Initial State', () => {\n    it('starts with MENU game state', () => {\n      const { gameState } = useGameStore.getState();\n      expect(gameState).toBe('MENU');\n    });\n\n    it('starts with score of 0', () => {\n      const { score } = useGameStore.getState();\n      expect(score).toBe(0);\n    });\n\n    it('starts at level 1', () => {\n      const { currentLevel } = useGameStore.getState();\n      expect(currentLevel).toBe(1);\n    });\n\n    it('starts with level 1 config', () => {\n      const { currentLevelConfig } = useGameStore.getState();\n      expect(currentLevelConfig).toEqual(LEVELS[0]);\n    });\n\n    it('starts with empty placed figures', () => {\n      const { placedFigures } = useGameStore.getState();\n      expect(placedFigures).toEqual([]);\n    });\n\n    it('starts with empty figure queue', () => {\n      const { figureQueue } = useGameStore.getState();\n      expect(figureQueue).toEqual([]);\n    });\n\n    it('starts with shield not used', () => {\n      const { shieldUsed } = useGameStore.getState();\n      expect(shieldUsed).toBe(false);\n    });\n\n    it('starts with second chance not used', () => {\n      const { secondChanceUsed } = useGameStore.getState();\n      expect(secondChanceUsed).toBe(false);\n    });\n\n    it('starts not in endless mode', () => {\n      const { isEndlessMode } = useGameStore.getState();\n      expect(isEndlessMode).toBe(false);\n    });\n\n    it('starts not frozen', () => {\n      const { isFrozen } = useGameStore.getState();\n      expect(isFrozen).toBe(false);\n    });\n  });\n\n  describe('setGameState', () => {\n    it('changes game state to PLAYING', () => {\n      useGameStore.getState().setGameState('PLAYING');\n      expect(useGameStore.getState().gameState).toBe('PLAYING');\n    });\n\n    it('changes game state to WIN', () => {\n      useGameStore.getState().setGameState('WIN');\n      expect(useGameStore.getState().gameState).toBe('WIN');\n    });\n\n    it('changes game state to LOSE', () => {\n      useGameStore.getState().setGameState('LOSE');\n      expect(useGameStore.getState().gameState).toBe('LOSE');\n    });\n  });\n\n  describe('setNotification', () => {\n    it('sets notification message', () => {\n      useGameStore.getState().setNotification('Test message');\n      expect(useGameStore.getState().notification).toBe('Test message');\n    });\n\n    it('clears notification with null', () => {\n      useGameStore.getState().setNotification('Test');\n      useGameStore.getState().setNotification(null);\n      expect(useGameStore.getState().notification).toBeNull();\n    });\n  });\n\n  describe('toggleBombTargeting', () => {\n    it('toggles bomb targeting mode when bombs available', () => {\n      const store = useGameStore.getState();\n      const initialMode = store.bombTargetingMode;\n      store.toggleBombTargeting();\n      \n      if (store.bombsRemaining > 0) {\n        expect(useGameStore.getState().bombTargetingMode).toBe(!initialMode);\n      }\n    });\n  });\n\n  describe('Level Selection', () => {\n    it('selectLevel updates selected level when unlocked', () => {\n      useGameStore.setState({ maxUnlockedLevel: 5 });\n      useGameStore.getState().selectLevel(3);\n      expect(useGameStore.getState().selectedLevel).toBe(3);\n    });\n\n    it('selectLevel respects maxUnlockedLevel', () => {\n      useGameStore.setState({ maxUnlockedLevel: 2, selectedLevel: 1 });\n      useGameStore.getState().selectLevel(5);\n      expect(useGameStore.getState().selectedLevel).toBe(1);\n    });\n  });\n\n  describe('Endless Mode', () => {\n    it('starts endless mode with wave 1', () => {\n      const { endlessWave } = useGameStore.getState();\n      expect(endlessWave).toBe(1);\n    });\n\n    it('tracks endless high score', () => {\n      const { endlessHighScore } = useGameStore.getState();\n      expect(endlessHighScore).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks best endless wave', () => {\n      const { endlessBestWave } = useGameStore.getState();\n      expect(endlessBestWave).toBeGreaterThanOrEqual(1);\n    });\n  });\n\n  describe('Consumables', () => {\n    it('tracks freeze count', () => {\n      const { freezeCount } = useGameStore.getState();\n      expect(freezeCount).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks cleanser count', () => {\n      const { cleanserCount } = useGameStore.getState();\n      expect(cleanserCount).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks lasso mode', () => {\n      const { isLassoMode } = useGameStore.getState();\n      expect(typeof isLassoMode).toBe('boolean');\n    });\n\n    it('tracks lasso points', () => {\n      const { lassoPoints } = useGameStore.getState();\n      expect(Array.isArray(lassoPoints)).toBe(true);\n    });\n  });\n\n  describe('Level Stats', () => {\n    it('tracks bombs used in level', () => {\n      const { levelStats } = useGameStore.getState();\n      expect(levelStats.bombsUsed).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks shields used in level', () => {\n      const { levelStats } = useGameStore.getState();\n      expect(levelStats.shieldsUsed).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks second chances used in level', () => {\n      const { levelStats } = useGameStore.getState();\n      expect(levelStats.secondChancesUsed).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks time remaining', () => {\n      const { levelStats } = useGameStore.getState();\n      expect(levelStats.timeRemaining).toBeGreaterThanOrEqual(0);\n    });\n\n    it('tracks perfect placements', () => {\n      const { levelStats } = useGameStore.getState();\n      expect(levelStats.perfectPlacements).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('Mutation Events', () => {\n    it('has no active mutation by default', () => {\n      const { activeMutation } = useGameStore.getState();\n      expect(activeMutation).toBeNull();\n    });\n\n    it('has default mutation modifiers', () => {\n      const { mutationModifiers } = useGameStore.getState();\n      expect(mutationModifiers.vibrationMultiplier).toBe(1);\n      expect(mutationModifiers.sizeMultiplier).toBe(1);\n      expect(mutationModifiers.speedMultiplier).toBe(1);\n      expect(mutationModifiers.driftEnabled).toBe(false);\n    });\n  });\n\n  describe('Close Call Tracking', () => {\n    it('starts with zero close calls', () => {\n      const { closeCallCount } = useGameStore.getState();\n      expect(closeCallCount).toBe(0);\n    });\n  });\n});\n","path":null,"size_bytes":7583,"size_tokens":null},"server/__tests__/storage.test.ts":{"content":"import { describe, it, expect, beforeAll, afterAll } from 'vitest';\nimport { db } from '../db';\nimport { DatabaseStorage } from '../storage';\nimport { \n  users, \n  playerProfiles, \n  leaderboard, \n  levelProgress,\n} from '@shared/schema';\nimport { eq } from 'drizzle-orm';\n\nconst storage = new DatabaseStorage();\nconst testId = Date.now().toString();\nconst TEST_USER_ID = `test-user-${testId}`;\nconst TEST_USER_ID_2 = `test-user-2-${testId}`;\nconst TEST_EMAIL = `test-${testId}@example.com`;\nconst TEST_EMAIL_2 = `test2-${testId}@example.com`;\n\ndescribe('DatabaseStorage', () => {\n  beforeAll(async () => {\n    await db.insert(users).values({\n      id: TEST_USER_ID,\n      email: TEST_EMAIL,\n      firstName: 'Test',\n      lastName: 'User',\n    });\n    await db.insert(users).values({\n      id: TEST_USER_ID_2,\n      email: TEST_EMAIL_2,\n      firstName: 'Test2',\n      lastName: 'User2',\n    });\n  });\n\n  afterAll(async () => {\n    try {\n      await db.delete(levelProgress).where(eq(levelProgress.userId, TEST_USER_ID));\n      await db.delete(levelProgress).where(eq(levelProgress.userId, TEST_USER_ID_2));\n      await db.delete(leaderboard).where(eq(leaderboard.userId, TEST_USER_ID));\n      await db.delete(leaderboard).where(eq(leaderboard.userId, TEST_USER_ID_2));\n      await db.delete(playerProfiles).where(eq(playerProfiles.userId, TEST_USER_ID));\n      await db.delete(playerProfiles).where(eq(playerProfiles.userId, TEST_USER_ID_2));\n      await db.delete(users).where(eq(users.id, TEST_USER_ID));\n      await db.delete(users).where(eq(users.id, TEST_USER_ID_2));\n    } catch (e) {\n      console.error('Cleanup error:', e);\n    }\n  });\n\n  describe('Player Profile', () => {\n    it('getPlayerProfile returns undefined for non-existent user', async () => {\n      const profile = await storage.getPlayerProfile('non-existent-user');\n      expect(profile).toBeUndefined();\n    });\n\n    it('createPlayerProfile creates a new profile', async () => {\n      const profile = await storage.createPlayerProfile({\n        userId: TEST_USER_ID,\n        coins: 100,\n        highScore: 500,\n      });\n\n      expect(profile).toBeDefined();\n      expect(profile.userId).toBe(TEST_USER_ID);\n      expect(profile.coins).toBe(100);\n      expect(profile.highScore).toBe(500);\n    });\n\n    it('getPlayerProfile retrieves existing profile', async () => {\n      const profile = await storage.getPlayerProfile(TEST_USER_ID);\n      expect(profile).toBeDefined();\n      expect(profile?.coins).toBe(100);\n    });\n\n    it('updatePlayerProfile updates coins', async () => {\n      const updated = await storage.updatePlayerProfile(TEST_USER_ID, { coins: 200 });\n      expect(updated.coins).toBe(200);\n    });\n\n    it('updatePlayerProfile updates multiple fields', async () => {\n      const updated = await storage.updatePlayerProfile(TEST_USER_ID, {\n        coins: 300,\n        highScore: 1000,\n        speedUpgrade: 2,\n      });\n      expect(updated.coins).toBe(300);\n      expect(updated.highScore).toBe(1000);\n      expect(updated.speedUpgrade).toBe(2);\n    });\n  });\n\n  describe('Leaderboard', () => {\n    it('addLeaderboardEntry creates new entry', async () => {\n      const entry = await storage.addLeaderboardEntry({\n        userId: TEST_USER_ID,\n        username: 'TestUser',\n        score: 500,\n      });\n\n      expect(entry.userId).toBe(TEST_USER_ID);\n      expect(entry.score).toBe(500);\n    });\n\n    it('addLeaderboardEntry updates if score is higher', async () => {\n      const entry = await storage.addLeaderboardEntry({\n        userId: TEST_USER_ID,\n        username: 'TestUser',\n        score: 1000,\n      });\n\n      expect(entry.score).toBe(1000);\n    });\n\n    it('addLeaderboardEntry does not update if score is lower', async () => {\n      const entry = await storage.addLeaderboardEntry({\n        userId: TEST_USER_ID,\n        username: 'TestUser',\n        score: 100,\n      });\n\n      expect(entry.score).toBe(1000);\n    });\n\n    it('getTopScores returns sorted entries', async () => {\n      await storage.addLeaderboardEntry({\n        userId: TEST_USER_ID_2,\n        username: 'TestUser2',\n        score: 2000,\n      });\n\n      const scores = await storage.getTopScores(10);\n      expect(scores.length).toBeGreaterThanOrEqual(2);\n      \n      for (let i = 1; i < scores.length; i++) {\n        expect(scores[i - 1].score).toBeGreaterThanOrEqual(scores[i].score);\n      }\n    });\n\n    it('getUserBestScore returns correct score', async () => {\n      const score = await storage.getUserBestScore(TEST_USER_ID);\n      expect(score).toBe(1000);\n    });\n\n    it('getUserBestScore returns 0 for non-existent user', async () => {\n      const score = await storage.getUserBestScore('non-existent');\n      expect(score).toBe(0);\n    });\n  });\n\n  describe('Level Progress', () => {\n    it('getLevelProgressByUser returns empty for new user', async () => {\n      const progress = await storage.getLevelProgressByUser(TEST_USER_ID);\n      expect(progress).toEqual([]);\n    });\n\n    it('upsertLevelProgress creates new entry', async () => {\n      const progress = await storage.upsertLevelProgress(TEST_USER_ID, 1, 150, true);\n\n      expect(progress.levelNumber).toBe(1);\n      expect(progress.bestScore).toBe(150);\n      expect(progress.isCompleted).toBe(1);\n    });\n\n    it('upsertLevelProgress updates existing entry with higher score', async () => {\n      const progress = await storage.upsertLevelProgress(TEST_USER_ID, 1, 200, true);\n      expect(progress.bestScore).toBe(200);\n    });\n\n    it('upsertLevelProgress keeps higher score', async () => {\n      const progress = await storage.upsertLevelProgress(TEST_USER_ID, 1, 100, true);\n      expect(progress.bestScore).toBe(200);\n    });\n\n    it('getLevelProgressByUser returns all levels', async () => {\n      await storage.upsertLevelProgress(TEST_USER_ID, 2, 175, true);\n      await storage.upsertLevelProgress(TEST_USER_ID, 3, 180, false);\n\n      const progress = await storage.getLevelProgressByUser(TEST_USER_ID);\n      expect(progress.length).toBe(3);\n    });\n  });\n\n  describe('Admin Methods', () => {\n    it('getAdminStats returns stats object', async () => {\n      const stats = await storage.getAdminStats();\n\n      expect(stats).toHaveProperty('totalUsers');\n      expect(stats).toHaveProperty('totalGamesPlayed');\n      expect(stats).toHaveProperty('totalErrors');\n      expect(typeof stats.totalUsers).toBe('number');\n    });\n\n    it('getAllUsers returns users array', async () => {\n      const allUsers = await storage.getAllUsers();\n      expect(Array.isArray(allUsers)).toBe(true);\n      expect(allUsers.length).toBeGreaterThan(0);\n    });\n\n    it('getAllProfiles returns profiles array', async () => {\n      const profiles = await storage.getAllProfiles();\n      expect(Array.isArray(profiles)).toBe(true);\n    });\n  });\n});\n","path":null,"size_bytes":6786,"size_tokens":null},"client/src/lib/__tests__/offline-storage.test.ts":{"content":"import { describe, it, expect, beforeEach, vi } from 'vitest';\n\nconst mockStorage: Record<string, string> = {};\nconst mockLocalStorage = {\n  getItem: vi.fn((key: string) => mockStorage[key] || null),\n  setItem: vi.fn((key: string, value: string) => { mockStorage[key] = value; }),\n  removeItem: vi.fn((key: string) => { delete mockStorage[key]; }),\n  clear: vi.fn(() => { Object.keys(mockStorage).forEach(k => delete mockStorage[k]); }),\n  length: 0,\n  key: vi.fn(),\n};\n\nvi.stubGlobal('localStorage', mockLocalStorage);\nvi.stubGlobal('navigator', { userAgent: 'Mozilla/5.0 (Test) Chrome/100.0' });\n\nimport { offlineStorage, LocalLevelProgress, LocalPlayerStats } from '../offline-storage';\n\ndescribe('offlineStorage', () => {\n  beforeEach(() => {\n    mockLocalStorage.clear();\n    vi.clearAllMocks();\n  });\n\n  describe('Level Progress', () => {\n    it('getLevelProgress returns empty array by default', () => {\n      const progress = offlineStorage.getLevelProgress();\n      expect(progress).toEqual([]);\n    });\n\n    it('setLevelProgress saves and retrieves progress', () => {\n      const progress: LocalLevelProgress[] = [\n        { levelNumber: 1, bestScore: 100, isCompleted: true },\n        { levelNumber: 2, bestScore: 150, isCompleted: true },\n      ];\n      offlineStorage.setLevelProgress(progress);\n      \n      const retrieved = offlineStorage.getLevelProgress();\n      expect(retrieved).toEqual(progress);\n    });\n\n    it('updateLevelProgress creates new entry if not exists', () => {\n      offlineStorage.updateLevelProgress(1, 100, true);\n      \n      const progress = offlineStorage.getLevelProgress();\n      expect(progress).toHaveLength(1);\n      expect(progress[0]).toMatchObject({\n        levelNumber: 1,\n        bestScore: 100,\n        isCompleted: true,\n      });\n    });\n\n    it('updateLevelProgress updates best score if higher', () => {\n      offlineStorage.updateLevelProgress(1, 100, true);\n      offlineStorage.updateLevelProgress(1, 150, true);\n      \n      const progress = offlineStorage.getLevelProgress();\n      expect(progress[0].bestScore).toBe(150);\n    });\n\n    it('updateLevelProgress keeps higher score', () => {\n      offlineStorage.updateLevelProgress(1, 200, true);\n      offlineStorage.updateLevelProgress(1, 100, true);\n      \n      const progress = offlineStorage.getLevelProgress();\n      expect(progress[0].bestScore).toBe(200);\n    });\n\n    it('updateLevelProgress unlocks next level on completion', () => {\n      offlineStorage.updateLevelProgress(1, 100, true);\n      \n      const unlocked = offlineStorage.getUnlockedLevels();\n      expect(unlocked).toBe(2);\n    });\n  });\n\n  describe('Unlocked Levels', () => {\n    it('getUnlockedLevels returns 1 by default', () => {\n      expect(offlineStorage.getUnlockedLevels()).toBe(1);\n    });\n\n    it('unlockLevel increases unlocked count', () => {\n      offlineStorage.unlockLevel(3);\n      expect(offlineStorage.getUnlockedLevels()).toBe(3);\n    });\n\n    it('unlockLevel does not decrease unlocked count', () => {\n      offlineStorage.unlockLevel(5);\n      offlineStorage.unlockLevel(3);\n      expect(offlineStorage.getUnlockedLevels()).toBe(5);\n    });\n  });\n\n  describe('Player Stats', () => {\n    it('getPlayerStats returns defaults', () => {\n      const stats = offlineStorage.getPlayerStats();\n      expect(stats.coins).toBe(0);\n      expect(stats.highScore).toBe(0);\n      expect(stats.bombCount).toBe(1);\n    });\n\n    it('setPlayerStats updates stats', () => {\n      offlineStorage.setPlayerStats({ coins: 500, highScore: 1000 });\n      \n      const stats = offlineStorage.getPlayerStats();\n      expect(stats.coins).toBe(500);\n      expect(stats.highScore).toBe(1000);\n    });\n\n    it('setPlayerStats preserves unset values', () => {\n      offlineStorage.setPlayerStats({ coins: 100 });\n      offlineStorage.setPlayerStats({ highScore: 200 });\n      \n      const stats = offlineStorage.getPlayerStats();\n      expect(stats.coins).toBe(100);\n      expect(stats.highScore).toBe(200);\n    });\n\n    it('updateHighScore updates if higher', () => {\n      offlineStorage.updateHighScore(100);\n      offlineStorage.updateHighScore(200);\n      \n      const stats = offlineStorage.getPlayerStats();\n      expect(stats.highScore).toBe(200);\n    });\n\n    it('updateHighScore keeps higher score', () => {\n      offlineStorage.updateHighScore(300);\n      offlineStorage.updateHighScore(100);\n      \n      const stats = offlineStorage.getPlayerStats();\n      expect(stats.highScore).toBe(300);\n    });\n  });\n\n  describe('Pending Sync', () => {\n    it('getPendingSync returns empty defaults', () => {\n      const pending = offlineStorage.getPendingSync();\n      expect(pending.levelProgress).toEqual([]);\n      expect(pending.highScore).toBeNull();\n    });\n\n    it('hasPendingSync returns false when empty', () => {\n      expect(offlineStorage.hasPendingSync()).toBe(false);\n    });\n\n    it('addPendingSync adds level progress', () => {\n      offlineStorage.updateLevelProgress(1, 100, true);\n      \n      expect(offlineStorage.hasPendingSync()).toBe(true);\n      const pending = offlineStorage.getPendingSync();\n      expect(pending.levelProgress.length).toBeGreaterThan(0);\n    });\n\n    it('clearPendingSync clears all pending data', () => {\n      offlineStorage.updateLevelProgress(1, 100, true);\n      offlineStorage.updateHighScore(500);\n      \n      offlineStorage.clearPendingSync();\n      \n      expect(offlineStorage.hasPendingSync()).toBe(false);\n    });\n  });\n\n  describe('Session Management', () => {\n    it('getSessionId returns a string', () => {\n      const sessionId = offlineStorage.getSessionId();\n      expect(typeof sessionId).toBe('string');\n      expect(sessionId.length).toBeGreaterThan(0);\n    });\n\n    it('getSessionId returns same id on subsequent calls', () => {\n      const id1 = offlineStorage.getSessionId();\n      const id2 = offlineStorage.getSessionId();\n      expect(id1).toBe(id2);\n    });\n\n    it('generateNewSession creates new session id', () => {\n      const id1 = offlineStorage.getSessionId();\n      offlineStorage.generateNewSession();\n      const id2 = offlineStorage.getSessionId();\n      expect(id1).not.toBe(id2);\n    });\n  });\n\n  describe('Device Info', () => {\n    it('getDeviceInfo returns device string', () => {\n      const info = offlineStorage.getDeviceInfo();\n      expect(typeof info).toBe('string');\n    });\n  });\n\n  describe('Metadata Events', () => {\n    it('getMetadata returns empty array by default', () => {\n      expect(offlineStorage.getMetadata()).toEqual([]);\n    });\n\n    it('hasMetadataToSync returns false when empty', () => {\n      expect(offlineStorage.hasMetadataToSync()).toBe(false);\n    });\n\n    it('trackLevelPlay adds metadata event', () => {\n      offlineStorage.trackLevelPlay(1);\n      \n      expect(offlineStorage.hasMetadataToSync()).toBe(true);\n      const metadata = offlineStorage.getMetadata();\n      expect(metadata.length).toBe(1);\n      expect(metadata[0].eventType).toBe('level_play');\n    });\n\n    it('trackLevelSuccess adds success event', () => {\n      offlineStorage.trackLevelSuccess(1, 100, 30);\n      \n      const metadata = offlineStorage.getMetadata();\n      expect(metadata[0].eventType).toBe('level_success');\n      expect(metadata[0].score).toBe(100);\n    });\n\n    it('trackLevelFail adds fail event', () => {\n      offlineStorage.trackLevelFail(1, 50, 15);\n      \n      const metadata = offlineStorage.getMetadata();\n      expect(metadata[0].eventType).toBe('level_fail');\n    });\n\n    it('clearMetadata removes all metadata', () => {\n      offlineStorage.trackLevelPlay(1);\n      offlineStorage.trackLevelSuccess(1, 100, 30);\n      \n      offlineStorage.clearMetadata();\n      \n      expect(offlineStorage.hasMetadataToSync()).toBe(false);\n    });\n  });\n\n  describe('Error Logs', () => {\n    it('getErrorLogs returns empty array by default', () => {\n      expect(offlineStorage.getErrorLogs()).toEqual([]);\n    });\n\n    it('hasErrorLogsToSync returns false when empty', () => {\n      expect(offlineStorage.hasErrorLogsToSync()).toBe(false);\n    });\n\n    it('addErrorLog adds error entry', () => {\n      offlineStorage.addErrorLog({\n        severity: 'error',\n        category: 'runtime',\n        message: 'Test error',\n      });\n      \n      expect(offlineStorage.hasErrorLogsToSync()).toBe(true);\n      const logs = offlineStorage.getErrorLogs();\n      expect(logs.length).toBe(1);\n      expect(logs[0].message).toBe('Test error');\n    });\n\n    it('clearErrorLogs removes all logs', () => {\n      offlineStorage.addErrorLog({\n        severity: 'error',\n        category: 'runtime',\n        message: 'Test error',\n      });\n      \n      offlineStorage.clearErrorLogs();\n      \n      expect(offlineStorage.hasErrorLogsToSync()).toBe(false);\n    });\n  });\n\n  describe('User Actions', () => {\n    it('setLastUserAction stores action', () => {\n      offlineStorage.setLastUserAction('click:button');\n      expect(offlineStorage.getLastUserAction()).toBe('click:button');\n    });\n\n    it('getLastUserAction returns undefined when not set', () => {\n      expect(offlineStorage.getLastUserAction()).toBeUndefined();\n    });\n  });\n\n  describe('Settings', () => {\n    it('getSettings returns defaults', () => {\n      const settings = offlineStorage.getSettings();\n      expect(settings).toHaveProperty('soundEnabled');\n      expect(settings).toHaveProperty('musicEnabled');\n    });\n\n    it('setSettings updates settings', () => {\n      offlineStorage.setSettings({ soundEnabled: false });\n      const settings = offlineStorage.getSettings();\n      expect(settings.soundEnabled).toBe(false);\n    });\n  });\n\n  describe('Leaderboard Cache', () => {\n    it('getLeaderboardCache returns empty array by default', () => {\n      expect(offlineStorage.getLeaderboardCache()).toEqual([]);\n    });\n\n    it('setLeaderboardCache stores entries', () => {\n      const entries = [\n        { id: '1', username: 'Player1', score: 100, userId: 'u1', createdAt: new Date() },\n      ];\n      offlineStorage.setLeaderboardCache(entries as any);\n      \n      const cached = offlineStorage.getLeaderboardCache();\n      expect(cached.length).toBe(1);\n    });\n  });\n\n  describe('Clear All', () => {\n    it('clearAll removes all storage data', () => {\n      offlineStorage.setPlayerStats({ coins: 100 });\n      offlineStorage.updateLevelProgress(1, 100, true);\n      offlineStorage.trackLevelPlay(1);\n      \n      offlineStorage.clearAll();\n      \n      expect(offlineStorage.getLevelProgress()).toEqual([]);\n      expect(offlineStorage.getPlayerStats().coins).toBe(0);\n      expect(offlineStorage.getMetadata()).toEqual([]);\n    });\n  });\n});\n","path":null,"size_bytes":10598,"size_tokens":null},"client/src/lib/__tests__/game-constants.test.ts":{"content":"import { describe, it, expect } from 'vitest';\nimport {\n  getVibrationEnvelope,\n  computeEffectiveRadius,\n  BACTERIA_TEMPLATES,\n  BOMB_TEMPLATE,\n  GAME_CONFIG,\n  LEVELS,\n  FigureTemplate,\n  FigureInstance,\n} from '../game-constants';\n\ndescribe('getVibrationEnvelope', () => {\n  const createTemplate = (pattern: string, amplitude: number): FigureTemplate => ({\n    id: 'test',\n    name: 'Test',\n    shapes: [],\n    vibrationPattern: pattern as any,\n    vibrationSpeed: 1,\n    vibrationAmplitude: amplitude,\n    baseScale: 1,\n    rarity: 'common',\n    coinValue: 10,\n  });\n\n  it('returns amplitude for horizontal pattern', () => {\n    const template = createTemplate('horizontal', 10);\n    expect(getVibrationEnvelope(template, 1)).toBe(10);\n  });\n\n  it('returns amplitude for vertical pattern', () => {\n    const template = createTemplate('vertical', 15);\n    expect(getVibrationEnvelope(template, 1)).toBe(15);\n  });\n\n  it('returns amplitude for circular pattern', () => {\n    const template = createTemplate('circular', 8);\n    expect(getVibrationEnvelope(template, 1)).toBe(8);\n  });\n\n  it('returns scaled pulse envelope for pulse pattern', () => {\n    const template = createTemplate('pulse', 10);\n    const scale = 1.5;\n    const expected = GAME_CONFIG.FIGURE_BASE_SIZE * scale * 0.1;\n    expect(getVibrationEnvelope(template, scale)).toBe(expected);\n  });\n\n  it('returns diagonal envelope with sqrt(2) factor', () => {\n    const template = createTemplate('diagonal', 10);\n    const expected = 10 * 0.7 * Math.sqrt(2);\n    expect(getVibrationEnvelope(template, 1)).toBeCloseTo(expected);\n  });\n\n  it('handles different scales correctly', () => {\n    const template = createTemplate('horizontal', 10);\n    expect(getVibrationEnvelope(template, 2)).toBe(10);\n  });\n});\n\ndescribe('computeEffectiveRadius', () => {\n  const createFigure = (templateId: string, scale: number): FigureInstance => ({\n    id: 'fig1',\n    templateId,\n    x: 100,\n    y: 100,\n    rotation: 0,\n    scale,\n    vibrationOffset: 0,\n    isPlaced: true,\n  });\n\n  it('computes radius for common bacteria', () => {\n    const figure = createFigure('blobby', 1);\n    const radius = computeEffectiveRadius(figure, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n    expect(radius).toBeGreaterThan(0);\n    expect(radius).toBeGreaterThan(GAME_CONFIG.FIGURE_BASE_SIZE);\n  });\n\n  it('computes radius for bomb template', () => {\n    const figure = createFigure('bomb', 1);\n    const radius = computeEffectiveRadius(figure, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n    expect(radius).toBeGreaterThan(0);\n  });\n\n  it('scales radius with figure scale', () => {\n    const figure1 = createFigure('blobby', 1);\n    const figure2 = createFigure('blobby', 2);\n    const radius1 = computeEffectiveRadius(figure1, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n    const radius2 = computeEffectiveRadius(figure2, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n    expect(radius2).toBeGreaterThan(radius1);\n  });\n\n  it('returns base radius for unknown template', () => {\n    const figure = createFigure('unknown', 1.5);\n    const radius = computeEffectiveRadius(figure, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n    expect(radius).toBe(GAME_CONFIG.FIGURE_BASE_SIZE * 1.5);\n  });\n\n  it('handles all bacteria templates', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      const figure = createFigure(template.id, 1);\n      const radius = computeEffectiveRadius(figure, BACTERIA_TEMPLATES, BOMB_TEMPLATE);\n      expect(radius).toBeGreaterThan(0);\n    }\n  });\n});\n\ndescribe('GAME_CONFIG', () => {\n  it('has valid canvas padding', () => {\n    expect(GAME_CONFIG.CANVAS_PADDING).toBeGreaterThan(0);\n  });\n\n  it('has valid figure base size', () => {\n    expect(GAME_CONFIG.FIGURE_BASE_SIZE).toBeGreaterThan(0);\n  });\n\n  it('has valid collision padding', () => {\n    expect(GAME_CONFIG.COLLISION_PADDING).toBeGreaterThanOrEqual(0);\n  });\n\n  it('has valid queue size', () => {\n    expect(GAME_CONFIG.QUEUE_SIZE).toBeGreaterThan(0);\n  });\n\n  it('has valid starting bombs', () => {\n    expect(GAME_CONFIG.STARTING_BOMBS).toBeGreaterThanOrEqual(0);\n  });\n});\n\ndescribe('LEVELS', () => {\n  it('has 100 levels', () => {\n    expect(LEVELS).toHaveLength(100);\n  });\n\n  it('overall difficulty increases from start to end', () => {\n    const firstLevel = LEVELS[0];\n    const lastLevel = LEVELS[99];\n    expect(lastLevel.figuresCount).toBeGreaterThan(firstLevel.figuresCount);\n    expect(lastLevel.speedMultiplier).toBeGreaterThan(firstLevel.speedMultiplier);\n    expect(lastLevel.sizeMultiplier).toBeGreaterThan(firstLevel.sizeMultiplier);\n  });\n\n  it('all levels have valid properties', () => {\n    for (const level of LEVELS) {\n      expect(level.figuresCount).toBeGreaterThan(0);\n      expect(level.startTime).toBeGreaterThan(0);\n      expect(level.speedMultiplier).toBeGreaterThan(0);\n      expect(level.sizeMultiplier).toBeGreaterThan(0);\n    }\n  });\n\n  it('level numbers are sequential', () => {\n    for (let i = 0; i < LEVELS.length; i++) {\n      expect(LEVELS[i].level).toBe(i + 1);\n    }\n  });\n\n  it('all levels have names', () => {\n    for (const level of LEVELS) {\n      expect(level.name).toBeDefined();\n      expect(level.name.length).toBeGreaterThan(0);\n    }\n  });\n\n  it('has milestone levels with increased difficulty', () => {\n    const milestones = [10, 25, 50, 75, 100];\n    for (const m of milestones) {\n      const level = LEVELS[m - 1];\n      expect(level.isMilestone).toBe(true);\n    }\n  });\n\n  it('has breather levels with reduced difficulty', () => {\n    const breathers = [7, 17, 27, 37, 47, 57, 67, 77, 87, 97];\n    for (const b of breathers) {\n      const level = LEVELS[b - 1];\n      expect(level.isBreather).toBe(true);\n    }\n  });\n\n  it('figures count stays within bounds', () => {\n    for (const level of LEVELS) {\n      expect(level.figuresCount).toBeGreaterThanOrEqual(8);\n      expect(level.figuresCount).toBeLessThanOrEqual(40);\n    }\n  });\n\n  it('speed multiplier stays within bounds', () => {\n    for (const level of LEVELS) {\n      expect(level.speedMultiplier).toBeGreaterThanOrEqual(1);\n      expect(level.speedMultiplier).toBeLessThanOrEqual(2.9);\n    }\n  });\n});\n\ndescribe('BACTERIA_TEMPLATES', () => {\n  it('has at least 10 templates', () => {\n    expect(BACTERIA_TEMPLATES.length).toBeGreaterThanOrEqual(10);\n  });\n\n  it('all templates have unique ids', () => {\n    const ids = BACTERIA_TEMPLATES.map(t => t.id);\n    const uniqueIds = new Set(ids);\n    expect(uniqueIds.size).toBe(ids.length);\n  });\n\n  it('all templates have valid rarity', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(['common', 'rare', 'epic']).toContain(template.rarity);\n    }\n  });\n\n  it('all templates have positive coin value', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(template.coinValue).toBeGreaterThan(0);\n    }\n  });\n\n  it('all templates have at least one shape', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(template.shapes.length).toBeGreaterThan(0);\n    }\n  });\n\n  it('all templates have valid vibration patterns', () => {\n    const validPatterns = ['horizontal', 'vertical', 'circular', 'pulse', 'diagonal'];\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(validPatterns).toContain(template.vibrationPattern);\n    }\n  });\n\n  it('all templates have positive vibration speed', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(template.vibrationSpeed).toBeGreaterThan(0);\n    }\n  });\n\n  it('all templates have names', () => {\n    for (const template of BACTERIA_TEMPLATES) {\n      expect(template.name).toBeDefined();\n      expect(template.name.length).toBeGreaterThan(0);\n    }\n  });\n});\n\ndescribe('BOMB_TEMPLATE', () => {\n  it('has bomb id', () => {\n    expect(BOMB_TEMPLATE.id).toBe('bomb');\n  });\n\n  it('has shapes', () => {\n    expect(BOMB_TEMPLATE.shapes.length).toBeGreaterThan(0);\n  });\n\n  it('has valid vibration properties', () => {\n    expect(BOMB_TEMPLATE.vibrationSpeed).toBeGreaterThan(0);\n    expect(BOMB_TEMPLATE.vibrationAmplitude).toBeGreaterThanOrEqual(0);\n  });\n});\n","path":null,"size_bytes":8023,"size_tokens":null},"vitest.config.ts":{"content":"import { defineConfig } from 'vitest/config';\nimport path from 'path';\n\nexport default defineConfig({\n  test: {\n    globals: true,\n    environment: 'node',\n    include: ['**/__tests__/**/*.test.ts'],\n    exclude: ['node_modules', '.cache'],\n    testTimeout: 30000,\n    hookTimeout: 30000,\n  },\n  resolve: {\n    alias: {\n      '@': path.resolve(__dirname, './client/src'),\n      '@shared': path.resolve(__dirname, './shared'),\n    },\n  },\n});\n","path":null,"size_bytes":442,"size_tokens":null},"client/src/lib/__tests__/endless-mode.test.ts":{"content":"import { describe, it, expect, beforeEach, vi, afterEach } from 'vitest';\n\nconst mockStorage: Record<string, string> = {};\nvi.stubGlobal('localStorage', {\n  getItem: vi.fn((key: string) => mockStorage[key] || null),\n  setItem: vi.fn((key: string, value: string) => { mockStorage[key] = value; }),\n  removeItem: vi.fn((key: string) => { delete mockStorage[key]; }),\n  clear: vi.fn(() => { Object.keys(mockStorage).forEach(k => delete mockStorage[k]); }),\n});\nvi.stubGlobal('navigator', { userAgent: 'Mozilla/5.0 (Test) Chrome/100.0' });\nvi.stubGlobal('window', {\n  setInterval: setInterval,\n  clearInterval: clearInterval,\n  setTimeout: setTimeout,\n  clearTimeout: clearTimeout,\n});\n\nvi.mock('../engagement-service', () => ({\n  engagementService: {\n    initialize: vi.fn(),\n    setAuthenticated: vi.fn(),\n    onAchievementUnlocked: vi.fn(() => () => {}),\n    recordPlacement: vi.fn(),\n    recordLevelComplete: vi.fn(),\n    recordCoinsEarned: vi.fn(),\n    recordEndlessWave: vi.fn(),\n    recordBombUsed: vi.fn(),\n  },\n}));\n\nimport { useGameStore } from '../store';\n\ndescribe('Endless Mode', () => {\n  beforeEach(() => {\n    vi.useFakeTimers();\n    useGameStore.setState({\n      gameState: 'MENU',\n      isEndlessMode: false,\n      endlessWave: 1,\n      endlessScore: 0,\n      endlessHighScore: 100,\n      endlessBestWave: 5,\n      score: 0,\n      coins: 1000,\n      upgrades: {\n        bombCount: 1,\n        figureSize: 1,\n        queueSize: 1,\n        timeBonus: 1,\n        placementBonus: 1,\n        slowMo: 1,\n        shield: 0,\n        coinBoost: 1,\n        lucky: 1,\n        secondChance: 0,\n      },\n      timerInterval: null,\n    });\n  });\n\n  afterEach(() => {\n    const state = useGameStore.getState();\n    if (state.timerInterval) {\n      clearInterval(state.timerInterval);\n      useGameStore.setState({ timerInterval: null });\n    }\n    vi.useRealTimers();\n  });\n\n  describe('startEndlessMode', () => {\n    it('sets isEndlessMode to true', () => {\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().isEndlessMode).toBe(true);\n    });\n\n    it('sets game state to ENDLESS_PLAYING', () => {\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().gameState).toBe('ENDLESS_PLAYING');\n    });\n\n    it('resets wave to 1', () => {\n      useGameStore.setState({ endlessWave: 10 });\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().endlessWave).toBe(1);\n    });\n\n    it('resets endless score to 0', () => {\n      useGameStore.setState({ endlessScore: 500 });\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().endlessScore).toBe(0);\n    });\n\n    it('sets high totalFigures for endless play', () => {\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().totalFigures).toBe(999999);\n    });\n\n    it('generates figure queue', () => {\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().figureQueue.length).toBeGreaterThan(0);\n    });\n\n    it('sets currentFigureId', () => {\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().currentFigureId).not.toBeNull();\n    });\n\n    it('clears placed figures', () => {\n      useGameStore.setState({ placedFigures: [{ id: 'test', x: 0, y: 0 }] as any });\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().placedFigures).toEqual([]);\n    });\n\n    it('applies time bonus upgrade', () => {\n      useGameStore.setState({ \n        upgrades: { ...useGameStore.getState().upgrades, timeBonus: 3 }\n      });\n      useGameStore.getState().startEndlessMode();\n      expect(useGameStore.getState().timeRemaining).toBe(60 + 6);\n    });\n\n    it('applies bomb count upgrade', () => {\n      useGameStore.setState({ \n        upgrades: { ...useGameStore.getState().upgrades, bombCount: 3 }\n      });\n      useGameStore.getState().startEndlessMode();\n      // Formula: STARTING_BOMBS (2) + (bombCount - 1) = 2 + 2 = 4\n      expect(useGameStore.getState().bombsRemaining).toBe(4);\n    });\n  });\n\n  describe('advanceEndlessWave', () => {\n    beforeEach(() => {\n      useGameStore.getState().startEndlessMode();\n      useGameStore.setState({ score: 50, figureQueue: ['blobby', 'grumpus'] });\n    });\n\n    it('increments wave number', () => {\n      const initialWave = useGameStore.getState().endlessWave;\n      useGameStore.getState().advanceEndlessWave();\n      expect(useGameStore.getState().endlessWave).toBe(initialWave + 1);\n    });\n\n    it('accumulates score into endlessScore', () => {\n      useGameStore.setState({ endlessScore: 100, score: 50 });\n      useGameStore.getState().advanceEndlessWave();\n      expect(useGameStore.getState().endlessScore).toBe(150);\n    });\n\n    it('adds time bonus on wave advance', () => {\n      const initialTime = useGameStore.getState().timeRemaining;\n      useGameStore.getState().advanceEndlessWave();\n      expect(useGameStore.getState().timeRemaining).toBe(initialTime + 30);\n    });\n\n    it('adds more figures to queue', () => {\n      const initialQueueLength = useGameStore.getState().figureQueue.length;\n      useGameStore.getState().advanceEndlessWave();\n      expect(useGameStore.getState().figureQueue.length).toBeGreaterThan(initialQueueLength);\n    });\n\n    it('sets wave notification', () => {\n      useGameStore.getState().advanceEndlessWave();\n      expect(useGameStore.getState().notification).toContain('WAVE');\n    });\n  });\n\n  describe('Endless Mode High Score Tracking', () => {\n    it('preserves endlessHighScore', () => {\n      useGameStore.setState({ endlessHighScore: 500 });\n      expect(useGameStore.getState().endlessHighScore).toBe(500);\n    });\n\n    it('preserves endlessBestWave', () => {\n      useGameStore.setState({ endlessBestWave: 10 });\n      expect(useGameStore.getState().endlessBestWave).toBe(10);\n    });\n  });\n});\n","path":null,"size_bytes":5893,"size_tokens":null},"client/src/lib/__tests__/achievements.test.ts":{"content":"import { describe, it, expect } from 'vitest';\nimport { ACHIEVEMENTS, AchievementDef } from '../game-constants';\n\ndescribe('Achievement System', () => {\n  describe('ACHIEVEMENTS definitions', () => {\n    it('has achievements defined', () => {\n      expect(ACHIEVEMENTS.length).toBeGreaterThan(0);\n    });\n\n    it('all achievements have unique ids', () => {\n      const ids = ACHIEVEMENTS.map(a => a.id);\n      const uniqueIds = new Set(ids);\n      expect(uniqueIds.size).toBe(ids.length);\n    });\n\n    it('all achievements have required properties', () => {\n      for (const achievement of ACHIEVEMENTS) {\n        expect(achievement.id).toBeDefined();\n        expect(achievement.name).toBeDefined();\n        expect(achievement.description).toBeDefined();\n        expect(achievement.category).toBeDefined();\n        expect(achievement.tier).toBeDefined();\n        expect(achievement.requirement).toBeDefined();\n        expect(achievement.coinReward).toBeDefined();\n        expect(achievement.badgeIcon).toBeDefined();\n        expect(achievement.trackingKey).toBeDefined();\n      }\n    });\n\n    it('all achievements have valid categories', () => {\n      const validCategories = ['mastery', 'collection', 'social', 'challenge'];\n      for (const achievement of ACHIEVEMENTS) {\n        expect(validCategories).toContain(achievement.category);\n      }\n    });\n\n    it('all achievements have valid tiers (1-3)', () => {\n      for (const achievement of ACHIEVEMENTS) {\n        expect(achievement.tier).toBeGreaterThanOrEqual(1);\n        expect(achievement.tier).toBeLessThanOrEqual(3);\n      }\n    });\n\n    it('all achievements have positive requirements', () => {\n      for (const achievement of ACHIEVEMENTS) {\n        expect(achievement.requirement).toBeGreaterThan(0);\n      }\n    });\n\n    it('all achievements have positive coin rewards', () => {\n      for (const achievement of ACHIEVEMENTS) {\n        expect(achievement.coinReward).toBeGreaterThan(0);\n      }\n    });\n\n    it('all achievements have badge icons', () => {\n      for (const achievement of ACHIEVEMENTS) {\n        expect(achievement.badgeIcon.length).toBeGreaterThan(0);\n      }\n    });\n  });\n\n  describe('Achievement Categories', () => {\n    it('has mastery achievements', () => {\n      const mastery = ACHIEVEMENTS.filter(a => a.category === 'mastery');\n      expect(mastery.length).toBeGreaterThan(0);\n    });\n\n    it('has collection achievements', () => {\n      const collection = ACHIEVEMENTS.filter(a => a.category === 'collection');\n      expect(collection.length).toBeGreaterThan(0);\n    });\n\n    it('has social achievements', () => {\n      const social = ACHIEVEMENTS.filter(a => a.category === 'social');\n      expect(social.length).toBeGreaterThan(0);\n    });\n\n    it('has challenge achievements', () => {\n      const challenge = ACHIEVEMENTS.filter(a => a.category === 'challenge');\n      expect(challenge.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Achievement Tracking Keys', () => {\n    it('uses valid tracking keys', () => {\n      const validKeys = [\n        'totalPlacements',\n        'totalCoinsEarned',\n        'highestLevel',\n        'dailyOrdersCompleted',\n        'endlessBestWave',\n        'bombsUsed',\n      ];\n      \n      for (const achievement of ACHIEVEMENTS) {\n        expect(validKeys).toContain(achievement.trackingKey);\n      }\n    });\n\n    it('has placement-based achievements', () => {\n      const placementAchievements = ACHIEVEMENTS.filter(\n        a => a.trackingKey === 'totalPlacements'\n      );\n      expect(placementAchievements.length).toBeGreaterThan(0);\n    });\n\n    it('has coin-based achievements', () => {\n      const coinAchievements = ACHIEVEMENTS.filter(\n        a => a.trackingKey === 'totalCoinsEarned'\n      );\n      expect(coinAchievements.length).toBeGreaterThan(0);\n    });\n\n    it('has level-based achievements', () => {\n      const levelAchievements = ACHIEVEMENTS.filter(\n        a => a.trackingKey === 'highestLevel'\n      );\n      expect(levelAchievements.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Achievement Tiers and Rewards', () => {\n    it('tier 1 achievements have lower rewards than tier 3', () => {\n      const tier1 = ACHIEVEMENTS.filter(a => a.tier === 1);\n      const tier3 = ACHIEVEMENTS.filter(a => a.tier === 3);\n      \n      if (tier1.length > 0 && tier3.length > 0) {\n        const avgTier1 = tier1.reduce((sum, a) => sum + a.coinReward, 0) / tier1.length;\n        const avgTier3 = tier3.reduce((sum, a) => sum + a.coinReward, 0) / tier3.length;\n        expect(avgTier3).toBeGreaterThan(avgTier1);\n      }\n    });\n\n    it('same tracking key achievements have progressive requirements', () => {\n      const placementAchievements = ACHIEVEMENTS\n        .filter(a => a.trackingKey === 'totalPlacements')\n        .sort((a, b) => a.requirement - b.requirement);\n      \n      for (let i = 1; i < placementAchievements.length; i++) {\n        expect(placementAchievements[i].requirement)\n          .toBeGreaterThan(placementAchievements[i - 1].requirement);\n      }\n    });\n  });\n\n  describe('Specific Achievements', () => {\n    it('has first placement achievement', () => {\n      const firstPlacement = ACHIEVEMENTS.find(a => a.id === 'first_placement');\n      expect(firstPlacement).toBeDefined();\n      expect(firstPlacement?.requirement).toBe(1);\n    });\n\n    it('has level completion achievements for all 7 levels', () => {\n      const level7 = ACHIEVEMENTS.find(a => a.id === 'level_7');\n      expect(level7).toBeDefined();\n      expect(level7?.requirement).toBe(7);\n    });\n\n    it('has daily order achievements', () => {\n      const dailyAchievements = ACHIEVEMENTS.filter(\n        a => a.trackingKey === 'dailyOrdersCompleted'\n      );\n      expect(dailyAchievements.length).toBeGreaterThan(0);\n    });\n\n    it('has endless mode achievements', () => {\n      const endlessAchievements = ACHIEVEMENTS.filter(\n        a => a.trackingKey === 'endlessBestWave'\n      );\n      expect(endlessAchievements.length).toBeGreaterThan(0);\n    });\n  });\n});\n","path":null,"size_bytes":6009,"size_tokens":null},"client/src/lib/__tests__/bomb-mechanics.test.ts":{"content":"import { describe, it, expect, beforeEach, vi } from 'vitest';\n\nconst mockStorage: Record<string, string> = {};\nvi.stubGlobal('localStorage', {\n  getItem: vi.fn((key: string) => mockStorage[key] || null),\n  setItem: vi.fn((key: string, value: string) => { mockStorage[key] = value; }),\n  removeItem: vi.fn((key: string) => { delete mockStorage[key]; }),\n  clear: vi.fn(() => { Object.keys(mockStorage).forEach(k => delete mockStorage[k]); }),\n});\nvi.stubGlobal('navigator', { userAgent: 'Mozilla/5.0 (Test) Chrome/100.0' });\n\nvi.mock('../engagement-service', () => ({\n  engagementService: {\n    initialize: vi.fn(),\n    setAuthenticated: vi.fn(),\n    onAchievementUnlocked: vi.fn(() => () => {}),\n    recordPlacement: vi.fn(),\n    recordLevelComplete: vi.fn(),\n    recordCoinsEarned: vi.fn(),\n    recordEndlessWave: vi.fn(),\n    recordBombUsed: vi.fn(),\n  },\n}));\n\nimport { useGameStore } from '../store';\nimport { FigureInstance } from '../game-constants';\n\nconst createFigure = (id: string, x: number, y: number): FigureInstance => ({\n  id,\n  templateId: 'blobby',\n  x,\n  y,\n  rotation: 0,\n  scale: 1,\n  vibrationOffset: 0,\n  isPlaced: true,\n});\n\ndescribe('Bomb Mechanics', () => {\n  beforeEach(() => {\n    useGameStore.setState({\n      gameState: 'PLAYING',\n      bombsRemaining: 3,\n      bombTargetingMode: false,\n      placedFigures: [],\n      figuresPlaced: 0,\n    });\n  });\n\n  describe('toggleBombTargeting', () => {\n    it('enables bomb targeting when bombs available', () => {\n      useGameStore.setState({ bombsRemaining: 2, bombTargetingMode: false });\n      useGameStore.getState().toggleBombTargeting();\n      expect(useGameStore.getState().bombTargetingMode).toBe(true);\n    });\n\n    it('disables bomb targeting when already enabled', () => {\n      useGameStore.setState({ bombsRemaining: 2, bombTargetingMode: true });\n      useGameStore.getState().toggleBombTargeting();\n      expect(useGameStore.getState().bombTargetingMode).toBe(false);\n    });\n\n    it('does not enable when no bombs remaining', () => {\n      useGameStore.setState({ bombsRemaining: 0, bombTargetingMode: false });\n      useGameStore.getState().toggleBombTargeting();\n      expect(useGameStore.getState().bombTargetingMode).toBe(false);\n    });\n  });\n\n  describe('detonateBombAt', () => {\n    it('clears figures within blast radius', () => {\n      const figures = [\n        createFigure('fig1', 100, 100),\n        createFigure('fig2', 120, 120),\n        createFigure('fig3', 500, 500),\n      ];\n      \n      useGameStore.setState({\n        placedFigures: figures,\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n        figuresPlaced: 3,\n      });\n      \n      const result = useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(result.success).toBe(true);\n      expect(result.cleared).toBe(2);\n      expect(useGameStore.getState().placedFigures).toHaveLength(1);\n    });\n\n    it('decrements bombs remaining', () => {\n      useGameStore.setState({\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n      });\n      \n      useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(useGameStore.getState().bombsRemaining).toBe(2);\n    });\n\n    it('disables targeting mode after detonation', () => {\n      useGameStore.setState({\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n      });\n      \n      useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(useGameStore.getState().bombTargetingMode).toBe(false);\n    });\n\n    it('fails when not in targeting mode', () => {\n      useGameStore.setState({\n        bombsRemaining: 3,\n        bombTargetingMode: false,\n      });\n      \n      const result = useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(result.success).toBe(false);\n    });\n\n    it('fails when no bombs remaining', () => {\n      useGameStore.setState({\n        bombsRemaining: 0,\n        bombTargetingMode: true,\n      });\n      \n      const result = useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(result.success).toBe(false);\n    });\n\n    it('updates figuresPlaced count', () => {\n      const figures = [\n        createFigure('fig1', 100, 100),\n        createFigure('fig2', 110, 110),\n      ];\n      \n      useGameStore.setState({\n        placedFigures: figures,\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n        figuresPlaced: 5,\n      });\n      \n      useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(useGameStore.getState().figuresPlaced).toBe(3);\n    });\n\n    it('sets notification on detonation', () => {\n      useGameStore.setState({\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n      });\n      \n      useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(useGameStore.getState().notification).toContain('BOOM');\n    });\n\n    it('clears nothing when no figures in range', () => {\n      const figures = [createFigure('fig1', 500, 500)];\n      \n      useGameStore.setState({\n        placedFigures: figures,\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n        figuresPlaced: 1,\n      });\n      \n      const result = useGameStore.getState().detonateBombAt(100, 100);\n      \n      expect(result.cleared).toBe(0);\n      expect(useGameStore.getState().placedFigures).toHaveLength(1);\n    });\n  });\n\n  describe('Blast Radius', () => {\n    it('uses 150px blast radius', () => {\n      const figures = [\n        createFigure('near', 100, 100),\n        createFigure('edge', 249, 100),\n        createFigure('far', 251, 100),\n      ];\n      \n      useGameStore.setState({\n        placedFigures: figures,\n        bombsRemaining: 3,\n        bombTargetingMode: true,\n      });\n      \n      useGameStore.getState().detonateBombAt(100, 100);\n      \n      const remaining = useGameStore.getState().placedFigures;\n      expect(remaining.some(f => f.id === 'far')).toBe(true);\n    });\n  });\n});\n","path":null,"size_bytes":5883,"size_tokens":null},"client/src/lib/__tests__/upgrades.test.ts":{"content":"import { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { UPGRADE_COSTS, UPGRADE_MAX_LEVELS } from '../store';\n\ntype UpgradeType = keyof typeof UPGRADE_COSTS;\n\nconst mockStorage: Record<string, string> = {};\nvi.stubGlobal('localStorage', {\n  getItem: vi.fn((key: string) => mockStorage[key] || null),\n  setItem: vi.fn((key: string, value: string) => { mockStorage[key] = value; }),\n  removeItem: vi.fn((key: string) => { delete mockStorage[key]; }),\n  clear: vi.fn(() => { Object.keys(mockStorage).forEach(k => delete mockStorage[k]); }),\n});\nvi.stubGlobal('navigator', { userAgent: 'Mozilla/5.0 (Test) Chrome/100.0' });\n\nvi.mock('../engagement-service', () => ({\n  engagementService: {\n    initialize: vi.fn(),\n    setAuthenticated: vi.fn(),\n    onAchievementUnlocked: vi.fn(() => () => {}),\n    recordPlacement: vi.fn(),\n    recordLevelComplete: vi.fn(),\n    recordCoinsEarned: vi.fn(),\n    recordEndlessWave: vi.fn(),\n    recordBombUsed: vi.fn(),\n  },\n}));\n\nimport { useGameStore } from '../store';\n\ndescribe('Upgrade System', () => {\n  beforeEach(() => {\n    useGameStore.setState({\n      coins: 10000,\n      upgrades: {\n        bombCount: 1,\n        figureSize: 1,\n        queueSize: 1,\n        timeBonus: 1,\n        placementBonus: 1,\n        slowMo: 1,\n        shield: 0,\n        coinBoost: 1,\n        lucky: 1,\n        secondChance: 0,\n      },\n    });\n    Object.keys(mockStorage).forEach(k => delete mockStorage[k]);\n  });\n\n  describe('UPGRADE_COSTS', () => {\n    it('has costs for all upgrade types', () => {\n      const upgradeTypes: UpgradeType[] = [\n        'bombCount', 'figureSize', 'queueSize', 'timeBonus',\n        'placementBonus', 'slowMo', 'shield', 'coinBoost', 'lucky', 'secondChance'\n      ];\n      \n      for (const type of upgradeTypes) {\n        expect(UPGRADE_COSTS[type]).toBeDefined();\n        expect(UPGRADE_COSTS[type]).toBeGreaterThan(0);\n      }\n    });\n\n    it('has reasonable cost progression', () => {\n      // Tiered pricing: Core (80-120), Power (150-200), Premium (220+)\n      expect(UPGRADE_COSTS.queueSize).toBe(80);      // Core tier\n      expect(UPGRADE_COSTS.timeBonus).toBe(100);     // Core tier\n      expect(UPGRADE_COSTS.coinBoost).toBe(120);     // Core tier\n      expect(UPGRADE_COSTS.figureSize).toBe(150);    // Power tier\n      expect(UPGRADE_COSTS.bombCount).toBe(220);     // Premium tier\n      expect(UPGRADE_COSTS.shield).toBe(220);        // Consumable\n      expect(UPGRADE_COSTS.secondChance).toBe(360);  // Most valuable consumable\n    });\n  });\n\n  describe('UPGRADE_MAX_LEVELS', () => {\n    it('has max levels for all upgrade types', () => {\n      const upgradeTypes: UpgradeType[] = [\n        'bombCount', 'figureSize', 'queueSize', 'timeBonus',\n        'placementBonus', 'slowMo', 'shield', 'coinBoost', 'lucky', 'secondChance'\n      ];\n      \n      for (const type of upgradeTypes) {\n        expect(UPGRADE_MAX_LEVELS[type]).toBeDefined();\n        expect(UPGRADE_MAX_LEVELS[type]).toBeGreaterThan(0);\n      }\n    });\n\n    it('consumables have high max levels', () => {\n      expect(UPGRADE_MAX_LEVELS.shield).toBe(99);\n      expect(UPGRADE_MAX_LEVELS.secondChance).toBe(99);\n    });\n\n    it('regular upgrades have limited max levels', () => {\n      expect(UPGRADE_MAX_LEVELS.bombCount).toBe(5);\n      expect(UPGRADE_MAX_LEVELS.figureSize).toBe(5);\n      expect(UPGRADE_MAX_LEVELS.queueSize).toBe(4);\n      expect(UPGRADE_MAX_LEVELS.timeBonus).toBe(3);\n    });\n  });\n\n  describe('buyUpgrade', () => {\n    it('successfully purchases upgrade when affordable', () => {\n      const initialCoins = useGameStore.getState().coins;\n      const result = useGameStore.getState().buyUpgrade('bombCount');\n      \n      expect(result).toBe(true);\n      expect(useGameStore.getState().upgrades.bombCount).toBe(2);\n      expect(useGameStore.getState().coins).toBeLessThan(initialCoins);\n    });\n\n    it('fails when not enough coins', () => {\n      useGameStore.setState({ coins: 0 });\n      const result = useGameStore.getState().buyUpgrade('bombCount');\n      \n      expect(result).toBe(false);\n      expect(useGameStore.getState().upgrades.bombCount).toBe(1);\n    });\n\n    it('calculates scaled cost for leveled upgrades', () => {\n      useGameStore.setState({ \n        coins: 10000,\n        upgrades: { ...useGameStore.getState().upgrades, bombCount: 3 }\n      });\n      \n      const initialCoins = useGameStore.getState().coins;\n      useGameStore.getState().buyUpgrade('bombCount');\n      const spent = initialCoins - useGameStore.getState().coins;\n      \n      expect(spent).toBe(UPGRADE_COSTS.bombCount * 3);\n    });\n\n    it('uses flat cost for consumables', () => {\n      const initialCoins = useGameStore.getState().coins;\n      useGameStore.getState().buyUpgrade('shield');\n      const spent = initialCoins - useGameStore.getState().coins;\n      \n      expect(spent).toBe(UPGRADE_COSTS.shield);\n    });\n\n    it('allows multiple consumable purchases', () => {\n      useGameStore.getState().buyUpgrade('shield');\n      useGameStore.getState().buyUpgrade('shield');\n      useGameStore.getState().buyUpgrade('shield');\n      \n      expect(useGameStore.getState().upgrades.shield).toBe(3);\n    });\n\n    it('blocks purchase at max level for non-consumables', () => {\n      useGameStore.setState({ \n        upgrades: { ...useGameStore.getState().upgrades, bombCount: 5 }\n      });\n      \n      const result = useGameStore.getState().buyUpgrade('bombCount');\n      expect(result).toBe(false);\n    });\n\n    it('allows consumable purchase beyond typical max', () => {\n      useGameStore.setState({ \n        upgrades: { ...useGameStore.getState().upgrades, shield: 50 }\n      });\n      \n      const result = useGameStore.getState().buyUpgrade('shield');\n      expect(result).toBe(true);\n      expect(useGameStore.getState().upgrades.shield).toBe(51);\n    });\n  });\n\n  describe('Skill Consumables', () => {\n    it('buySkillConsumable purchases freeze', () => {\n      useGameStore.setState({ coins: 1000, freezeCount: 0 });\n      const result = useGameStore.getState().buySkillConsumable('freeze');\n      \n      expect(result).toBe(true);\n      expect(useGameStore.getState().freezeCount).toBe(1);\n    });\n\n    it('buySkillConsumable purchases cleanser', () => {\n      useGameStore.setState({ coins: 1000, cleanserCount: 0 });\n      const result = useGameStore.getState().buySkillConsumable('cleanser');\n      \n      expect(result).toBe(true);\n      expect(useGameStore.getState().cleanserCount).toBe(1);\n    });\n\n    it('buySkillConsumable fails without enough coins', () => {\n      useGameStore.setState({ coins: 0, freezeCount: 0 });\n      const result = useGameStore.getState().buySkillConsumable('freeze');\n      \n      expect(result).toBe(false);\n      expect(useGameStore.getState().freezeCount).toBe(0);\n    });\n  });\n});\n","path":null,"size_bytes":6790,"size_tokens":null},"client/public/sw.js":{"content":"const CACHE_NAME = 'kikteria-v8';\nconst STATIC_ASSETS = [\n  '/',\n  '/index.html',\n  '/manifest.json',\n  '/icon-192.svg',\n  '/icon-512.svg'\n];\n\nconst OFFLINE_PAGE = `<!DOCTYPE html>\n<html><head><title>Kikteria - Offline</title>\n<style>body{background:#0a0a1a;color:#00ff88;font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;text-align:center}\nh1{font-size:2rem}p{color:#888}</style></head>\n<body><div><h1>You're Offline</h1><p>Please check your connection and try again.</p></div></body></html>`;\n\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(CACHE_NAME).then((cache) => {\n      return cache.addAll(STATIC_ASSETS).catch(() => {});\n    })\n  );\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames\n          .filter((name) => name !== CACHE_NAME)\n          .map((name) => caches.delete(name))\n      );\n    })\n  );\n  self.clients.claim();\n});\n\nself.addEventListener('fetch', (event) => {\n  if (event.request.method !== 'GET') return;\n  \n  const url = new URL(event.request.url);\n  \n  if (url.pathname.startsWith('/api/')) {\n    event.respondWith(\n      fetch(event.request).catch(() => {\n        return new Response(JSON.stringify({ error: 'Offline' }), {\n          status: 503,\n          headers: { 'Content-Type': 'application/json' }\n        });\n      })\n    );\n    return;\n  }\n  \n  event.respondWith(\n    caches.match(event.request).then((cached) => {\n      if (cached) return cached;\n      \n      return fetch(event.request).then((response) => {\n        if (response.ok) {\n          const clone = response.clone();\n          caches.open(CACHE_NAME).then((cache) => {\n            cache.put(event.request, clone);\n          });\n        }\n        return response;\n      }).catch(() => {\n        if (event.request.mode === 'navigate') {\n          return new Response(OFFLINE_PAGE, {\n            status: 200,\n            headers: { 'Content-Type': 'text/html' }\n          });\n        }\n        return new Response('Offline', { status: 503 });\n      });\n    })\n  );\n});\n","path":null,"size_bytes":2176,"size_tokens":null}},"version":2}